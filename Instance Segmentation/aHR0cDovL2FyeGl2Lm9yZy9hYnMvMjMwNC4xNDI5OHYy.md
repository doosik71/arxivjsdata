# Instance Segmentation in the Dark

Linwei Chen, Ying Fu, Kaixuan Wei, Dezhi Zheng, Felix Heide

## 🧩 Problem to Solve

기존 인스턴스 분할 기술은 주로 가시성이 좋은 환경에 맞춰져 있어, 극도로 낮은 조명 환경에서는 성능이 크게 저하됩니다. 낮은 조명 이미지의 노이즈는 신경망의 특징 맵에 고주파 교란($\text{feature noise}$)을 유발하여 인스턴스 분할의 정확도를 심각하게 떨어뜨립니다. 또한, 저조도 인스턴스 분할을 위한 전용 방법론이나 데이터셋이 부족하여 기존 이미지 전처리(강화/노이즈 제거) 후 인스턴스 분할을 수행하는 방식은 계산 비용과 지연 시간을 증가시키고, 극심한 저조도에서는 이미지 세부 정보의 영구적인 손실로 인해 한계가 명확합니다.

## ✨ Key Contributions

* 저조도에서 발생하는 깊은 특징 내 고주파 교란을 해결하기 위한 **적응형 가중치 다운샘플링 레이어($\text{Adaptive Weighted Downsampling layer, AWD}$)**, **스무스 지향 컨볼루션 블록($\text{Smooth-Oriented Convolutional Block, SCB}$)**, 그리고 **교란 억제 학습($\text{Disturbance Suppression Learning, DSL}$)** 기법을 제안했습니다. 이 기법들은 일반 조명 인스턴스 분할에도 이점을 제공합니다.
* 저조도 인스턴스 분할을 위해 $\text{RAW}$ 입력 설계의 잠재력을 탐구하고, 기존 데이터셋으로부터 사실적인 저조도 $\text{RAW}$ 이미지를 생성하는 **저조도 $\text{RAW}$ 합성 파이프라인($\text{low-light RAW synthetic pipeline}$)**을 활용하여 $\text{RAW}$ 입력 인스턴스 분할 모델의 종단 간($\text{end-to-end}$) 학습을 가능하게 했습니다.
* 정확한 픽셀 단위 인스턴스 라벨이 있는 실세계 저조도 데이터셋인 **LIS ($\text{Low-light Instance Segmentation}$)** 데이터셋을 수집하여 공개했습니다. 이 데이터셋은 2천 개 이상의 장면을 포함하며, 저조도 환경에서의 인스턴스 분할 벤치마크 역할을 합니다.
* 어떠한 이미지 전처리 없이도 기존 최첨단 기술보다 4% $\text{AP}$ 더 높은 만족스러운 성능을 달성했습니다.

## 📎 Related Works

* **일반 인스턴스 분할**: $\text{Mask R-CNN}$ ($\text{He et al., 2017}$), $\text{YOLACT}$ ($\text{Bolya et al., 2019}$) 등 딥러닝 기반 방법들이 고조명 환경에서 상당한 발전을 이루었으나 저조도 조건은 간과했습니다.
* **저조도 + 분할/인식**: 저조도 이미지 강화 ($\text{Chen et al., 2018}$), 이미지 노이즈 제거 ($\text{Gu et al., 2019}$) 기법을 전처리 단계로 활용하는 접근 방식이 있었으나, 계산 비용과 정보 손실 문제가 있습니다. $\text{QIS}$를 사용한 분류 ($\text{Gnanasambandam and Chan, 2020}$), $\text{Anscombe networks}$ ($\text{Diamond et al., 2021}$)를 사용한 검출 등 연구가 초기 단계입니다.
* **저조도 합성**: $\text{Retinex-Net}$ ($\text{Wei et al., 2018}$), $\text{GLADNet}$ ($\text{Wang et al., 2018a}$) 등 기존 이미지를 조작하여 저조도 이미지를 합성하는 연구가 있었으나, 현실적인 노이즈 모델링이나 $\text{RAW}$ 이미지 합성에 한계가 있었습니다. 본 연구에서는 비처리($\text{unprocessing}$) 및 물리 기반 노이즈 모델 ($\text{Wei et al., 2020}$)을 활용합니다.
* **저조도 인스턴스 분할 데이터셋**: $\text{PASCAL VOC}$, $\text{COCO}$ 등 일반적인 데이터셋은 저조도를 고려하지 않았으며, 야간 검출/분할 데이터셋은 극심한 저조도와 픽셀 단위 인스턴스 라벨이 부족했습니다.

## 🛠️ Methodology

본 연구는 저조도 $\text{RAW}$ 이미지 입력에 대한 종단 간 인스턴스 분할 프레임워크를 제안하며, 핵심적으로 세 가지 아키텍처 및 학습 기법과 하나의 데이터 합성 파이프라인으로 구성됩니다.

1. **저조도 $\text{RAW}$ 합성 파이프라인**:
    * **비처리($\text{Unprocessing}$)**: $\text{sRGB}$ 이미지를 $\text{RAW}$ 이미지로 역변환하여 기존 $\text{sRGB}$ 데이터셋을 $\text{RAW}$ 데이터셋으로 활용합니다.
    * **노이즈 주입($\text{Noise Injection}$)**: 물리 기반 노이즈 모델 ($\text{Wei et al., 2020}$)을 사용하여 광자 샷 노이즈, 판독 노이즈 등 실제 노이즈 구조를 정확하게 시뮬레이션하여 합성된 $\text{RAW}$ 이미지에 주입합니다.

2. **적응형 가중치 다운샘플링 레이어($\text{Adaptive Weighted Downsampling layer, AWD}$)**:
    * 신경망의 다운샘플링 과정에서 발생하는 $\text{feature noise}$를 억제하기 위해 제안됩니다.
    * 기존의 $1 \times 1$ 컨볼루션(stride=2) 대신 **콘텐츠 인지형 저주파 필터**를 학습하여 적용합니다.
    * 수학적으로는 각 공간 및 채널 위치에 대해 네트워크가 필터 가중치 $\text{W}$를 예측합니다:
        $$
        Y_{c,i,j} = \sum_{p,q \in S} W_{p,q}^{c,i,j} \cdot X_{c,i+p,j+q}
        $$
        $$
        V_{c,i,j} = \phi(X_{\Psi_{c,i,j}}), \quad T_c = \phi'(GP(X))
        $$
        $$
        W_{p,q}^{c,i,j} = \frac{\exp(V_{p,q}^{c,i,j} \cdot T_c)}{\sum_{p,q \in S} \exp(V_{p,q}^{c,i,j} \cdot T_c)}
        $$
        여기서 $GP$는 전역 풀링($\text{global pooling}$)을 나타내며, 국소 정보($\text{V}$)와 전역 정보($\text{T}$)를 결합하여 필터를 생성합니다. 이는 노이즈를 억제하면서 디테일을 보존하는 공간 및 채널 가변 필터의 생성을 가능하게 합니다.

3. **스무스 지향 컨볼루션 블록($\text{Smooth-Oriented Convolutional Block, SCB}$)**:
    * 일반적인 $3 \times 3$ 컨볼루션 레이어를 대체하여 네트워크의 강건성을 향상시킵니다.
    * 훈련 단계에서는 주 컨볼루션 브랜치와 $1 \times 1$ 컨볼루션 레이어 및 스무스 지향 컨볼루션으로 구성된 보조 브랜치를 선형 결합합니다.
    * 스무스 지향 컨볼루션은 평균 필터 또는 가우시안 필터로 초기화되고 소프트맥스 함수로 정규화되어, 고주파 특징 노이즈를 억제하는 스무스 커널을 학습합니다.
    * 추론 단계에서는 **재매개변수화($\text{re-parameterization}$)** 기법 ($\text{Ding et al., 2021}$)을 사용하여 일반 $3 \times 3$ 컨볼루션 레이어로 폴딩되어 추가 계산 비용이 없습니다.
        $$
        W'_{3 \times 3}[i,j,h,t] = W_{3 \times 3}[i,j,h,t] + (W_{1 \times 1}[i,j,1,1] * W_{\text{SConv}}[i,1,h,t])
        $$

4. **교란 억제 학습($\text{Disturbance Suppression Learning, DSL}$)**:
    * 네트워크가 노이즈의 유무에 관계없이 유사한 특징을 추출하도록 장려하여 교란 불변 특징을 학습하게 합니다.
    * 총 손실 함수는 다음과 같습니다:
        $$
        L(\theta) = L_{\text{IS}}(x;\theta) + \alpha L_{\text{IS}}(x';\theta) + \beta L_{\text{DS}}(x,x';\theta)
        $$
        여기서 $x$는 비처리된 깨끗한 합성 $\text{RAW}$ 이미지, $x'$는 노이즈가 있는 버전입니다.
        $L_{\text{IS}}$는 인스턴스 분할 손실이며, $L_{\text{DS}}$는 특징 교란 억제 손실로 다음과 같이 정의됩니다:
        $$
        L_{\text{DS}}(x,x';\theta) = \sum_{i=1}^{n} \|f^{(i)}(x;\theta) - f^{(i)}(x';\theta)\|_2^2
        $$
        이는 깨끗한 특징과 노이즈가 있는 특징 간의 유클리드 거리를 최소화하여 노이즈로 인한 특징 교란을 줄입니다.

## 📊 Results

* **$\text{RAW}$ 이미지의 중요성**: $\text{LIS}$ 데이터셋 실험 결과, 저조도 환경에서 $\text{RAW}$ 이미지가 $\text{sRGB}$ 이미지보다 훨씬 풍부한 장면 정보를 보존하며, 특히 고비트 심도($\text{high bit-depth}$)가 성능에 결정적인 영향을 미침을 확인했습니다. 8비트에서 14비트로 비트 심도가 증가할수록 $\text{AP}$가 꾸준히 향상되었습니다.
* **저조도 $\text{RAW}$ 합성 파이프라인의 효과**: $\text{Unprocessing}$과 $\text{Noise Injection}$이 각각 2.2 $\text{AP}$와 3.5 $\text{AP}$ 성능 향상을 가져왔으며, 둘을 결합했을 때 31.6 $\text{AP}$에서 38.0 $\text{AP}$로 크게 향상되어 실제 $\text{RAW}$ 데이터(39.0 $\text{AP}$)로 훈련한 결과에 매우 근접했습니다. 이는 합성 파이프라인이 사실적인 $\text{RAW}$ 이미지 생성이 가능함을 입증합니다.
* **제안된 구성 요소들의 기여**:
  * $\text{AWD}$ 레이어는 특징 교란을 효과적으로 줄여 1.3 $\text{AP}$ (LIS 훈련) 또는 1.6 $\text{AP}$ ($\text{COCO}$ 훈련) 향상을 가져왔습니다. 전통적인 저주파 필터나 주의 메커니즘보다 우수하거나 상호보완적임을 확인했습니다.
  * $\text{SCB}$는 추론 시 추가 계산 비용 없이 $0.5 \sim 0.7$ $\text{AP}$ 정도의 성능 향상을 제공했습니다.
  * $\text{DSL}$은 기존 $\text{Perceptual Loss}$보다 훨씬 큰 0.9 $\text{AP}$ (RAW-dark) 및 1.9 $\text{AP}$ (RAW-normal) 성능 향상을 달성하며 교란 불변 특징 학습에 효과적임을 입증했습니다.
* **경쟁 방법과의 비교**: 제안된 종단 간($\text{end-to-end}$) 방식은 기존의 저조도 강화/노이즈 제거 전처리 파이프라인(예: $\text{Zero-DCE + SGN}$)을 사용한 방법들보다 훨씬 높은 인스턴스 분할 정확도($\text{AP}$)를 달성했습니다 (예: 26.5 $\text{AP}$ vs. 31.8 $\text{AP}$ in Table 11). 또한, 훨씬 빠른 추론 속도를 보였습니다 (예: 34.1 $\text{FPS}$ vs. 53.1 $\text{FPS}$).
* **다양한 모델 및 백본에서의 일반화**: 제안된 방법은 $\text{PointRend}$, $\text{Mask2Former}$와 같은 다른 인스턴스 분할 모델과 $\text{Swin Transformer}$, $\text{ConvNeXt}$와 같은 백본에서도 일관되게 우수한 성능을 보였습니다. 저조도 객체 탐지($\text{Faster R-CNN}$ 기반)에서도 효과를 입증하여 일반화 능력을 시사했습니다.
* **LIS 데이터셋**: 2230쌍의 저/일반 조명 이미지를 포함하며, 8가지 일반 객체 클래스에 대한 10504개의 픽셀 단위 인스턴스 라벨을 제공합니다.

## 🧠 Insights & Discussion

* 이 연구는 저조도 인스턴스 분할 문제에 대한 포괄적인 접근 방식을 제시합니다. 특히, $\text{RAW}$ 이미지의 고비트 심도 특성과 네트워크 내부의 **"특징 노이즈"** ($\text{feature noise}$) 억제가 저조도 환경에서 높은 성능을 달성하는 데 핵심적임을 밝혀냈습니다.
* **$\text{RAW}$ 입력의 중요성**: $\text{sRGB}$와 달리 $\text{RAW}$ 데이터가 낮은 조도에서도 더 많은 원본 장면 정보를 보존하기 때문에 저조도 비전 작업에 필수적임을 정량적으로 입증했습니다. 이는 향후 저조도 이미지 처리 연구가 $\text{RAW}$ 도메인에서 이루어져야 함을 시사합니다.
* **효율적인 특징 노이즈 억제**: $\text{AWD}$, $\text{SCB}$, $\text{DSL}$은 외부 전처리 단계 없이 네트워크 자체의 강건성을 높여 종단 간($\text{end-to-end}$) 시스템의 효율성과 정확도를 동시에 향상시켰습니다. 특히 $\text{SCB}$는 추론 시 추가 비용이 없어 실용적입니다.
* **데이터셋의 기여**: $\text{LIS}$ 데이터셋은 실제 저조도 환경에서의 인스턴스 분할 연구를 위한 귀중한 벤치마크를 제공하며, 합성 파이프라인은 라벨이 부족한 $\text{RAW}$ 데이터셋의 한계를 극복하는 현실적인 대안을 제시합니다.
* **한계점**: 모든 카메라 모델이 $\text{RAW}$ 캡처를 일정한 비트 심도로 지원하므로, 다양한 비트 심도의 $\text{RAW}$ 이미지를 직접 수집하는 것은 어렵습니다. 본 연구에서는 양자화 시뮬레이션을 통해 다양한 비트 심도를 탐색했으나, 이는 직접 캡처와는 차이가 있을 수 있습니다.

## 📌 TL;DR

이 논문은 극심한 저조도 환경에서의 인스턴스 분할 문제를 해결합니다. 저조도 이미지의 노이즈가 신경망 특징 맵에 고주파 교란을 일으켜 성능을 저하시킨다는 관찰에 따라, 본 연구는 **적응형 가중치 다운샘플링 레이어($\text{AWD}$)**, **스무스 지향 컨볼루션 블록($\text{SCB}$)**, **교란 억제 학습($\text{DSL}$)**을 제안합니다. 이 기법들은 다운샘플링 및 컨볼루션 과정에서 특징 노이즈를 효과적으로 줄이고 교란 불변 특징을 학습하게 하여 모델의 강건성을 높입니다. 또한, 고비트 심도 $\text{RAW}$ 이미지의 중요성을 강조하고, 기존 $\text{sRGB}$ 데이터셋을 활용하여 현실적인 저조도 $\text{RAW}$ 이미지를 생성하는 **합성 파이프라인**을 개발했습니다. 더불어, 2천 쌍 이상의 실제 저/일반 조명 이미지와 픽셀 단위 인스턴스 라벨을 포함하는 새로운 **$\text{LIS}$ 데이터셋**을 구축했습니다. 결과적으로, 제안된 종단 간 방법은 어떠한 전처리 없이도 기존 최첨단 방법보다 4% 높은 $\text{AP}$를 달성하며, 우수한 정확도와 효율성을 입증했습니다.
