# Look Closer to Segment Better: Boundary Patch Refinement for Instance Segmentation

Chufeng Tang, Hang Chen, Xiao Li, Jianmin Li, Zhaoxiang Zhang, Xiaolin Hu

## 🧩 Problem to Solve

인스턴스 분할(Instance Segmentation) 모델들은 객체 마스크를 예측하지만, 저해상도 피처 맵과 경계 픽셀의 극히 낮은 비율로 인한 불균형 문제로 인해 예측된 마스크의 경계 정확도가 떨어진다. 이로 인해 마스크의 품질이 만족스럽지 못하고, 특히 객체 경계 부분에서 부정확한 분할이 발생하여 자율주행, 로봇 공학 등 정밀한 응용 분야에서 제약이 따른다.

## ✨ Key Contributions

* **BPR(Boundary Patch Refinement) 프레임워크 제안**: 기존 인스턴스 분할 모델의 결과물에 후처리 방식으로 적용 가능한 개념적으로 간단하지만 효과적인 경계 개선 프레임워크를 제안했다.
* **고해상도 경계 패치 정제**: 예측된 인스턴스 경계를 따라 작은 경계 패치들을 추출하고, 고해상도에서 정제하는 방식을 통해 경계 품질을 크게 향상시켰다.
* **낮은 해상도 및 경계 픽셀 불균형 문제 완화**: 경계 패치를 고해상도로 처리하고 패치 내 경계 픽셀 비율을 높여 기존 모델의 두 가지 주요 문제를 해결했다.
* **뛰어난 성능 달성**: Cityscapes 벤치마크에서 Mask R-CNN 베이스라인 대비 $AP$ 점수를 크게 향상시켰으며, 특히 경계 인식 지표에서 현저한 개선을 보였다.
* **Cityscapes 리더보드 1위 달성**: "PolyTransform + SegFix" 베이스라인에 BPR 프레임워크를 적용하여 Cityscapes 리더보드에서 $42.7\%$ $AP$로 1위를 달성했다.
* **전이성(Transferability) 입증**: Mask R-CNN 결과로 훈련된 BPR 모델이 다른 인스턴스 분할 모델(PointRend, SegFix)의 결과도 재훈련 없이 성공적으로 개선할 수 있음을 입증했다.

## 📎 Related Works

* **인스턴스 분할 (Instance Segmentation)**: Mask R-CNN [15]과 같은 투 스테이지(two-stage) 방법론과 YOLACT [3], BlendMask [4], SOLOv2 [43]와 같은 원 스테이지(one-stage) 방법론에 대한 연구가 이루어졌다. 본 연구는 특정 모델에 구애받지 않고 적용 가능하다.
* **시맨틱 분할 (Semantic Segmentation)**: FCN [29]을 시작으로, 피처 맵 해상도 증가 (dilated/atrous convolution [6, 7]), 문맥 정보 활용 (DANet [12]), 인코더-디코더 아키텍처 (U-Net [35]), 그리고 정제 기법들이 [20, 22] 연구되었다. 본 연구에서는 고해상도 표현을 유지하는 HRNetV2 [41]를 정제 네트워크로 채택했다.
* **분할 경계 정제 (Boundary Refinement for Segmentation)**: BMask R-CNN [9], Gated-SCNN [37]은 경계 인식을 위한 추가 브랜치를 사용하며, PointRend [19]는 신뢰할 수 없는 예측을 반복적으로 샘플링하여 정제한다. SegFix [50]는 후처리 방식으로 경계 픽셀의 예측을 내부 픽셀 예측으로 대체하지만, 경계 예측의 정확성에 크게 의존한다. PolyTransform [23]은 변형 네트워크를 사용하여 다각형 정점의 오프셋을 예측하지만, 계산 오버헤드가 크다.

## 🛠️ Methodology

BPR(Boundary Patch Refinement) 프레임워크는 어떤 인스턴스 분할 모델의 결과에도 적용 가능한 후처리 메커니즘이다.

1. **경계 패치 추출 (Boundary Patch Extraction)**:
    * 주어진 인스턴스 마스크에서 예측된 경계를 따라 `sliding-window` 스타일의 알고리즘으로 일련의 작은 정사각형 바운딩 박스를 밀집하게 할당한다.
    * 과도한 중복과 중복성을 줄이기 위해 비최대 억제(NMS) 알고리즘을 적용하여 패치들을 필터링한다. NMS 임계값은 속도/정확도 균형을 위해 조절 가능하다.
    * 이미지 패치와 해당 이진 마스크 패치를 모두 추출하여 다음 단계로 전달한다.

2. **경계 패치 정제 (Boundary Patch Refinement)**:
    * **마스크 패치 (Mask Patch)**: 이진 마스크 패치는 훈련 수렴을 가속화하고, 분할할 인스턴스에 대한 위치 안내를 제공하여 정제 네트워크가 처음부터 인스턴스 수준의 의미론을 학습할 필요 없이 경계 주변의 어려운 픽셀을 올바른 쪽으로 이동시키는 데 집중하도록 돕는다.
    * **경계 패치 정제 네트워크 (Boundary Patch Refinement Network)**: 추출된 각 경계 패치에 대해 이진 분할을 수행한다. 입력 채널을 4개(RGB 이미지 패치 3개, 이진 마스크 패치 1개)로, 출력 클래스를 2개로 수정하여 어떠한 시맨틱 분할 모델도 사용할 수 있다. 본 논문에서는 HRNetV2 [41]를 정제 네트워크로 채택했으며, 적절하게 입력 크기를 늘려 고해상도로 패치를 처리한다.

3. **재조합 (Reassembling)**:
    * 정제된 경계 패치들은 이전 예측을 대체하여 압축된 인스턴스 수준 마스크로 재조합된다.
    * 정제되지 않은 픽셀의 예측은 변경되지 않는다.
    * 인접한 패치의 중첩 영역의 경우, 출력 로짓을 단순히 평균화하고 $0.5$의 임계값을 적용하여 전경과 배경을 구분한다.

4. **학습 및 추론 (Learning and Inference)**:
    * 정제 네트워크는 훈련 이미지에서 추출된 경계 패치를 기반으로 훈련되며, 검증 또는 테스트 이미지에서 추론된다. 기존 인스턴스 분할 모델의 수정이나 미세 조정은 필요 없다.
    * 훈련 시에는 예측 마스크와 Ground-truth 마스크 간의 IoU(Intersection over Union) 중첩이 $0.5$보다 큰 인스턴스에서만 경계 패치를 추출한다. 추론 시에는 모든 예측 인스턴스가 유지된다.
    * 모델 출력은 픽셀 단위 이진 교차 엔트로피 손실(pixel-wise binary cross-entropy loss)을 사용하여 해당 Ground-truth 마스크 패치와 비교하여 학습된다.

## 📊 Results

* **Cityscapes 벤치마크**:
  * Mask R-CNN 베이스라인 대비 $AP$를 $4.3\%$ (val/test 모두) 향상시켰다.
  * SegFix [50]보다 훨씬 큰 폭으로 성능이 개선되었다.
  * "PolyTransform [23] + SegFix" 베이스라인에 BPR을 적용하여 Cityscapes 테스트 세트에서 $42.7\%$ $AP$를 달성, CVPR 2021 제출 마감일 기준 Cityscapes 리더보드 1위를 차지했다.
  * 경계 품질을 평가하는 $AF$ 점수에서도 Mask R-CNN 대비 $54.9$에서 $66.8$로 크게 향상되었다.
* **COCO 벤치마크**:
  * Mask R-CNN ResNeXt-FPN-101 베이스라인에 대해 $0.8\%$ $AP$ 및 LVIS [14] 고품질 주석을 사용한 $1.7\%$ $AP^{?}$ 향상을 달성했다. COCO의 거친 주석으로 인해 Cityscapes만큼 높은 개선 폭은 아니었지만, 여전히 유효성을 입증했다.
* **전이성**:
  * Mask R-CNN으로 훈련된 BPR 모델이 PointRend [19] 결과($AP: 35.6 \rightarrow 38.6$) 및 Mask R-CNN + SegFix [50] 결과($AP: 38.2 \rightarrow 40.0$)를 크게 개선하여, BPR이 다른 경계 정제 방법과도 호환됨을 보였다.
* **속도**:
  * Cityscapes 이미지 하나를 처리하는 데 약 211ms (RTX 2080Ti GPU 기준)가 소요되며, PolyTransform [23]보다 훨씬 빠르다.

## 🧠 Insights & Discussion

* **인간 분할 행동 모방**: 사람이 객체를 대략적으로 분할한 후, 고품질 마스크를 얻기 위해 경계 영역을 확대하여 정밀하게 다듬는 방식에서 영감을 얻었다. 이는 고해상도 경계 패치 정제 전략의 핵심 아이디어이다.
* **지역적 정제(Local Refinement)의 중요성**: 전체 인스턴스를 재분할하는 대신, 경계 주변의 작은 패치에 집중함으로써 저해상도 문제와 경계 픽셀 불균형 문제를 효과적으로 해결했다.
* **마스크 패치의 역할**: 마스크 패치는 정제 네트워크가 객체의 전역적인 의미론을 재학습하는 부담 없이, 경계 주변의 미묘한 시각적 단서(색상 일관성, 대비)에 집중하여 정확한 경계를 학습하도록 돕는 중요한 컨텍스트 정보를 제공한다.
* **모델-불가지론적(Model-Agnostic) 접근**: BPR은 기존 인스턴스 분할 모델에 대한 수정이나 재훈련 없이 후처리 방식으로 적용될 수 있어, 범용성이 매우 높다.
* **한계점**:
  * 초기 마스크의 경계 품질에 의존한다. 초기 예측 경계가 실제 객체 경계와 너무 멀면 최적의 마스크를 생성하기 어렵다.
  * 지역적인 경계 정제에만 집중하기 때문에, 초기 마스크가 인접한 인스턴스를 크게 과분할하는 경우, BPR 모델이 이를 하나의 인스턴스로 간주하고 오류를 확대할 수 있다.
  * COCO 데이터셋과 같이 주석 품질이 낮은 데이터셋에서는 모호한 최적화 목표로 인해 모델 수렴에 어려움이 있을 수 있다.
  * 작은 인스턴스의 경계 정제 개선폭이 큰 인스턴스에 비해 상대적으로 작다.

## 📌 TL;DR

본 논문은 인스턴스 분할의 부정확한 마스크 경계 문제를 해결하기 위해 **BPR(Boundary Patch Refinement)**이라는 개념적으로 간단하지만 효과적인 후처리 프레임워크를 제안한다. BPR은 초기 인스턴스 마스크에서 예측된 경계를 따라 작은 **경계 패치들을 추출**하고, 이를 고해상도 **정제 네트워크**를 통해 이진 분할하여 정밀하게 개선한 후 **재조합**한다. 이 방식은 저해상도 피처 맵과 경계 픽셀의 불균형 문제를 완화하여 Mask R-CNN 등 다양한 베이스라인에서 일관되고 인상적인 성능 향상을 달성했으며, Cityscapes 벤치마크에서 **새로운 SOTA를 수립**하고 리더보드 1위를 차지했다. 또한, 학습된 BPR 모델이 다른 인스턴스 분할 모델에 **재훈련 없이 전이**되어 경계 품질을 개선할 수 있음을 입증했다.
