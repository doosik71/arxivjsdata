# Gland Instance Segmentation Using Deep Multichannel Neural Networks

Yan Xu, Yang Li, Yipei Wang, Mingyuan Liu, Yubo Fan, Maode Lai, and Eric I-Chao Chang

## 🧩 Problem to Solve

이 논문은 대장 조직학 이미지에서 개별 선(gland)을 인스턴스 단위로 분할(segmentation)하는 문제를 다룹니다. 이는 단순한 전경-배경 분할을 넘어, 각 선 인스턴스를 개별적으로 식별해야 하는 복잡한 작업입니다. 주요 도전 과제는 다음과 같습니다:

* **다양한 모양과 구조**: 선의 형태가 매우 이질적이어서 수학적 모양 모델을 적용하기 어렵습니다.
* **색상 변화 (Anisochromasia)**: 세포 내외 기질의 변화로 인해 이미지의 색상이 일정하지 않아 배경과 선을 구분하기 어렵습니다.
* **인접한 객체의 합착 (Coalescence)**: 선들이 서로 매우 가깝게 붙어 있거나 융합되어 있어, 단 몇 픽셀의 연결이라도 두 인스턴스를 하나로 오인할 수 있습니다.
* **기존 방법의 한계**: 자연 이미지에 주로 사용되는 객체 감지 후 마스킹 방식은 불규칙한 형태의 선에는 부적합하며, 전통적인 의료 영상 분석 방법은 수작업 특징에 크게 의존합니다.

이 문제는 선 분할(gland labeling/segmentation)과 인스턴스 인식(instance recognition)이라는 두 가지 하위 문제로 공식화됩니다.

## ✨ Key Contributions

본 논문의 주요 기여는 다음과 같습니다:

* **깊은 다중 채널 프레임워크 제안**: 선 조직학 이미지에서 지역(regional), 위치(location), 경계(boundary) 정보를 자동으로 활용하고 융합하는 딥 다중 채널 신경망 알고리즘을 제안했습니다.
* **특징 설계 부담 완화**: 합성곱 신경망(CNN)을 사용하여 복잡한 수동 특징 설계의 부담을 덜었습니다.
* **다양한 정보 융합의 효과 입증**: FCN, HED, Faster R-CNN을 기반으로 하는 전경 분할, 경계 감지, 객체 감지 채널의 상호 보완적인 정보 융합이 인스턴스 분할 성능을 크게 향상시킴을 보여주었습니다.
* **최첨단 성능 달성**: MICCAI 2015 Gland Segmentation Challenge Contest 데이터셋에서 기존 참가자 및 최신 인스턴스 분할 방법을 능가하는 최첨단 결과를 달성했습니다.
* **데이터 증강 전략**: 조직학 이미지의 회전 불변성을 활용한 새로운 데이터 증강 전략을 제안하여 모델의 강건성과 성능을 개선했습니다.
* **일반화 능력**: 제안된 모델이 선 인스턴스 분할 문제를 해결할 뿐만 아니라, 채널을 특정 작업에 맞춰 대체할 수 있는 일반화 능력을 가지고 있음을 시사했습니다.

## 📎 Related Works

* **인스턴스 분할 (Instance segmentation)**:
  * SDS (Simultaneous Detection and Segmentation) [14]: R-CNN과 유사한 프레임워크로 객체 감지 후 경계 상자 내에서 분할을 수행.
  * Hypercolumn [15]: 픽셀 특징을 모든 CNN 단위의 활성화 벡터로 정의하고, 이를 기반으로 영역 제안을 분류하고 분할을 개선.
  * MNC (Multi-task Network Cascades) [16]: 탐지, 분할, 분류를 위한 세 가지 네트워크를 통합한 캐스케이드 구조로, RPN을 활용하여 엔드-투-엔드 학습 가능.
  * 이러한 방법들은 주로 자연 이미지에 적합하며, 먼저 객체를 감지한 후 분할하는 파이프라인 방식을 따릅니다.
* **선 인스턴스 분할 (Gland instance segmentation)**:
  * 전통적인 방법 [27, 28, 29]: 핵 및 내강과 같은 선 구조 감지에 초점을 맞추거나, 수학적 형태학 또는 텍스처/구조적 특징을 사용. 양성 이미지에는 효과적이나 악성 이미지에는 한계.
  * 딥러닝 기반 방법:
    * Li et al. [30]: CNN 특징과 수작업 특징을 결합한 윈도우 기반 이진 분류기.
    * Kainz et al. [26]: 선과 선 분리 구조를 인식하는 두 개의 분리된 네트워크.
    * MICCAI 2015 Gland Segmentation Challenge 참가작:
      * DCAN [24]: 다운샘플링 및 업샘플링 경로를 결합하고, 윤곽 정보 및 객체 분할을 위한 두 가지 브랜치를 갖는 다중 태스크 학습 프레임워크.
      * Team ExB [12]: 여러 합성곱 레이어로 구성된 다중 경로 CNN으로 다양한 특징을 캡처하고 융합.
      * Team Freburg [12]: U-Net [31]을 활용한 후 후처리(구멍 채우기, 작은 객체 제거) 수행.

## 🛠️ Methodology

제안된 알고리즘은 **깊은 다중 채널 프레임워크**로, 세 가지 독립적인 채널과 이들을 융합하는 네트워크로 구성됩니다. 모든 채널의 기반 네트워크는 VGG16 모델을 사용합니다.

1. **전경 분할 채널 (Foreground Segmentation Channel)**
    * **목표**: 이미지에서 선 픽셀과 배경 픽셀을 구분합니다.
    * **모델**: FCN-32s [20]의 수정된 버전입니다.
    * **특징**: `pool4`와 `pool5`의 스트라이드를 1로 설정하고, 이어서 딜레이티드 컨볼루션(dilated convolution)을 적용하여 더 넓은 수용장(receptive field)을 확보하면서도 특징 맵의 해상도 손실을 줄였습니다. 이는 인접한 객체가 하나로 간주되는 FCN의 한계를 보완합니다.
    * **학습**: 소프트맥스 교차 엔트로피 손실(softmax cross entropy loss)을 사용하여 학습됩니다.

2. **경계 감지 채널 (Edge Detection Channel)**
    * **목표**: 선들 사이의 경계를 정밀하게 감지합니다.
    * **모델**: Holistically-nested Edge Detector (HED) [21]를 기반으로 합니다.
    * **특징**: 계층적으로 내장된 멀티스케일 경계 필드를 학습하여 저수준, 중간수준, 고수준의 윤곽 정보를 포착합니다. FCN의 맥스 풀링 및 스트라이드 컨볼루션으로 인한 정보 손실을 보완하고, 인접 객체를 분리하는 데 도움을 줍니다. 경계와 비경계 픽셀의 불균형 문제를 해결하기 위해 딥 감독(deep supervision)과 경계 팽창(edge dilation)이 사용됩니다.
    * **학습**: 시그모이드 교차 엔트로피 손실(sigmoid cross entropy loss)을 사용하여 학습됩니다.

3. **객체 감지 채널 (Object Detection Channel)**
    * **목표**: 이미지 내에서 선과 그 위치를 감지합니다.
    * **모델**: Faster R-CNN [22]을 사용합니다.
    * **특징**: 합성곱 레이어로 특징 맵을 추출한 후, RPN(Region Proposal Network)이 객체 존재 확률과 함께 경계 상자 집합을 생성합니다. 이 경계 상자 정보는 픽셀이 속한 경계 상자의 개수를 나타내는 "채우기(filling)" 작업으로 변환되어 융합 네트워크로 전달됩니다. 이는 인스턴스 분할의 첫 단계로 경계 상자를 활용하는 기존 방식과 달리, 컨텍스트 정보 손실을 방지하기 위해 융합 네트워크에 위치 정보를 통합하는 방식입니다.
    * **학습**: Faster R-CNN과 동일하게 분류 손실과 회귀 손실의 합을 사용하여 학습됩니다.

4. **다중 채널 융합 (Fusing Multichannel)**
    * **목표**: 세 채널에서 생성된 지역, 위치, 경계 정보를 결합하여 최종 인스턴스 분할 결과를 생성합니다.
    * **모델**: 얕은 7층 합성곱 신경망(CNN)을 사용합니다.
    * **특징**: 정보 손실을 줄이고 충분히 넓은 수용장을 보장하기 위해, 다운샘플링 대신 딜레이티드 컨볼루션을 다시 적용합니다. 네트워크 아키텍처는 교차 검증을 통해 설계되었습니다.
    * **학습**: 소프트맥스 교차 엔트로피 손실을 사용하여 학습됩니다.

**데이터 증강 및 전처리**: 각 채널별 제로 평균화를 수행하고, 경계 레이블 및 경계 상자 ground truth를 생성합니다. 과적합 방지 및 성능 향상을 위해 수평 뒤집기, 회전($0^{\circ}$, $90^{\circ}$, $180^{\circ}$, $270^{\circ}$), 그리고 핀 쿠션 및 배럴 변환과 같은 탄성 변환(elastic transformation)을 포함하는 두 가지 전략의 데이터 증강이 사용됩니다.

## 📊 Results

본 연구는 MICCAI 2015 Gland Segmentation Challenge Contest에서 제공된 데이터셋(85개 학습 이미지, 80개 테스트 이미지)으로 평가되었습니다.

* **최첨단 성능 달성**: 제안된 다중 채널 알고리즘은 FCN, 딜레이티드 FCN, 그리고 챌린지 참가팀을 포함한 다른 인기 있는 인스턴스 분할 방법들보다 높은 성능을 보였습니다. 랭크 합(Rank Sum) 및 가중 랭크 합(Weighted Rank Sum) 지표에서 가장 높은 순위를 기록했습니다.
* **평가 지표**: F1 Score (감지 정확도), Object Dice (분할 성능), Object Hausdorff (모양 유사성)의 세 가지 지표를 사용했습니다.
  * F1 Score (Test A/Test B): 0.893 / 0.843 (다른 방법들보다 우수)
  * Object Dice (Test A/Test B): 0.908 / 0.833 (다른 방법들보다 우수)
  * Object Hausdorff (Test A/Test B): 44.129 / 116.821 (낮을수록 좋으며, 다른 방법들보다 우수)
* **다중 채널의 우월성**: 단일 FCN 또는 딜레이티드 FCN에 비해, 제안된 알고리즘은 인접한 선 구조를 효과적으로 분리하여 인스턴스 분할 지표에서 더 높은 점수를 얻었습니다.
* **기존 인스턴스 분할 방법과의 비교**: SDS, Hypercolumn, MNC와 같은 기존 자연 이미지 인스턴스 분할 방법보다 훨씬 우수한 성능을 보였습니다. 이는 이들이 감지 또는 제안의 정밀도에 의존하고 컨텍스트 정보 접근이 제한되는 문제 때문입니다.
* **채널의 타당성 (Ablation Study)**:
  * 딜레이티드 컨볼루션과 경계 팽창이 분할 정밀도 향상에 효과적임을 입증했습니다.
  * 전경 분할 채널, 경계 감지 채널, 객체 감지 채널의 세 가지 채널을 모두 사용하는 것이, 두 채널만 사용하는 경우보다 인스턴스 분할 성능을 더욱 향상시킴을 확인했습니다.

## 🧠 Insights & Discussion

* **상호 보완적인 정보 융합의 힘**: 제안된 다중 채널 프레임워크는 영역, 경계, 위치 정보를 융합함으로써 각 정보의 약점을 보완하고 시너지 효과를 창출하여 강력한 인스턴스 분할 성능을 달성합니다. 예를 들어, 경계 감지는 FCN의 정보 손실을 보완하고 인접 객체를 분리하는 데 도움을 주며, 객체 감지는 전반적인 객체 범위와 개수를 파악하는 데 기여합니다.
* **다운샘플링 및 딜레이티드 컨볼루션**: 다운샘플링의 해상도 감소 및 공간 불변성 문제 (분할은 공간에 민감함)를 딜레이티드 컨볼루션으로 해결하여 넓은 수용장을 유지하면서도 정밀한 분할을 가능하게 합니다.
* **한계점**:
  * 일부 선 조직학 이미지에서 백색 영역이 세포질인지 배경인지 혼동하는 경우가 있었습니다. 이는 세포나 조직이 없는 백색 영역을 세포질로 오인하는 문제로 이어집니다.
  * 이미지 자르기 과정에서 선이 분리될 때 세포질이 배경으로 오인되는 경우도 있었습니다.
  * 드물지만, 일부 선이 분리된 상태로 모델 감지에서 누락되는 경우가 있었습니다.
* **일반화 능력**: 제안된 모델의 유연한 채널 구성은 다른 유형의 의료 영상 인스턴스 분할 문제에도 적용될 수 있는 잠재력을 보여줍니다.

## 📌 TL;DR

이 논문은 대장 조직학 이미지에서 개별 선(gland)을 정확하게 분할하는 **선 인스턴스 분할 문제**를 해결하기 위해 **깊은 다중 채널 신경망**을 제안합니다. 이 방법은 전경 분할(FCN 기반), 경계 감지(HED 기반), 객체 감지(Faster R-CNN 기반)의 세 가지 채널에서 얻은 **지역, 경계, 위치 정보를 융합 네트워크를 통해 통합**하여 인스턴스 단위의 결과를 도출합니다. MICCAI 2015 챌린지 데이터셋에서 **최첨단 성능**을 달성하며, 각 채널의 상호 보완적인 정보 융합이 복잡한 인스턴스 분할 문제에 효과적임을 입증했습니다.
