# ISINet: An Instance-Based Approach for Surgical Instrument Segmentation

Cristina Gonz ́alez, Laura Bravo-S ́anchez, and Pablo Arbelaez

## 🧩 Problem to Solve

로봇 보조 수술 장면에서 수술 도구를 의미론적으로 분할하는 것은 컴퓨터 보조 수술 시스템 개발에 중요한 중간 단계입니다. 기존의 픽셀 단위(pixel-wise) 분할 방법은 다음과 같은 주요 문제점을 가지고 있습니다:

1. **공간적 일관성 부족**: 단일 도구 인스턴스가 여러 도구 유형으로 잘못 분류될 수 있습니다.
2. **시간적 일관성 부족**: 이전 프레임의 정보를 고려하지 않고 프레임별로 도구 클래스를 예측하여 시간이 지남에 따라 레이블 일관성을 유지하기 어렵습니다.
3. **데이터 부족**: 특히 미세 분류(fine-grained) 도구 분할을 위한 주석(annotation) 데이터가 부족하여 모델 일반화에 한계가 있습니다.

## ✨ Key Contributions

* **ISINet (Instance-based Surgical Instrument Segmentation Network) 제안**: 수술 도구 분할을 위한 인스턴스 기반 접근 방식을 도입하여 기존 픽셀 단위 방법의 한계를 극복합니다.
* **새로운 시간적 일관성 모듈 개발**: 데이터의 순차적 특성을 활용하여 도구 인스턴스에 대한 클래스 예측 정확도를 높이는 모듈을 제안합니다.
* **EndoVis 2018 데이터셋 확장**: EndoVis 2018 데이터셋에 추가적인 도구 유형 주석을 제공하여 미세 분류 도구 분할 연구를 위한 데이터를 풍부하게 합니다.
* **최첨단 성능 능가**: 기존 최첨단 픽셀 단위 분할 방법보다 IoU(Intersection over Union) 성능을 2배에서 3배까지 크게 향상시켰습니다.

## 📎 Related Works

* **U-Net [26] 및 FCN [22] 기반 방법**: 대부분의 최첨단 수술 도구 분할 방법은 U-Net 변형을 사용한 픽셀 단위 의미론적 분할 패러다임을 따릅니다 (예: TernausNet [28]).
* **기존 방법의 한계**: 경계선 [9], 깊이 정보 [24], 후처리 전략 [8], 돌출 맵 [14], 포즈 추정 [19] 등을 사용하여 개선하려 했으나, 단일 도구가 여러 유형으로 할당되는 레이블 불일치 문제(공간적 일관성 부족)를 겪었습니다.
* **인스턴스 기반 접근**: [18]은 인스턴스 기반 접근 방식을 사용하여 이 문제를 해결했지만, 개인 데이터셋에 적용되었습니다.
* **시간적 정보 활용**: MF-TAPNet [15]은 이전 프레임의 광학 흐름(optical flow)을 사용하여 시간적 사전 지식(temporal prior)을 도입한 최초의 방법입니다. 본 논문은 이와 달리 예측의 중복성을 활용하여 시간적 일관성을 확보합니다.
* **Mask R-CNN [11]**: 본 연구의 ISINet은 자연 이미지의 인스턴스 분할에서 매우 성공적인 Mask R-CNN 아키텍처를 기반으로 합니다.

## 🛠️ Methodology

ISINet은 Mask R-CNN을 기반으로 하며, 수술 도구의 미세 분류 문제에 맞게 예측 레이어를 수정하고 시간적 일관성 모듈을 추가했습니다.

**1. Mask R-CNN 기반 인스턴스 후보 추출**:

* 수열 $I$의 각 프레임 $t$에 대해 Mask R-CNN 모델 $M$을 사용하여 $n$개의 후보 스코어 $S_{i,t}$, 객체 후보 $O_{i,t}$, 클래스 예측 $C_{i,t}$를 얻습니다.
    $$ (\{ \{S_{i,t}\}_{i=1}^n \}_{t=1}^T, \{ \{O_{i,t}\}_{i=1}^n \}_{t=1}^T, \{ \{C_{i,t}\}_{i=1}^n \}_{t=1}^T ) = M(\{I_t\}_{t=1}^T) $$
* 후보는 신뢰도 점수가 0.75 이상인 예측만 포함합니다.

**2. 시간적 일관성 모듈 (Temporal Consistency Module)**:

* **Matching Step**:
  * FlowNet2 [13]를 사용하여 이전 프레임 $t-1$에서 현재 프레임 $t$로의 역방향 광학 흐름(backward optical flow) $OF_{t \to t-1}$을 계산합니다.
  * 이 광학 흐름을 사용하여 이전 $f$개 프레임의 후보 객체를 현재 프레임 $t$로 워핑($\hat{O}$)합니다.
  * 워핑된 객체 후보들을 IoU($\text{Intersection over Union}$) 기준으로 상호 매칭하여 $f$개의 프레임에 걸친 $m$개의 도구 인스턴스 $O_k$를 추적합니다. IoU가 임계값 $U$보다 큰 경우에만 매칭으로 간주합니다.
* **Assignment Step**:
  * 현재 프레임 $t$의 각 인스턴스 $k$에 대한 클래스 예측을 이전 $f$개 프레임의 예측을 고려하여 업데이트합니다.
  * 클래스와 스코어를 모두 고려하는 함수 $A$를 사용하여 최종 클래스 $C_{k,t}$를 할당합니다.
  * 최종 방법에서는 $f=6$, $U$는 데이터셋에 따라 0 또는 0.5로 설정하고, $A$는 입력 클래스들의 스코어로 가중치 부여된 최빈값(weighted mode)으로 정의됩니다.

**3. 추가 주석 (Additional Annotations)**:

* EndoVis 2018 데이터셋의 주석을 수동으로 확장하여 9가지 도구 유형(예: Bipolar Forceps, Prograsp Forceps 등)을 포함시켰습니다. 각 도구는 프레임 및 전체 이미지 시퀀스를 고려하여 일관성 있는 인스턴스 레이블이 지정됩니다.

## 📊 Results

* **최첨단 성능 능가**: ISINet의 기본 버전은 EndoVis 2017 및 2018 데이터셋 모두에서 TernausNet [28]과 MF-TAPNet [15]의 IoU 성능을 2배로 향상시켰고, 완전한 모델은 3배까지 향상시켰습니다.
* **클래스별 개선**: 특히 일부 도구 클래스에서는 30.0 IoU 포인트 이상의 개선을 보였습니다. 개선 정도는 클래스의 예제 수와 상관관계가 있었습니다.
* **추가 데이터의 효과**: EndoVis 2017 및 2018 데이터셋 모두에서 추가 데이터를 사용하여 훈련했을 때 단일 데이터셋으로 훈련한 경우보다 성능이 향상되었습니다. EndoVis 2017의 7개 클래스 중 6개, EndoVis 2018의 7개 클래스 중 4개에서 성능이 최대 20.0 IoU 포인트까지 증가하며, 이 작업을 해결하는 데 추가 데이터의 필요성을 입증했습니다.
* **시간적 일관성 모듈의 효과**: 시간적 일관성 모듈은 추가 데이터 유무와 관계없이 두 데이터셋 모두에서 전반적인 IoU 지표를 향상시켰습니다. EndoVis 2017 데이터셋에서는 일부 클래스에서 거의 8%p까지 증가했습니다. EndoVis 2018의 경우, 데이터셋의 높은 가변성으로 인해 2017 데이터셋보다 개선 폭이 적었습니다.
* **정성적 결과**: ISINet은 기존에 식별되지 않던 클래스를 분할하고, 누락된 도구 픽셀을 복구하며, 거짓 양성(false positive) 예측을 줄이는 등 시각적으로도 우수한 결과를 보였습니다. 흔한 오류 모드로는 도구 누락, 오분류, 거친 분할이 있었습니다.

## 🧠 Insights & Discussion

* **인스턴스 기반 접근의 중요성**: 픽셀 단위 분할의 고질적인 문제인 도구 인스턴스 내의 레이블 불일치 문제를 해결하는 데 인스턴스 기반 접근 방식이 매우 효과적임을 입증했습니다.
* **시간적 일관성 활용의 가치**: 수술 영상 데이터의 순차적 특성을 활용하는 시간적 일관성 모듈이 예측의 정확도를 높이는 데 결정적인 역할을 함을 보여주었습니다. 이는 특히 의료 영상 분석에서 시계열 데이터의 잠재력을 강조합니다.
* **데이터의 필요성**: 추가 주석 데이터가 모델의 일반화 능력과 성능 향상에 필수적임을 경험적으로 증명했습니다. 이는 의료 영상 분야에서 양질의 대규모 주석 데이터셋 구축의 중요성을 시사합니다.
* **제한 사항**: EndoVis 2018 데이터셋의 높은 가변성이 시간적 일관성 모듈의 효과를 다소 제한할 수 있음을 지적했으며, 예시가 적은 특정 도구 클래스(예: Stapler)는 여전히 도전 과제로 남아있습니다.

## 📌 TL;DR

본 논문은 로봇 보조 수술에서 수술 도구 분할의 **공간적, 시간적 일관성 부족 문제**를 해결하기 위해 **인스턴스 기반의 ISINet**을 제안합니다. ISINet은 Mask R-CNN을 기반으로 하며, 영상의 순차적 특성을 활용하는 **시간적 일관성 모듈**을 포함합니다. 또한, EndoVis 2018 데이터셋에 **새로운 미세 분류 도구 유형 주석**을 추가했습니다. 실험 결과, ISINet은 기존 최첨단 방법 대비 IoU 성능을 크게(2~3배) 향상시켰으며, 시간적 일관성 모듈과 추가 데이터가 모델 성능 및 일반화에 필수적임을 입증했습니다.
