# Cross-Domain Weakly-Supervised Object Detection through Progressive Domain Adaptation

Naoto Inoue, Ryosuke Furuta, Toshihiko Yamasaki, Kiyoharu Aizawa

## 🧩 Problem to Solve

본 논문은 다양한 이미지 도메인(예: 수채화, 만화)에서 객체를 감지할 때 인스턴스-레벨 주석(bounding box 및 레이블)이 부족하거나 존재하지 않는 문제를 다룹니다. 기존의 완전 지도 학습(fully supervised) 객체 감지기(FSD)는 방대한 양의 인스턴스-레벨 주석 데이터가 필요하지만, 새로운 도메인에 대해 이러한 데이터를 수집하는 것은 비용이 많이 들고 현실적으로 어렵습니다.

이 연구가 제안하는 새로운 과제인 **교차 도메인 약지도 객체 감지(cross-domain weakly-supervised object detection)**는 다음 조건을 가정합니다:

1. 원본 도메인(예: 자연 이미지)에는 인스턴스-레벨 주석이 사용 가능합니다.
2. 대상 도메인(예: 수채화 이미지)에는 이미지-레벨 주석(즉, 이미지에 어떤 클래스의 객체가 포함되어 있는지에 대한 레이블만)만 사용 가능합니다.
3. 대상 도메인에서 감지할 클래스는 원본 도메인 클래스의 전부 또는 일부입니다.

이러한 약한 지도 학습 조건에서 대상 도메인에서 객체를 가능한 한 정확하게 감지하는 것이 목표입니다.

## ✨ Key Contributions

- **새로운 과제 제안**: 교차 도메인 약지도 객체 감지(cross-domain weakly-supervised object detection)라는 새로운 과제와 이를 해결하기 위한 프레임워크를 제안했습니다.
- **두 단계 진행형 도메인 적응 프레임워크**: 도메인 전이(Domain Transfer, DT)와 의사 레이블링(Pseudo-Labeling, PL)을 통해 인공적으로 생성된 샘플을 활용하여 FSD를 순차적으로 미세 조정하는 두 단계 진행형 도메인 적응 기법을 개발했습니다.
- **새로운 벤치마크 데이터셋 구축**: 자연 이미지와는 다른 세 가지 시각 도메인(Clipart1k, Watercolor2k, Comic2k)에 걸쳐 여러 객체 클래스의 인스턴스-레벨 주석이 완전하게 부여된 데이터셋을 구축하고 공개했습니다.
- **우수한 성능 입증**: 제안된 프레임워크가 모든 데이터셋에서 기존 최신 베이스라인 대비 mAP(mean Average Precision)를 약 5%p에서 20%p 향상시키는 것을 실험적으로 보여주었습니다.

## 📎 Related Works

- **완전 지도 객체 감지(Fully Supervised Detection, FSD)**: R-CNN [10], Fast R-CNN [9], Faster R-CNN [28], SSD [22], YOLOv2 [27] 등은 PASCAL VOC [6], MSCOCO [21]와 같은 대규모 인스턴스-레벨 주석 데이터셋이 필수적입니다.
- **약지도 객체 감지(Weakly Supervised Detection, WSD)**: 이미지-레벨 주석만을 사용하며, 다중 인스턴스 학습(Multiple Instance Learning, MIL) [30,11,31,1,18] 또는 투 스트림 CNN [2,15,33]에 기반합니다(예: WSDDN [2], CLNet [15]). 하지만 객체의 정확한 경계 위치 파악 능력은 떨어집니다.
- **교차 도메인 객체 감지(Cross-domain Object Detection)**: [13] 및 [5]와 같은 연구들이 유사하지만, 본 논문은 원본 도메인에 인스턴스-레벨, 대상 도메인에 이미지-레벨 주석을 사용하는 독특한 설정에서 교차 도메인 약지도 객체 감지를 제안하는 첫 번째 연구입니다.
- **비지도 도메인 적응(Unsupervised Domain Adaptation, UDA)**: 원본 도메인에만 주석이 있고 대상 도메인에는 이미지 정보만 있는 경우 도메인 불변 모델을 학습합니다. 주로 분포 일치 기반 방법(MMD [12], 도메인 분류기 네트워크 [23,8,24,35]인 ADDA [35] 등)이 사용되지만, 객체 감지와 같이 구조화된 출력이 필요한 태스크에서는 효과적인 정렬이 어렵습니다. 본 연구는 이미지-대-이미지 변환 및 미세 조정을 통해 이 문제를 회피합니다.

## 🛠️ Methodology

본 논문은 원본 도메인에서 사전 학습된 FSD를 대상 도메인으로 적응시키기 위해 두 단계의 진행형 미세 조정을 제안합니다.

1. **FSD 사전 학습(Pre-train)**:

   - 원본 도메인(예: PASCAL VOC)의 인스턴스-레벨 주석을 사용하여 FSD(예: SSD300)를 사전 학습합니다.

2. **도메인 전이(Domain Transfer, DT)**:

   - **목표**: 원본 도메인의 이미지를 인스턴스-레벨 주석과 함께 대상 도메인의 스타일로 변환하여, FSD가 저수준 특징(색상, 질감)의 도메인 차이에 강건해지도록 만듭니다.
   - **방법**: CycleGAN [40]과 같은 비쌍 이미지-대-이미지 변환 기법을 사용하여 원본 도메인 $X_s$와 대상 도메인 $X_t$ 간의 매핑 함수 $G: X_s \to X_t$를 학습합니다.
   - **활용**: 원본 도메인에 인스턴스-레벨 주석이 있는 이미지를 CycleGAN으로 대상 도메인 스타일로 변환합니다. 이 변환된 이미지는 원본 주석을 유지하면서 대상 도메인에 가까운 외형을 가집니다.
   - **미세 조정**: 변환된 이미지로 FSD를 1차 미세 조정합니다.

3. **의사 레이블링(Pseudo-Labeling, PL)**:
   - **목표**: 대상 도메인의 이미지-레벨 주석을 활용하여 인스턴스-레벨 의사 주석을 생성하고, FSD가 다른 클래스 및 배경과의 혼동을 줄이도록 만듭니다.
   - **전제**: DT를 통해 1차 미세 조정된 FSD는 대상 도메인 이미지에 대한 객체 감지 능력을 어느 정도 갖추고 있습니다.
   - **방법**:
     - 대상 도메인의 각 이미지 $x \in R^{H \times W \times 3}$에 대해, DT로 미세 조정된 FSD를 사용하여 감지 결과 $D$ (각 감지 $d = (p, b, c)$는 확률 $p$, 경계 상자 $b$, 클래스 $c$로 구성)를 얻습니다.
     - 이미지 $x$에 대한 이미지-레벨 주석 $z$ (이미지 내 존재하는 클래스 집합)를 사용합니다.
     - $z$에 포함된 각 클래스 $c \in z$에 대해, $D$에서 해당 클래스 $c$에 대한 감지 결과 중 가장 높은 신뢰도 $p$를 가진 감지 $d_{best} = (p_{best}, b_{best}, c)$를 선택하고, $(b_{best}, c)$를 의사 인스턴스-레벨 주석 $G$에 추가합니다.
   - **미세 조정**: 생성된 의사 인스턴스-레벨 주석 $G$와 이미지 $x$ 쌍을 사용하여 FSD를 2차 미세 조정합니다. 이 과정에서 FSD의 어떤 레이어도 변경되지 않습니다.

## 📊 Results

- **새로운 데이터셋 성능**:
  - **Clipart1k**: Baseline SSD300의 mAP 26.8%에서 DT+PL 적용 시 mAP 46.0%로 약 19.2%p 향상되었습니다. 이는 Ideal case(55.4%)의 9.4%p 이내에 해당하는 성능입니다.
  - **Watercolor2k**: Baseline mAP 49.6%에서 DT+PL 적용 시 mAP 54.3%로 향상되었습니다.
  - **Comic2k**: Baseline mAP 24.9%에서 DT+PL 적용 시 mAP 37.2%로 향상되었습니다.
- **구성 요소별 기여**: PL 단독으로 Baseline SSD300 대비 mAP 9.6%p 향상, DT 단독으로 mAP 11.2%p 향상을 보였으며, DT+PL은 두 방법이 상호 보완적으로 작용하여 가장 우수한 성능을 달성했습니다.
- **경쟁 방법 대비 우위**: WSD (WSDDN, CLNet), Ensemble, UDA (ADDA) 등 기존의 모든 비교 방법보다 월등히 높은 mAP를 기록했습니다. 특히 ADDA는 구조화된 출력 태스크에서 성능이 미미했습니다.
- **추가(Extra) 데이터 활용**: BAM! 데이터셋의 노이즈가 있는 대규모 이미지-레벨 레이블을 PL과 함께 활용하는 (+extra) 방법은 성능을 크게 향상시키며, 일부 경우 1,000개의 깨끗한 주석으로 훈련된 Ideal case보다도 우수한 성능을 보여주었습니다.
- **일반화 능력**: SSD300 외에 YOLOv2 [27], Faster R-CNN [28] 등 다른 FSD 백본에서도 제안된 프레임워크가 일관된 성능 향상을 보이며 일반화 능력을 입증했습니다. SSD300에서 성능 향상 폭이 가장 컸는데, 이는 SSD300의 데이터 증강(예: 줌인/줌아웃) 기능이 노이즈가 많은 의사 레이블로 훈련할 때 특히 유용했기 때문으로 분석됩니다.
- **오류 분석**: DT는 덜 확신하는 감지에서 성능을 향상시키고, PL은 이미지-레벨 주석을 활용하여 다른 클래스(Sim) 및 배경(Oth)과의 혼동을 크게 줄이는 데 효과적임을 확인했습니다.

## 🧠 Insights & Discussion

- **진행형 적응의 효과**: DT와 PL을 순차적으로 적용하는 두 단계 진행형 도메인 적응 방식이 FSD를 새로운 도메인에 효과적으로 적응시키는 데 중요함을 입증했습니다. 특히, PL의 성능은 DT를 통해 향상된 FSD의 초기 성능에 크게 의존합니다.
- **DT와 PL의 상호 보완성**: DT는 도메인 간의 시각적 스타일 차이를 줄여 초기 적응을 돕고, PL은 대상 도메인의 실제 이미지-레벨 정보를 활용하여 클래스 혼동을 명확히 함으로써 감지 정확도를 높입니다. 이 두 방법이 결합될 때 최적의 시너지를 발휘합니다.
- **새로운 데이터셋의 중요성**: 구축된 Clipart1k, Watercolor2k, Comic2k 데이터셋은 향후 교차 도메인 및 약지도 학습 연구를 위한 강력한 벤치마크 역할을 합니다.
- **한계점 및 향후 연구**:
  - 현재 PL은 각 클래스당 가장 높은 신뢰도의 경계 상자 하나만 사용하므로, 다른 인스턴스를 놓치거나 음성 샘플로 활용하지 못하는 한계가 있습니다. 향후 MIL 패러다임을 도입하여 의사 레이블링의 위치 정확도를 개선할 수 있을 것입니다.
  - CycleGAN을 통한 이미지 전이가 완벽하지 않을 수 있지만, FSD의 미세 조정을 통해 여전히 유효한 개선을 가져왔습니다.

## 📌 TL;DR

이 논문은 인스턴스-레벨 주석이 없는 대상 도메인에서 객체를 감지하는 "교차 도메인 약지도 객체 감지"라는 새로운 과제를 제시합니다. 제안된 프레임워크는 원본 도메인에서 사전 학습된 완전 지도 객체 감지기(FSD)를 **도메인 전이(DT)**를 통해 대상 도메인 스타일의 이미지로 적응시키고, 이어서 대상 도메인의 이미지-레벨 주석을 활용한 **의사 레이블링(PL)**을 통해 의사 인스턴스-레벨 주석을 생성하여 두 단계에 걸쳐 점진적으로 미세 조정합니다. 새로 구축된 Clipart1k, Watercolor2k, Comic2k 데이터셋에서의 실험 결과, 이 진행형 도메인 적응 기법은 기존 최신 베이스라인 대비 약 5%에서 20%p의 mAP 성능 향상을 달성하며, 교차 도메인 약지도 객체 감지를 위한 효과적이고 강력한 기준선을 제시합니다.
