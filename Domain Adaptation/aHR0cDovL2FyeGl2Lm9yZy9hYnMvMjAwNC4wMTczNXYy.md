# Unsupervised Domain Adaptation with Progressive Domain Augmentation

Kevin Hua and Yuhong Guo

## 🧩 Problem to Solve

비지도 도메인 적응(Unsupervised Domain Adaptation, UDA)은 레이블이 풍부한 소스 도메인의 데이터를 활용하여 레이블이 부족하거나 없는 타겟 도메인에서 분류기를 학습하는 것을 목표로 합니다. 하지만 소스 도메인과 타겟 도메인 간에 상당한 분포 차이(도메인 발산)가 있을 때, 직접적인 도메인 정렬 방식은 정보 손실을 야기하며 큰 도메인 발산을 효과적으로 다루기 어렵다는 문제가 있습니다.

## ✨ Key Contributions

- **진보적 도메인 증강(Progressive Domain Augmentation, PrDA) 기법 제안**: 소스 도메인과 타겟 도메인 간의 큰 도메인 발산을 여러 개의 작은 정렬 문제로 분할하여 점진적으로 해결하는 새로운 비지도 도메인 적응 방법을 제안합니다.
- **가상 중간 도메인 생성**: Mixup 데이터 보간법을 활용하여 소스 도메인과 타겟 도메인 사이에 가상 중간 도메인을 생성합니다.
- **그라스만 다양체에서의 다중 부분 공간 정렬**: 그라스만 다양체(Grassmann manifold) 상에서 다중 부분 공간 정렬(Multiple Subspace Alignment)을 수행하여 소스-가상 도메인 간의 기하학적 정렬을 달성합니다.
- **소스 도메인 점진적 증강**: 정렬된 가상 도메인의 신뢰도 높은 의사 레이블(pseudo-label)이 부여된 데이터를 사용하여 소스 도메인을 점진적으로 증강합니다.
- **최첨단 성능 달성**: 여러 표준 도메인 적응 벤치마크 태스크에서 기존 최첨단(state-of-the-art) 방법들을 능가하는 성능을 보였으며, 특히 도메인 발산이 큰 경우에 강점을 입증했습니다.

## 📎 Related Works

이 논문은 비지도 도메인 적응 분야와 데이터 증강 분야의 기존 연구를 기반으로 합니다.

- **비지도 도메인 적응**:
  - **발산 기반(Divergence-based) 방법**: Maximum Mean Discrepancy (MMD) [24], Correlation Alignment (CORAL) [30], Wasserstein distance [4], Maximum Classifier Discrepancy (MCD) [28], Central Moment Discrepancy (CMD) [38] 등을 통해 도메인 불변 특징 표현 학습.
  - **적대적 기반(Adversarial-based) 방법**: GAN [11]의 원리를 확장하여 도메인 분포를 정렬. Coupled GAN (CoGAN) [23], Domain Adversarial Neural Network (DANN) [8], Cycle-Consistent Adversarial Domain Adaptation (CyCADA) [16].
  - **부분 공간 기반(Subspace-based) 방법**: Geodesic Flow Kernel (GFK) [10], Thopalli et al. [33]의 다중 부분 공간 정렬.
- **데이터 증강**:
  - **Mixup [39]**: 두 샘플을 선형 보간하여 새로운 가상 샘플 생성.
  - **MixMatch [3]**: Mixup을 의사 레이블링(pseudo-labeling)과 결합하여 비지도 학습에 활용.

## 🛠️ Methodology

제안된 PrDA(Progressive Domain Augmentation) 방법은 대규모 도메인 발산을 여러 작은 단계로 나누어 점진적으로 해결합니다.

1. **가상 도메인 생성 (Virtual Domain Generation)**:
   - Mixup 선형 데이터 보간 메커니즘을 적용하여 소스 샘플 $x_{s_i}$와 타겟 샘플 $x_{t_j}$ 사이의 가상 샘플 $\hat{x}$를 생성합니다.
   - $$ \hat{x} = \lambda x*{s_i} + (1-\lambda)x*{t_j} $$
   - $\lambda$ 값은 가상 도메인이 소스에 가까울지 타겟에 가까울지 결정합니다. 초기 $\lambda_0 > 0.5$ 에서 시작하여 점진적으로 $\lambda$ 값을 감소시켜 가상 도메인이 소스 도메인에서 타겟 도메인으로 점차 이동하도록 합니다.
2. **다중 부분 공간 생성 및 정렬 (Multiple Subspace Generation and Alignment)**:
   - 각 도메인(소스 및 가상 타겟)에 대해 여러 개의 $k$-차원 부분 공간을 생성합니다 (Algorithm 1). PCA를 반복적으로 적용하여 각 부분 공간에 의해 잘 설명되지 않는 고-오차(high-error) 샘플들을 다음 부분 공간 생성에 활용합니다.
   - 그라스만 다양체 상에서 소스 도메인 부분 공간 $B_{s_i}$와 가상 도메인 부분 공간 $B_{u_j}$ 간의 거리를 대칭 방향 거리(chordal metric) $d_{\Delta}$로 측정하여 가장 가까운 부분 공간 쌍을 매칭합니다.
   - $$ d*{\Delta}(B_s,B_u) = \left( k-\sum*{i,j=1}^{k,k} (b*{s_i}^T \cdot b*{u_j})^2 \right)^{\frac{1}{2}} $$
   - 매칭된 부분 공간 쌍에 대해 선형 변환 행렬 $A^*$를 학습하여 소스 부분 공간을 가상 타겟 부분 공간에 정렬합니다.
   - $$ A^\* = \text{arg min}_A ||B_{s*i}A - B*{u*j}||\_F = (B*{s*i})^T B*{u_j} $$
   - 소스 데이터를 정렬된 부분 공간 $B_{ta_i} = B_{s_i} \cdot A^*$에 투영하여 $Z_s = X_s \cdot B_{ta_i}$를 얻고, 가상 타겟 데이터를 해당 부분 공간에 투영하여 $Z_u = X_u \cdot B_{u_j}$를 얻습니다.
3. **전체 학습 알고리즘 (Overall Training Algorithm)**:
   - 특징 추출기 $G$와 분류기 $F$를 소스 도메인 $(X_s, Y_s)$로 사전 학습합니다.
   - 미리 정의된 $\lambda$ 값들의 집합($\lambda_{set}$)을 순회하며 다음 과정을 반복합니다.
     - 현재 $\lambda$ 값을 사용하여 소스 및 타겟 샘플의 배치를 통해 가상 도메인 $X_u$를 생성합니다.
     - $G(X_u)$에 대한 부분 공간 $M_u$를 생성합니다.
     - $M_s$와 $M_u$의 부분 공간을 매칭하고 정렬합니다.
     - 정렬된 소스 데이터 $(Z_s, Y_s)$로 분류기 $H$를 학습합니다.
     - 분류기 $H$를 사용하여 가상 도메인 $X_u$의 의사 레이블 $\hat{Y}_u$를 예측합니다.
     - 의사 레이블 신뢰도 $\rho$를 초과하는 가상 샘플과 그 의사 레이블을 기존 소스 도메인에 추가하여 소스 도메인을 증강합니다.
     - 증강된 소스 도메인을 기반으로 $M_s$를 업데이트하고, $F$와 $G$를 다시 학습합니다.

## 📊 Results

세 가지 표준 비지도 도메인 적응 데이터셋(Office-31, Office-Caltech-10, ImageCLEF-DA)에서 ResNet-50을 백본으로 사용하여 PrDA의 성능을 평가했습니다.

- **Office-31**: 기본 부분 공간 정렬(SA)을 크게 능가하며, A→D 태스크에서 최첨단 성능을 달성했고 다른 태스크에서도 매우 경쟁력 있는 결과를 보였습니다. 도메인 간 발산이 클수록(2클래스 도메인 분류 정확도로 측정) PrDA의 성능이 더 우수하다는 것을 확인했습니다.
- **Office-Caltech-10**: SA 대비 현저한 개선을 보였으며, 총 12개 태스크 중 7개에서 최첨단 성능을 달성했습니다. 이 데이터셋 역시 도메인 발산이 큰 경향이 있어 PrDA의 강점이 다시 입증되었습니다.
- **ImageCLEF-DA**: 도메인 발산이 상대적으로 작은 이 데이터셋에서도 6개 태스크 중 3개에서 최첨단 성능을, 2개에서 비견할 만한 성능을 달성했습니다.

전반적으로 PrDA는 다양한 도메인 적응 태스크에서 강력하고 경쟁력 있는 성능을 입증했으며, 특히 도메인 간 발산이 큰 시나리오에서 효과적임을 보여주었습니다.

## 🧠 Insights & Discussion

- **점진적 접근의 중요성**: 이 연구는 큰 도메인 발산을 한 번에 해결하려 하기보다는, 여러 개의 작은 정렬 문제로 나누어 점진적으로 접근하는 것이 효과적임을 입증했습니다. 이는 현실 세계의 복잡한 도메인 적응 문제에 대한 실용적인 해결책을 제시합니다.
- **도메인 발산 처리 능력**: 특히 도메인 간 차이가 큰 경우에 PrDA의 성능이 두드러지게 나타났습니다. 가상 중간 도메인을 생성하고 점진적으로 소스 도메인을 타겟 도메인으로 이동시키는 전략이 이러한 큰 발산을 효과적으로 완화하는 데 기여합니다.
- **방법론의 단순성 및 효율성**: 제안된 PrDA는 개념적으로는 단순하지만, 다중 부분 공간 정렬과 Mixup 기반 데이터 증강을 효과적으로 결합하여 강력한 성능을 보여주었습니다. 이는 복잡한 모델이나 최적화 과정 없이도 우수한 결과를 얻을 수 있음을 시사합니다.
- **한계**: 의사 레이블링의 신뢰도에 성능이 의존할 수 있으며, 하이퍼파라미터($k$, $\tau$, $\rho$, $\lambda_{set}$)의 선택이 성능에 영향을 미칠 수 있습니다.

## 📌 TL;DR

큰 도메인 발산이 있는 비지도 도메인 적응 문제를 해결하기 위해, 논문은 Mixup 보간으로 생성된 가상 중간 도메인을 활용하여 소스 도메인을 점진적으로 증강하는 `진보적 도메인 증강(PrDA)` 방법을 제안합니다. 이 방법은 그라스만 다양체 상에서 다중 부분 공간 정렬을 통해 도메인 간의 간극을 여러 작은 단계로 나누어 메웁니다. 결과적으로 PrDA는 표준 도메인 적응 태스크에서 최첨단 성능을 달성했으며, 특히 도메인 발산이 큰 경우에 매우 효과적임을 입증했습니다.
