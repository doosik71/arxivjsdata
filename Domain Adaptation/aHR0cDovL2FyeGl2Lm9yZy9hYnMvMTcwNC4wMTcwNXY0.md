# Generate To Adapt: Aligning Domains using Generative Adversarial Networks

Swami Sankaranarayanan, Yogesh Balaji, Carlos D. Castillo, Rama Chellappa

## 🧩 Problem to Solve

라벨링된 데이터가 풍부한 소스 도메인에서 훈련된 딥러닝 모델은 라벨링되지 않은 데이터만 사용할 수 있는 타겟 도메인으로 적용될 때, 두 도메인 간의 데이터 분포 차이(도메인 시프트)로 인해 성능이 저하되는 문제가 발생합니다. 이 연구는 **비지도 도메인 적응** 문제, 즉 라벨링되지 않은 타겟 데이터를 활용하여 소스와 타겟 도메인 간의 도메인 시프트를 완화하고, 두 도메인에 걸쳐 일반화될 수 있는 강력한 특징 임베딩을 학습하는 것을 목표로 합니다.

## ✨ Key Contributions

- **결합 생성-판별 프레임워크 제안**: 학습된 임베딩과 생성적 적대 신경망(GAN) 간의 '공생 관계'를 유도하여 소스 및 타겟 분포를 공유 특징 공간으로 가깝게 만듭니다. 이는 단순히 GAN을 데이터 증강에 사용하여 딥 모델을 재훈련하는 기존 방식과 다릅니다.
- **GAN을 활용한 특징 공간 정렬**: GAN 프레임워크를 사용하여 인코더가 학습한 특징 공간에서 도메인 시프트를 직접적으로 다룹니다. GAN은 현실적인 이미지 생성에 실패하는 경우(예: OFFICE 데이터셋)에도 도메인 적응에 필요한 풍부한 그래디언트 정보를 제공합니다.
- **광범위한 실험을 통한 우수성 입증**: DIGITS, OFFICE, Synthetic-to-Real 등 다양한 난이도의 세 가지 도메인 적응 태스크에서 제안된 방법이 최첨단 성능을 달성함을 입증했습니다. 특히, 이미지 생성이 어려운 OFFICE 데이터셋에서도 우수한 성능을 보여, 다양한 데이터셋에 걸쳐 잘 작동하는 유일한 GAN 기반 방법임을 강조합니다.
- **보조 분류기 GAN(AC-GAN) 변형 활용**: 판별자를 다중 클래스 분류기로 모델링하여, 생성자가 클래스 일관성 있는 이미지를 생성하도록 유도하고, 이는 도메인 적응 과정에 기여합니다.

## 📎 Related Works

- **특징 표현 학습**: 초기 도메인 적응 접근 방식은 도메인 불변 특징 표현을 구축하는 데 중점을 두었습니다 (예: 특징 재가중, 특징 선택, 명시적 특징 변환).
- **딥러닝 기반 비지도 도메인 적응**:
  - **MMD (Maximum Mean Discrepancy) 기반**: DDC, DAN, RTN, JAN 등은 분류 손실 외에 도메인 불일치를 측정하는 MMD 손실을 최소화합니다.
  - **적대적 손실 기반 (임베딩 공간)**: RevGrad는 도메인 분류 네트워크를 사용하여 특징 추출 네트워크가 도메인 분류기 손실을 최대화하도록 학습하며, ADDA는 소스 및 타겟에 대해 별도의 특징 추출 네트워크를 학습하여 도메인 분류기가 임베딩을 구별하지 못하게 합니다.
  - **적대적 손실 기반 (픽셀 공간)**: [31], [1]과 같은 방법은 GAN을 사용하여 소스 이미지를 타겟 도메인으로 매핑한 후 적응을 수행하며, CoGAN은 결합 생성 모델을 훈련하여 도메인 불변 분류기를 학습합니다.

이 연구는 기존 GAN 기반 도메인 적응 방법(예: [31], [1])이 GAN을 데이터 증강 단계로 사용하는 것과 달리, GAN을 통해 학습된 임베딩을 도메인 적응적으로 만드는 '풍부한 그래디언트 정보'를 얻는 데 활용한다는 점에서 차별화됩니다.

## 🛠️ Methodology

이 연구는 보조 분류기 GAN(AC-GAN)의 변형을 비지도 도메인 적응 문제에 맞게 수정하여 사용합니다. 주요 구성 요소는 다음과 같습니다:

- **특징 추출 네트워크 (F)**: 입력 이미지 $x$를 특징 임베딩 $F(x)$로 매핑합니다.
- **분류기 네트워크 (C)**: $F(x)$를 입력받아 클래스 확률 분포 $C(x)$를 예측합니다.
- **생성자 네트워크 (G)**: 임베딩 $F(x)$, 무작위 노이즈 벡터 $z$, 클래스 라벨의 원-핫 인코딩 $l$을 결합한 $x_g = [F(x), z, l]$을 입력으로 받아 이미지를 생성합니다. 타겟 샘플의 경우, $l$은 '가짜 클래스'로 설정됩니다.
- **판별자 네트워크 (D)**: 실제 이미지 $x$ 또는 생성된 이미지 $G(x_g)$를 입력받아 다음 두 가지 분포를 출력합니다:
  1. $D_{data}(x)$: 입력이 실제(real)인지 가짜(fake)인지에 대한 이진 확률.
  2. $D_{cls}(x)$: 입력의 클래스 확률 분포 (AC-GAN의 보조 분류기 역할).

학습은 D, G, F, C 네트워크를 번갈아 최적화하는 방식으로 진행됩니다:

1. **판별자 (D) 업데이트**:

   - 소스 이미지를 사용하여 $D_{data}$와 $D_{cls}$를 업데이트합니다. $D_{data}$는 실제 소스 이미지를 '실제'로, 생성된 소스 이미지를 '가짜'로 분류하도록 학습하고, $D_{cls}$는 소스 라벨과 일치하도록 분류합니다.
   - 라벨이 없는 타겟 이미지를 기반으로 생성된 타겟 이미지를 '가짜'로 분류하도록 $D_{data}$를 업데이트합니다.
     $$ L*D = L*{data,src} + L*{cls,src} + L*{adv,tgt} $$
    $$ L*{data,src} = \max_D E*{x \sim S} [\log(D_{data}(x)) + \log(1 - D_{data}(G(f_g)))] $$
    $$ L*{cls,src} = \max_D E*{x \sim S} [\log(D_{cls}(x)_y)] $$
    $$ L*{adv,tgt} = \max_D E*{x \sim T} [\log(1 - D_{data}(G(h_g)))] $$

2. **생성자 (G) 업데이트**:

   - 소스 데이터를 사용하여 $G$를 업데이트하여 $D$를 속이고, 실제와 같으면서 클래스 일관성 있는 이미지를 생성하도록 합니다.
     $$ L*G = \min_G E*{x \sim S} [-\log(D_{cls}(G(f_g))_y) + \log(1 - D_{data}(G(f_g)))] $$

3. **특징 추출 네트워크 (F) 및 분류기 (C) 업데이트**:
   - 소스 이미지를 사용하여 $F$와 $C$를 전통적인 지도 학습 방식으로 업데이트합니다 ($L_C$).
   - $F$는 또한 $D$의 적대적 그래디언트를 사용하여 업데이트됩니다. 이는 특징 학습과 이미지 생성 과정이 원활하게 상호작용하도록 합니다.
   - 타겟 데이터를 사용하여 $F$를 업데이트합니다. $F$는 생성된 타겟 이미지가 $D$에 의해 '실제'로 분류되도록 유도하며, 이를 통해 타겟 임베딩이 소스 분포와 정렬되도록 합니다.
     $$ L*F = L_C + \alpha L*{cls,src} + \beta L*{F*{adv}} $$
    $$ L*C = \min_C \min_F E*{x \sim S} [-\log(C(F(x))_y)] $$
    $$ L*{cls,src} = \min_F E*{x \sim S} [-\alpha \log(D_{cls}(G(f_g))_y))] $$
    $$ L*{F*{adv}} = \min*F E*{x \sim T} [\beta \log(1 - D_{data}(G(h_g)))] $$
    여기서 $\alpha$와 $\beta$는 분류 손실과 적대적 손실 간의 균형을 조절하는 계수입니다. $G$-$D$ 쌍의 생성 능력이 타겟 데이터에 대한 클래스 일관성 있는 임베딩 생성에 필요한 그래디언트를 제공하는 '공생 관계'가 이 방법의 핵심입니다.

## 📊 Results

이 연구는 DIGITS, OFFICE, Synthetic-to-Real 데이터셋에 걸쳐 광범위한 실험을 수행하여 제안된 방법의 우수성을 입증했습니다.

- **DIGITS 데이터셋 (MNIST, USPS, SVHN)**:

  - MNIST $\leftrightarrow$ USPS 및 SVHN $\rightarrow$ MNIST와 같은 도메인 적응 태스크에서 모든 비교 방법들을 능가하는 최첨단 성능을 달성했습니다.
  - 예를 들어, SVHN $\rightarrow$ MNIST에서 소스 전용 모델의 60.3%에서 92.4%로 성능을 크게 향상시켰으며, 이는 32.1%p의 성능 향상에 해당합니다.
  - t-SNE 시각화 결과, 적응 후 소스 및 타겟 분포가 클래스 일관성 있게 가까워졌음을 보여줍니다.

- **OFFICE 데이터셋 (Amazon, Webcam, DSLR)**:

  - 데이터셋 규모가 작아 GAN 학습이 어려운 환경임에도 불구하고, 모든 적응 설정에서 최첨단 성능을 달성했습니다.
  - 특히, A→W, A→D, W→A, D→A와 같은 어려운 전이 케이스에서 일관되게 좋은 성능 향상을 보였습니다.
  - 이는 이미지 생성 품질이 다소 낮더라도, 생성 과정이 특징 추출 네트워크에 의미 있는 그래디언트 정보를 제공하여 도메인 불변 특징 표현을 학습하는 데 충분했음을 시사합니다.

- **Synthetic-to-Real 데이터셋 (CAD $\rightarrow$ PASCAL VOC)**:

  - CAD 합성 데이터셋에서 PASCAL VOC 실제 이미지로의 적응과 같은 높은 도메인 차이가 있는 가장 어려운 시나리오에서도 우수한 성능을 보였습니다.
  - 소스 전용 VGGNet 모델의 38.1%에서 50.4%로 성능을 크게 향상시켜, 비교 대상 방법들보다 뛰어났습니다.
  - ResNet-50을 사용한 추가 실험에서도 소스 전용 모델 대비 큰 성능 향상(30.2% $\rightarrow$ 46.5%)을 확인했습니다.

- **VISDA Challenge**:

  - 대규모 비지도 도메인 적응 챌린지인 VISDA 데이터셋에서도 기준 모델 대비 상당한 성능 향상(예: Resnet-152 44.5% $\rightarrow$ 77.1%)을 달성했습니다.

- **Ablation Study (OFFICE A→W)**:
  - 판별자의 real/fake 분류기($C_1$)만 사용했을 때도 성능 향상(68.4% $\rightarrow$ 80.5%)이 있었지만, 보조 분류기($C_2$)를 함께 사용했을 때 가장 좋은 성능(89.5%)을 달성했습니다.
  - $C_2$의 사용은 전통적인 GAN의 모드 붕괴(mode collapse) 문제를 완화하고, 클래스 일관성을 보장하여 GAN 훈련을 안정화하는 데 중요함이 확인되었습니다.

## 🧠 Insights & Discussion

이 연구의 핵심 통찰은 GAN이 반드시 완벽하게 사실적인 이미지를 생성해야만 도메인 적응에 효과적인 것은 아니라는 점입니다. 오히려, GAN의 생성-판별 메커니즘을 통해 얻어지는 '풍부한 그래디언트 정보'가 특징 추출 네트워크로 역전파되어, 소스와 타겟 도메인 간의 도메인 불일치를 줄이는 데 결정적인 역할을 합니다.

- **"생성"의 새로운 역할**: 기존 GAN 기반 접근 방식이 생성된 이미지를 직접적인 데이터 증강에 활용하는 것과 달리, 이 방법은 GAN을 특징 공간 정렬을 위한 강력한 그래디언트 소스로 활용합니다. 이는 이미지 생성이 어려운 복잡한 데이터셋(예: OFFICE)에서도 성공적인 적응을 가능하게 합니다.
- **공생 관계**: 학습된 임베딩(F)과 생성-판별 쌍(G-D) 간의 공생 관계가 중요합니다. G는 소스 데이터에서 클래스 조건부 정보를 학습하고, 이 정보는 타겟 임베딩에 대한 클래스 일관성 있는 그래디언트를 제공하여 F가 도메인 불변 임베딩을 학습하도록 돕습니다.
- **보조 분류기의 중요성**: 판별자에 통합된 보조 분류기(AC-GAN 구조)는 GAN 훈련의 안정화에 기여하고, 모드 붕괴를 방지하며, 생성된 이미지가 클래스 일관성을 유지하도록 함으로써 전체 시스템의 성능을 크게 향상시킵니다.
- **한계 및 향후 연구**: 하이퍼파라미터(예: $\alpha$, $\beta$, 노이즈 벡터 차원)에 대한 민감도가 완전히 해결된 것은 아니지만, 실험을 통해 합리적인 범위 내에서 안정적인 성능을 보였습니다. 향후 연구로는 더 강력한 인코더 아키텍처 적용 및 RGB-D 객체 인식, 의료 영상과 같은 더 도전적인 도메인 적응 문제에 대한 적용이 제안됩니다.

## 📌 TL;DR

이 논문은 비지도 도메인 적응을 위해 생성적 적대 신경망(GAN)을 활용하는 새로운 방법을 제안합니다. 핵심 아이디어는 학습된 특징 임베딩과 GAN 사이에 '공생 관계'를 구축하여, GAN이 소스 및 타겟 도메인 데이터를 모두 클래스 일관성 있게 생성하도록 학습하고, 이 과정에서 발생하는 풍부한 그래디언트 정보를 통해 특징 추출 네트워크가 도메인 불변 임베딩을 학습하도록 유도하는 것입니다. DIGITS, OFFICE, Synthetic-to-Real 등 다양한 데이터셋에서 기존 최첨단 방법들을 능가하는 성능을 달성했으며, 특히 이미지 생성 품질이 낮더라도 GAN이 특징 공간 정렬을 위한 강력한 수단으로 활용될 수 있음을 보여주었습니다.
