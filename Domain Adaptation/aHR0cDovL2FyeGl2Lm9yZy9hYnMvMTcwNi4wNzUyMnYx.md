# Deep Hashing Network for Unsupervised Domain Adaptation

Hemanth Venkateswara, Jose Eusebio, Shayok Chakraborty, Sethuraman Panchanathan

## 🧩 Problem to Solve

심층 신경망은 다양한 응용 분야에서 뛰어난 성능을 보이지만, 훈련을 위해서는 대규모의 레이블된 데이터가 필요하며, 이는 시간, 인력, 전문성 측면에서 비용이 많이 듭니다. 도메인 적응(Domain Adaptation)은 관련성이 있는 다른 소스 도메인의 레이블된 데이터를 활용하여 타겟 도메인의 모델을 개발하는 방식으로 이 문제를 해결하려 합니다. 특히, 타겟 도메인에 레이블된 데이터가 전혀 없는 비지도 도메인 적응(Unsupervised Domain Adaptation)은 더욱 어려운 과제입니다.

또한, 폭발적인 디지털 데이터 증가로 인해 효율적인 데이터 저장 및 검색의 필요성이 증대되었으며, 해싱(Hashing) 기술이 각광받고 있습니다. 이 연구는 심층 신경망의 특징 학습 능력을 활용하여 비지도 도메인 적응 문제를 해결하기 위한 정보성 해시 코드를 학습하는 방법을 제시합니다.

## ✨ Key Contributions

- **새로운 데이터셋 공개:** 도메인 적응 알고리즘 평가를 위해 일상 사물 이미지를 포함하는 `Office-Home` 데이터셋을 새롭게 공개했습니다.
- **DAH 프레임워크 제안:** 레이블된 소스 데이터와 레이블되지 않은 타겟 데이터를 활용하여 정보성 해시 코드를 학습하는 새로운 딥러닝 프레임워크인 DAH(Domain Adaptive Hashing)를 제안했습니다.
- **최초의 연구:** 딥 신경망의 특징 학습 능력과 해시 코드 학습을 비지도 도메인 적응 문제에 통합한 최초의 연구입니다.
- **우수한 성능:** 여러 전이 학습(transfer task) 실험에서 기존의 경쟁력 있는 비지도 도메인 적응 베이스라인보다 효율적인 해시 코드 학습과 분류 성능에서 뛰어남을 입증했습니다.

## 📎 Related Works

- **얕은 전이 학습(Shallow Transfer Learning):** 특징 추출 후 도메인 정렬(예: GFK, TCA, CORAL, JDA 등)을 수행하는 접근 방식이 있습니다. MMD(Maximum Mean Discrepancy)를 사용하여 비선형적으로 도메인 불일치를 줄이는 방법도 활용됩니다.
- **깊은 전이 학습(Deep Transfer Learning):** 심층 신경망의 특징 학습 능력을 활용하여 전이 가능한 특징 표현을 학습합니다. GAN(Generative Adversarial Network) 기반의 DANN(Domain Adversarial Neural Network)이나 DAN(Deep Adaptation Network)과 같이 MMD를 활용하는 방식이 대표적입니다.
- **비지도 해싱(Unsupervised Hashing):** 효율적인 데이터 저장 및 검색을 위해 고유한 해시 코드를 추출하는 기술(예: ITQ, KMeans, BA, BDNN)이 있으며, 신경망 기반 해싱도 발전했습니다.
- **교차-모달 해싱(Cross-modal Hashing):** 텍스트와 이미지와 같은 다중 모달 데이터에 대한 공통 해시 코드를 학습하지만, 이는 비지도 도메인 적응과는 다른 목표를 가집니다.

이 연구는 기존에 깊은 해싱과 비지도 도메인 적응을 통합한 연구가 없었다는 점을 강조하며, DAH가 이 간극을 메운다고 주장합니다.

## 🛠️ Methodology

DAH(Domain Adaptive Hashing) 네트워크는 VGG-F 네트워크를 기반으로 소스 도메인의 레이블된 데이터($D_s = \{ \mathbf{x}_i^s, \mathbf{y}_i^s \}_{i=1}^{n_s}$)와 타겟 도메인의 레이블되지 않은 데이터($D_t = \{ \mathbf{x}_i^t \}_{i=1}^{n_t}$)를 사용하여 정보성 해시 코드를 학습합니다.

핵심 방법론은 다음 구성 요소를 포함하는 고유한 손실 함수를 사용하여 심층 신경망을 훈련하는 것입니다:

1. **도메인 불일치 감소 (MK-MMD Loss):**

   - 소스와 타겟 간의 특징 표현 불일치를 최소화하기 위해 다중 커널 최대 평균 불일치(Multi-kernel Maximum Mean Discrepancy, MK-MMD) 손실을 사용합니다.
   - 이는 네트워크의 완전 연결 계층(fc6, fc7, fc8)에서 소스 및 타겟 특징 표현 간의 분포 차이를 줄입니다.
   - 손실 함수는 다음과 같습니다:
     $$ M(U*s, U_t) = \sum*{l \in F} d_k^2(U_s^l, U_t^l) $$
        여기서 $U_s^l$, $U_t^l$은 $l$번째 계층의 소스 및 타겟 출력 표현이며, $d_k^2(.)$는 MK-MMD를 측정합니다.

2. **소스 데이터용 지도 해시 손실 (Supervised Hash Loss):**

   - 레이블된 소스 데이터를 사용하여 동일 클래스에 속하는 샘플은 유사한 해시 코드를 갖도록 학습합니다.
   - 해밍 거리와 내적 관계를 활용하여 유사성 행렬 $S$를 기반으로 음의 로그 우도(negative log likelihood)를 최소화합니다.
   - 이산적인 해시 코드 제약 $\mathbf{h}_i \in \{-1,+1\}^d$을 $\mathbf{u}_i \in \mathbb{R}^d$로 완화하고, $\text{tanh}()$ 활성화와 배치 정규화를 사용하여 출력을 $[-1, +1]$ 범위로 제한합니다.
   - 또한 양자화 오차를 줄이기 위해 $\sum_{i=1}^{n_s} \| \mathbf{u}_i - \text{sgn}(\mathbf{u}_i) \|_2^2$ 항을 추가합니다.
   - 손실 함수는 다음과 같습니다:
     $$ L(U*s) = - \sum*{s*{ij} \in S} \left( s*{ij} \mathbf{u}_i^\top \mathbf{u}\_j - \log \left( 1 + \exp(\mathbf{u}\_i^\top \mathbf{u}\_j) \right) \right) + \sum_{i=1}^{n_s} \| \mathbf{u}\_i - \text{sgn}(\mathbf{u}\_i) \|\_2^2 $$

3. **타겟 데이터용 비지도 엔트로피 손실 (Unsupervised Entropy Loss):**
   - 레이블이 없는 타겟 데이터를 위해 각 타겟 샘플이 정확히 하나의 소스 카테고리와 밀접하게 정렬되고 다른 카테고리와는 구별되도록 합니다.
   - 타겟 샘플이 각 소스 카테고리에 속할 확률을 계산하고, 이 확률 벡터의 엔트로피를 최소화하여 원-핫(one-hot) 벡터에 가깝게 만듭니다.
   - 손실 함수는 다음과 같습니다:
     $$ H(U*s, U_t) = - \frac{1}{n_t} \sum*{i=1}^{n*t} \sum*{j=1}^C p*{ij} \log(p*{ij}) $$
        여기서 $p_{ij}$는 $i$번째 타겟 데이터 포인트가 $j$번째 카테고리에 할당될 확률입니다.

**최종 목적 함수:** DAH 네트워크는 다음 통합 손실 함수를 최소화하도록 훈련됩니다.
$$ \min\_{U} J = L(U_s) + \gamma M(U_s, U_t) + \eta H(U_s, U_t) $$
여기서 $\gamma$와 $\eta$는 도메인 적응 및 타겟 엔트로피 손실의 중요도를 제어하는 가중치입니다. 해시 값 $\mathbf{H}$는 네트워크 출력 $\mathbf{U}$에 $\text{sgn}(\cdot)$ 함수를 적용하여 얻습니다.

**네트워크 아키텍처:** VGG-F 네트워크의 `conv1`~`conv5`, `fc6`, `fc7` 계층을 전이 학습(fine-tuning)하고, `fc8` 계층 대신 `hash-fc8` 계층을 도입하여 $d$차원 벡터를 출력합니다. `hash-fc8`은 `fc8` $\rightarrow$ `batch-norm` $\rightarrow$ `tanh()`로 구성되어 그래디언트 소실 문제를 완화하고 안정적인 훈련을 가능하게 합니다.

## 📊 Results

- **Office-Home 데이터셋 소개:** 총 4개 도메인(Art, Clipart, Product, Real-World), 65개 카테고리, 약 15,500개의 이미지로 구성된 새로운 데이터셋을 공개했으며, 이는 딥러닝 기반 도메인 적응 연구에 적합합니다.
- **비지도 도메인 적응 성능:**
  - **Office-Home 데이터셋:** DAH는 모든 도메인 전이 작업에서 GFK, TCA, CORAL, JDA와 같은 얕은 학습 기반 방법론과 DAN, DANN과 같은 심층 학습 기반 방법론을 일관되게 능가했습니다. 특히, DAH는 평균 45.54%의 정확도를 달성하여 DANN(44.94%)보다 우수했습니다.
  - **Office 데이터셋:** DANN이 DAH보다 약간 더 나은 성능을 보였는데, 이는 카테고리 수가 적을 때 도메인 적대적 훈련이 더 효과적일 수 있음을 시사합니다. 카테고리 수가 많을수록 DAH가 더 높은 정확도를 달성했습니다.
  - **엔트로피 손실의 중요성:** 엔트로피 손실($\eta=0$인 DAH-e)을 사용하지 않은 DAH-e는 DAH보다 성능이 떨어져, 타겟 데이터에 대한 엔트로피 최소화가 소스와 타겟 샘플의 정렬을 개선하고 정확도를 높이는 데 기여함을 입증했습니다.
- **특징 분석:** `fc7` 계층의 특징 표현에 대한 A-거리 및 t-SNE 임베딩 분석 결과, DAH 특징이 DAN 및 Deep 특징에 비해 소스와 타겟 도메인 간의 불일치가 가장 적고, 시각적으로도 더 나은 클러스터링 및 도메인 중첩을 보였습니다.
- **비지도 도메인 적응 해싱 성능:**
  - DAH는 NoDA(도메인 적응 없는 해싱), ITQ, KMeans, BA, BDNN과 같은 기존의 비지도 해싱 방법론보다 월등히 뛰어난 mAP(mean Average Precision)를 기록했습니다.
  - 이는 DAH가 소스 도메인의 레이블된 데이터를 의미 있게 활용하여 타겟 도메인에 효율적인 해시 코드를 학습하는 능력을 갖췄음을 보여줍니다.
  - DAH는 지도 해싱(SuH) 성능에 근접하며, 경우에 따라 SuH를 능가하기도 했습니다. 해시 코드 길이(16비트, 64비트, 128비트)에 따른 성능 변화도 분석되었으며, 64비트에서 가장 좋은 평균 성능을 보였습니다.

## 🧠 Insights & Discussion

- 이 연구는 딥러닝 기반의 특징 학습 능력과 해시 코드 생성을 비지도 도메인 적응과 통합함으로써, 약한 지도 학습(weak supervision) 환경에서의 카테고리 할당과 비지도 환경에서의 해시 코드 추정이라는 두 가지 중요한 실용적 문제를 단일 통합 프레임워크 내에서 해결했습니다.
- DAH 프레임워크는 소스 도메인의 레이블 정보를 활용하여 타겟 도메인에 대한 판별적인 해시 코드를 학습하는 데 매우 효과적임을 입증했습니다. 이는 실제 세계의 데이터 불균형 상황에서 매우 유용할 것입니다.
- 특히, 타겟 데이터에 대한 비지도 엔트로피 손실은 타겟 샘플의 예측 확률 분포를 원-핫 벡터에 가깝게 만들어, 학습된 해시 코드가 타겟 도메인에서 보다 명확하고 판별적인 분류를 가능하게 하는 데 결정적인 역할을 합니다.
- DAH가 카테고리 수가 더 많은 Office-Home 데이터셋에서 DANN보다 우수한 성능을 보인 것은, 카테고리가 많고 복잡한 도메인 전환 시나리오에서 DAH의 강점을 시사합니다. 도메인 정렬이 카테고리에 무관하게 이루어질 경우, 카테고리 수가 많을수록 정렬된 도메인이 분류에 불리할 수 있지만, DAH는 이를 잘 극복합니다.
- Office-Home이라는 새로운 데이터셋의 도입은 딥러닝 기반 도메인 적응 연구의 발전에 크게 기여할 것입니다.

## 📌 TL;DR

이 논문은 레이블된 데이터가 부족한 환경에서 발생하는 도메인 적응 문제와 대규모 데이터의 효율적인 저장/검색을 위한 해싱 문제를 동시에 해결합니다. 저자들은 딥러닝 기반의 비지도 도메인 적응 해싱(DAH) 프레임워크를 제안하여, 소스 도메인의 레이블된 데이터와 타겟 도메인의 레이블 없는 데이터를 활용해 정보성 해시 코드를 학습합니다. DAH는 지도 해시 손실, 비지도 엔트로피 손실, MK-MMD 손실의 세 가지 구성 요소를 통해 소스-타겟 도메인 불일치를 줄이고, 타겟 데이터에 대한 판별적인 해시 코드를 생성합니다. 새로운 Office-Home 데이터셋과 기존 Office 데이터셋에 대한 광범위한 실험을 통해, DAH는 기존 비지도 도메인 적응 및 해싱 방법론보다 우수한 성능을 보여, 깊은 특징 학습과 해시 코드 생성을 통합한 효과적인 솔루션을 제시합니다.
