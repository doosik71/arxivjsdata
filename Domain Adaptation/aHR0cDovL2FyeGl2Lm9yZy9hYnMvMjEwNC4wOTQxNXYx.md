# Cross-Domain Adaptive Clustering for Semi-Supervised Domain Adaptation

Jichang Li, Guanbin Li, Yemin Shi, Yizhou Yu

## 🧩 Problem to Solve

기존 준지도 도메인 적응(Semi-Supervised Domain Adaptation, SSDA) 방법론들은 소스 도메인의 레이블된 샘플이 학습 데이터를 지배하기 때문에 타겟 도메인에 대해 고도로 식별적인 특징 표현을 생성하기 어렵습니다. 이는 다음 문제로 이어집니다:

- 레이블된 타겟 샘플과 레이블되지 않은 타겟 샘플 간의 **단절(disconnection)**.
- 레이블되지 않은 타겟 샘플과 소스 도메인 간의 **불일치(misalignment)**.

본 논문은 이러한 문제들을 해결하여 도메인 간 적응(inter-domain adaptation)과 도메인 내 적응(intra-domain adaptation)을 동시에 달성하는 것을 목표로 합니다.

## ✨ Key Contributions

- SSDA 문제를 해결하기 위해 도메인 간 **클러스터별 특징 정렬(cluster-wise feature alignment)**을 수행하는 **적대적 적응형 클러스터링 손실($L_{AAC}$)**을 도입했습니다.
- 적대적 학습을 촉진하기 위해 타겟 도메인 내 클러스터 코어의 견고성과 성능을 향상시키기 위한 **어댑티브 의사 레이블링(pseudo labeling)** 기법을 통합했습니다.
- DomainNet, Office-Home, Office와 같은 벤치마크 데이터셋에 대한 광범위한 실험을 통해 제안된 CDAC(Cross-domain Adaptive Clustering) 접근 방식이 준지도 도메인 적응 분야에서 **최첨단 성능**을 달성함을 입증했습니다.

## 📎 Related Works

- **비지도 도메인 적응(Unsupervised Domain Adaptation, UDA)을 위한 적대적 학습:** DANN(Domain-Adversarial Neural Network)과 같은 초기 연구는 도메인 간 특징 분포 정렬에 중점을 두었으며, Saito et al. [33]은 분류기 불일치를 최대화하여 타겟 샘플을 감지했습니다. ENT [11]와 ADVENT [40]는 엔트로피 기반 적대적 학습을 도입했습니다. 본 연구는 이러한 샘플별 적대적 학습과 달리 **클러스터별 특징 정렬**을 제안합니다.
- **UDA의 의사 레이블링(Pseudo Labeling):** 준지도 학습에서 신뢰할 수 있는 의사 레이블을 생성하여 모델 학습 및 일반화 성능을 향상시키는 데 사용되는 기법입니다 [20, 11]. FixMatch [35]와 같은 기법은 여러 증강된 입력 또는 다른 모델의 출력을 통합하여 의사 레이블의 신뢰성을 높였습니다. 본 논문은 이를 활용하여 타겟 도메인의 클러스터 코어를 강화합니다.
- **준지도 도메인 적응(SSDA):** 타겟 도메인의 소수 레이블된 샘플을 활용하여 도메인 적응 성능을 크게 향상시키는 것을 목표로 합니다. MME [32], UODA [29], BiAT [15], APE [17] 등 기존 SSDA 방법론의 대부분은 **샘플별 특징 정렬**에 기반합니다. 본 연구는 의사 레이블링과 결합된 **적응형 클러스터별 특징 정렬**을 통해 도메인 간 및 도메인 내 적응을 동시에 시도합니다.

## 🛠️ Methodology

본 논문은 다음 구성 요소를 포함하는 Cross-domain Adaptive Clustering (CDAC) 접근 방식을 제안합니다:

- **특징 추출기($G$) 및 분류기($F$):** 특징 추출기($G$)와 정규화 레이어를 가진 비편향 선형 분류기($F$)로 구성됩니다. 분류기($F$)는 특징을 구형 특징 공간으로 매핑하여 동일 클래스 샘플의 특징 분산을 감소시킵니다.
- **교차 엔트로피 손실($L_{CE}$):** 소스 및 타겟 도메인의 모든 레이블된 데이터에 대한 표준 지도 학습 손실입니다.
  $$L_{CE} = - \sum_{(x,y) \in S \cup L} y \log(p(x))$$
- **적대적 적응형 클러스터링 손실($L_{AAC}$):**
  - 타겟 도메인의 레이블되지 않은 샘플 특징을 클러스터로 그룹화하고 도메인 간 클러스터별 특징 정렬을 수행합니다.
  - 동일한 미니배치 내의 레이블되지 않은 타겟 샘플 쌍($x^u_i, x^u_j$) 간의 **쌍별 유사도($s_{ij}$)**를 계산합니다. 이는 두 샘플이 상위 $k$개의 특징 인덱스를 공유하면 $1$, 아니면 $0$으로 설정됩니다.
    $$s_{ij} = 1\{\text{topk}(G(x^u_i)) = \text{topk}(G(x^u_j))\}$$
  - 이 쌍별 유사도를 타겟으로 사용하여 이진 교차 엔트로피 손실을 최소화하여 타겟 도메인 내에서 특징이 클러스터를 형성하도록 유도합니다.
    $$L_{AAC} = - \sum_{i=1}^M \sum_{j=1}^M \left[ s_{ij} \log(p_i^T p'_j) + (1-s_{ij}) \log(1-p_i^T p'_j) \right]$$
  - Minimax 최적화를 통해 특징 추출기($G$)는 $L_{AAC}$를 최소화하여 타겟 특징이 클러스터를 형성하도록 하고, 분류기($F$)는 $L_{AAC}$를 최대화하여 소스 도메인에 대한 특징 표현의 편향을 줄이고 도메인 불변 특징을 생성하도록 합니다.
- **의사 레이블링 손실($L_{PL}$):**
  - 레이블되지 않은 타겟 샘플에 대해 높은 신뢰도의 의사 레이블($\hat{y}^u_j$)을 생성하여 타겟 도메인의 "레이블된" 샘플 수를 늘리고, 더 견고하고 강력한 클래스별 클러스터 코어를 형성합니다.
  - 모델의 예측($p_j$)을 원-핫 하드 레이블($\hat{y}^u_j = \text{arg max}(p_j)$)로 변환하고, 신뢰도 임계값($\tau$) 이상의 의사 레이블만 사용합니다.
  - 데이터 증강된 이미지($x''_j$)의 예측($p(x''_j)$)에 대해 표준 교차 엔트로피 손실을 적용합니다.
    $$L_{PL} = - \sum_{j=1}^M 1\{\text{max}(p_j) \ge \tau\} \cdot \hat{y}^u_j \log(p(x''_j))$$
- **일관성 손실($L_{Con}$):**
  - 두 가지 다른 변형된 타겟 이미지($x'_j, x''_j$)에 대한 모델 예측이 일관성을 유지하도록 합니다.
    $$L_{Con} = w(t) \sum_{j=1}^M ||p'_j - p''_j||^2$$
    여기서 $w(t)$는 램프-업 함수입니다.
- **전체 손실 함수:** 특징 추출기($G$)와 분류기($F$)는 다음 목적 함수를 사용하여 minimax 방식으로 학습됩니다.
  $$ \theta^_*G = \text{arg min}*{\theta*G} \left( L*{CE} + \lambda L*{AAC} + L*{PL} + L\_{Con} \right) $$
    $$ \theta^__F = \text{arg min}_{\theta*F} \left( L*{CE} - \lambda L*{AAC} + L*{PL} + L\_{Con} \right) $$

## 📊 Results

- **최첨단 성능 달성:** DomainNet, Office-Home, Office 벤치마크 데이터셋에서 Alexnet 및 Resnet34 백본 네트워크를 사용하여 1-shot 및 3-shot 설정 모두에서 기존의 최첨단 SSDA 방법론들을 크게 능가하는 성능을 달성했습니다.
  - **DomainNet:** Alexnet 백본에서 1-shot 및 3-shot 설정에서 각각 평균 6.6%, 6.8% 향상. Resnet34 백본에서 각각 6%, 4.3% 향상.
  - **Office-Home 및 Office:** 두 데이터셋 모두에서 평균 정확도 측면에서 비교 방법들을 능가하는 우수한 성능을 보였습니다.
- CDAC는 ResNet34 백본을 사용한 DomainNet 3-shot 설정에서 동시 연구인 MiCo보다 0.4% 높은 평균 성능을 보였습니다.

## 🧠 Insights & Discussion

- **어블레이션 연구:** 각 손실 항($L_{CE}, L_{AAC}, L_{PL}, L_{Con}$)의 효과를 분석한 결과, $L_{AAC}$와 $L_{PL}$을 $L_{CE}$와 함께 사용했을 때 baseline 대비 평균 25.3% 더 높은 성능을 보였습니다. 이는 각 구성 요소가 분류 성능 향상에 중요한 역할을 함을 입증합니다.
- **적대적 적응형 클러스터링의 효과:** Cluster Core Distance (CCD)를 사용하여 도메인 간 특징 클러스터 간의 거리를 측정했습니다. CDAC는 "CDAC w/o PL" (의사 레이블링 제거 버전) 및 S+T보다 CCD를 가장 낮은 값으로 수렴시켜, 제안된 적대적 적응형 클러스터링 손실이 더 나은 클러스터별 특징 정렬을 유도하는 데 효과적임을 보여줍니다.
- **의사 레이블링의 효과:** 의사 레이블링 기법이 레이블되지 않은 데이터의 상당 부분(각각 최대 59.9% 및 63.8%)에 정확한 의사 레이블을 부여하는 것으로 나타났습니다. 이는 타겟 도메인 내에서 견고한 클러스터 코어를 구축하는 데 의사 레이블링의 유효성을 증명합니다.
- **특징 시각화:** t-SNE [24]를 통한 특징 분포 시각화는 학습이 진행됨에 따라 타겟 특징이 타겟 클러스터 코어로 점진적으로 수렴하고, 각 타겟 클러스터가 해당 소스 클러스터 코어에 가까워지는 클러스터별 특징 정렬 효과를 명확하게 보여주었습니다.

## 📌 TL;DR

본 논문은 SSDA 문제 해결을 위해 **Cross-domain Adaptive Clustering (CDAC)**을 제안합니다. CDAC는 레이블되지 않은 타겟 데이터를 클러스터로 그룹화하고 도메인 간 클러스터별 특징 정렬을 수행하는 **적대적 적응형 클러스터링 손실($L_{AAC}$)**과, 강력한 클러스터 코어 형성을 위한 **의사 레이블링** 기법을 통합합니다. 이 방법은 기존 SSDA 방법의 타겟 도메인 특징 표현 편향 및 샘플 간 불일치 문제를 해결하며, 벤치마크에서 최첨단 성능을 달성했습니다.
