# GPT-DRIVER: LEARNING TO DRIVE WITH GPT

Jiageng Mao, Yuxi Qian, Junjie Ye, Hang Zhao, Yue Wang

## 🧩 Problem to Solve

자율주행의 핵심 과제인 모션 플래닝(motion planning)은 안전하고 편안한 주행 궤적을 계획하는 것을 목표로 합니다. 기존의 휴리스틱 또는 학습 기반 모션 플래너는 새로운 주행 시나리오에 대한 일반화 능력이 부족하며, 특히 학습 기반 모델은 '블랙박스' 방식으로 작동하여 의사결정 과정의 해석 가능성(interpretability)이 떨어집니다. 또한, 대규모 언어 모델(LLM)을 자율주행에 활용하는 데 있어, LLM은 이질적인 센서 입력(지도, 인지 결과 등)을 직접 처리하기 어렵고, 고정밀 수치 추론(예: 좌표 값 예측) 능력이 불분명하다는 문제가 있습니다.

## ✨ Key Contributions

* **GPT-Driver 제안:** OpenAI GPT-3.5 모델을 자율주행 모션 플래너로 변환하는 혁신적인 접근 방식을 제시하며, 모션 플래닝을 언어 모델링 문제로 재구성했습니다.
* **언어 모델링 해석:** GPT 토크나이저의 관점에서 모션 플래닝에서의 언어 모델링의 본질을 직관적으로 해석했습니다. 이는 좌표 값을 정수 부분과 소수 부분으로 분해하여 정밀한 예측을 가능하게 합니다.
* **새로운 전략 개발:** LLM의 수치 추론 잠재력을 자극하기 위해 자율주행에 특화된 프롬프트-추론-미세조정(prompting-reasoning-finetuning) 전략을 제안했습니다.
* **우수한 성능 및 일반화/해석 가능성:** nuScenes 데이터셋에서 기존 최첨단 모션 플래너 대비 우수한 계획 성능, 뛰어난 few-shot 일반화 능력, 그리고 향상된 해석 가능성을 입증했습니다.

## 📎 Related Works

* **자율주행 모션 플래닝:**
  * **규칙 기반(Rule-based):** IDM(Intelligent Driver Model)과 같이 명시적인 규칙을 사용하며 해석 가능성은 높으나 복잡한 시나리오 처리 능력 부족.
  * **최적화 기반(Optimization-based):** 모션 플래닝을 최적 제어 문제로 공식화.
  * **학습 기반(Learning-based):** 대규모 운전 데이터로부터 학습하며 복잡한 시나리오 처리 능력은 우수하나, NMP, P3, MP3, ST-P3, UniAD와 같은 접근 방식은 의사결정 과정이 '블랙박스'여서 해석 가능성이 낮음.
* **대규모 언어 모델(LLMs):** GPT, GPT-3.5, GPT-4, LLaMA/LLaMA 2 등 광범위한 텍스트 데이터를 학습하여 인간과 유사한 텍스트를 이해하고 생성. InstructGPT, Chain-of-Thought(CoT), ReAct와 같은 기법으로 LLM의 추론 능력이 향상됨.
* **LLM의 로봇/자율주행 활용:** 이전 연구들은 주로 태스크 레벨의 고수준 액션 계획에 LLM을 사용했으나(예: Ahn et al., Fu et al., Huang et al.), 본 연구는 좌표 기반의 저수준, 고정밀 수치 궤적 계획에 GPT-3.5를 적용한 첫 시도입니다.

## 🛠️ Methodology

GPT-Driver는 모션 플래닝 문제를 언어 모델링 문제로 재정의합니다. 즉, 관측 ($O$) 및 자차 상태 ($S$)를 입력으로 받아 주행 궤적 ($T$)을 계획하는 기존의 함수 $T=F(O,S)$를 언어 모델의 예측 문제로 변환합니다.

1. **입력 및 출력의 언어 토큰화:**
    * **입력:** 자차 정보, 지도 데이터, 인지 및 예측 결과와 같은 이질적인 플래너 입력은 클래스 이름, 위치, 속도 등의 매개변수화된 정보로 변환되어 자연어 설명 형태의 언어 프롬프트로 변환됩니다.
    * **출력:** 계획된 궤적 $T = \{(x_1, y_1), \dots, (x_t, y_t)\}$의 각 웨이포인트 좌표는 GPT 토크나이저 $K$를 사용하여 "23.17"이 "23", ".", "17"로 분해되는 것처럼 일련의 언어 토큰으로 변환됩니다.
    * **학습:** 인간 주행 궤적 $\hat{T}$에서 파생된 토큰 $\hat{w}$의 발생 확률 $P(\hat{w}_i | w_1, \dots, w_{i-1})$을 최대화하는 언어 모델링 손실 $L_{LM} = -\sum_{i=1}^N \log P(\hat{w}_i | w_1, \dots, w_{i-1})$을 사용하여 모델을 학습합니다.

2. **프롬프트-추론-미세조정(Prompting-Reasoning-Finetuning) 전략:**
    * **프롬프트(Prompting):** 자율주행의 일반적인 문맥 정보(좌표계, 목표 등)와 특정 프레임의 관측 및 자차 상태(인지, 예측, 자차 상태, 과거 궤적, 미션 목표)를 자연어 프롬프트로 GPT-3.5 모델에 제공합니다.
    * **추론(Reasoning - Chain-of-Thought):** 모델은 명시적인 의사결정 과정을 출력하도록 지시받습니다. 이 과정은 다음 3단계로 구성됩니다.
        1. 인지 결과로부터 중요한 객체 식별.
        2. 예측 결과로부터 해당 객체가 자차에 미칠 잠재적 영향 분석.
        3. 위 분석을 바탕으로 고수준 운전 결정(메타 액션) 및 궤적 계획.
        이러한 추론 과정은 모델의 해석 가능성을 높입니다.
    * **미세조정(Fine-tuning):** OpenAI 미세조정 API를 사용하여 LLM의 출력 $\{T, R\}$을 인간 주행 궤적 $\hat{T}$ 및 자동으로 생성된 지상 진실 추론 $\hat{R}$에 맞춰 조정합니다. 추론 과정 $\hat{R}$은 가상의 자차 궤적과 주변 객체들의 겹침 여부를 분석하여 자동으로 생성됩니다.

## 📊 Results

* **성능 비교:** nuScenes 데이터셋에서 평가했을 때, GPT-Driver는 L2 오차(궤적 정확도) 면에서 기존 최첨단 방법(예: UniAD)을 크게 능가했습니다. 평균 L2 오차가 0.84m로 UniAD의 1.03m보다 우수했습니다. 충돌률 면에서는 최상위 방법들과 비슷한 수준(평균 0.44%로 UniAD의 0.31%와 비교 가능)을 유지했습니다. 기존 방법들이 충돌률을 낮추기 위해 후처리 최적화(post-optimization)에 의존하는 반면, GPT-Driver는 그러한 추가적인 기법 없이도 우수한 안전성을 보였습니다.
* **Few-shot 일반화 능력:** 제한된 훈련 데이터(전체 시나리오의 10%만 사용)로 학습했을 때, GPT-Driver는 UniAD보다 훨씬 뛰어난 성능을 보였으며, 이는 LLM의 강력한 일반화 능력과 few-shot 학습 능력을 입증합니다 (GPT-Driver 1.20m L2 vs UniAD 1.80m L2).
* **해석 가능성:** 시각화 결과, GPT-Driver는 주변의 중요한 객체들을 식별하고, 잠재적 영향을 평가하며, 이를 바탕으로 합리적인 고수준 액션(메타 액션)과 부드러운 주행 궤적을 계획하는 과정을 명시적으로 보여주어 뛰어난 해석 가능성을 입증했습니다.
* **미세조정 vs. 인-컨텍스트 학습:** 모션 플래닝 작업에서 미세조정(fine-tuning) 전략이 인-컨텍스트 학습(in-context learning)보다 훨씬 효과적임을 입증했습니다. 인-컨텍스트 학습은 LLM의 컨텍스트 창 제한으로 인해 성능이 크게 떨어집니다 (GPT-Driver 미세조정 0.84m L2 vs 인-컨텍스트 학습 3.17m L2).

## 🧠 Insights & Discussion

* **LLM의 새로운 활용:** 본 연구는 LLM이 단순한 언어 이해 및 생성뿐만 아니라, 자율주행의 모션 플래닝과 같이 고정밀 수치 추론이 요구되는 저수준 작업에도 성공적으로 적용될 수 있음을 보여주었습니다.
* **투명한 의사결정:** Chain-of-Thought 추론 전략을 통해 GPT-Driver는 기존 '블랙박스' 방식의 학습 기반 플래너와 달리, 자율주행 차량의 의사결정 과정을 명시적으로 설명할 수 있어 안전성 및 신뢰도 측면에서 큰 이점을 제공합니다.
* **강력한 일반화:** 적은 양의 훈련 데이터로도 뛰어난 성능을 발휘하는 몇-샷 학습 능력은 GPT-Driver가 다양한 주행 시나리오에 효과적으로 적응할 수 있음을 시사합니다.
* **한계점:**
  * **추론 시간:** OpenAI API의 제한으로 모델의 실시간 추론 시간을 측정할 수 없었으며, 기존 MLP 기반 플래너보다 느릴 가능성이 있습니다. 이는 향후 더 작은 LLM으로의 증류(distillation) 등을 통해 해결될 수 있습니다.
  * **평가 방식:** 현재는 개방 루프(open-loop) 모션 플래닝으로 평가되었으나, 미래에는 오류 누적을 고려한 폐쇄 루프(closed-loop) 평가가 필요합니다.
* **향후 연구:** 추론 시간 최적화 및 고화질 지도(HD map)와 같은 더 많은 센서 관측을 입력 프롬프트에 통합하여 성능을 더욱 향상시키는 방안이 모색될 것입니다.

## 📌 TL;DR

자율주행 모션 플래닝의 일반화 및 해석 가능성 문제를 해결하기 위해, 본 논문은 OpenAI GPT-3.5를 활용한 **GPT-Driver**를 제안합니다. 이 방법은 모션 플래닝을 언어 모델링 문제로 재구성하고, 이질적인 입력/출력을 언어 토큰으로 변환한 후, **프롬프트-추론-미세조정** 전략을 통해 고정밀 웨이포인트 좌표와 해석 가능한 의사결정 과정(chain-of-thought)을 생성합니다. nuScenes 데이터셋에서 GPT-Driver는 궤적 정확도(L2 오차)에서 최첨단 성능을 달성하고, 안전성(충돌률)에서도 필적하며, 특히 뛰어난 few-shot 일반화 능력과 투명한 추론을 통한 향상된 해석 가능성을 입증했습니다.
