# Federated Deep Reinforcement Learning for Privacy-Preserving Robotic-Assisted Surgery

Sana Hafeez, Sundas Rafat Mulkana, Muhammad Ali Imran, and Michele Sevegnani

## 🧩 해결하고자 하는 문제

로봇 보조 수술(Robotic-Assisted Surgery, RAS)에 강화 학습(Reinforcement Learning, RL)을 통합하는 것은 수술 정밀도, 적응성 및 자율적 의사 결정을 향상시킬 잠재력을 가지고 있습니다. 그러나 임상 환경에서 견고한 RL 모델을 개발하는 데에는 다음과 같은 주요 제약이 있습니다:

* 엄격한 환자 데이터 프라이버시 규제.
* 다양한 수술 데이터셋에 대한 접근성 제한.
* 높은 수술 절차 가변성(procedural variability).

기존의 중앙 집중식 RL 훈련 패러다임은 민감한 환자 데이터를 중앙 저장소에 집계하므로 데이터 유출 및 무단 접근에 대한 상당한 프라이버시 위험을 초래하며, 기관별 수술 관행의 미묘한 차이를 충분히 반영하지 못하여 개인화된 수술 의사 결정에 한계가 있습니다.

## ✨ 주요 기여

이 논문은 프라이버시를 보존하는 RAS(Privacy-Preserving Robotic-Assisted Surgery) 분야에 다음과 같은 주요 기여를 합니다:

* **FDRL(Federated Deep Reinforcement Learning) 프레임워크 설계:** FL(Federated Learning)과 DRL(Deep Reinforcement Learning)을 완벽하게 통합하여 여러 의료기관이 협력하면서도 프라이버시를 보존하는 수술 정책 최적화를 가능하게 합니다.
* **동적 정책 적응 메커니즘 제시:** 수술 로봇이 실시간으로 동적으로 변화하는 수술 환경(환자별 조건, 수술 복잡성 등)에 따라 최적의 작업별 정책을 자율적으로 선택하고 실행할 수 있도록 지원하여 수술의 적응성, 정밀도 및 환자 안전을 향상시킵니다.
* **보안 프라이버시 보존 통신 아키텍처 개발:** 동형 암호화(Homomorphic Encryption, HE) 및 보안 집계(Secure Aggregation)를 포함한 고급 암호화 기술을 통합하여 연합 학습 및 집계 과정에서 민감한 의료 데이터의 보안을 강화합니다.
* **포괄적인 성능 평가:** 프라이버시 누출률(Privacy Leakage Rate, PLR) 및 전반적 프라이버시 효율성(Overall Privacy Effectiveness, OPE)과 같은 핵심 지표를 사용하여 제안된 FDRL 프레임워크의 성능을 평가하고, 다양한 데이터 이질성(data heterogeneity) 수준에서 우수한 프라이버시-유틸리티 균형을 달성함을 입증합니다.

## 📎 관련 연구

* **로봇 보조 수술 및 AI 통합:** RAS는 정밀 수술, 환자 외상 감소, 회복 시간 단축 등 혁신을 가져왔으며, AI(특히 RL)는 수술 로봇의 자율성과 역량을 더욱 향상시킬 잠재력을 가집니다. RL은 동적 환경에서 보상 신호를 통해 최적의 행동 시퀀스를 학습하게 합니다.
* **RL 기반 수술 로봇의 도전 과제:** 수술 환경의 이질성, 대규모 다양성 데이터셋의 필요성, 엄격한 데이터 프라이버시 규정(HIPAA, GDPR)이 RL 모델의 광범위한 채택을 방해합니다.
* **연합 학습(FL)의 등장:** FL은 민감한 환자 데이터를 직접 공유하지 않고도 여러 의료기관 간의 협력적 모델 훈련을 가능하게 하는 유망한 분산 학습 패러다임으로 부상했습니다. 각 기관은 로컬에서 모델을 훈련하고, 원시 데이터 대신 집계된 모델 업데이트(예: 기울기, 파라미터 차이)만 중앙 서버와 공유합니다.
* **기존 FL 헬스케어 응용:** FL은 의료 영상 분석, 환자 결과 예측, 임상 분석 등 다양한 헬스케어 분야에서 효과를 입증했지만, RAS의 실시간 동적 의사 결정을 위한 RL과의 견고한 통합은 여전히 초기 단계이며 충분히 탐색되지 않은 분야입니다.

## 🛠️ 방법론

제안된 FDRL(Federated Deep Reinforcement Learning) 프레임워크는 여러 병원이 민감한 환자 데이터를 중앙 집중화하지 않고도 RL 모델을 협력적으로 훈련할 수 있도록 설계되었습니다.

1. **RL 모델링:**
    * 수술 작업은 마르코프 결정 과정(Markov Decision Process, MDP)으로 정식화됩니다.
        * **상태 공간 ($S$):** 환자별 파라미터(활력 징후, 의료 영상 데이터), 수술 조건, 실시간 센서 입력 등.
        * **행동 공간 ($A$):** 로봇 움직임, 도구 조작, 절개 전략 등.
        * **보상 함수 ($R(s,a)$):** 수술 오류에 벌칙을 주고 정밀도에 보상을 줌으로써 최적의 수술 결과 유도.
    * 목표는 예상 누적 보상 $J(\pi) = E\left[\sum_{t=0}^{T} \gamma^{t}R(s_t,a_t) \right]$을 최대화하는 최적 정책 $\pi^*(a|s)$를 학습하는 것입니다.
2. **연합 학습 과정:**
    * **Federated Averaging (FedAvg):** 각 병원 $i$는 로컬 데이터셋 $D_i$를 사용하여 로컬 RL 정책 $\pi_i$ 또는 모델 파라미터 $\theta_i$를 독립적으로 훈련합니다.
    * **비-IID(Non-IID) 데이터 처리:** 의료 데이터의 비-IID 특성을 완화하기 위해 가중치 로컬 업데이트 방식을 도입합니다.
        $$\theta_i \leftarrow \theta_i - \eta\nabla L(\theta_i;D_i) + \lambda(\theta-\theta_i)$$
        여기서 $L(\theta_i;D_i)$는 로컬 손실 함수, $\eta$는 학습률, $\lambda$는 로컬 모델과 글로벌 모델 간의 발산을 제어하는 정규화 항입니다.
    * **글로벌 모델 집계:** 중앙 서버는 각 병원에서 받은 모델 업데이트(가중치 또는 기울기)를 집계하여 글로벌 모델 $\theta$를 생성합니다.
        $$\theta \leftarrow \sum_{i=1}^{N} \frac{n_i}{n} \theta_i$$
        여기서 $n_i$는 병원 $i$의 훈련 샘플 수, $n$은 전체 훈련 샘플 수입니다.
3. **프라이버시 보존 기술:**
    * **차등 프라이버시(Differential Privacy, DP):** 로컬 모델 업데이트를 중앙 서버로 전송하기 전에 가우시안 노이즈 $N(0, \sigma^2)$를 추가하여 프라이버시를 보호합니다.
        $$\nabla L'_i = \nabla L_i + N(0, \sigma^2)$$
        프라이버시 예산 $\epsilon = \frac{\alpha}{2\sigma^2}$로 DP 수준을 제어합니다.
    * **동형 암호화(Homomorphic Encryption, HE) 및 보안 다자간 계산(Secure Multi-Party Computation, SMPC):** 각 병원은 로컬 모델 파라미터를 HE를 사용하여 암호화한 후 서버로 전송합니다. 서버는 암호화된 상태에서 직접 집계 연산을 수행하여 민감한 정보가 노출되는 것을 방지합니다.
        $$\sum_{i=1}^{N} \text{Enc}(\theta_i) = \text{Enc}\left( \sum_{i=1}^{N} \theta_i \right)$$
        집계 후, 신뢰할 수 있는 글로벌 서버만이 개인 키를 사용하여 암호화된 글로벌 모델을 복호화합니다.

4. **동적 정책 적응 메커니즘:**
    * 글로벌 RL 모델은 새로운 환자를 만났을 때, 수술 유형, 환자 건강 지표, 특정 정책의 과거 성능 등 요인을 고려하여 가장 관련성 높은 정책을 동적으로 선택합니다.
    * 메타 학습 접근 방식을 기반으로 최적 정책을 선택합니다.
        $$\pi^*(s) = \arg \max_{\pi_i} E[J(\pi_i)|s]$$
        여기서 $\pi_i$는 연합 노드에서 학습된 개별 정책을 나타냅니다.
    * **동적 정책 적응률($\alpha_{\text{adapt}}$):** 환자 상태 변화에 대한 정책 전환 능력을 측정합니다.
        $$\alpha_{\text{adapt}} = \frac{\sum_{i=1}^{N} \sum_{t=1}^{T} I(d(s_t,s_{t-1})> \theta) \cdot I(a_t \neq a_{t-1})}{\sum_{t=1}^{T} I(d(s_t,s_{t-1})> \theta)}$$

5. **평가 지표:**
    * **작업별 정확도($A_{\text{task}}$):** 정의된 수술 작업을 전문가 벤치마크 대비 얼마나 잘 수행하는지 측정합니다.
    * **수술 위험 완화 점수($R_{\text{mit}}$):** 로봇 보조 수술 중 위험(과도한 힘 적용, 의도치 않은 조직 손상, 치명적 오류)을 최소화하는 능력을 측정합니다.
        $$D_t = w_1 F_t + w_2 T_{d,t} + w_3 C_t$$
        여기서 $F_t$는 힘, $T_{d,t}$는 조직 손상, $C_t$는 치명적 오류, $w_1, w_2, w_3$는 가중 계수입니다. $R_{\text{mit}} = 1 - \frac{1}{N} \sum_{i=1}^{N} \frac{\sum_{t=1}^{T} D^i_t}{T}$로 계산됩니다.

## 📊 결과

* **시뮬레이션 환경:** Python 기반의 합성 수술 환경을 개발하여 여러 병원 사이트에서의 수술 절차를 시뮬레이션했습니다. 각 병원은 고유한 환자 데이터 분포와 수술 전문 분야를 가집니다.
* **프라이버시 누출률(PLR) 감소:** FDRL은 기존 중앙 집중식 RL 대비 프라이버시 누출을 약 **60%** 감소시키는 것으로 나타났습니다(Fig. 3a). 이는 데이터 집계 없이 모델 훈련을 분산함으로써 강력한 프라이버시 보존을 의미합니다.
* **수술 정밀도 유지:** 제안된 프레임워크는 중앙 집중식 기준선 대비 **1.5%** 오차 범위 내에서 수술 정밀도를 유지했습니다.
* **정책 발산 및 프라이버시 향상:** 연합 RL에서 로컬 정책과 집계된(글로벌) 정책 간의 평균 Kullback–Leibler (KL) 발산이 높아, 병원 간의 정책 다양성이 커짐을 보여줍니다. 이는 글로벌 모델로부터 데이터셋 재구성 위험을 줄여 프라이버시를 향상시킵니다(Fig. 3b).
* **전반적 프라이버시 효율성(OPE) 우수성:** OPE 점수는 FDRL이 중앙 집중식 RL 대비 **25.8%** 더 높게 나타났으며, PLR, 정책 발산 및 DP 제약을 통합하여 프라이버시-성능 균형에서 우수함을 확인했습니다(Fig. 3c, Fig. 5).
* **DP 노이즈의 영향:** DP 노이즈 표준 편차가 증가함에 따라 프라이버시 효율성은 향상되지만, 모델 정확도는 감소하는 프라이버L시-유틸리티 트레이드오프가 명확히 나타났습니다(Fig. 4).
* **데이터 이질성(Heterogeneity)에 대한 견고성:** 높은 데이터 이질성($H=0.8$) 조건에서도 제안된 FDRL 프레임워크는 **91% 이상**의 안정적인 수술 정확도를 유지했습니다(Fig. 6).
* **수술 위험 완화 능력 향상:** FL은 중앙 집중식 방식보다 수술 위험 완화 능력에서 **15.2%** 더 높은 성능을 보여, 동적 수술 환경에 더 효과적으로 적응하여 위험을 줄일 수 있음을 시사합니다(Fig. 5, Fig. 7).
* **계산 오버헤드:** HE 사용으로 인해 통신 라운드당 평균 0.7초의 지연이 발생하지만, 이는 프라이버시-보안 트레이드오프를 통해 정당화됩니다.

## 🧠 시사점 및 논의

FDRL 프레임워크는 환자 데이터를 노출하지 않고도 여러 의료기관이 협력하여 수술 RL 모델을 훈련할 수 있는 효과적인 접근 방식을 제시합니다. 차등 프라이버시, 보안 다자간 계산, 동형 암호화와 같은 프라이버시 강화 기술의 통합은 강력한 프라이버시 보호를 보장하면서도 높은 수술 정밀도를 유지합니다. 동적 정책 적응 메커니즘은 환자별 조건과 수술 복잡성에 따라 최적의 RL 정책을 선택함으로써 로봇 보조 수술에서의 의사 결정을 더욱 향상시킵니다.

중앙 집중식 RL 접근 방식과 비교했을 때, FDRL은 데이터 노출 위험을 줄이고, 다양한 수술 작업에 걸쳐 모델 성능을 유지하며, 기관별 절차 지식을 활용하여 정책 일반화 능력을 향상시킵니다. 또한, 정책 발산은 공유된 글로벌 모델로부터 민감한 환자 데이터를 재구성할 위험을 줄이는 암묵적인 프라이버시 보존 수단으로 작용합니다.

**제한사항 및 향후 연구:**

* **계산 효율성:** HE 및 보안 집계로 인한 계산 오버헤드와 지연 시간 완화를 위해 양자화 모델, 엣지 컴퓨팅, 경량 압축 등 하드웨어 효율적인 전략을 탐색할 필요가 있습니다.
* **임상 검증:** 실제 환자 데이터 및 협력 병원과의 협력을 통해 프레임워크의 적응성, 일반화 가능성 및 실시간 성능에 대한 임상 검증이 필요합니다.
* **공식 검증:** FL 프로토콜 및 정책 적응 메커니즘의 정확성, 안전성, 프라이버시 보장을 엄격하게 검증하기 위해 모델 검증(model checking) 및 형식적 방법(formal methods)과 같은 공식 검증 기술을 탐구할 것입니다.
* **보안 강화:** 프라이버시 공격, 적대적 견고성, 재구성 위협과 관련된 보안 문제를 해결할 예정입니다.
* **확장성 및 개인화:** 병원별 모델 미세 조정을 통해 프레임워크의 확장성 및 개인화를 개선할 것입니다.
* **응용 확장:** 실시간 환자 모니터링 및 원격 진단 분야로의 확장 가능성도 모색할 것입니다.

## 📌 TL;DR

* **문제:** 로봇 보조 수술(RAS)에서 강화 학습(RL) 모델을 개발하는 데 있어 환자 데이터 프라이버시, 데이터 부족, 수술 절차 가변성이 큰 장애물입니다.
* **제안 방법:** 민감한 데이터를 공유하지 않고 여러 의료기관이 협력하여 RL 모델을 훈련할 수 있는 연합 심층 강화 학습(FDRL) 프레임워크를 제안합니다. 이 프레임워크는 차등 프라이버시(DP), 동형 암호화(HE), 보안 집계 기술을 통합하여 프라이버시를 보호하며, 동적 정책 적응 메커니즘을 통해 환자별 조건에 맞춰 최적의 정책을 실시간으로 선택합니다.
* **주요 결과:** 시뮬레이션 결과, FDRL은 기존 중앙 집중식 방식 대비 프라이버시 누출을 60% 감소시키고, 수술 정밀도를 1.5% 오차 범위 내에서 유지하며, 수술 위험 완화 능력을 15.2% 향상시키고, 전반적 프라이버시 효율성(OPE)은 25.8% 더 높게 나타났습니다. 이는 프라이버시와 성능 간의 최적의 균형을 달성함을 입증합니다.
