# Jekyll: Attacking Medical Image Diagnostics using Deep Generative Models

Neal Mangaokar, Jiameng Pu, Parantapa Bhattacharya, Chandan K. Reddy, Bimal Viswanath

## 🧩 Problem to Solve

이 논문은 딥 생성 모델(GAN)을 활용하여 의료 영상 진단을 공격하는 새로운 위협, 즉 '의료 딥페이크'에 초점을 맞춥니다. 핵심 문제는 다음과 같습니다:

1. 악의적인 행위자가 심층 신경망(DNN)을 사용하여 환자의 민감한 생체 의료 이미지를 조작할 수 있는 가능성.
2. 이러한 조작된 이미지가 의료 전문가와 알고리즘 기반 진단 시스템 모두를 오진으로 유도할 수 있다는 점.
3. 주된 동기는 금융적 이득(예: 불필요한 시술에 대한 보험 사기 청구) 또는 개인에게 해를 끼치거나 의료 시스템을 교란하려는 범죄적 의도입니다.
4. 기존의 적대적 샘플 공격은 인간에게 인지하기 어렵게 교란을 주입하지만, 의료 전문가의 육안 검사에는 취약합니다. 따라서, 육안으로도 설득력 있고 환자의 신원을 보존하면서 질병 조건을 주입하는 새로운 공격 방법이 필요합니다.
5. 시간이 지남에 따라 질병의 자연스러운 진행을 모방하여 반복적인 공격을 지속하는 능력 또한 중요합니다.

## ✨ Key Contributions

이 연구의 주요 기여는 다음과 같습니다:

- **Jekyll 프레임워크 설계 및 구현**: 환자의 생체 의료 이미지에 공격자가 선택한 질병 조건을 주입하면서 환자의 신원을 보존하는 GAN 기반 도구인 Jekyll을 설계하고 구현했습니다.
- **공격 실현 가능성 입증**: 흉부 X-레이(심장 비대, 흉막 삼출) 및 망막 안저 이미지(당뇨병성 망막증)와 같은 두 가지 주요 생체 의료 영상 양식에 대해 Jekyll 공격의 실현 가능성을 입증했습니다. 이는 공개적으로 사용 가능한 의료 데이터셋을 기반으로 합니다.
- **시간 경과에 따른 공격 지속성**: 환자가 병원을 반복적으로 방문할 때, Jekyll이 질병의 자연스러운 진행을 모방하는 질병 패턴을 주입할 수 있는 방법을 제시하고 이를 입증했습니다.
- **공격 효과성 평가**: 기계 학습 알고리즘 및 이미지 품질 지표뿐만 아니라 의료 전문가를 대상으로 한 사용자 연구를 통해 Jekyll 공격의 효과를 광범위하게 평가했습니다. 사용자 연구 결과, 의료 전문가들이 가짜 이미지에 주입된 질병 상태를 확신했으며, 진짜와 가짜 이미지를 구별하지 못했음을 보여주었습니다.
- **방어 조치 탐색**: Jekyll이 생성한 이미지를 탐지하기 위한 기계 학습 기반의 두 가지 방어(블라인드 및 지도 학습) 방법을 조사했습니다. 지도 학습 방식이 효과적임을 보여주었지만, 공격자가 탐지 시스템을 우회하기 위해 Jekyll 모델을 수정하는 회피 전략에 취약할 수 있음을 발견했습니다.

## 📎 Related Works

- **"딥페이크" 위협**: 딥 생성 모델(예: GAN)을 통해 사실적인 가짜 이미지 및 비디오를 생성하는 딥페이크는 웹 분야에서 가짜 계정 생성, 허위 정보 유포 등의 위협으로 논의되어 왔습니다 [2, 3, 4, 5, 6].
- **의료 분야의 사기**: 많은 선진국에서 막대한 의료비 지출로 인해 의료 시스템이 이미 사기로 몸살을 앓고 있으며, 다양한 주체들이 재정적 이득을 위해 사기에 가담하고 있습니다 [8, 9, 10, 11, 12, 13].
- **의료 데이터 보안 취약성**: PACS(Picture Archiving and Communication System)와 같은 의료 정보 시스템의 보안 취약성은 민감한 환자 데이터의 무결성을 위협합니다 [14, 15].
- **의료 분야 ML/AI 오용 선행 연구**:
  - **CT-GAN (Mirsky et al., 2019)** [16]: 3D 의료 영상(CT 이미지)을 조작하여 의료 상태의 징후를 추가하거나 제거하는 딥러닝 프레임워크를 제안. Jekyll은 2D 이미지에 더 적합하며, 더 일반적이고 효율적인 공격 방식을 제시합니다. CT-GAN은 복잡한 다단계 처리와 수동 조정이 필요한 반면, Jekyll은 단일 단계 변환으로 가능합니다.
  - **Kohli et al. (2017)** [50]: DCGAN을 이용한 홍채 생체 인식 시스템 공격을 제안.
- **ML/AI 기반 의료 결정 채택**: 딥러닝은 의료 영상 분석을 통해 의사의 진단을 돕고, 인간의 성능을 능가하는 결과를 보여주는 등 의료 분야에서 중요한 역할을 하고 있습니다 [17, 26, 28, 29, 30, 31, 32, 33, 34, 35, 36].
- **적대적 샘플 공격과의 차이점**: 기존의 적대적 샘플 공격 [37]은 인간에게 인지할 수 없는 미세한 교란을 통해 ML 모델을 오분류하게 만들지만, 의료 전문가의 육안 검사에는 효과적이지 않아 본 연구의 목적(인간과 알고리즘 모두 기만)과 차이가 있습니다.
- **GAN을 이용한 의료 이미지 연구**: 주로 데이터 증강 [59, 60, 61, 62], 비식별화 [50], 이상 감지 [63], 특징 추출 [64, 65], 이미지 분할 [66, 67, 68, 69, 70, 71] 등 비-적대적 시나리오에 초점을 맞춰 왔습니다.

## 🛠️ Methodology

Jekyll은 Generative Adversarial Network (GAN)을 기반으로 하며, 이미지-투-이미지 스타일 전이(image-to-image style transfer) 방식을 사용하여 환자의 의료 이미지를 공격자가 선택한 질병 조건을 포함하는 새로운 이미지로 변환합니다. CycleGAN [73]의 비-쌍(unpaired) 이미지 전이 접근 방식을 기반으로 합니다.

**Jekyll 디자인 구성 요소:**

1. **생성자 ($G, F$)**:
   - $G: X \to Y$: 건강한 상태($C_X$)의 이미지 도메인 $X$를 질병 상태($C_Y$)의 이미지 도메인 $Y$로 변환합니다.
   - $F: Y \to X$: 질병 상태($C_Y$)의 이미지 도메인 $Y$를 건강한 상태($C_X$)의 이미지 도메인 $X$로 변환합니다.
2. **판별자 ($D_Y, D_X$)**:
   - $D_Y$: $G$가 생성한 이미지와 $Y$ 도메인의 실제 이미지를 구별합니다.
   - $D_X$: $F$가 생성한 이미지와 $X$ 도메인의 실제 이미지를 구별합니다.
3. **손실 함수 ($L(G,F,D_X,D_Y)$)**: 여러 손실 항을 결합하여 질병 주입, 신원 보존, 이미지 품질을 최적화합니다.
   - **적대적 손실 ($L_{adv}$)**: 생성자와 판별자가 서로 경쟁하도록 합니다. Least-squares GAN loss [73]를 사용하여 훈련 안정화와 이미지 품질을 향상시킵니다.
     $$ L*{GAN}(G,D_Y,X,Y) = E*{y \sim p*{data}(y)}[D_Y(y)^2] + E*{x \sim p*{data}(x)}[(D_Y(G(x))-1)^2] $$
     총 적대적 손실은 $L*{adv} = L*{GAN}(G,D_Y,X,Y) + L*{GAN}(F,D_X,X,Y)$ 입니다.
   - **질병 손실 ($L_{disease}$)**: 미리 학습된 질병 분류기 $S$를 사용하여 생성된 이미지 $G(x)$가 목표 질병 조건 $C_Y$에 속할 확률을 피드백으로 제공합니다. 이는 생성자가 목표 질병을 정확히 주입하도록 강제합니다.
     $$ L*{disease} = E*{x \sim p\_{data}(x)}[l(S(G(x)|C_Y),C_Y)] $$
        여기서 $l$은 교차 엔트로피 함수입니다.
   - **사이클 일관성 손실 ($L_{cycle}$)**: 이미지 $x$를 $Y$ 도메인으로 변환($G(x)$)하고 다시 $X$ 도메인으로 재구성($F(G(x))$)했을 때, 원본 $x$와 대부분 유사해야 한다는 아이디어($F(G(x)) \approx x$)를 적용합니다. 이는 가능한 매핑 공간을 줄여 신원 보존에 기여합니다.
     $$ L*{cycle} = E*{x \sim p*{data}(x)}[\|F(G(x))-x\|_1] + E*{y \sim p\_{data}(y)}[\|G(F(y))-y\|_1] $$
   - **신원 손실 ($L_{identity}$)**: 환자의 신원을 더 효과적으로 보존하기 위해 도입됩니다. 미리 학습된 신원 분류기 $E$의 특정 레이어에서 추출된 특징을 사용하여 원본 이미지와 생성된 이미지의 신원 특징 유사성을 측정하는 지각 손실(perceptual loss)을 사용합니다.
     $$ L*{identity} = E*{x \in p\_{data}(x)}[\|E(x)-E(G(x))\|_1 + \|E(F(G(x)))-E(G(x))\|_1] $$
   - **최종 손실 함수**: 각 손실 항의 가중치($\lambda_{adv}, \lambda_{disease}, \lambda_{identity}, \lambda_{cycle}$)를 조절하여 전체 손실을 최적화합니다.
     $$ L(G,F,D*X,D_Y) = \lambda*{adv}L*{adv} + \lambda*{disease}L*{disease} + \lambda*{identity}L*{identity} + \lambda*{cycle}L\_{cycle} $$

**시간 경과에 따른 공격 지속 (질병 진행 모방):**

1. **질병 단계 데이터 사용**: 질병의 다양한 단계를 캡처하는 공개 데이터셋을 사용하여 각 단계별 Jekyll 모델을 훈련합니다. (예: 당뇨병성 망막증의 다른 단계 주입).
2. **선형 보간**: 질병 진행 데이터가 없는 경우, 비-질병 이미지($I_{nd}$)와 Jekyll이 생성한 질병 주입 이미지($I_d$) 간의 선형 보간($I_f = \alpha \cdot I_d + (1-\alpha) \cdot I_{nd}$)을 통해 중간 질병 단계를 근사합니다. ($\alpha$는 질병 주입 정도).

**Jekyll 모델 아키텍처:**

- **생성자 및 판별자**: CycleGAN [73]에서 영감을 받았으며, 256x256 이미지 해상도를 처리합니다. 판별자는 70x70 PatchGAN [72]을 기반으로 합니다.
- **질병 및 신원 분류기**: DenseNet-121 [75] 모델 아키텍처를 사용하며, 전이 학습(transfer learning)을 활용하여 미리 학습됩니다. 질병 분류기는 이진 분류를, 신원 분류기는 다중 클래스 분류를 수행합니다.

**대체 아키텍처 평가:**
Jekyll의 기술이 다른 이미지-투-이미지 변환 GAN에도 적용될 수 있음을 보이기 위해 StarGAN [76] 및 IPCGAN (Identity Preserving Conditional GAN) 아키텍처를 Jekyll 프레임워크에 맞춰 수정하여 평가했습니다. 또한, 기본적인 이미지-투-이미지 변환 모델인 Pix2Pix [72]를 베이스라인으로 사용했습니다.

## 📊 Results

- **이미지 품질 (MSSIM)**: 생성된 가짜 이미지와 실제 질병 이미지 간의 MSSIM(Multi-scale Structural Similarity) 점수가 유사하여, 가짜 이미지가 시각적으로 실제 이미지와 구별하기 어렵고 만족스러운 품질을 가짐을 확인했습니다.
- **질병 주입 성공 ($R_d$)**:
  - 흉부 X-레이 (심장 비대증): 82.8%
  - 흉부 X-레이 (흉막 삼출): 95.7%
  - 망막 안저 이미지 (증식성 당뇨병성 망막증): 100%
  - 질병 분류기 모델 해석 도구(ChexNet 기반 히트맵)를 통해, 질병 패턴이 의학적으로 올바른 해부학적 위치에 주입되었음을 시각적으로 확인했습니다.
- **신원 보존 성공 ($R_i$)**:
  - 흉부 X-레이 (심장 비대증): 95.2%
  - 흉부 X-레이 (흉막 삼출): 94.4%
  - 망막 안저 이미지 (증식성 당뇨병성 망막증): 88.4%
  - 망막 안저 이미지의 경우, 혈관 분할 마스크를 비교했을 때 원본과 생성된 이미지 간의 MSSIM 점수가 0.71~0.89로 높아 혈관 구조가 잘 보존됨을 정량적으로 입증했습니다.
- **시간 경과에 따른 공격 지속**:
  - **질병 단계 데이터 사용**: 중증 당뇨병성 망막증 주입 시 $R_d=99.6\%$, $R_i=97.5\%$를 달성하여 질병 진행 모방이 가능함을 보였습니다.
  - **선형 보간**: 질병 단계 데이터가 없는 경우에도 선형 보간을 사용하여 심장 비대증의 중간 단계를 성공적으로 시뮬레이션했으며, 평가 분류기가 질병 주입 정도에 따라 질병 확률이 단조롭게 증가함을 확인했습니다.
- **대체 아키텍처 평가**:
  - **StarGAN**: 모든 데이터셋에서 70% 이상의 질병 주입률과 79% 이상의 신원 보존율을 달성했으나, Jekyll의 성능에는 미치지 못했습니다.
  - **IPCGAN**: 신원 보존율은 99% 이상으로 매우 높았지만, 질병 주입률은 낮았습니다(망막 데이터셋에서는 2%대).
  - **Pix2Pix**: 높은 질병 주입 성능을 보였으나, 신원 보존에는 거의 실패했습니다.
- **제거 연구 (Ablation Study)**:
  - 질병 손실($L_{disease}$)을 제거하면 질병 주입률($R_d$)이 크게 감소(X-레이 데이터셋에서 55% 미만)하여 이 손실 항의 중요성을 확인했습니다.
  - 신원 손실($L_{identity}$)을 제거하면 신원 보존율($R_i$)이 감소(평균 5.8~6.2% 감소)하지만, 사이클 일관성 손실($L_{cycle}$) 덕분에 큰 폭의 하락은 피했습니다.
  - $L_{disease}$와 $L_{identity}$를 모두 제거한 바닐라 CycleGAN 모델은 질병 주입률이 크게 떨어졌습니다.
- **의료 전문가 평가 (사용자 연구)**:
  - **질병 주입 평가**: 의료 전문가들은 가짜 이미지의 60%에서 질병 증상을 확인하는 데 동의했고, 80%에서는 다수가 동의했습니다. 진짜 질병 이미지와 가짜 질병 이미지에 대한 전문가들의 판단 사이에 통계적으로 유의미한 차이가 없었습니다 (Pearson's Chi-squared test p=0.4132).
  - **가짜 이미지 탐지 평가**: 전문가들의 가짜 이미지 탐지 정확도는 47%에 불과했으며, 평가자들 간의 동의도 매우 낮아 (Fleiss' $\kappa=0.024$) 진짜와 가짜 이미지를 정확히 구별하지 못했습니다.

## 🧠 Insights & Discussion

- **Jekyll의 심각한 위협**: Jekyll은 딥 생성 모델을 사용하여 의료 영상 진단을 공격하는 새로운 종류의 현실적인 위협을 제시하며, 의료 사기, 불필요한 치료, 환자에게 해를 끼치는 등 심각한 결과를 초래할 수 있습니다.
- **인간과 AI 모두 기만**: 이 연구는 Jekyll이 생성한 이미지가 의료 전문가와 ML 기반 진단 알고리즘 모두를 효과적으로 속일 수 있음을 입증하여, 기존의 미세한 적대적 교란과는 다른 위협을 보여줍니다.
- **신원 보존의 중요성**: 환자의 고유한 신체적 특징(예: 흉부 X-레이의 갈비뼈 구조, 망막의 혈관 패턴)을 보존함으로써, 생성된 가짜 이미지가 환자 본인의 것으로 보이게 하여 공격 탐지를 훨씬 어렵게 만듭니다.
- **방어의 어려움과 회피 전략**:
  - **블라인드 탐지(CSD-SVM)**: 공격 모델에 대한 정보 없이 색상 구성 요소 불일치를 분석하는 블라인드 탐지 기법은 Jekyll이 생성한 이미지를 탐지하는 데 효과적이지 않았습니다 (정확도 60%).
  - **지도 학습 탐지(MesoNet)**: 실제 및 가짜 이미지를 모두 사용하여 훈련된 지도 학습 분류기(MesoNet)는 Jekyll 이미지를 매우 높은 정확도(98-99%)로 탐지할 수 있어 유망한 방어책으로 보였습니다.
  - **회피 공격**: 그러나 공격자가 Jekyll 모델을 수정("Repurposed Jekyll")하여 추가적인 판별자를 포함시킴으로써, 이전에 훈련된 MesoNet의 탐지 정확도를 심장 비대증 데이터셋에서 99.4%에서 55.6%로, 증식성 당뇨병성 망막증 데이터셋에서 98.1%에서 83.4%로 크게 떨어뜨릴 수 있음을 보여주었습니다. 이는 공격자가 방어 모델에 대한 백색 상자(white-box) 접근 없이도 회피가 가능함을 시사합니다.
- **견고한 방어 메커니즘의 필요성**: 의료 시스템의 알려진 보안 취약성과 결합하여 Jekyll과 같은 딥러닝 기반 공격은 중요한 보안 문제이며, 커뮤니티가 이러한 위협에 대한 견고한 방어 메커니즘 개발에 적극적으로 참여하도록 권장합니다.

## 📌 TL;DR

**문제**: 딥 생성 모델을 사용하여 환자의 생체 의료 이미지를 조작, 의료 진단을 오도하는 '의료 딥페이크' 공격 위협이 증대되고 있습니다. 이러한 공격은 의료 전문가와 AI 진단 시스템 모두를 속여 사기 및 환자 위해를 야기할 수 있습니다.

**제안 방법**: 이 논문은 CycleGAN 기반의 이미지-투-이미지 변환 프레임워크인 **Jekyll**을 제안합니다. Jekyll은 환자의 신원(내용)을 보존하면서 공격자가 선택한 질병 조건(스타일)을 이미지에 주입합니다. 이를 위해 적대적 손실, 질병 분류기 기반의 질병 손실, 사이클 일관성 손실, 그리고 지각 손실을 활용한 신원 손실을 결합한 독창적인 손실 함수를 사용합니다. 또한, 질병 진행 데이터를 활용하거나 선형 보간을 통해 질병의 심각도를 조절하며 시간 경과에 따른 공격 지속성을 가능하게 합니다.

**주요 결과**:

- **공격 성공**: 흉부 X-레이(심장 비대, 흉막 삼출) 및 망막 안저 이미지(당뇨병성 망막증)에 대해 82.8%~100%의 높은 질병 주입률과 88.4%~95.2%의 신원 보존율을 달성했습니다.
- **인간 및 AI 기만**: 의료 전문가를 대상으로 한 사용자 연구에서, 전문가들은 Jekyll이 생성한 가짜 이미지의 질병 증상을 확신했으며, 진짜 이미지와 가짜 이미지를 구별하지 못했습니다 (탐지 정확도 47%). ML 기반 분류기 또한 가짜 이미지를 질병으로 진단했습니다.
- **방어의 취약성**: 지도 학습 기반 방어 모델(MesoNet)은 Jekyll 이미지를 높은 정확도로 탐지할 수 있었지만, 공격자가 Jekyll 모델을 수정("Repurposed Jekyll")하여 탐지를 회피할 수 있음을 입증했습니다.

**결론**: Jekyll은 의료 시스템에 대한 심각한 보안 위협을 제기하며, 이는 딥러닝 기술을 이용한 새로운 형태의 공격에 대비하고, 견고한 방어 기술을 개발하는 것이 시급함을 강조합니다.
