# Online Keyword Spotting with a Character-Level Recurrent Neural Network

Kyuyeon Hwang, Minjae Lee, and Wonyong Sung

## 🧩 Problem to Solve

기존 은닉 마르코프 모델(HMM) 기반 키워드 탐지(KWS) 시스템은 언어 모델이 없어 "honeymoon"에서 "honey"와 같이 긴 단어에 키워드 음성 특징이 포함될 경우 오탐지가 발생하는 문맥 인지(context-aware) 문제가 있었습니다. 또한, 이전 순환 신경망(RNN) 기반 접근 방식은 양방향 RNN을 사용하거나 발화가 끝난 후에 키워드를 탐지하여 온라인 및 저지연(low-latency) 애플리케이션에 적합하지 않았습니다. 음성 특징 전처리 또는 딕셔너리 구성이 필요 없는 종단간(end-to-end) 학습 방식과 키워드 목록 변경이 용이한 유연한 시스템에 대한 필요성이 있었습니다.

## ✨ Key Contributions

- 문맥 인지 기능을 갖춘 문자 단위(character-level)의 단방향 RNN 기반 키워드 탐지 모델을 제안했습니다.
- 연결주의 시간 분류(CTC)를 사용하여 종단간 학습하며, 음성 전사(phonetic transcription), 세논 모델링(senone modeling) 또는 시스템 딕셔너리가 필요 없습니다.
- RNN 재학습 없이 텍스트 기반 키워드 목록을 수정하여 키워드를 쉽게 추가 및 변경할 수 있습니다.
- 단방향 RNN이 사전 분할(pre-segmentation) 없이 무한히 긴 오디오 스트림을 처리하여, 발화가 끝나기 전에 저지연으로 키워드를 탐지할 수 있습니다.
- CTC를 통해 학습된 단어 경계(word-boundary) 레이블은 긴 단어에 포함된 키워드 스트링을 필터링하는 데 중요한 역할을 합니다.
- 기존 심층 신경망(DNN)-HMM 기반 키워드-필러(keyword-filler) 모델보다 적은 연산으로도 훨씬 뛰어난 성능을 보였습니다.

## 📎 Related Works

- **HMM 기반 키워드 탐지 [1]:** 전통적인 키워드 탐지 방식. 언어 모델 부재로 오탐지 문제 발생.
- **양방향 RNN 기반 키워드 탐지 [5], [6]:** 문맥 인지 능력을 향상시키나, 발화 사전 분할 및 끝까지 청취가 필요.
- **종단간 키워드 탐지 [5], [7]:** 키워드 변경 시 재학습이 필요한 경우가 많음.
- **온라인 CTC [3]:** 연속적인 RNN 학습을 위한 CTC 변형.
- **CTC 기반 종단간 음성 인식 [14], [15]:** DNN-HMM 모델과 비교할 만한 인상적인 성능을 보여줌.
- **DNN 음향 모델 [8]:** 베이스라인 모델에 사용된 기술.
- **LSTM [10], Forget Gates [11], Peephole Connections [12]:** 제안된 RNN 모델의 구성 요소.

## 🛠️ Methodology

제안된 키워드 탐지기는 전단부(front-end) RNN과 후단부(back-end) 디코더로 구성됩니다.

- **문자 단위 단방향 RNN (전단부):**

  - 3개의 LSTM 레이어와 소프트맥스 출력 레이어로 구성된 심층 단방향 LSTM 네트워크입니다.
  - 연결주의 시간 분류(CTC) [2]를 통해 시퀀스-투-시퀀스(sequence-to-sequence) 방식으로 종단간 학습됩니다. 특히 온라인 CTC [3]를 사용하여 무한히 긴 음성 스트림을 처리합니다.
  - **입력:** 40차원 로그 필터뱅크 특징(log-filterbank features)에 에너지, 그리고 이들의 델타($\Delta$) 및 더블 델타($\Delta\Delta$)를 포함한 총 123차원 벡터를 사용합니다.
  - **출력:** 26개 알파벳, 2개 특수 문자, 단어 경계 레이블(`_`), CTC 공백 레이블(`-`)을 포함한 30개 레이블에 대한 확률을 생성합니다.
  - **학습:** 무작위로 훈련 시퀀스를 연결하여 생성된 무한히 긴 훈련 스트림에서 온라인 CTC 알고리즘을 사용하여 학습됩니다. GPU에서 병렬 훈련 스트림과 온라인 BPTT(Backpropagation Through Time) 알고리즘을 활용하여 효율적인 학습을 수행합니다.

- **디코더 모델 (후단부):**
  - RNN의 문자 단위 출력 시퀀스를 키워드 단위 확률 시퀀스로 변환합니다.
  - **CTC 키워드-필러 모델:** HMM 키워드 탐지기와 유사하게 필러 네트워크와 키워드 네트워크를 사용하며, 단어 경계 레이블(`_`)로 시작하고 끝납니다. 필러 모델과 키워드 모델의 로그 사후 확률(log-posterior probabilities) 차이가 임계값(threshold) 이하일 때 키워드를 탐지합니다.
  - **CTC 키워드 전용(keyword-only) 모델:** 필러 네트워크를 제거하고 키워드 네트워크 앞에 단어 경계 노드를 삽입합니다. 음의 로그 사후 확률이 임계값 이하일 때 키워드를 탐지합니다. 실험 결과, 이 모델이 필러 모델과 유사한 성능을 보이며 더 간단합니다.
  - **상태 전이:** 표준 CTC의 원칙을 따르며, 각 노드는 문자 또는 단어 경계 레이블과 CTC 공백 레이블(`-`)로 구성됩니다.
  - **확률 계산:** 필러 모델의 확률은 필러 모델 내 모든 CTC 상태 중 최대 사후 확률로 정의됩니다. 키워드 네트워크의 확률은 마지막 단어 경계 노드 내 두 CTC 상태의 합산(또는 최대) 사후 확률입니다.
  - **합산-최대 근사(Sum-to-max approximation):** 필러 모델 사용 시, 서로 다른 레이블 히스토리(label histories)에서 오는 확률을 정확히 합산하기 어렵기 때문에, 최적의 정렬(best alignment)을 찾기 위해 합산 연산을 최대(max) 연산으로 근사합니다.

## 📊 Results

- **데이터셋:** WSJ(Wall Street Journal) 코퍼스에서 167시간 분량의 음성을 훈련하고, WSJ Nov'92 20K 평가 세트(42분 오디오)를 사용하여 평가했습니다.
- **베이스라인:** DNN-HMM 키워드-필러 모델을 사용했습니다.
- **키워드 세트:** 다음절 단어인 Set A와 단음절 단어인 Set B를 사용했습니다. 특히 Set B는 탐지가 어려운 키워드들입니다.
- **탐지 지연 시간:** 키워드 완성 후 200ms 이내에 탐지되었으며, 이는 인간의 반응 시간과 유사한 수준입니다.
- **디코딩 모델 비교 (그림 4):**
  - 제안된 CTC 기반 키워드 탐지기가 베이스라인 DNN-HMM 모델보다 뛰어난 성능을 보였으며, 특히 Set B(단음절 키워드)에서 현저한 개선을 나타냈습니다.
  - CTC 키워드-필러 모델과 CTC 키워드 전용 모델 간의 성능 차이는 거의 없었으며, 이는 CTC 키워드 탐지기에 필러 모델이 필요 없음을 시사합니다.
  - 합산-최대 근사는 탐지 정확도를 저하시키지 않았습니다.
- **다양한 네트워크 크기 비교 (그림 5):**
  - 대규모 CTC 모델($3 \times 768$)이 소규모 CTC 모델($3 \times 128$)보다 성능이 좋았으며, 두 모델 모두 DNN-HMM 베이스라인을 크게 능가했습니다.
  - 최대 F1 점수: Set A의 경우 DNN-HMM(0.936), 소규모 CTC(0.964), 대규모 CTC(0.980); Set B의 경우 DNN-HMM(0.517), 소규모 CTC(0.806), 대규모 CTC(0.847)를 기록했습니다.
  - **계산 효율성:** 소규모 CTC 모델($3 \times 128$)은 베이스라인 DNN-HMM 모델의 약 6%의 연산량(파라미터: 0.40M vs 6.61M)으로도 더 높은 성능을 달성했습니다. 후단부 디코더 네트워크도 HMM 키워드-필러 모델보다 훨씬 간단합니다.

## 🧠 Insights & Discussion

- **문맥 인지 강화:** 전단부 RNN에 내장된 약한 언어 모델과 단어 경계 레이블의 사용은, 특히 짧고 혼동하기 쉬운 단어(단음절 키워드)의 탐지 정확도를 크게 향상시켰습니다. 이는 키워드가 다른 단어의 일부로 발화될 때의 오탐지 문제를 해결하는 데 기여합니다.
- **온라인 및 저지연 처리:** 단방향 RNN과 온라인 CTC 학습 덕분에 사전 분할 없이 연속적인 음성을 실시간으로 처리할 수 있어, 낮은 지연 시간으로 키워드 탐지가 가능합니다.
- **높은 유연성:** 딕셔너리가 필요 없는 특성과 RNN 재학습 없이 키워드를 쉽게 수정할 수 있는 유연성은 시스템의 실용성을 높입니다.
- **뛰어난 효율성:** 기존 DNN-HMM 모델에 비해 훨씬 적은 연산으로 우수한 성능을 달성하여, 소형화(small-footprint) 및 저지연이 요구되는 애플리케이션에 매우 적합합니다.
- **모델 간소화:** HMM 기반 시스템에서 일반적으로 사용되는 필러 모델이 CTC 키워드 탐지기에서는 불필요하다는 것을 보여주어, 후단부 모델을 더욱 간소화할 수 있습니다.

## 📌 TL;DR

**문제:** 기존 키워드 탐지(KWS) 시스템은 문맥 인지 부족으로 오탐지가 잦았고, 실시간/저지연 연속 음성 처리에 한계가 있었습니다.
**방법:** 본 논문은 문자 단위 단방향 순환 신경망(RNN)과 온라인 연결주의 시간 분류(CTC)를 활용한 종단간(end-to-end) 키워드 탐지 모델을 제안합니다. 이 모델은 음성을 문자 및 단어 경계 레이블로 직접 변환하며, 연속적인 오디오 스트림을 온라인으로 처리합니다.
**결과:** 제안된 모델은 특히 짧은 키워드에서 최첨단 정확도를 달성하며, 기존 DNN-HMM 모델보다 훨씬 적은 연산량으로 우수한 성능을 보였습니다. 이를 통해 저지연, 문맥 인지 키워드 탐지가 가능하고, RNN 재학습 없이 유연하게 키워드를 추가할 수 있습니다.
