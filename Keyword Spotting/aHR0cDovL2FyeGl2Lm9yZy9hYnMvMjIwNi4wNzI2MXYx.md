# Latency Control for Keyword Spotting
Christin Jose, Joseph Wang, Grant P. Strimel, Mohammad Omar Khursheed, Yuriy Mishchenko, Brian Kulis

## 🧩 Problem to Solve
대화형 에이전트 시스템에서 사용되는 키워드 스포팅(KWS) 모델은 사용자 경험과 프라이버시를 위해 높은 정확도가 중요하지만, 이는 종종 탐지 지연 시간(latency) 증가로 이어집니다. 기존 KWS 지연 시간 제어 방식은 키워드 종점(endpoint)에 대한 명시적인 지식을 필요로 하여 데이터 준비 및 모델 훈련을 복잡하게 만들고, 특히 맥스 풀링 손실(max-pooling loss)과 같은 정렬 불필요(alignment-free) 방식의 장점을 상쇄시킵니다. 따라서 본 논문은 키워드 종점 정보 없이 KWS 모델의 지연 시간을 효과적으로 제어하면서도 정확도를 유지하는 방법을 제안합니다.

## ✨ Key Contributions
*   **새로운 손실 함수 제안:** 키워드 종점에 대한 명시적인 지식 없이 KWS 모델의 지연 시간을 제어할 수 있는 새로운 손실 함수를 제안합니다. 이는 기존의 맥스 풀링 손실을 일반화한 형태입니다.
*   **단일 하이퍼파라미터 제어:** 단일 하이퍼파라미터 $b$를 통해 탐지 정확도와 지연 시간 간의 균형을 쉽게 조정할 수 있도록 합니다.
*   **향상된 성능:** 고정된 지연 시간 목표에서 기존 SOTA(State-Of-The-Art) 베이스라인 대비 오탐(false accepts)률을 약 25% 상대적으로 개선하는 성능을 달성했습니다.
*   **손실 함수 일반화:** 제안된 접근 방식이 어떤 손실 함수에도 일반화될 수 있음을 보여줍니다. 맥스 풀링 손실과 결합했을 때, 교차 엔트로피 손실 대비 고정 지연 시간에서 오탐률을 25% 향상시켰습니다.
*   **쉬운 구현 및 튜닝:** 키워드 종점 추정이 필요 없으며, 간단하고 계산적으로 효율적인 손실 함수 수정만으로 구현이 가능합니다. 하이퍼파라미터 $b$와 지연 시간 간의 단조(monotonic) 관계 덕분에 제한된 탐색으로도 지연 시간 제어가 용이합니다.

## 📎 Related Works
*   **전통적인 KWS 연구:** 대부분 정확도 향상 및 새로운 아키텍처(예: [13, 14, 15, 16])에 초점을 맞춥니다.
*   **지연 시간 제어 연구:**
    *   **Sigtia et al. [17]:** 2단계 검증 모델을 사용하여 정확도를 높였지만, 일부 예제에서 추가 지연 시간을 유발합니다. 본 논문은 단일 단계 모델의 제어에 중점을 둡니다.
    *   **Low-latency CRNN [18]:** 파라미터 수 및 추론 연산 감소를 통해 컴퓨팅 제약 환경에서의 지연 시간 개선을 목표로 합니다. 본 논문은 모델이 결정을 내리는 데 걸리는 시간인 *알고리즘적 지연 시간*에 집중합니다.
    *   **Fu et al. [19] ("max-latency approach"):** 훈련 중 키워드 이후의 오디오 컨텍스트를 마스킹하여 탐지 지연 시간을 제어하는 손실 함수를 제안합니다. 이 방법은 키워드 종점에 대한 명시적인 지식을 필요로 하며, 다른 손실 함수로 쉽게 일반화되지 않는 한계가 있습니다. 본 논문에서는 이 방법을 SOTA 베이스라인으로 사용했습니다.

## 🛠️ Methodology
1.  **맥스 풀링 손실 재검토:**
    *   기존 맥스 풀링 손실 $L(y,[p_y0,...,p_yT]) = -log(p_yt)$는 양성 예제($y \neq 0$)의 경우 $argmax_{i \in \{0,...,T\}} (p_{yi})$를, 음성 예제($y=0$)의 경우 $argmin_{i \in \{0,...,T\}} (p_{0i})$를 사용하여 손실을 계산할 프레임을 자동으로 선택합니다.
    *   이 손실은 정확도를 높이지만, 모델이 키워드 이후의 오디오 컨텍스트를 활용하여 더 높은 점수를 내기 위해 탐지 시점을 지연시키는 경향이 있습니다.

2.  **지연 시간 제어를 위한 맥스 풀링 손실 확장:**
    *   새로운 손실 함수는 다음과 같이 정의됩니다:
        $$
        L(y,[p_y0,...,p_yT]) = -log(p_yt)
        $$
        여기서 $t$는 다음과 같이 결정됩니다:
        $$
        t =
        \begin{cases}
        \underset{i \in \{0,...,T\}}{\operatorname{argmin}}(p_{0i}) & \text{if } y=0 \\
        \left(\underset{i \in \{0,...,T\}}{\operatorname{argmax}}(p_{yi}) - \beta\right)_{+} & \text{if } y \neq 0
        \end{cases}
        $$
        *   $(\cdot)_{+}$는 $\max(x,0)$을 의미합니다.
        *   $\beta$는 사전에 정의된 분포 $B$에서 추출된 무작위 값입니다. 실제로는 사용자 정의 파라미터 $b$를 갖는 베르누이 분포(즉, $\beta=1$일 확률이 $b$)로 설정됩니다.
    *   **작동 원리:** 양성 예제의 경우, 확률 $b$로 모델이 최대 후방 확률(maximum posterior) 프레임 대신 *이전 프레임*의 후방 확률을 기준으로 손실을 계산하도록 강제합니다. 이는 모델이 더 이른 시점에 탐지 피크를 생성하도록 유도하여 지연 시간을 줄입니다.
    *   **하이퍼파라미터 $b$ 조정:** $b$ 값을 증가시킬수록 더 이른 시점의 후방 확률에 대한 강조가 커지므로, 사용자는 이 값을 조정하여 탐지 정확도와 지연 시간 사이의 균형을 맞출 수 있습니다.
    *   **일반화:** 이 접근 방식은 단일 시점의 후방 확률과 레이블을 입력으로 받는 모든 손실 함수 $L(y,P)$에 일반화될 수 있습니다.

3.  **실험 설정:**
    *   **데이터:** 약 20,000시간의 비식별화된 주석 처리된 훈련 데이터와 약 1,400시간의 평가 데이터를 사용했습니다. 키워드 세그먼트는 HMM 모델을 사용하여 대략적으로 정렬되었으며, 클리핑 방지를 위해 패딩이 추가되었습니다.
    *   **모델 아키텍처:** [21]에서 제안된 CNN 아키텍처를 사용했습니다(그림 2). 64차원 로그 멜-필터뱅크 에너지(LFBE) 특징을 입력으로 받습니다. 5개의 컨볼루션 레이어와 3개의 완전 연결(FC) 레이어로 구성됩니다.
    *   **최적화:** Adam 옵티마이저와 0.3의 드롭아웃 비율을 사용했습니다.
    *   **비교 대상:** 제안된 방법($b \in \{0.0, 0.1, 0.2, 0.33, 0.5, 1.0\}$)과 함께, HMM 정렬 데이터를 사용한 교차 엔트로피 손실 모델, 그리고 Fu et al. [19]의 'max-latency' 접근 방식을 비교했습니다.

## 📊 Results
*   **DET 곡선 (그림 3):** 맥스 풀링 손실(b=0)이 가장 좋은 탐지 성능을 보였습니다. $b$ 값이 증가할수록 탐지 성능은 감소하는 경향을 보였는데, 이는 지연 시간 감소에 대한 중요도가 높아짐에 따라 탐지 성능이 희생됨을 나타냅니다. 특히 $b=0.33$일 때 교차 엔트로피 손실 모델과 유사한 탐지 성능을 보였습니다.
*   **지연 시간 vs. 오탐률 (그림 4):** 고정된 미탐(false reject)률에서 모델들의 상대적 지연 시간 감소율과 상대적 오탐률을 비교한 결과, 제안된 접근 방식(파란색 선)이 'max-latency' 방식 [19]과 HMM 정렬 데이터를 사용한 교차 엔트로피 손실 모델보다 명확하게 우수한 성능을 보였습니다. 특히, 키워드 정렬에 대한 정확한 추정치가 필요 없다는 이점이 있었습니다.
*   **정량적 개선:** 고정된 지연 시간 목표에서 베이스라인 SOTA 모델 대비 오탐률을 25% 상대적으로 개선했습니다. 또한, 맥스 풀링 손실과 함께 사용했을 때 교차 엔트로피 손실 대비 고정 지연 시간에서 오탐률을 25% 향상시켰습니다.
*   **시각화 (그림 5):** $b$ 값을 증가시킬수록 모델의 후방 확률 피크가 점차 더 이른 시점으로 이동하는 것이 관찰되었습니다. $b=1$의 극단적인 경우, 피크가 키워드 완료 시점보다 훨씬 일찍 발생하여 $b$ 파라미터만으로 지연 시간을 효과적으로 줄일 수 있음을 보여주었습니다.

## 🧠 Insights & Discussion
본 연구는 KWS 모델의 정확도와 지연 시간 사이의 중요한 트레이드오프를 해결하는 실용적인 방법을 제시합니다. 기존의 맥스 풀링 손실의 장점(키워드 종점 레이블링 불필요)을 유지하면서도, 단일 하이퍼파라미터 $b$를 통해 지연 시간 제어라는 새로운 기능을 추가했습니다. 이는 모델 훈련의 복잡성을 크게 늘리지 않으면서도 유연한 배포를 가능하게 합니다.

특히, 제안된 방법이 키워드 종점 정보에 의존하는 기존 SOTA 방식보다 우수한 성능을 보인다는 점은 주목할 만합니다. 이는 키워드 종점 정보의 부재가 모델 성능 저하로 이어지지 않으면서도 지연 시간 제어가 가능하다는 것을 의미하며, 데이터 주석 작업의 부담을 크게 줄일 수 있습니다. $b$ 값과 지연 시간 사이의 단조 관계는 실제 환경에서 원하는 지연 시간 제약을 충족하기 위한 모델 튜닝 과정을 간소화합니다.

한계점으로는, $b$ 값을 너무 높게 설정할 경우 탐지 정확도가 저하될 수 있다는 점입니다. 이는 궁극적으로 정확도-지연 시간 트레이드오프를 관리해야 함을 시사합니다.

## 📌 TL;DR
본 논문은 키워드 스포팅(KWS) 모델의 고질적인 문제인 정확도와 지연 시간 사이의 트레이드오프를 해결하기 위한 새로운 손실 함수를 제안합니다. 이 방법은 키워드 종점 정보에 대한 명시적인 지식 없이, 맥스 풀링 손실을 일반화하고 단일 하이퍼파라미터 $b$를 통해 지연 시간을 제어합니다. 실험 결과, 제안된 접근 방식은 기존 SOTA 모델 대비 고정 지연 시간에서 오탐률을 25% 개선하는 등 우수한 성능을 보였으며, 구현이 간단하고 다양한 손실 함수에 적용 가능하여 KWS 시스템의 실제 배포 유연성을 크게 높였습니다.
