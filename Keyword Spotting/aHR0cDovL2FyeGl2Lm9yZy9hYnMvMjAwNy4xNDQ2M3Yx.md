# Few-Shot Keyword Spotting With Prototypical Networks

Archit Parnami, Minwoo Lee

## 🧩 Problem to Solve

기존의 키워드 스포팅(KWS) 시스템은 미리 정의된 키워드를 인식하기 위해 방대한 양의 학습 데이터를 필요로 합니다. 이는 사용자가 **새로운 키워드를 정의**하거나, **제한된 수의 샘플**만을 사용하여 **장치 내(on-device)에서 키워드를 인식**해야 하는 시나리오에서는 큰 제약이 됩니다. 특히 스마트 장치가 개인화되면서 사용자 정의 키워드를 적은 샘플로 빠르게 학습해야 할 필요성이 커지고 있지만, 기존 딥러닝 방식은 데이터 의존적이며, 최적화 기반의 소수 학습(Few-Shot Learning) 방식(예: MAML)은 장치 내 컴퓨팅 자원 제약으로 인해 미세 조정(fine-tuning)이 어려울 수 있습니다.

## ✨ Key Contributions

- **소수 키워드 스포팅(FS-KWS) 문제 정의 및 해결**: 메트릭 학습(metric learning)과 소수 학습(few-shot learning) 접근 방식을 통해 제한된 샘플만으로 새로운 키워드를 분류할 수 있는 FS-KWS 시스템을 제안합니다.
- **효과적인 임베딩 네트워크 제안**: FS-KWS를 위한 더 나은 임베딩 함수로 시간적(temporal) 및 팽창(dilated) 컨볼루션을 활용한 CNN 아키텍처인 **TD-ResNet7**을 제안합니다.
- **FS-KWS 데이터셋 공개**: Google Speech Commands 데이터셋 [18]을 기반으로 배경 소음, 침묵, 알 수 없는(unknown) 키워드 탐지 기능을 포함하여 FS-KWS를 위한 도전적인 데이터셋을 합성하여 공개했습니다.

## 📎 Related Works

- **기존 KWS 시스템**:
  - **LVCSR (Large Vocabulary Continuous Speech Recognition) 기반 모델 [1, 2]**: 높은 자원과 컴퓨팅 파워를 요구하여 클라우드 환경에서 주로 사용되며, 개인 정보 보호 및 지연 시간 문제가 발생할 수 있습니다.
  - **경량 딥러닝 기반 모델 [3, 4, 5, 6, 7]**: 미리 정의된 키워드 세트에 대해 수천 개의 학습 예제를 사용하여 훈련되나, 새로운 키워드에는 한계가 있습니다.
  - **MFCC(Mel-frequency Cepstral Coefficients) 및 CNN 활용 [3, 4, 7, 9, 10]**: 음성 특징으로 MFCC를 사용한 CNN 기반 KWS가 좋은 성능을 보여주었습니다.
- **소수 학습 (Few-Shot Learning)**:
  - **메트릭 학습(Metric Learning) 기반 [12, 13, 14]**: 동일 클래스 예제를 임베딩 공간에서 가깝게, 다른 클래스 예제는 멀게 학습하는 임베딩 함수를 목표로 합니다 (예: Prototypical Networks [14], Siamese Neural Networks [12], Matching Networks [13]).
  - **최적화 기반 [15, 16]**: 소수의 경사 하강 단계를 사용하여 새로운 클래스에 대해 미세 조정될 수 있는 분류기를 위한 좋은 초기화 파라미터를 학습합니다 (예: MAML [16]).
- **기존 FS-KWS 시도**: MAML [16]과 같은 최적화 기반 접근법을 사용한 연구 [17]가 있었지만, 제한된 컴퓨팅 환경에서는 미세 조정이 어려울 수 있습니다.
- **임베딩 네트워크 아키텍처**:
  - **TC-ResNet8 [9]**: KWS에서 시간적 컨볼루션이 뛰어난 성능을 보여주었음을 입증했습니다.
  - **팽창 컨볼루션(Dilated Convolutions) [10]**: 키워드 신호 처리에도 유용함이 입증되었습니다.

## 🛠️ Methodology

저자들은 Prototypical Networks [14]를 기반으로 FS-KWS 프레임워크를 구축했습니다.

1. **FS-KWS 문제 공식화**:

   - $N$개의 사용자 정의 키워드 클래스 $\mathcal{S} = \{(s_i, y_i)\}^{N \times K}_{i}$가 주어졌을 때, 각 키워드에는 $K$개의 샘플($K$는 작은 수)이 있습니다.
   - 사용자 쿼리 $q$가 주어지면, FS-KWS 시스템은 $q$를 $N$개의 키워드 클래스 중 하나로 분류하는 것을 목표로 합니다. 이때 $\mathcal{S}$의 키워드들은 시스템 훈련 중에 한 번도 보지 못한 새로운 키워드일 수 있습니다.

2. **에피소드 기반 학습**:

   - 모델은 $\mathcal{D}_{\text{train}}$에서 $N$-way $K$-shot FS-KWS 작업을 해결하도록 학습됩니다.
   - 각 에피소드($e$)마다 훈련 세트에서 $N$개의 카테고리(클래스)를 샘플링합니다.
   - 이 $N$개의 카테고리에서 두 가지 예제 세트가 샘플링됩니다:
     - **Support Set ($\mathcal{S}_e$)**: 각 $N$개 카테고리당 $K$개의 예제를 포함합니다. $\mathcal{S}_e = \{(s_i, y_i)\}^{N \times K}_{i=1}$.
     - **Query Set ($\mathcal{Q}_e$)**: 동일한 $N$개 카테고리에서 $Q$개의 다른 예제를 포함합니다. $\mathcal{Q}_e = \{(q_j, y_j)\}^{N \times Q}_{j=1}$.
   - 손실 함수는 쿼리 세트의 예측 손실을 최소화하는 방식으로 정의됩니다:
     $$L(\theta) = - \sum_{t=1}^{|\mathcal{Q}_e|} \log P_{\theta}(y_t|q_t, \mathcal{S}_e)$$

3. **Prototypical Networks를 이용한 분류**:

   - **임베딩 함수 ($f$)**: CNN $f: \mathbb{R}^{n_v} \rightarrow \mathbb{R}^{n_p}$는 동일 카테고리 샘플은 가깝게, 다른 카테고리 샘플은 멀리 매핑하는 $n_p$차원 공간을 학습합니다.
   - **프로토타입($p_c$) 계산**: 각 카테고리 $c$에 대한 프로토타입은 해당 클래스에 속하는 모든 Support Set 샘플 임베딩의 평균으로 계산됩니다:
     $$p_c = \frac{1}{|\mathcal{S}^c_e|} \sum_{(s_i, y_i) \in \mathcal{S}^c_e} f(s_i)$$
   - **쿼리 샘플 분류**: 쿼리 샘플 $q_t$는 각 클래스 프로토타입 $p_c$와의 거리를 기반으로 분류됩니다. 음의 거리에 소프트맥스 함수를 적용하여 $N$개 카테고리에 대한 확률 분포를 생성합니다:
     $$P(y=c|q_t, \mathcal{S}_e, \theta) = \frac{\exp(-d(f(q_t), p_c))}{\sum_n \exp(-d(f(q_t), p_n))}$$
     여기서 $d$는 유클리드 거리입니다.
   - **최적화**: $\theta$ 파라미터는 SGD(Adam [21] 사용)를 통해 Equation (1)을 최소화하여 업데이트됩니다.

4. **오디오 특징 추출**:

   - 각 에피소드에서 Support Set과 Query Set의 모든 오디오 샘플에 대해 **MFCC(Mel-frequency Cepstral Coefficients) 특징**을 추출합니다.
   - 40ms 길이의 음성 프레임에서 20ms 스트라이드로 40개의 MFCC 특징을 추출합니다.

5. **임베딩 네트워크 (TD-ResNet7)**:

   - 입력 MFCC 특징을 재구성하여 시간적 컨볼루션 [9]을 수행하고, 팽창 컨볼루션 [10]을 결합합니다.
   - TC-ResNet8 [9] 아키텍처를 수정하여 커널 크기를 $7 \times 1$로 줄이고, 세 개의 ResNet 블록에서 각각 1, 2, 4의 팽창(dilation) 비율을 사용합니다.

6. **Few-Shot Google Speech Command 데이터셋 합성**:

   - **필터링**: 1초 미만의 발화는 제거하여 MFCC 특징 일관성을 확보합니다.
   - **그룹화**: 1000명 이상의 화자가 있는 키워드는 `Core` 그룹으로, 나머지는 `Unknown` 그룹으로 분류합니다.
   - **균형 조정**: 30개의 `Core` 키워드 (각 1062개 샘플)와 5개의 `Unknown` 키워드 (각 386개 샘플)로 데이터셋을 균형 있게 구성하며, 각 키워드 샘플은 서로 다른 화자로부터 가져옵니다.
   - **분할**: `Core` 키워드는 학습/검증/테스트 세트로 (클래스 중복 없이) 20/5/5로 분할하고, `Unknown` 키워드는 모든 단계에 사용되지만 샘플은 고유하게 분할됩니다.
   - **배경 소음 혼합**: 학습 중 무작위로 배경 소음을 오디오 샘플에 낮은 볼륨(0.1)으로 섞습니다.
   - **침묵(Silence) 감지**: 배경 소리에서 무작위로 1000개의 1초 길이 구간을 샘플링하여 `Silence` 클래스로 추가합니다.

7. **실험 케이스**:
   - (a) **Core**: 순수 키워드 탐지.
   - (b) **Core + Background**: 배경 소음이 섞인 `Core` 키워드.
   - (c) **Core + Optional**: `Core` 키워드에 `Unknown` 또는 `Silence` 클래스 추가.
   - (d) **Core + Unknown + Silence + Background**: 배경 소음과 `Unknown`, `Silence` 클래스가 모두 포함된 가장 현실적인 시나리오.

## 📊 Results

- 제안된 **TD-ResNet7** 아키텍처는 대부분의 실험 케이스에서 모든 기준선(cnntradfpool3, C64, TC-ResNet8)보다 뛰어난 성능을 보였습니다 (Table 2, Figure 6).
- 특히, 새로운 2-way 5-shot KWS 작업에서 **TD-ResNet7 모델은 약 94%의 정확도**를 달성하여, 제한된 샘플만으로 새로운 키워드를 효과적으로 분류할 수 있음을 입증했습니다. 이는 전통적인 딥러닝 방식으로는 불가능한 성능입니다.
- `Core + Background` 케이스의 2-way 5-shot KWS에서는 TC-ResNet8이 약간 더 나은 성능을 보였으나, 통계적으로 유의미한 차이는 아니었습니다 ($p=0.36$). 다른 모든 케이스에서는 TD-ResNet7이 유의미하게 우수했습니다 ($p \leq 0.05$).
- 클래스당 샘플 수(`K`)가 증가할수록 모든 아키텍처의 전반적인 성능이 향상되었으며, TD-ResNet7은 꾸준히 다른 기준선보다 우월한 성능을 유지했습니다.

## 🧠 Insights & Discussion

- 이 연구는 메트릭 학습 기반의 Prototypical Networks를 활용하여 소수 샘플만으로 새로운 키워드를 인식하는 Few-Shot Keyword Spotting(FS-KWS) 문제 해결의 가능성을 보여주었습니다.
- 제안된 TD-ResNet7 임베딩 모델(시간적 및 팽창 컨볼루션 사용)은 FS-KWS에 매우 효과적이며, 특히 제한된 자원을 가진 엣지(edge) 장치에서의 온디바이스 KWS 배포에 적합합니다. 이는 추론 시 미세 조정을 필요로 하지 않는 메트릭 학습의 장점 덕분입니다.
- 배경 소음, 침묵, 알 수 없는 키워드를 포함하도록 합성된 FS-KWS 데이터셋은 향후 이 분야 연구에 중요한 자원입니다. 이를 통해 실제 환경에 가까운 시나리오에서 시스템의 견고성을 평가할 수 있습니다.
- `unknown` 및 `silence` 카테고리를 효과적으로 처리하는 능력은 실제 환경에서 불필요한 호출을 방지하고 시스템의 사용자 경험을 개선하는 데 필수적입니다.

## 📌 TL;DR

기존 KWS는 대규모 데이터로 미리 정의된 키워드만 인식하여 사용자 정의 및 온디바이스 인식에 한계가 있었습니다. 본 연구는 이 문제를 **소수 키워드 스포팅(FS-KWS)**으로 정의하고, **Prototypical Networks**를 기반으로 한 메트릭 학습 방식을 제안합니다. 특히, 시간적 및 팽창 컨볼루션을 활용한 새로운 임베딩 네트워크 **TD-ResNet7**을 도입하고, 배경 소음, 침묵, 알 수 없는 키워드가 포함된 FS-KWS 데이터셋을 합성하여 공개했습니다. 제안된 TD-ResNet7 모델은 2-way 5-shot KWS 작업에서 **약 94%의 정확도**를 달성하며, 제한된 샘플로도 새로운 키워드를 효과적으로 분류할 수 있음을 입증하여 기존 방식들을 뛰어넘는 성능을 보여주었습니다.
