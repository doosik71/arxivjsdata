# A Cascade Architecture for Keyword Spotting on Mobile Devices

Alexander Gruenstein, Raziel Alvarez, Chris Thornton, Mohammadali Ghodrat

## 🧩 Problem to Solve

모바일 기기에서 "Ok Google", "Alexa", "Hey Siri"와 같은 키워드를 지속적으로 감지해야 하는 과제를 다룹니다. 특히, 배터리 용량(1,000~2,400mAh)이 제한적이고 연산 능력이 낮은 모바일 기기에서, 하루 배터리 소모량을 1% 미만으로 유지하기 위해 시스템 전체가 1mA 미만의 전력을 소모하면서도 높은 정확도를 유지해야 하는 것이 핵심 문제입니다.

## ✨ Key Contributions

- **캐스케이드(Cascade) 아키텍처:** 저전력 DSP(Digital Signal Processor)에서 실행되는 작고 전력 효율적인 1단계 탐지기와, 메인 AP(Application Processor)에서 실행되는 더 크고 정확한 2단계 탐지기를 결합한 구조를 제안합니다.
- **초저전력 소모:** 지속적인 키워드 감지 작업을 전력 효율적인 DSP에 위임함으로써, 모바일 기기에서 상시 대기 상태에서의 전력 소모를 최소화했습니다.
- **화자 검증(Speaker Verification) 통합:** 2단계에 화자 검증 기능을 추가하여, 등록된 사용자만이 키워드를 활성화할 수 있도록 함으로써, 오인식률(FAR)을 5~10배 감소시키고 오거절률(FRR) 증가를 1% 미만으로 유지했습니다.
- **모델 경량화를 위한 양자화(Quantization):** 신경망 모델의 메모리 사용량과 연산 속도 개선을 위해 모델 파라미터를 8비트 정수로 양자화하는 방법을 적용했습니다.
- **DSP 플랫폼 호환성 확보:** 다양한 DSP 플랫폼의 정밀도 차이에도 불구하고 비트 단위로 동일한 동작을 에뮬레이션하는 라이브러리를 사용하여, 플랫폼별 최적화된 모델 훈련을 가능하게 했습니다.

## 📎 Related Works

- **소형 풋프린트 키워드 스포팅(Small-footprint Keyword Spotting):** 심층 신경망(DNNs) 및 컨볼루션 신경망(CNNs)을 활용한 소형 풋프린트 키워드 스포팅 연구들 [2,3,8].
- **랭크 제약 토폴로지(Rank-Constrained Topology):** 심층 신경망 압축을 위한 랭크 제약 토폴로지 [6].
- **디코더 공식(Decoder Formulation):** 키워드 스포팅의 디코더 점수 계산 방식 [7].
- **화자 검증(Speaker Verification):** 텍스트-의존적(text-dependent) 화자 검증을 위한 심층 신경망 및 LSTM 활용 [4,9].
- **심층 음향 모델의 효율적인 표현 및 실행:** [1]에서 제안된 심층 음향 모델의 효율적인 표현 및 실행 방법.
- **서버 측 검증(Server-side Validation):** 컨텍스트 음성 인식(Contextual Speech Recognition)을 이용한 키워드 스포팅 [5].

## 🛠️ Methodology

1. **캐스케이드 아키텍처:**
   - **1단계 (DSP):** 매우 작고 전력 효율적인 모델이 DSP에서 지속적으로 실행됩니다. 키워드에 해당하는 오디오(예: 2초)를 버퍼링하며, 잠재적인 키워드 감지 시 2단계를 트리거합니다.
   - **2단계 (AP):** 1단계에서 버퍼링된 오디오를 받아, 더 크고 정확한 모델을 사용하여 최종 감지 결정을 내립니다. 이 단계에서 화자 검증도 수행됩니다. 메인 애플리케이션 프로세서(AP)에서 실행되어 더 높은 연산 능력을 활용합니다.
2. **키워드 스포터 구성 요소:**
   - **신호 처리 프런트엔드 (Frontend):** 원본 오디오 신호를 로그-멜 필터뱅크(log-mel filterbank) 특징으로 변환합니다 (예: 25ms 프레임당 32 또는 40 채널).
   - **신경망 음향 인코더 (Neural Network Acoustic Encoder):** 필터뱅크 특징을 받아 키워드에 대한 음향 단위(예: 음소 또는 음절)의 사후 확률(posterior probabilities)을 생성합니다. [6]에서 제안된 랭크 제약 토폴로지를 사용합니다.
   - **디코더 (Decoder):** 키워드의 음향 단위 $y = \{y_1, y_2, \dots, y_M\}$에 대한 사후 확률을 입력받아 0과 1 사이의 점수 $h(y)$를 생성합니다. 이 점수는 슬라이딩 윈도우(sliding window) 내에서 스무딩된(smoothed) 사후 확률 $s_t(y_i)$의 곱을 통해 계산됩니다:
     $$s_t(y_i) = \frac{1}{L} \sum_{j=t-L+1}^{t} y_{i,j}$$
     $$h(y) = \left[ \max_{1 \le t_1 \le \dots \le t_M \le T} \prod_{i=1}^{M} s_{t_i}(y_i) \right]^{1/M}$$
3. **화자 검증:**
   - 사전에 사용자의 키워드 발화(예: 3회)를 등록하여 고유한 시그니처를 생성합니다.
   - 실시간 감지 시, 2단계 키워드 탐지기에 의해 분할된 발화를 신경망(예: LSTM [4])이 처리하여 시그니처를 생성하고, 저장된 시그니처와 비교(예: 코사인 거리)하여 화자 검증을 수행합니다.
4. **작동 지점(Operating Point) 선택:**
   - 1단계와 2단계 탐지기는 유사한 오거절률(FRR)을 가지도록 훈련됩니다.
   - 1단계의 오인식률(FAR)은 2단계보다 높지만, 2단계를 시간당 몇 번만 깨우도록 조정하여 전체 전력 소모를 낮춥니다.
   - 화자 검증은 전체 FAR을 5~10배 감소시키며, FRR은 1% 미만으로 추가됩니다.
5. **DSP 구현 고려사항:**
   - **메모리:** DSP의 제한된 메모리(예: 128kB) 내에서 2초 오디오 버퍼(64kB), 코드(25kB), FFT 테이블(12kB) 등을 고려하여 1단계 키워드 모델의 크기를 13kB로 제한합니다.
   - **정밀도:** 다양한 DSP 플랫폼의 16, 24, 32비트 연산 정밀도 차이를 극복하기 위해 에뮬레이션 라이브러리를 사용하여 비트 단위로 동일한 동작을 보장하고, 플랫폼별 신경망 모델 훈련을 가능하게 합니다.
6. **양자화:**
   - 신경망 모델의 부동 소수점(floating point) 파라미터를 8비트 정수 표현으로 변환합니다.
   - 균일 선형 양자화기(uniform linear quantizer)를 사용하여 파라미터의 최소 및 최대값을 찾아 스케일링 인자(scaling factor)를 결정, 값을 더 작은 정밀도 스케일에서 균등하게 분포시킵니다.

## 📊 Results

- 제안된 캐스케이드 시스템은 1단계의 작동 지점에 따라 전반적인 오인식률(FAR)을 크게 줄이면서 2단계 단독 모델과 유사한 오거절률(FRR)을 달성합니다.
- 예를 들어, 1단계가 시간당 10.0회 오인식(FA/hr)을 할 때, 캐스케이드 시스템은 시간당 0.02회 오인식으로 FAR을 크게 낮추는 것을 보여줍니다. 동시에 FRR은 3.5%로, 2단계 단독 모델의 FRR(0.1%)에 가까워집니다.
- 화자 검증은 전체 오인식률(FAR)을 5~10배 추가적으로 감소시키는 반면, 절대적인 오거절률(FRR) 증가는 1% 미만으로 미미합니다.

## 🧠 Insights & Discussion

- **의의:** 이 캐스케이드 아키텍처는 전력 제약이 심한 모바일 기기에서 "항상 켜져 있는" 음성 비서 기능을 고정밀도로 구현할 수 있게 합니다.
- **효과:** 저전력 DSP와 고성능 AP 간에 작업을 지능적으로 분배함으로써, 전력 소모와 정확도 사이의 균형을 효과적으로 맞춥니다. 화자 검증은 시스템의 신뢰성을 높이고 불필요한 오작동을 줄이는 데 결정적인 역할을 합니다.
- **한계 및 과제:** DSP의 엄격한 메모리 제약으로 인해 매우 작은 모델이 필요하며, 다양한 DSP 플랫폼의 정밀도 차이로 인한 최적화 및 모델 훈련의 복잡성이 있습니다. 1단계와 2단계의 작동 지점을 정밀하게 조정하는 것이 FAR, FRR, 전력 소모의 균형을 맞추는 데 중요합니다.
- **향후 개선:** 선택적으로 서버 측 검증 단계를 추가하여 오인식률(FAR)을 더욱 줄이고 전반적인 단어 오류율(WER)을 개선할 수 있습니다.

## 📌 TL;DR

**문제:** 모바일 기기에서 낮은 전력 소모로 높은 정확도를 유지하며 키워드를 지속적으로 감지하는 것.
**방법:** 저전력 DSP에서 상시 대기하는 소형 1단계 탐지기와, 1단계에 의해 트리거될 때 메인 AP에서 실행되는 대형 2단계 탐지기로 구성된 캐스케이드 아키텍처를 제안합니다. 2단계에는 화자 검증 기능이 포함되며, 모델은 8비트 정수로 양자화됩니다.
**결과:** 이 시스템은 낮은 오인식률(FAR)과 오거절률(FRR)을 유지하면서 모바일 기기에서 상시 대기 음성 비서의 전력 효율적인 구현 가능성을 입증합니다.
