# Learning Audio-Text Agreement for Open-vocabulary Keyword Spotting

Hyeon-Kyeong Shin, Hyewon Han, Doyeon Kim, Soo-Whan Chung, Hong-Goo Kang

## 🧩 Problem to Solve

- 기존 키워드 스포팅(KWS) 방식은 일반적으로 사용자가 키워드 음성을 직접 등록해야 하는 Query-by-Example (QbyE) 접근 방식을 사용합니다.
- 음성 등록 방식은 사용자의 음성 특성, 녹음 환경, 배경 소음 등 녹음 세션의 일관성에 크게 의존하여 성능 저하를 야기하고, 다양한 사용자와 환경에 대한 일반화가 어렵습니다.
- 학습 데이터에 포함되지 않은 임의의 문구를 포함하는 '사용자 정의 키워드'를 탐지하는 개방형 어휘(open-vocabulary) KWS는 더욱 어려운 과제입니다.
- 소음이 많은 환경에서도 안정적인 KWS 성능을 유지하는 것이 중요합니다.

## ✨ Key Contributions

- **새로운 End-to-End 사용자 정의 키워드 스포팅(UDKWS) 방법 제안:** 음성 키워드 등록 없이 텍스트 키워드 등록을 활용하여 음성 및 텍스트 시퀀스 간의 언어적 일치 패턴을 학습하는 방법을 제안합니다.
- **교차-모달 대응 감지기(CMCD) 아키텍처:** 오디오와 텍스트 임베딩을 공통 잠재 공간에 배치하고 교차 어텐션(cross-attention) 메커니즘을 사용하여 일치 여부를 판단하는 CMCD 아키텍처를 도입했습니다.
- **단조 매칭 손실($L_{MM}$) 도입:** 어피니티 행렬(affinity matrix)에서 강건한 시간적 상관관계 패턴을 강제하기 위한 새로운 단조 매칭 손실 함수를 제안했습니다.
- **디노이징 손실($L_{DN}$) 활용:** 음향 임베딩 네트워크의 강건성을 향상시키기 위해 디노이징 손실을 사용하여 시끄러운 환경에서의 성능을 개선했습니다.
- **LibriPhrase 데이터셋 공개:** 개방형 어휘 KWS 모델의 효율적인 학습을 위한 LibriSpeech 기반의 새로운 단문구 데이터셋인 LibriPhrase를 구축하고 공개했습니다.
- **경쟁력 있는 성능 달성:** 다양한 평가 세트에서 기존 단일 모달 및 교차 모달 기준선 대비 우수하거나 경쟁력 있는 결과를 달성했습니다.

## 📎 Related Works

- **키워드-필러(Keyword-filler) 전략:** 입력 스트림에서 음운 시퀀스를 감지합니다 ([1, 2, 3]).
- **Query-by-Example (QbyE) 방법:** 입력 쿼리를 등록된 예제와 일치시킵니다.
  - LSTM 네트워크를 사용한 가변 길이 오디오 신호의 고정 길이 임베딩 [4].
  - 개방형 어휘 문제 극복을 위해 CTC(Connectionist Temporal Classification) 손실 사용 [14].
  - 어텐션 및 SoftTriple 손실을 사용하는 QbyE 시스템 [6].
- **교차-모달(Cross-modal) 접근 방식:**
  - 오디오와 텍스트 임베딩을 사용하여 단어 수준 표현으로 매핑하는 개방형 어휘 KWS [7].
  - 등록된 텍스트 쿼리에서 추출된 단어 수준 임베딩과 프레임 단위 오디오 임베딩을 곱하여 확률 계산 [11].
  - 오디오-시각(audio-visual) KWS에서 비디오 및 오디오 임베딩 간의 유사성 맵을 계산하는 접근 방식 [10] (본 논문의 유사성 맵 패턴 활용과 유사하나 모델 크기 문제가 있음).

## 🛠️ Methodology

제안하는 모델은 **교차-모달 대응 감지기(Cross-Modal Correspondence Detector, CMCD)**로, 다음과 같은 서브 모듈과 학습 기준으로 구성됩니다.

1. **아키텍처:**

   - **오디오 인코더:**
     - 입력: 40차원 멜 필터뱅크(mel-filterbank) 계수.
     - 구성: 두 개의 1D 컨볼루션 레이어(stride 2로 프레임 수 감소)와 두 개의 GRU(Gated Recurrent Unit) 레이어.
     - 출력: 오디오 임베딩 $E_a \in R^{T_a \times m}$.
   - **텍스트 인코더:**
     - 입력: 텍스트 키워드.
     - 구성: 사전 학습된 Grapheme-to-Phoneme (G2P) 모델 [15] (CMU 발음 사전 활용, OOV 단어는 신경망으로 음소 시퀀스 추정)과 완전 연결(fully-connected) 레이어.
     - 출력: 텍스트 임베딩 $E_t \in R^{T_t \times m}$.
     - 임베딩 차원 $m$은 128로 설정.
   - **패턴 추출기 (Pattern Extractor):**
     - 메커니즘: 교차 어텐션 메커니즘 [9, 10, 11] 사용.
     - 오디오 임베딩 $E_a$는 키($K$) 및 값($V$)으로, 텍스트 임베딩 $E_t$는 쿼리($Q$)로 사용.
     - $$Attn = softmax \left( \frac{QK^T}{\sqrt{d_k}} \right) \times V = A(Q,K) \times V$$
     - 어피니티 행렬 $A$는 오디오와 텍스트 임베딩 간의 시간적 상관관계를 나타내며, 동일한 언어적 내용일 경우 단조 패턴(monotonic pattern)을, 다를 경우 불분명한 패턴을 보인다.
     - 출력: 어텐션 행렬 $Attn$.
   - **패턴 분류기 (Pattern Discriminator):**
     - 입력: 어텐션 행렬 $Attn$.
     - 구성: 하나의 GRU 레이어와 시그모이드 함수를 포함하는 완전 연결 레이어.
     - 기능: 오디오와 텍스트 입력이 동일한 키워드인지(긍정) 아닌지(부정)를 결정.

2. **학습 기준 (손실 함수):**

   - 총 손실: $L_{total} = \lambda_1 L_{DN} + \lambda_2 L_{MM} + L_D$ (여기서 $\lambda_1=0.5, \lambda_2=0.3$).
   - **디노이징 손실($L_{DN}$):**
     - 목표: 잡음이 있는 음성 쿼리에서도 강건한 성능을 얻기 위함.
     - 방법: 음향 인코더를 샴(Siamese) 네트워크로 구성하여 깨끗한 음성 임베딩과 잡음 있는 음성 임베딩 간의 평균 제곱 오차(MSE)를 최소화.
     - $$L_{DN} = ||E_{clean\_A} - E_{noisy\_A}||^2$$
   - **단조 매칭 손실($L_{MM}$):**
     - 목표: 어피니티 행렬 $A$에 나타나는 패턴을 강화.
     - 방법: $A$와 수동으로 구축된 목표 패턴 $M_i$ 간의 거리를 최소화.
     - $$L_{MM} = ||A - M_i||^2, \text{ where } i \in \{f, n, pf\}$$
     - 목표 패턴 종류:
       - 완전 일치($M_f$): 가우시안 대각선 패턴 (식 5, 그림 2(a)).
       - 불일치($M_n$): 정규화된 무작위 노이즈를 사용한 산포된 행렬 (식 6, 그림 2(b)).
       - 부분 일치($M_{pf}$): 시퀀스의 앞부분이 일치할 경우 $M_f$와 $M_n$을 결합한 형태 (식 7, 그림 2(c)). 뒷부분만 일치하는 경우는 불일치로 간주.
   - **탐지 손실($L_D$):**
     - 목표: 교차-어텐션 행렬을 기반으로 키워드를 탐지하도록 모델 학습.
     - 방법: 학습 초기에는 이진 교차 엔트로피(BCE) 손실을 사용하고, 나중에는 불균형 데이터셋에 효과적인 Focal Loss [12]로 대체.

3. **데이터셋 (LibriPhrase):**
   - LibriSpeech 데이터셋 [13]을 기반으로 새로운 구절 단위 코퍼스를 구축.
   - Montreal Forced Aligner [20]를 사용하여 단어 수준 시간 스탬프를 추출하고, 1~4단어 길이의 짧은 구절로 분할.
   - 훈련 세트: 각 길이별 20만 개씩 총 80만 개의 구절.
   - 잡음: MS-SNSD 데이터셋 [21]의 잡음(SNR 5~15dB)을 훈련 중 오디오 샘플에 추가하여 환경 강건성 확보.
   - 평가 세트: Levenshtein 거리에 따라 쉬운 부정(easy negatives, $LP_E$) 및 어려운 부정(hard negatives, $LP_H$) 샘플로 구성. Google Speech Commands V1 (G) [23] 및 Qualcomm Keyword Speech (Q) [25] 데이터셋도 사용.

## 📊 Results

- **기준선 대비 성능 비교 (표 2, 그림 3):**
  - 제안하는 CMCD 모델은 $LP_H$ (어려운 부정 샘플) 및 Q 데이터셋에서 기존 방법론들을 능가하는 성능을 보였습니다. 특히 Q 데이터셋은 'snapdragon', 'lumina'와 같은 고유 명사를 포함하여 음성 정보 추정이 어려운 경우에도 우수한 성능을 나타냈습니다.
  - G 데이터셋(자주 사용되는 단어로 구성)에서는 어텐션 기반 QbyE 방법 [6]이 약간 더 나은 성능을 보였지만, G 데이터셋을 제외한 모든 데이터셋에서 CMCD는 AUC 점수와 EER 면에서 기준선을 뛰어넘었습니다.
- **어블레이션 스터디 (표 3, 그림 4):**
  - **$L_{DN}$ (디노이징 손실):** 환경적 왜곡이 있는 G 데이터셋에서 전반적인 성능을 향상시켰습니다. 상대적으로 깨끗한 오디오 데이터로 구성된 $LP_E$ 데이터셋에서는 미미한 부정적 영향을 보였으나, 전반적인 소음 환경 강건성에 기여함을 확인했습니다.
  - **$L_{MM}$ (단조 매칭 손실):** 대부분의 데이터셋에서 전반적인 성능 향상을 가져왔습니다. 어피니티 행렬 시각화 결과 (그림 4)는 $L_{MM}$이 일치 영역에서는 일관된 패턴을, 불일치 영역에서는 산포된 패턴을 형성하는 데 도움을 줍니다.
- **키워드 길이에 따른 분석 (그림 5):**
  - 제안하는 방법은 키워드 구절의 단어 수(1~4개)에 관계없이 강건한 탐지 성능을 보였습니다.
  - 특히 키워드가 짧을수록 다른 방법론들이 성능 저하를 겪는 반면, CMCD는 대부분의 서브셋에서 가장 좋은 점수를 기록했습니다. 단일 단어 키워드에서 어텐션 기반 QbyE 방법 [6]의 성능이 크게 저하되는 것과 대조적입니다.

## 🧠 Insights & Discussion

- **교차-모달 접근 방식의 장점:** 텍스트 키워드 등록을 활용함으로써 기존 QbyE 방식의 음성 등록 일관성 문제를 해결하고, 사용자 음성 특성이나 환경에 관계없이 일반화된 성능을 제공하여 사용자 친화적인 KWS 시스템 구축 가능성을 높입니다.
- **단조 매칭 손실의 효과:** $L_{MM}$은 오디오-텍스트 간의 명확하고 해석 가능한 시간적 상관관계 패턴(일치 시 대각선 단조 패턴, 불일치 시 산포된 패턴)을 학습하도록 모델을 명시적으로 안내하여 더욱 강건한 임베딩을 생성합니다.
- **소음에 대한 강건성:** $L_{DN}$의 도입은 실제 환경에서 중요한 요소인 소음이 있는 환경에서의 성능 향상에 기여합니다.
- **개방형 어휘 처리 능력:** 교차-모달 접근 방식은 제한된 키워드 세트에 특화된 음향 모델에 의존하지 않기 때문에 본질적으로 개방형 어휘 키워드를 더 잘 처리할 수 있습니다. 텍스트 인코딩을 위한 G2P 모델은 언어적 기반을 제공합니다.
- **도전적인 경우에 대한 우수성:** $LP_H$ (음운적으로 유사한 부정 샘플) 및 Q (고유 명사) 데이터셋에서의 강력한 성능은 미묘한 언어적 차이를 구별하는 모델의 능력을 보여주며, 이는 KWS에서 중요한 과제입니다.
- **한계 및 트레이드오프:** 비록 전반적으로 우수하지만, 모델은 간단하고 일반적인, 훈련 데이터 내의 키워드(G 데이터셋)에서는 특정 음성 전용 QbyE 시스템에 비해 약간 낮은 성능을 보였습니다. 이는 개방형 어휘 일반화와 특정 키워드 최적화 간의 잠재적인 트레이드오프를 시사할 수 있습니다.
- **LibriPhrase 데이터셋의 기여:** 짧은 구절 및 개방형 어휘 시나리오에 특화된 KWS 시스템을 훈련하고 평가하기 위한 귀중한 자원을 제공하며, 기존 데이터셋의 공백을 채웁니다.

## 📌 TL;DR

본 논문은 오디오-텍스트 간의 언어적 일치를 학습하는 End-to-End 사용자 정의 키워드 스포팅(UDKWS) 시스템인 CMCD(Cross-Modal Correspondence Detector)를 제안한다. CMCD는 음성 키워드 등록 대신 텍스트 키워드 등록을 사용하며, 교차 어텐션 메커니즘을 통해 오디오 쿼리와 등록된 텍스트 키워드 간의 언어적 합의를 공통 잠재 공간에서 매칭한다. 주요 기여는 강건한 학습을 위한 새로운 단조 매칭 손실과 디노이징 손실, 그리고 KWS 시스템 학습을 위한 단문구 데이터셋인 LibriPhrase의 도입이다. 실험 결과, CMCD는 기존 기준선에 비해 경쟁력 있는 성능을 보였으며, 특히 개방형 어휘 및 소음이 있는 어려운 환경에서 뛰어난 성능과 키워드 길이에 대한 강건성을 입증했다.
