# Latency Control for Keyword Spotting
Christin Jose, Joseph Wang, Grant P. Strimel, Mohammad Omar Khursheed, Yuriy Mishchenko, Brian Kulis

## 🧩 Problem to Solve
음성 비서와 같은 대화형 에이전트에서 키워드 스포팅(KWS)은 사용자 상호작용을 시작하는 데 필수적입니다. 기존 KWS 모델은 주로 정확도에 중점을 두어 왔지만, 이는 종종 탐지 지연 시간(latency) 증가로 이어집니다. 높은 지연 시간은 사용자 경험을 저해하고 반복적인 키워드 발화와 같은 사용자 행동 변화를 유발할 수 있습니다. 특히 맥스 풀링(max-pooling) 손실을 사용하는 모델은 추가 오디오 문맥을 활용하여 정확도를 높일 수 있으나, 이로 인해 탐지 지연 시간이 현저히 증가하는 문제가 있습니다. 이 문제를 해결하기 위해 키워드 끝점에 대한 명시적인 지식 없이도 KWS 모델의 지연 시간을 제어하면서 정확도와의 균형을 맞출 수 있는 방법을 찾는 것이 목표입니다.

## ✨ Key Contributions
*   **지연 시간 제어 손실 함수 제안**: 키워드 끝점 정보 없이 KWS 모델의 지연 시간을 제어할 수 있는 새로운 손실 함수를 제안합니다. 이 손실 함수는 맥스 풀링 손실을 일반화한 형태입니다.
*   **단일 튜닝 가능한 하이퍼파라미터**: 단일 하이퍼파라미터($b$) 조정을 통해 탐지 지연 시간과 정확도 사이의 균형을 쉽게 조절할 수 있게 합니다.
*   **우수한 성능 입증**: 지연 시간 제약 조건 하에서 기존 최신(SOTA) 방법론 대비 우수한 성능을 보여줍니다. 특히, 고정된 지연 시간 목표에서 기준선 대비 오탐(False Accept)률을 25% 상대적으로 개선했습니다.
*   **손실 함수 일반화**: 제안하는 방법이 맥스 풀링 손실뿐만 아니라 단일 시점의 사후 확률을 입력으로 받는 모든 손실 함수에 일반화될 수 있음을 보여줍니다.

## 📎 Related Works
*   **전통적인 KWS 연구**: 대부분의 KWS 연구는 정확도 향상과 새로운 아키텍처에 중점을 두었습니다 (예: [13, 14, 15, 16]).
*   **정확도-지연 시간 상충 관계**: Sigtia et al. [17]은 키워드 후의 추가 문맥을 사용하는 2단계 검증 모델을 통해 정확도를 개선하지만, 일부 예외에서 지연 시간 증가를 초래하는 접근 방식을 제시했습니다. 본 논문의 목표는 단일 단계 모델에서 정확도와 지연 시간의 균형을 조절하는 것입니다.
*   **저지연 CRNN**: Du et al. [18]과 같은 저지연 컨볼루션 순환 신경망(CRNN) 아키텍처는 계산 효율성을 통해 지연 시간을 개선하는 데 초점을 맞춥니다. 본 논문은 계산 지연 시간이 아닌 모델이 결정을 내리는 데 걸리는 알고리즘적 지연 시간(키워드 끝점 이후 프레임 수)에 초점을 맞춥니다.
*   **Fu et al. [19]의 맥스 지연(Max-Latency) 접근법**: 이 방법은 학습 중 키워드 이후의 오디오 문맥을 마스킹하여 탐지 지연 시간을 제어하는 손실 함수를 제안합니다. 그러나 이 접근법은 학습을 위해 키워드 끝점의 명시적인 지식을 필요로 하며 다른 손실 함수에 쉽게 일반화되지 않는다는 한계가 있습니다. 본 논문에서는 이 방법을 SOTA 기준선으로 사용합니다.

## 🛠️ Methodology

### 3.1. 맥스 풀링 손실 (Max Pooling Loss)
기존 맥스 풀링 손실은 다음과 같습니다:
$$
L(y,[p_{y0},...,p_{yT}]) = - \log(p_{yt})
$$
여기서 $t$는 다음과 같이 선택됩니다:
$$
t = \begin{cases}
\operatorname*{argmin}_{i \in \{0,...,T\}} (p_{0i}) & \text{if } y=0 \\
\operatorname*{argmax}_{i \in \{0,...,T\}} (p_{yi}) & \text{if } y \neq 0
\end{cases}
$$
$y$는 예제 레이블이고 $p_{yt}$는 시간 $t$에서의 클래스 $y$에 대한 모델의 사후 확률입니다.
*   **장점**: 수동 정렬 없이 모델이 최적의 프레임을 선택하여 데이터 준비 오버헤드를 줄이고 정렬 오류를 방지하며, 경험적으로 더 나은 탐지 정확도를 달성합니다.
*   **단점**: 긍정 예제에서 모델이 최대 사후 확률 프레임을 결정하도록 허용함으로써, 특히 키워드 이후에 상당한 오디오 문맥이 있을 때 상당한 지연 시간이 발생할 수 있습니다. 이는 모델이 추가 문맥을 활용하여 예측 정확도를 높이기 때문입니다.

### 3.2. 지연 시간 제어 (Latency Control)
지연 시간 제어를 위해 맥스 풀링 손실을 다음과 같이 확장합니다:
$$
L(y,[p_{y0},...,p_{yT}]) = - \log(p_{yt})
$$
여기서 $t$는 다음과 같이 선택됩니다:
$$
t = \begin{cases}
\operatorname*{argmin}_{i \in \{0,...,T\}} (p_{0i}) & \text{if } y=0 \\
\left( \operatorname*{argmax}_{i \in \{0,...,T\}} (p_{yi}) - \beta \right)_+ & \text{if } y \neq 0
\end{cases}
$$
여기서 $(\cdot)_+$ 함수는 $(x)_+ = \max(x,0)$으로 정의되며, $\beta$는 미리 정의된 분포 $B$에서 추출된 임의 값입니다. 실제로는 $B$를 사용자 정의 매개변수 $b$를 갖는 베르누이 분포($\beta=1$일 확률 $b$)로 설정합니다.
*   **작동 원리**: 긍정 예제의 경우, 확률 $b$로 손실은 최대 클래스 사후 확률 프레임이 아닌 이전 프레임에서 생성된 사후 확률을 기반으로 계산됩니다. 이는 모델이 더 이른 탐지 피크를 방출하도록 강제하여 지연 시간을 줄입니다. $b$ 값을 증가시킬수록 이른 사후 확률에 더 큰 가중치가 부여됩니다.
*   **장점**: 키워드 끝점에 대한 정확한 추정 없이도 지연 시간을 제어할 수 있습니다. 기존 맥스 풀링 손실과 동일한 데이터셋, 학습 절차, 모델 아키텍처를 사용하며, 손실 함수의 간단하고 계산 효율적인 수정만 필요합니다.
*   **일반화**: 이 접근 방식은 Eqn. 3과 같이 단일 시점의 사후 확률과 레이블을 입력으로 받는 모든 손실 함수에 일반화될 수 있습니다.

### 4. 실험 설정
*   **모델 아키텍처**: [21]에서 제안된 CNN 아키텍처(그림 2)를 사용하여 "Amazon" 키워드에 대한 이진 KWS 문제를 해결합니다.
*   **특징**: 오디오는 25ms 프레임, 10ms 시프트로 계산된 64차원 로그 멜-필터뱅크 에너지(LFBE) 특징으로 변환됩니다.
*   **네트워크 구조**: 5개의 컨볼루션 계층과 3개의 완전 연결(FC) 계층으로 구성되며, 첫 번째 계층 후에 맥스 풀링, 두 번째 계층에는 3-stride 컨볼루션이 적용됩니다.
*   **학습**: Adam 최적화기와 0.3의 드롭아웃 비율을 사용합니다.
*   **데이터**: 약 20,000시간의 비식별화된 주석 데이터로 학습하고, 약 1,400시간의 데이터로 평가합니다. 키워드 예제 세그먼트는 HMM 모델을 사용하여 대략적으로 정렬되었습니다.

## 📊 Results
*   **$b$ 값에 따른 성능 변화**: 제안된 방법으로 $b \in \{0.0, 0.1, 0.2, 0.33, 0.5, 1.0\}$ 값을 사용하여 6개의 모델을 학습했습니다. $b=0$은 표준 맥스 풀링 손실과 동일합니다.
    *   예상대로 $b=0$ (맥스 풀링 모델)이 최고의 탐지 성능을 보였습니다.
    *   $b$ 값이 증가함에 따라 성능이 감소하며, $b=0.33$에서는 교차 엔트로피(HMM 정렬 데이터 사용)와 유사한 탐지 성능을 보였습니다. $b$가 더 커지면 탐지 성능이 더 저하되지만, 이는 지연 시간 단축이라는 목표와 상충됩니다.
*   **지연 시간 대 오탐(FA)률 비교**: 그림 4는 고정된 미탐(False Reject)률에서 모델의 상대적 지연 시간과 오탐률을 비교합니다.
    *   제안된 접근 방식은 맥스 지연 접근 방식 [19]과 HMM 정렬 데이터를 사용한 교차 엔트로피 학습 모델 모두를 명확하게 능가합니다.
    *   특히, 맥스 풀링 손실(가장 높은 지연 시간, 가장 낮은 오탐률)을 기준선으로 했을 때, 제안된 방법은 고정된 지연 시간에서 기준 모델 대비 오탐률을 25% 상대적으로 개선했습니다.
    *   제안된 방법은 학습 시 키워드 정렬에 대한 정확한 추정을 필요로 하지 않는다는 추가적인 이점이 있습니다.
*   **시각화**: 그림 5는 $b$ 값 변화가 단일 오디오 예제에서 사후 확률 피크에 미치는 영향을 시각화하여 보여줍니다. $b$ 값이 증가함에 따라 사후 확률 피크가 점차 더 일찍 이동하며, $b=1$인 극단적인 경우 키워드 완료 이전에 피크가 발생하여 지연 시간 단축 능력을 시각적으로 입증합니다.

## 🧠 Insights & Discussion
KWS 모델에서 지연 시간은 대화형 에이전트 시스템의 사용자 경험에 매우 중요한 요소입니다. 본 논문에서 제안하는 새로운 손실 함수를 사용한 접근 방식은 키워드 끝점 지식을 필요로 하지 않으며, 구현이 용이하면서도 키워드 끝점 지식에 의존하는 기존 SOTA 접근 방식보다 뛰어난 성능을 제공합니다. 이는 특히 실제 환경에서 데이터 주석의 부담을 줄이면서도 뛰어난 성능을 유지할 수 있음을 의미합니다. 지연 시간과 성능 간의 균형을 하나의 직관적인 하이퍼파라미터로 제어할 수 있어 다양한 애플리케이션 요구사항에 유연하게 대응할 수 있습니다.

한계점으로는, 이 연구가 특정 CNN 아키텍처와 "Amazon" 키워드에 초점을 맞추었으며, 다른 모델 구조나 다양한 키워드에 대한 일반화 가능성에 대한 추가 실험이 필요할 수 있습니다. 미래 연구에서는 이 하이퍼파라미터를 교차 엔트로피와 같은 다른 일반적인 손실 함수에 적용하고, 신호-해석 애플리케이션의 발화 탐지와 같은 다른 사용 사례로 확장할 계획입니다.

## 📌 TL;DR
KWS 모델의 정확도와 지연 시간 상충 문제를 해결하기 위해, 본 논문은 키워드 끝점 정보 없이 지연 시간을 제어할 수 있는 새로운 손실 함수를 제안한다. 이 손실 함수는 단일 하이퍼파라미터 $b$를 통해 맥스 풀링 손실을 확장하여 모델이 더 이른 시점에 탐지 피크를 생성하도록 강제한다. 실험 결과, 제안된 방법은 고정된 지연 시간 목표에서 오탐률을 25% 상대적으로 개선하는 등 기존 SOTA 모델보다 우수한 성능을 보였다.