# Boundary-aware Context Neural Network for Medical Image Segmentation

Ruxin Wang, Shuyuan Chen, Chaojie Ji, Jianping Fan and Ye Li, Senior Member, IEEE

---

## 🧩 Problem to Solve

의료 영상 분할은 임상 분석 및 질병 진단을 위한 신뢰할 수 있는 기반을 제공하지만, 기존 컨볼루션 신경망(CNN) 기반 방법들은 종종 객체 경계가 부정확하여 만족스럽지 못한 분할 마스크를 생성합니다. 이는 연속적인 풀링 및 컨볼루션 연산 후 제한된 컨텍스트 정보와 불충분한 판별 특징 맵으로 인해 발생합니다. 특히, 의료 영상은 높은 클래스 내 변동성, 클래스 간 구별 불가능성, 그리고 노이즈가 특징이므로, 미세한 분할을 위해 강력한 컨텍스트를 추출하고 판별 특징을 통합하는 것이 여전히 어려운 과제입니다.

---

## ✨ Key Contributions

- 2D 의료 영상 분할을 위해 **경계 인식 컨텍스트 신경망(BA-Net)**이라는 새로운 신경망 프레임워크를 제안합니다. 이 네트워크는 풍부한 컨텍스트를 캡처하고 미세 공간 정보를 보존합니다.
- 인코더 네트워크의 각 단계에서 **피라미드 경계 추출(PEE) 모듈**을 제안하여 다중 세분화된 경계 정보를 효과적으로 얻습니다.
- 객체 마스크 분할과 병변 경계 감지를 공동으로 학습하는 **미니 다중 작업 학습(mini-MTL) 모듈**을 설계합니다. 특히, 두 작업 간의 정보 상호 보완성을 달성하기 위해 새로운 **상호 작용 어텐션(Interactive Attention, IA)** 메커니즘을 도입하여 경계 정보를 활용해 분할 성능을 향상시킵니다.
- 전체 인코더 네트워크에서 다단계 특징을 선택적으로 통합하는 **교차 특징 융합(Cross Feature Fusion, CFF) 모듈**을 구축하여 다른 레벨 간의 정보 보완성을 실현합니다.
- 5가지 공개 의료 데이터셋(ISIC-2017, Kvasir-SEG, CVC-ColonDB, SZ-CXR, RIM-ONE-R1)에 대한 광범위한 실험을 통해 제안된 BA-Net이 최첨단 방법들보다 우수한 성능을 달성함을 입증합니다.

---

## 📎 Related Works

- **기존 분할 방법**: 회색조 기반(히스토그램 통계, 에지 감지, 영역 성장), 텍스처 기반(Gabor 필터), 아틀라스 기반 방법 등이 있으며, 수동으로 제작된 특징과 이미지 품질에 대한 낮은 견고성이라는 한계가 있습니다.
- **CNN 기반 분할 프레임워크**:
  - **인코더-디코더 구조**: U-Net, FCN이 대표적이며, 픽셀 단위의 감독 학습을 통해 작동합니다.
  - **컨텍스트 정보 추출**: DeepLab (Atrous Spatial Pyramid Pooling, ASPP), PSPNet (Pyramid Pooling Module), DDN (Dense Deconvolutional Network) 등은 다중 스케일 컨텍스트 정보를 인코딩하는 데 중점을 둡니다.
  - **어텐션 메커니즘**: AG-Net 등은 관심 영역에 가중치를 부여하여 성능을 향상시킵니다.
  - **다중 작업 학습**: 질병 분류와 병변 분할을 공동으로 개선하거나, 도메인 적응을 통해 교차 모달리티 분할을 수행하는 연구들도 있습니다.
  - **경계 정보**: 많은 기존 CNN 기반 방법들이 부정확한 객체 경계와 불만족스러운 분할 결과를 초래하는 제한된 컨텍스트 정보 문제를 겪고 있습니다.

---

## 🛠️ Methodology

제안된 BA-Net은 인코더-디코더 아키텍처를 기반으로 하며, ResNet을 백본으로 사용합니다.

**인코더 네트워크**:

1. **백본**: ImageNet으로 사전 학습된 ResNet-101을 사용하며, 마지막 전역 풀링 및 완전 연결 계층을 제거합니다. 수용 필드를 확대하고 공간 해상도를 유지하기 위해 마지막 두 블록에 atrous convolution (atrous rate = 2)을 적용합니다. 최종 residual 블록의 특징 맵에는 다중 스케일 특징 캡처를 위한 Atrous Spatial Pyramid Pooling (ASPP) 모듈이 적용됩니다.
2. **피라미드 경계 추출(PEE) 모듈**:
   - 각 인코더 단계에서 이전 residual 블록의 특징 맵 $F_{i}$를 $1 \times 1$ 컨볼루션을 통해 $F'_{i}$로 압축합니다.
   - 다양한 크기의 평균 풀링 $\text{avg}_{s}$을 $F'_{i}$에서 빼서 다중 세분화 경계 특징 $F^{(s)}_{i,P} = F'_{i} - \text{avg}_{s}(F'_{i})$를 얻습니다.
   - 이러한 경계 특징들을 $F'_{i}$와 함께 연결(concatenation)하고 $1 \times 1$ 컨볼루션으로 통합하여 $F_{i,P}$를 생성합니다.
3. **미니 다중 작업 학습(mini-MTL) 모듈**:
   - PEE 모듈의 출력 $F_{i,P}$를 입력으로 받아, 객체 마스크 분할과 병변 경계 감지를 위한 두 개의 작업별 브랜치로 분기됩니다. 각 브랜치는 두 개의 컨볼루션 계층과 하나의 업샘플링 계층을 포함합니다.
   - **상호 작용 어텐션(IA)**: 첫 번째 컨볼루션 계층에 임베드되어 다른 작업의 특징 맵으로부터 상호 작용 정보를 마이닝합니다.
     - 경계 특징 통합 예시: $F^{(1)}_{i,E} = F^{(1)}_{i,E} + (1-\sigma(F^{(1)}_{i,E})) \otimes F^{(1)}_{i,S}$
     - 분할 특징 통합 예시: $F^{(1)}_{i,S} = F^{(1)}_{i,S} + (1-\sigma(F^{(1)}_{i,S})) \otimes F^{(1)}_{i,E}$
     - 여기서 $\sigma$는 시그모이드 활성화 함수, $\otimes$는 원소별 곱셈입니다. 이 게이트 메커니즘은 추가 파라미터 없이 효과적인 정보 전달을 가능하게 합니다.
   - 두 개의 컨볼루션 계층과 IA 계층을 거친 후, 두 작업의 특징들을 통합하여 현재 단계의 풍부한 컨텍스트 표현 $F_{i,M}$을 얻습니다.
   - **공동 감독**: 각 mini-MTL 모듈에서 경계 맵($L_{i,E}$)과 분할 맵($L_{i,S}$) 예측에 대해 이진 교차 엔트로피 손실($BCE$)을 최소화하여 $L_{i,M} = L_{i,E} + L_{i,S}$를 통해 네트워크를 종단 간 훈련합니다.
4. **교차 특징 융합(CFF) 모듈**:
   - $F_{i,M}$을 입력으로 받아 어텐션 메커니즘을 통해 다른 수준의 특징 $F_{j,M}$ ($j \neq i$)에서 보완적인 구성 요소를 선택적으로 통합합니다:
     $$
     F_{i,C} = F_{i,M} + (1-\sigma(F_{i,M})) \otimes \left[ \sum_{j \neq i} \sigma(F_{j,M}) \otimes F_{j,M} \right]
     $$
   - 이 모듈은 다단계 특징 간의 정보 보완성을 실현하고 고수준 및 저수준 특징 맵을 모두 개선합니다.

**디코더 네트워크**:

- ASPP 모듈의 출력 특징 맵 $F_{A}$와 각 인코더 단계의 인코딩된 특징 $F_{i,C}$를 순차적으로 통합하여 최종 분할 예측을 위한 디코딩 특징 $D_{i}$를 얻습니다.
  $$
  D_{i} =
  \begin{cases}
  F(C(D_{i+1},F_{i,C});\theta_{i,D}), & i \in \{1,2,3\} \\
  F(C(F_{A},F_{i,C});\theta_{i,D}), & i=4
  \end{cases}
  $$

**최적화**:

- 전체 네트워크의 손실 함수는 디코더 손실 $L_{D}$와 다중 작업 모듈의 공동 손실 $L_{i,M}$의 합으로 정의됩니다: $\min L_{D} + \sum_{i} \lambda_{i} L_{i,M}$. 여기서 $\lambda_{i}$는 균형 매개변수이며 1.0으로 설정됩니다.

---

## 📊 Results

- **데이터셋**: ISIC-2017(피부 병변), Kvasir-SEG(결장 폴립), CVC-ColonDB(결장 폴립), SZ-CXR(폐), RIM-ONE-R1(망막 시신경 유두)의 5가지 의료 영상 데이터셋에서 평가되었습니다.
- **평가 지표**: Dice Similarity Coefficient (DI), Jaccard Index (JA), Accuracy (AC), Sensitivity (SE), Specificity (SP)가 사용되었으며, JA가 주요 평가 지표입니다.
  $$
  DI = \frac{2 \cdot TP}{2 \cdot TP+FN+FP}, \quad SE = \frac{TP}{TP+FN} \\
  JA = \frac{TP}{TP+FN+FP}, \quad SP = \frac{TN}{TN+FP} \\
  AC = \frac{TP+TN}{TP+FP+TN+FN}
  $$
- **정량적 성능**:
  - BA-Net은 5개 데이터셋 모두에서 최첨단 방법들을 지속적으로 능가하는 성능을 보였습니다.
  - ISIC-2017에서 81.0% JA를 달성하여 CE-Net(78.5% JA) 및 ISIC-2017 챌린지 최고 성능을 뛰어넘었습니다.
  - Kvasir-SEG에서 86.1% JA, CVC-ColonDB에서 88.4% JA를 달성하여 폴립 분할에서도 우수성을 입증했습니다.
  - SZ-CXR에서 92.8% JA를 기록하여 FCN 대비 5.9% JA 향상을 보였습니다.
  - RIM-ONE-R1에서 평균 93.0% JA를 달성하여 전문가 주석 결과와 비교해도 우수했습니다.
- **정성적 성능**: BA-Net은 다른 최첨단 방법들에 비해 더 정확한 위치와 세부 사항으로 객체를 강조하고 배경 노이즈를 효과적으로 억제하며, 유사한 색상이나 낮은 대비의 경계에서도 명확한 결과를 얻었습니다.
- **어블레이션 연구**:
  - PEE, mini-MTL, CFF 모듈 각각을 제거했을 때 JA가 0.7%에서 1.6%까지 감소하여 각 모듈의 효과를 확인했습니다.
  - mini-MTL 모듈 내의 Interactive Attention (IA)을 제거했을 때도 JA가 0.7%에서 1.1% 감소하여, 두 작업 간의 정보 전달에 IA가 중요함을 입증했습니다.

---

## 🧠 Insights & Discussion

- BA-Net은 경계 인식 및 다단계 컨텍스트 통합을 통해 의료 영상 분할에서 부정확한 경계 문제를 효과적으로 해결합니다.
- **PEE 모듈**은 다중 세분화된 경계 특징을 추출하여 객체 경계의 복잡하고 다양한 특성에 대한 강력한 보완 정보를 제공합니다.
- **mini-MTL 모듈**과 **IA 메커니즘**은 분할과 경계 감지 작업 간의 상호 보완성을 최대한 활용합니다. IA는 게이트 메커니즘을 통해 다른 작업의 유용한 정보가 적절한 위치로 전달되도록 하여, 모델이 보다 정확한 경계 준수 특징을 생성하도록 돕습니다.
- **CFF 모듈**은 인코더의 저수준(공간적 세부 사항)과 고수준(풍부한 의미 정보) 특징을 선택적으로 통합하여 각 단계에서 상세 정보와 의미 정보 모두를 보존하는 풍부한 컨텍스트 특징을 얻도록 합니다.
- 이러한 세 가지 모듈의 계단식 설계는 각 단계에서 풍부한 컨텍스트와 미세한 특징을 효과적으로 인코딩하게 하여 전반적인 분할 성능을 크게 향상시킵니다.
- **한계 및 향후 연구**: 현재 BA-Net은 2D 의료 영상 분할에 중점을 두고 있습니다. 향후에는 3D 의료 영상 분할 작업으로 확장할 계획입니다.

---

## 📌 TL;DR

BA-Net은 2D 의료 영상 분할에서 부정확한 경계 문제를 해결하기 위해 제안된 경계 인식 컨텍스트 신경망입니다. 이 모델은 다중 세분화 경계 특징을 추출하는 **PEE(Pyramid Edge Extraction)** 모듈, 분할 및 경계 감지를 공동 학습하고 상호 작용 어텐션(IA)을 통해 정보 상호 보완성을 달성하는 **mini-MTL(mini Multi-Task Learning)** 모듈, 그리고 교차 레벨 특징을 융합하여 상세 정보와 의미 정보를 모두 보존하는 **CFF(Cross Feature Fusion)** 모듈로 구성됩니다. BA-Net은 5가지 의료 데이터셋에서 기존 최첨단 방법들을 능가하는 정확하고 경계가 명확한 분할 결과를 달성하여, 풍부한 컨텍스트와 미세한 공간 정보를 효과적으로 활용함을 입증했습니다.
