# Automatic Sleep Stage Scoring with Single-Channel EEG Using Convolutional Neural Networks

Orestis Tsinalis, Paul M. Matthews, Yike Guo, and Stefanos Zafeiriou

## 🧩 Problem to Solve

수면은 인간 건강에 필수적이지만, 수면 단계를 분류하는 것은 수면 전문의가 폴리솜노그래피(PSG)를 분석해야 하므로 비용이 많이 들고 시간이 소모됩니다. 기존의 자동 수면 단계 분류 방법은 종종 수동으로 설계된 특징(hand-engineered features)과 여러 채널의 뇌전도(EEG) 또는 다른 생체 신호(예: EOG, EMG)에 의존합니다. 이 연구의 주요 목표는 단일 채널 EEG만 사용하여 사전 도메인 지식 없이 수면 단계를 자동으로 분류하는 심층 학습(deep learning) 기반 시스템을 개발하는 것입니다. 특히, 데이터셋의 고질적인 클래스 불균형 문제를 해결하고, 모델이 학습하는 특징들이 인간 전문가의 수면 판독 기준과 일치하는지 확인하는 것도 중요합니다.

## ✨ Key Contributions

- 단일 채널 원시(raw) EEG 신호를 사용하여 자동 수면 단계 분류를 위한 새로운 컨볼루션 신경망(CNN) 아키텍처를 제안했습니다.
- 사전 도메인 지식 없이도 CNN이 수면 단계 분류를 위한 작업별 필터를 자동으로 학습할 수 있음을 입증했습니다.
- 기존의 수동 설계 특징 기반 최첨단 방법과 유사한 높은 성능(평균 F1-점수 81%, 개별 수면 단계별 평균 정확도 82%, 전체 정확도 74%)을 달성했습니다.
- 확률적 경사 하강법(SGD) 최적화 과정에서 클래스 균형 무작위 샘플링(class-balanced random sampling)을 사용하여 데이터셋의 클래스 불균형으로 인한 편향된 성능 문제를 효과적으로 해결했습니다.
- CNN이 학습한 필터를 분석하고 시각화하여, 이 필터들이 인간 전문가가 따르는 미국 수면의학회(AASM) 매뉴얼의 수면 판독 기준과 일치함을 발견했습니다.
- CNN 모델의 필터들이 해석 가능하며 교차 검증 폴드(cross-validation folds) 전반에 걸쳐 일관성을 보여, CNN이 단순한 자동화 도구를 넘어 과학적 도구로 활용될 수 있음을 시사했습니다.

## 📎 Related Works

- **저자들의 이전 연구 [28]:** 수동으로 설계된 특징(Morlet 웨이블렛)과 스택 희소 오토인코더(stacked sparse autoencoders)를 사용하여 최첨단 수면 단계 분류 성능을 달성했으며, 본 연구의 비교 기준으로 사용되었습니다.
- **CNN의 발전 [16]:** 객체 인식, 이미지 분할, 얼굴 인식 등 컴퓨터 비전 분야에서 CNN이 높은 효과를 보이며 널리 사용되고 있습니다.
- **1D 생체 신호 및 음성/음향학 분야 CNN 적용 [23, 4, 15, 33, 24, 6, 11, 32, 19, 27, 20, 10]:** 1차원 생체 신호(EEG, ECG) 및 음성 신호 처리에 CNN을 적용하려는 관심이 증가하고 있습니다.
- **수면 단계 분류 기준 [12, 22, 25]:** 미국 수면의학회(AASM) 매뉴얼 및 Rechtschaffen과 Kales의 수면 단계 분류 기준은 인간 전문가의 수면 판독에 사용되는 표준입니다.
- **다른 자동 수면 단계 분류 방법 [7, 17, 3]:** 기존의 다양한 자동 분류 연구들이 참고 자료로 인용되었습니다.

## 🛠️ Methodology

- **데이터:** PhysioNet 저장소 [14]에서 공개적으로 사용 가능한 PSG 데이터셋을 활용했습니다. 20명의 건강한 젊은 성인(25-34세)으로부터 기록된 단일 채널 EEG (Fpz-Cz 전극) 데이터를 사용했습니다. 모든 데이터는 100 Hz로 샘플링되었으며, 30초 단위의 에포크(epoch)로 나뉘었습니다. AASM 권장 사항에 따라 N3와 N4 단계를 N3로 병합하고, "Movement" 및 "Not Scored" 에포크는 제거했습니다.
- **입력:** 현재 분류할 에포크와 그 이전 두 에포크, 이후 두 에포크의 신호를 하나의 연속적인 1차원 신호(총 15,000 타임포인트)로 결합하여 CNN의 입력으로 사용했습니다. 이는 인간 전문가가 수면 단계를 판독할 때 주변 에포크의 정보를 고려하는 방식을 모방한 것입니다.
- **CNN 아키텍처 (Figure 1, Table 3):**
  - **C1 (컨볼루션 계층 1):** 20개의 1차원 필터(길이 200)를 사용하여 원시 EEG 신호에서 특징을 추출하고, ReLU 활성화 함수를 적용했습니다.
  - **P1 (맥스-풀링 계층 1):** C1의 출력을 풀링 영역 크기 20으로 다운샘플링했습니다.
  - **S1 (스태킹 계층):** P1의 20개 1차원 출력 신호를 하나의 2차원 스택 ($20 \times 1479$)으로 재구성했습니다. 이 계층은 1D 신호 처리와 2D 이미지 처리 아이디어를 결합하여, 다양한 주파수 특징 간의 관계를 다음 계층에서 학습할 수 있도록 합니다.
  - **C2 (컨볼루션 계층 2):** 400개의 2차원 필터(크기 $20 \times 30$)를 사용하여 스태킹된 신호에서 특징을 추출하고, ReLU를 적용했습니다. 이 2D 필터는 C1에서 생성된 필터링된 신호들 간의 관계를 포착하는 역할을 합니다.
  - **P2 (맥스-풀링 계층 2):** C2의 출력을 풀링 영역 크기 10으로 다운샘플링했습니다.
  - **F1 & F2 (완전 연결 계층):** 각각 500개의 유닛을 가진 두 개의 완전 연결 계층을 사용하고, ReLU를 적용했습니다.
  - **출력 계층:** 5가지 수면 단계(W, N1, N2, N3, R)를 분류하기 위한 소프트맥스(softmax) 계층을 사용했습니다.
- **학습:** L2-정규화(L2-regularization)가 적용된 소프트맥스 손실 함수를 사용하여 역전파(backpropagation) 알고리즘과 확률적 경사 하강법(SGD)으로 학습했습니다. 각 SGD 에포크(epoch)에서 클래스 불균형 문제를 해결하기 위해 클래스별로 균형 잡힌 무작위 샘플링된 배치(batch)를 사용했습니다.
- **평가:** 알고리즘의 일반화 능력을 평가하기 위해 20겹 교차 검증(20-fold cross-validation)을 적용했습니다(한 피험자 데이터를 테스트용으로, 나머지 19명 중 4명은 검증용, 15명은 훈련용). 정규화된 혼동 행렬(normalized confusion matrix)을 기반으로 정밀도(precision), 민감도(sensitivity), F1-점수, 단계별 정확도(per-stage accuracy), 전체 정확도(overall accuracy)를 계산했습니다. 95% 신뢰 구간은 1000개의 부트스트랩 샘플링(bootstrapping)을 통해 추정했습니다. 수면 효율(sleep efficiency) 및 과도기적 에포크(transitional epochs) 비율과의 상관관계를 분석하여 방법의 견고성을 추가로 평가했습니다.
- **CNN 필터 분석 및 시각화:** 학습된 첫 번째 컨볼루션 계층(C1) 필터의 주파수 내용(Fourier 변환 사용)과 각 수면 단계별 평균 활성화(mean activation)를 분석 및 시각화했습니다. 이를 AASM 수면 판독 기준 및 이전 연구의 수동 설계 Morlet 웨이블렛 필터와 비교했습니다.

## 📊 Results

- **수면 단계 분류 성능:**
  - N3 단계가 가장 높은 정확도(약 90%)로 분류되었습니다. R, N2 단계는 약 75%, W 단계는 약 70%였습니다.
  - N1 단계가 가장 많이 오분류(정확도 약 60%)되었으며, 주로 W 및 R 단계(~15%)와 N2 단계(~8%)와의 오분류가 많았습니다.
  - 오분류 오류가 각 클래스 간에 대략적으로 균형을 이루어, 클래스 불균형 완화 전략이 효과적이었음을 시사합니다.
  - 전체 피험자에서 평균 F1-점수 81%(범위 79-83%), 개별 수면 단계별 평균 정확도 82%(범위 80-84%), 전체 정확도 74%(범위 71-76%)를 달성했습니다.
  - 이전 연구의 수동 설계 특징 기반 방법[28]보다 약간 낮은 성능을 보였으나, 95% 신뢰 구간이 겹쳐 통계적으로 유의미한 차이는 아니었습니다.
  - 수면 효율이나 과도기적 에포크 비율과 F1-점수 및 전체 정확도 사이에 통계적으로 유의미한 상관관계가 없었습니다($R^2 < 0.05$, $p > 0.25$). 이는 제안된 방법이 다양한 수면 품질 및 수면 단계 변화에도 강건함을 나타냅니다.
- **CNN 필터 분석 결과:**
  - CNN이 학습한 필터들은 AASM 수면 판독 기준과 일관된 특징을 보였습니다.
  - **N3 단계:** 주로 1-1.5 Hz에서 가장 높은 파워를 보였고, 때로는 12.5-14 Hz(수면 방추, sleep spindles)와 결합되어 N3 단계에서 수면 방추가 지속되는 특징을 포착했습니다.
  - **N2 단계:** 주로 13-14.5 Hz(수면 방추)에서 가장 높은 파워를 보였고, 2-4 Hz(K-복합체, K-complexes)와 결합된 필터가 많았습니다. CNN은 K-복합체와 이어지는 수면 방추의 동시 감지를 학습했습니다.
  - **R 단계:** 주로 2-5 Hz에서 높은 파워를 보였고, 14 Hz 주변 활동과 20-50 Hz 고주파 활동의 부재를 특징으로 했습니다.
  - **N1 단계:** 가장 일관성이 없었으나, 7 Hz와 9 Hz(8 Hz는 아님)에서 두드러진 스파이크를 보였고 항상 20-50 Hz 고주파 활동을 포함했습니다. 이는 EOG 및 EMG 관련 패턴과 연관될 수 있습니다.
  - 모든 폴드에서 10.5-12 Hz와 15-17 Hz 주파수 대역의 활동을 보이는 필터는 거의 없었습니다.

## 🧠 Insights & Discussion

- **CNN의 해석 가능성:** 본 연구의 가장 중요한 통찰은 CNN이 학습한 필터들이 인간 전문가의 AASM 수면 판독 기준과 일치하는 주파수 특성을 갖는다는 점입니다. 이는 CNN이 단순히 분류를 잘하는 것을 넘어, 데이터에서 해석 가능한 생리학적 패턴을 자동으로 추출할 수 있는 "과학적 도구"로서의 잠재력을 보여줍니다.
- **수동 특징 설계와의 비교:** 제안된 CNN 모델은 수동으로 설계된 특징을 사용한 이전 최첨단 모델과 통계적으로 유의미한 차이 없이 유사한 성능을 달성했습니다. 이는 CNN이 도메인 지식 없이도 경쟁력 있는 특징을 자동으로 학습할 수 있음을 의미하며, 특히 대규모 데이터셋에서는 CNN이 더 유리할 수 있습니다.
- **End-to-End 학습의 중요성:** 고정된 Morlet 웨이블렛을 첫 번째 CNN 계층으로 사용한 모델(M-CNN)보다 원시 데이터로부터 필터를 직접 학습하는 End-to-End CNN(CNN 모델)이 더 나은 성능을 보였습니다. 이는 데이터 기반 학습의 이점을 강조합니다.
- **단일 채널 EEG의 한계:** N1 단계의 높은 오분류율은 단일 EEG 채널로는 특정 수면 단계(예: N1과 R)를 구별하는 데 중요한 EOG 및 EMG 관련 패턴을 포착하기 어렵기 때문일 수 있습니다. 필터 수를 늘려도 성능이 향상되지 않은 점이 이 가설을 뒷받침합니다.
- **강건성:** 수면 효율이나 과도기적 에포크 비율이 수면 단계 분류 성능에 통계적으로 유의미한 영향을 미치지 않는다는 결과는, 이 방법이 다양한 수면 품질과 수면 패턴에 걸쳐 견고하게 작동함을 나타냅니다.

## 📌 TL;DR

**문제:** 단일 채널 EEG를 사용하여 사전 도메인 지식 없이 자동 수면 단계 분류를 수행하고, 클래스 불균형 문제를 해결하며, 모델의 학습 메커니즘을 해석 가능하게 만드는 것이 목표입니다.

**방법:** 저자들은 raw 1D EEG 신호를 입력으로 받아 2개의 컨볼루션 및 풀링 계층, 그리고 2개의 완전 연결 계층으로 구성된 새로운 CNN 아키텍처를 제안했습니다. 특히, 첫 번째 컨볼루션 계층의 출력을 2차원 스택으로 변환하는 '스태킹 계층(stacking layer)'을 도입하여 다양한 주파수 특징 간의 관계 학습을 용이하게 했습니다. 학습 시 클래스 불균형을 완화하기 위해 클래스 균형 무작위 샘플링 기법을 적용했습니다.

**주요 결과:** 이 CNN 모델은 높은 F1-점수(81%)와 정확도(단계별 82%, 전체 74%)를 달성하여 기존 최첨단 수동 특징 설계 기반 방법과 경쟁할 만한 성능을 보였습니다. 더 나아가, CNN이 자동으로 학습한 필터들은 인간 전문가가 따르는 AASM 매뉴얼의 수면 판독 기준(예: N3 단계의 1-1.5Hz 활동, N2 단계의 수면 방추 및 K-복합체)과 시각적으로 일관성 있게 대응되었습니다. 이는 CNN이 단순히 높은 예측 성능을 제공하는 것을 넘어, 원시 데이터로부터 인간이 해석 가능한 신경생리학적 특징을 효과적으로 추출할 수 있는 강력한 '과학적 도구'가 될 수 있음을 입증합니다.
