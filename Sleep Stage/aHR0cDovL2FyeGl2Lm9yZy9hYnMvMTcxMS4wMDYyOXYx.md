# Sleep Stage Classification Based on Multi-level Feature Learning and Recurrent Neural Networks via Wearable Device

Xin Zhang, Weixuan Kou, Eric I-Chao Chang, He Gao, Yubo Fan and Yan Xu\*

## 🧩 Problem to Solve

수면은 인간의 기본적인 생리 활동이지만, 수면 장애는 건강에 심각한 위협이 됩니다. 수면 장애의 효과적인 진단 및 치료를 위해서는 정확한 수면 단계 분류가 필수적입니다. 현재 표준 기술인 수면다원검사(PSG)는 여러 센서를 부착해야 하여 환자의 자연스러운 수면을 방해하고, 비용이 비싸며, 휴대성이 낮아 장기적인 가정 모니터링에 부적합하다는 단점이 있습니다. 본 연구는 이러한 PSG의 한계를 극복하고 웨어러블 기기를 활용한 자동 수면 단계 분류의 실용적인 접근 방식을 제안합니다.

## ✨ Key Contributions

- 웨어러블 기기(심박수 및 손목 활동량)를 활용하여 자동 수면 단계 분류를 위한 완벽한 솔루션을 제안했습니다.
- 수면 단계 분류 영역에 중간 수준(mid-level) 특징 학습 개념을 도입하고 그 효과를 입증했습니다.
- 순환 신경망(RNN)이 수면 신호를 모델링하는 데 적합함을 검증했습니다.
- 기존의 수동으로 설계된 특징(hand-engineered features)에 대한 과도한 전문 지식 의존도를 줄여, 수면 장애 감지 등 다른 수면 관련 문제에 일반화될 가능성을 보여주었습니다.

## 📎 Related Works

- **심박수 변이도(HRV) 기반 방법:** Yoon et al. [16]은 HRV에서 파생된 자동 활성화 기반의 임계값 및 휴리스틱 규칙을 사용하여 서파 수면(SWS)을 추정했고, Long et al. [17]은 심호흡 신호를 사용하여 SWS를 감지했습니다. Ebrahimi et al. [18]과 Xiao et al. [19]은 HRV에서 다양한 시간 영역, 주파수 영역, 비선형 특징을 추출하여 선형/이차 판별 분류기 또는 랜덤 포레스트(RF)를 사용했습니다.
- **활동량계(Actigraphy) 기반 방법:** Herscovici et al. [23]은 말초 동맥 톤(PAT) 신호와 활동량계를 기반으로 REM 수면 감지 알고리즘을 제시했습니다. Kawamoto et al. [24]는 활동량계에서 호흡 정보를 추정하여 REM 수면을 감지했으며, Long et al. [25]은 동적 워핑(dynamic warping) 방법을 사용하여 활동량계와 호흡 노력으로 수면 및 각성 상태를 분류했습니다.
- **딥러닝 기반 방법:** Tsinalis et al. [28]은 단일 채널 EEG를 사용하여 컨볼루션 신경망(CNN)으로 수면 단계를 예측했으며, Zhang et al. [29]은 희소 딥 빌리프 네트워크(DBN)를 사용하여 EEG, EOG, EMG에서 특징을 추출했습니다. 이 연구들은 수동 설계 특징 없이도 강건성을 보였습니다.

## 🛠️ Methodology

본 연구에서 제안하는 방법은 **다단계 특징 학습**과 **RNN 기반 분류**의 두 단계로 구성됩니다.

1. **다단계 특징 학습 (Multi-level Feature Learning)**

   - **데이터 전처리:** 각 심박수 및 활동량 데이터는 30초 단위의 에포크(epoch)로 분할됩니다.
   - **저수준 특징 추출 (Low-level Feature Extraction):**
     - **심박수:**
       - 현재 에포크를 중심으로 10개의 에포크를 포함하는 슬라이딩 윈도우에서 특징을 추출합니다.
       - **시간 영역:** 각 에포크의 평균 RR 간격($RR = 60/HR$)을 계산하여 평균 값 벡터를 구성합니다.
       - **주파수 영역:** RR 간격에 이산 코사인 변환(DCT)을 적용하여 각 에포크의 상위 5개 주파수 구성 요소를 추출합니다. 이 구성 요소 벡터의 0차, 1차, 2차 차분(difference)을 함께 결합하여 주파수 영역 특징으로 사용합니다.
     - **활동량계:**
       - 현재 에포크 내에서만 특징을 추출합니다.
       - 3축 활동량의 1차 차분을 계산하고, 각 축에서 상위 30개의 켑스트럼(cepstrum) 구성 요소를 추출하여 활동량 특징 벡터를 구성합니다.
   - **중간 수준 특징 학습 (Mid-level Feature Learning):**
     - 저수준 특징들을 기반으로 K-평균(K-means) 군집화 알고리즘을 통해 딕셔너리(dictionary)를 구축합니다.
     - 각 군집 중심($m_j$)은 수면 구성 요소("word")를 나타냅니다.
     - 각 저수준 특징과 각 군집 중심 간의 유클리드 거리를 계산하여 중간 수준 특징으로 활용합니다. 이는 각 구성 요소의 다른 영향을 나타냅니다.
   - **최종 특징:** 저수준 특징과 중간 수준 특징을 연결(concatenate)하고 Z-score 정규화를 적용하여 최종 특징 벡터를 만듭니다.

2. **RNN 기반 분류 (RNN-based Classification)**
   - 수면 단계 분류는 시퀀스 문제이며 장기 의존성을 갖기 때문에 순환 신경망(RNN)이 적합합니다.
   - 기존 RNN의 기울기 소실(gradient vanishing) 문제를 해결하고 장기 의존성을 포착하기 위해 망각 게이트(forget gate)와 피프홀 연결(peephole connection)이 있는 **장단기 기억(LSTM) 유닛**을 사용합니다.
   - 과거 및 미래 컨텍스트 정보를 모두 활용하기 위해 **양방향 LSTM (BLSTM)** 아키텍처를 사용합니다.
   - 여러 개의 순환 은닉층을 쌓아 **심층 BLSTM (Deep BLSTM)** 모델을 구성하여 깊은 아키텍처의 이점을 탐색합니다.
   - 최종 출력층에는 소프트맥스(softmax) 함수를 적용하여 각 수면 단계의 확률을 출력하고, 교차 엔트로피(cross entropy) 손실 함수를 사용하여 모델을 최적화합니다.

## 📊 Results

- **데이터셋:** 휴식 그룹(28개 기록)과 포괄 그룹(39개 기록, 휴식 및 비휴식 포함)에서 수집된 데이터를 사용했습니다. 5가지 수면 단계(W, N1, N2, N3, REM)로 분류했습니다.
- **주요 성능:** 본 연구의 방법은 휴식 그룹에서 가중치 정밀도 58.0%, 재현율 60.3%, F1 점수 58.2%를 달성했으며, 포괄 그룹에서는 각각 58.5%, 61.1%, 58.5%를 달성했습니다.
- **기존 방법과의 비교:** HRV와 랜덤 포레스트(RF)를 사용하는 기존의 베이스라인 방법([19])보다 심박수 단독 및 심박수+활동량계 모두에서 우수한 성능을 보였습니다. 활동량계 특징을 추가했을 때 두 방법 모두 성능이 향상되었습니다.
- **중간 수준 학습의 효과:** 중간 수준 특징 학습을 적용했을 때, 저수준 특징만 사용한 경우보다 F1 점수가 크게 향상되었습니다 (예: 1개 은닉층에서 52.7% → 58.2%). 이는 딕셔너리를 통한 수면 구성 요소의 공간적 분포 및 내재된 구조 분석이 효과적임을 시사합니다.
- **다양한 분류기와의 비교:** SVM(Support Vector Machine) 및 RF(Random Forest)와 비교했을 때, RNN(BLSTM)이 가중치 재현율과 F1 점수에서 더 우수했습니다. RNN은 장기 의존성을 학습하는 데 강점이 있습니다.
- **매개변수 민감도:**
  - **DCT 주파수 구성 요소 크기:** 구성 요소 크기가 증가할수록 성능이 감소했는데, 이는 고주파 구성 요소에 노이즈가 많기 때문으로 분석되었습니다. 5개 구성 요소를 사용했을 때 가장 좋은 성능을 보였습니다.
  - **딕셔너리 크기(K):** 딕셔너리 크기가 100에서 500으로 변할 때 성능 변화는 작았습니다. 이는 데이터의 양(약 37,000 에포크)이 너무 많은 매개변수를 가진 대규모 딕셔너리를 최적화하기에 충분하지 않을 수 있음을 시사합니다.
- **신경망 구성:**
  - MLP(Multilayer Perceptron), LSTM, BLSTM을 비교했을 때, LSTM과 BLSTM 유닛을 사용하는 RNN이 MLP보다 훨씬 우수한 성능을 보였습니다. 이는 수면 시퀀스의 시간적 관계를 학습하는 데 RNN의 효율성을 보여줍니다.
  - BLSTM은 LSTM보다 약간 더 나은 성능을 보였습니다.
  - 은닉 유닛과 층의 수가 너무 많아질 경우, 과도한 매개변수와 상대적으로 희소한 데이터 간의 불일치로 인해 LSTM 및 BLSTM의 성능이 약간 감소하는 경향을 보였습니다.

## 🧠 Insights & Discussion

본 연구는 웨어러블 기기에서 수면 단계 분류를 위한 실용적인 솔루션을 제시했습니다. 특히, 심박수와 손목 활동량이라는 접근하기 쉬운 신호원을 활용하고, 수동 설계 특징에 대한 의존도를 줄이는 다단계 특징 학습 프레임워크와 시퀀스 학습에 강한 BLSTM 기반 RNN을 결합한 점이 중요합니다.

중간 수준 특징 학습의 도입은 수면 신호의 내재된 구조와 구성 요소를 더 잘 포착하여 분류 성능 향상에 기여했습니다. 또한, RNN, 특히 BLSTM이 수면의 시간적, 주기적 특성 및 장기 의존성을 효과적으로 모델링할 수 있음을 입증했습니다.

성능은 주로 W, N1 단계의 형태학적 유사성 및 분류의 어려움으로 인해 완벽하지는 않았지만, 기존의 HRV 기반 방법에 비해 우수한 결과를 보였습니다. 또한, 휴식 상태뿐만 아니라 비휴식 상태가 포함된 포괄 그룹에서도 견고한 성능을 유지하여 실제 사용 환경에서의 적용 가능성을 높였습니다.

제안된 방법은 최소한의 사전 도메인 지식만을 사용하므로, 수면 장애 진단과 같은 다른 수면 관련 문제에도 일반화될 잠재력이 있습니다. 다만, 은닉층의 깊이와 유닛의 수가 증가할 때 성능이 약간 저하되는 현상은 데이터 희소성(약 37,000 에포크)과 과도한 매개변수 간의 불균형 때문일 수 있습니다. 향후 연구에서는 자동 점수 매기기 성능을 더욱 향상시키는 데 초점을 맞출 필요가 있습니다.

## 📌 TL;DR

본 연구는 웨어러블 기기(심박수 및 손목 활동량)를 사용하여 수면 단계를 자동으로 분류하는 새로운 방법을 제안합니다. 이 방법은 저수준 및 중간 수준 특징을 학습하는 **다단계 특징 학습 프레임워크**와 수면 신호의 시간적 순차 패턴 및 장기 의존성을 효과적으로 모델링하는 **BLSTM 기반 순환 신경망(RNN) 분류기**로 구성됩니다. 제안된 방법은 기존 접근법보다 우수하며, 특히 중간 수준 특징 학습과 BLSTM의 효과를 입증했습니다. 이는 웨어러블 기기를 통한 장기 가정 수면 모니터링 및 수면 장애 진단에 활용될 잠재력을 가지고 있습니다.
