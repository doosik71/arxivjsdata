# SalientSleepNet: Multimodal Salient Wave Detection Network for Sleep Staging

Ziyu Jia, Youfang Lin, Jing Wang, Xuehui Wang, Peiyi Xie, Yingbin Zhang

## 🧩 Problem to Solve

수면 단계 분류(sleep staging)는 수면 평가 및 질병 진단에 필수적이지만, 다음과 같은 과제가 남아있습니다.

1. **다중 모드 수면 데이터에서 특징적인 파형(salient waves)을 효과적으로 추출하는 방법**. 기존 연구들은 특징적인 파형을 간접적으로 포착하여 정보 손실 및 사전 지식 요구 문제를 야기합니다.
2. **수면 단계 간의 다중 스케일 전환 규칙(multi-scale transition rules)을 포착하는 방법**. 전문가들은 단기, 중기, 장기 스케일의 전환 규칙을 고려하여 수면 단계를 결정하지만, 기존 순환 신경망(RNN) 기반 모델은 이러한 다중 스케일 특성을 명시적으로 포착하기 어렵고 튜닝 및 최적화가 복잡합니다.
3. **수면 단계 분류를 위해 특정 모달리티(modality)의 핵심 역할을 적응적으로 활용하는 방법**. 다른 수면 단계 분류에 각 모달리티(예: 뇌파(EEG), 안구전도(EOG))의 기여도가 다름에도 불구하고, 기존 모델들은 이를 고려하지 않고 단순히 특징을 결합합니다.

## ✨ Key Contributions

- 생체 신호에서 특징적인 파형을 감지하기 위해 여러 개의 중첩된 U-유닛으로 구성된 **U$^2$-구조 스트림**을 개발했습니다. 이는 컴퓨터 비전 분야의 U$^2$-Net에서 영감을 받았습니다.
- 수면 단계 전환 규칙을 포착하기 위해 수용장(receptive fields)이 다른 여러 확장 컨볼루션(dilated convolutions)으로 구성된 **다중 스케일 추출 모듈(Multi-scale Extraction module, MSE)**을 설계했습니다.
- 특정 수면 단계에 대해 다중 모드 데이터에서 가치 있는 정보를 적응적으로 포착하는 **다중 모드 어텐션 모듈(Multimodal Attention module, MMA)**을 제안했습니다.
- 제안된 SalientSleepNet이 최첨단(state-of-the-art) 성능을 달성하며, 기존 심층 신경망 모델 중 가장 적은 수의 파라미터를 가집니다.

## 📎 Related Works

- **초기 연구**: 특징 공학(hand-engineered features)에 의존하는 머신러닝(예: SVM, Random Forests) 방법론이 사용되었으나, 많은 사전 지식을 요구했습니다.
- **심층 학습(Deep Learning) 방법론**: CNN 또는 RNN 기반 모델이 자동 수면 단계 분류에 널리 사용되었습니다.
  - **DeepSleepNet**: CNN으로 시간 불변 특징을 추출하고 BiLSTM으로 수면 단계 간의 전환 규칙을 학습합니다.
  - **SeqSleepNet**: 병렬 필터뱅크(filterbank) 층과 양방향 RNN을 사용하여 시퀀스 정보를 인코딩합니다.
  - **SleepEEGNet**: 원본 신호에서 시간 불변 특징을 추출하고 장단기 문맥 의존성을 포착합니다.
  - **SleepUtime**: 임의 길이의 시퀀스 입력을 클래스 레이블 시퀀스로 매핑하는 완전 순방향(fully feed-forward) 접근 방식입니다.
  - **TinySleepNet**: CNN과 단방향 RNN을 결합한 경량 모델입니다.
- **기존 모델의 한계**: 높은 성능을 달성했지만, 다중 모드 원본 신호에서 특징적인 파형을 효과적으로 감지하고 융합하는 데 한계가 있으며, 다중 스케일 수면 전환 규칙을 명시적으로 포착하지 못합니다.

## 🛠️ Methodology

SalientSleepNet은 컴퓨터 비전의 U$^2$-Net 아키텍처에서 영감을 받은 **시간 완전 컨볼루션 네트워크(temporal fully convolutional network)**입니다. 주요 구성 요소는 다음과 같습니다.

1. **두 개의 스트림 U$^2$-구조 (Two-Stream U$^2$-Structure)**:

   - EEG 및 EOG 신호에서 특징적인 파형(salient waves)을 직접 포착하기 위해 두 개의 독립적인 U$^2$-구조를 사용합니다.
   - 각 U$^2$-구조는 여러 개의 중첩된 U-유닛으로 구성된 인코더-디코더 구조입니다.
   - U-유닛은 채널 재구성(channel-reshape) 층, U-유사 구조($U_{l}$, 깊이 $l=4$), 그리고 잔여 연결($X_{m}^{''} = X_{m} + X_{m}^{'}$)로 구성됩니다.

2. **다중 스케일 추출 모듈 (Multi-scale Extraction Module, MSE)**:

   - 다중 스케일 수면 전환 규칙을 명시적으로 포착하기 위해 설계되었습니다.
   - 서로 다른 확장률($r=1, 2, 3, 4$)을 가진 4개의 확장 컨볼루션($\text{DConv}_{r}$)을 사용하여 다양한 스케일의 수용장 특징을 추출합니다.
   - 이 특징 맵들은 연결되어($X_{ms} = \text{Concat}(X_{1}^{d}, X_{2}^{d}, X_{3}^{d}, X_{4}^{d})$) 다중 스케일 특징 맵을 형성합니다.
   - 모델 경량화를 위해 **병목(bottleneck) 층**($X_{b} = \text{Bottleneck}(X_{ms})$)을 사용하여 채널 수를 줄입니다.

3. **다중 모드 어텐션 모듈 (Multimodal Attention Module, MMA)**:

   - 특정 수면 단계 분류에 더 큰 기여를 하는 모달리티의 특징을 적응적으로 강화합니다.
   - **모달리티 융합(Modality Fusion)**: EEG와 EOG 스트림의 특징 맵을 $X_{fuse} = X_{EEG} + X_{EOG} + (X_{EEG} \circ X_{EOG})$ 와 같이 융합합니다. (${\circ}$는 요소별 곱셈)
   - **채널별 어텐션(Channel-wise Attention)**: 융합된 특징 맵 $X_{fuse}$를 전역 평균 풀링(GAP), 완전 연결(FC) 층, ReLU, 시그모이드(sigmoid) 활성화 함수를 통해 처리하여 어텐션 맵 $X_{att}$를 생성하고, 이를 $X_{fuse}$에 곱하여 ($X_{att}^{'} = X_{fuse} \circ X_{att}$) 중요한 특징을 강화합니다.

4. **세그먼트별 분류기 (Segment-wise Classification)**:
   - 컴퓨터 비전의 픽셀별(pixel-wise) 분류기를 생체 신호 세그먼트별(segment-wise) 분류에 맞게 개선했습니다.
   - 1D 특징 맵에 평균 풀링(average pooling) 층을 적용하여 크기를 줄이고, 이후 Softmax 활성화 함수를 가진 컨볼루션 층을 사용하여 예측 레이블 시퀀스 $\hat{Y}$를 출력합니다.

## 📊 Results

- **성능**: Sleep-EDF-39 및 Sleep-EDF-153 데이터셋에서 모든 최신(state-of-the-art) 기준선 모델을 능가하는 최고의 전반적인 성능을 달성했습니다 (예: Sleep-EDF-39에서 F1-score 83.0, Accuracy 87.5). 특히 N1 단계의 F1-score를 개선했습니다.
- **경량성**: 기존 딥러닝 모델 중 가장 적은 수의 파라미터(0.9M)를 가지며, 병목 층은 파라미터 수를 16% 감소시킵니다.
- **어블레이션 연구(Ablation Study)**:
  - U$^2$-구조는 기본 U-구조에 비해 성능을 크게 향상시켰습니다.
  - MSE 모듈 추가는 다중 스케일 특징 학습을 통해 성능을 더욱 개선했습니다.
  - MMA 모듈 추가는 특정 수면 단계에 대한 다중 모드 특징의 중요성을 적응적으로 포착하여 최종 성능 향상에 기여했습니다.
- **해석 가능성**: 모델이 EEG (예: N2 단계의 방추파 및 K-복합체, N3 단계의 델타파) 및 EOG (예: N1 단계의 느린 안구 운동, REM 단계의 빠른 안구 운동) 신호에서 특징적인 파형을 감지할 수 있음을 시각적으로 확인하여 모델의 해석 가능성을 높였습니다.

## 🧠 Insights & Discussion

SalientSleepNet은 다중 모드 수면 데이터에서 특징적인 파형을 직접 감지하고, RNN 모델의 단점 없이 다중 스케일 수면 전환 규칙을 효과적으로 학습하며, 특정 수면 단계 분류에 대한 모달리티별 기여도를 적응적으로 포착함으로써 기존의 문제점들을 해결합니다. 이 모델은 원시 신호를 직접 처리하여 시간-주파수 이미지 변환 시 발생할 수 있는 정보 손실을 방지하고, 해석 가능한 특징 감지 능력을 보여줍니다. 또한, 적은 수의 파라미터로도 최첨단 성능을 달성하여 효율성이 높습니다. 제안된 프레임워크는 수면 단계 분류뿐만 아니라 다중 모드 생체 시계열 데이터 분석 전반에 걸쳐 활용될 수 있는 일반적인 접근 방식을 제공합니다.

## 📌 TL;DR

수면 단계 분류에서 다중 모드 특징 파형 추출, 다중 스케일 전환 규칙 포착, 모달리티별 기여도 활용의 어려움을 해결하기 위해 SalientSleepNet이 제안되었습니다. 이 모델은 U$^2$-Net 기반의 완전 컨볼루션 네트워크로, 두 개의 U$^2$-스트림으로 특징 파형을 감지하고, 확장 컨볼루션을 활용한 다중 스케일 추출 모듈로 전환 규칙을 학습하며, 다중 모드 어텐션 모듈로 적응적 특징 융합을 수행합니다. 결과적으로 SalientSleepNet은 최소 파라미터로 최첨단 성능을 달성하며, 특징 파형 감지를 통해 모델의 해석 가능성까지 제공합니다.
