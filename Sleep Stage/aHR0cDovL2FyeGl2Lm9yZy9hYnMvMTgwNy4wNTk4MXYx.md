# A DEEP LEARNING ARCHITECTURE TO DETECT EVENTS IN EEG SIGNALS DURING SLEEP

Stanislas Chambon, Valentin Thorey, Pierrick J. Arnal, Emmanuel Mignot, Alexandre Gramfort

## 🧩 Problem to Solve

수면 중 뇌 활동은 특정 뇌파(EEG) 패턴, 즉 사건(예: 수면 방추, K-복합체)으로 특징지어지며, 이는 수면 단계를 정의하는 데 사용됩니다. 이러한 사건의 시각적 분석은 훈련된 수면 전문가를 필요로 하며, 시간이 많이 소요되고 지루할 뿐만 아니라 전문가 간의 불일치(inter-scorer variability)가 높습니다. 기존의 자동 감지 알고리즘은 특정 사건(event-specific)에만 초점을 맞추고 있으며, 다음과 같은 한계를 가집니다:

- 고정된 주파수 차단(cut-off) 필터링 사용으로 일부 피험자에게 적합하지 않을 수 있습니다.
- 본질적으로 사건별 특성을 가집니다.
- 하이퍼파라미터가 종종 성능 평가에 사용된 기록에 최적화되어 과적합(overfitting) 편향을 유발합니다.
  이 논문은 이러한 한계를 극복하고 수면 EEG 신호에서 다양한 유형의 사건의 위치, 지속 시간 및 유형을 동시에 예측할 수 있는 일반적인 딥러닝 방법을 제안합니다.

## ✨ Key Contributions

- **통합적인 사건 감지 아키텍처:** EEG 시계열에서 사건의 위치, 지속 시간 및 유형을 동시에 예측하는 딥러닝 기반의 통합적인 아키텍처를 제안합니다. 이는 기존의 사건별(event-specific) 알고리즘과 차별화됩니다.
- **원시 EEG 신호에서 특징 학습:** 컨볼루션 신경망(CNN)을 사용하여 원시 EEG 신호로부터 직접 고수준 특징 표현(feature representation)을 구축합니다. 이는 복잡한 전처리 과정 없이도 다양한 사건을 감지할 수 있게 합니다.
- **객체 감지 패러다임 적용:** 컴퓨터 비전 분야의 객체 감지(object detection) 알고리즘(예: SSD [18], YOLO [19])에서 영감을 받아 EEG 사건 감지에 적용하여, 기본 사건(default events)을 설정하고 이를 분류 및 정제하는 방식을 도입했습니다.
- **최첨단 성능 달성:** 수면 방추(spindles)와 K-복합체(K-complexes) 감지 작업에서 기존의 사건별 최첨단 알고리즘보다 뛰어난 성능을 보였습니다.
- **적은 훈련 데이터로도 강건성:** 단 10개의 훈련 기록으로도 좋은 성능을 보였으며, 심지어 1개의 훈련 기록으로도 작동 가능함을 확인하여, 데이터가 제한적인 임상 환경에서의 잠재력을 시사합니다.

## 📎 Related Works

기존의 수면 EEG 사건 자동 감지 알고리즘은 주로 미세 사건(micro-events)에 초점을 맞추며 세 가지 유형으로 분류됩니다:

- **필터링 및 임계값 기반 방법:** 특정 주파수 대역(예: 수면 방추 감지를 위한 11-16Hz)으로 대역 통과 필터링(band-pass filtering)을 수행한 후, 필터링된 신호의 엔벨로프(envelop)를 추출하고 고정되거나 조절 가능한 임계값(thresholding)을 적용합니다 [7, 8, 9, 10, 11, 12]. 주로 수면 방추 감지에 사용되며, 대부분 수면 단계에 특화되어 있고 50Hz 노치 필터링(notch filtering)과 같은 전처리에 크게 의존합니다.
- **EEG 분해 기반 방법:** EEG를 진동(oscillatory) 및 일시적(transient) 구성 요소로 분해한 다음, 필터링 및 임계값 설정을 사용하여 관심 사건을 감지합니다 [13, 14, 15]. 이는 수면 방추 또는 K-복합체 모두를 감지할 수 있어 좀 더 일반적입니다.
- **머신러닝 기반 방법:** EEG 신호를 필터링하고 세그먼트에서 스펙트럼 및 시간 특징을 추출한 다음, 이진 SVM(Support Vector Machine)과 같은 분류기를 사용하여 사건 여부를 예측합니다 [16].

이러한 기존 방법들은 고정된 차단 주파수 필터링, 본질적인 사건별 특성, 과적합 편향 가능성 등의 한계를 가지고 있습니다. 제안된 접근 방식은 컴퓨터 비전의 객체 감지(object detection) 알고리즘(예: SSD [18], YOLO [19], Faster R-CNN [20])에서 영감을 받아 이러한 한계를 극복하려 합니다.

## 🛠️ Methodology

제안된 딥러닝 아키텍처는 컴퓨터 비전의 객체 감지 방법(SSD [18], YOLO [19] 등)에서 영감을 받았습니다. 예측 절차는 세 단계로 구성됩니다:

1. **기본 사건(Default Events) 생성:** 입력 EEG 신호 $x \in \mathbb{R}^{C \times T}$ (여기서 $C$는 채널 수, $T$는 시간 단계 수)에 대해 일정한 간격과 지속 시간을 가진 기본 사건들을 생성합니다.
2. **위치 및 유형 예측:** 신경망은 각 기본 사건에 대해 조정된 중심($\hat{t_c}$), 지속 시간($\hat{t_d}$), 그리고 잠재적인 사건의 레이블($\hat{l}$)을 예측합니다. 레이블에는 '사건 없음(0)'도 포함됩니다.
3. **겹치는 예측 제거:** 가장 높은 확률을 가진 사건이 선택되고, 겹치는 예측을 제거하기 위해 비최대 억제(Non-Maximum Suppression, NMS)가 적용됩니다.

**훈련 과정:**

- 기본 사건은 실제 사건(true events)과 Jaccard Index (IoU)를 기반으로 매칭됩니다.
- 매칭된 기본 사건의 중심과 지속 시간은 실제 사건과의 상대적 변화를 인코딩하는 함수 $\phi_{e_j}(d_i) = \left( \frac{t_{c_j}-t_{c_i}}{t_{d_i}}, \log\frac{t_{d_j}}{t_{d_i}} \right)$를 통해 네트워크가 예측해야 할 양으로 변환됩니다.
- 충분한 IoU를 갖는 실제 사건과 매칭되지 않는 기본 사건에는 레이블 $l=0$이 할당됩니다. 레이블 불균형을 위해 $l=0$인 사건 중 일부만 훈련에 사용됩니다.
- **손실 함수:** 실제 주석 $E(x)$와 모델 예측 $\hat{f}(x)$ 사이의 손실 $\mathcal{L}(E(x), \hat{f}(x)) = \mathcal{L}_{\text{norm}}^{+} + \mathcal{L}_{\text{norm}}^{-}$는 다음과 같이 정의됩니다:
  - $\mathcal{L}^{+} = \sum_{i \in JN_dK, \gamma(i) \ne \emptyset} \text{L1}_{\text{smooth}}(\phi_{e_{\gamma(i)}}(d_i), \hat{\tau}_i) - \log(\hat{\pi}_{l_{\gamma(i)}}^i)$ (매칭된 기본 사건에 대한 위치 및 분류 손실)
  - $\mathcal{L}^{-} = - \sum_{i \in JN_dK, \forall j \in JN_eK: \text{IoU}(d_i, e_j) < \eta} \log(\hat{\pi}_0^i)$ (매칭되지 않은 기본 사건에 대한 분류 손실)
    여기서 $\text{L1}_{\text{smooth}}$는 회귀 손실, $\hat{\pi}$는 예측된 확률입니다.

**네트워크 아키텍처:**
네트워크는 크게 세 부분으로 구성됩니다:

1. **Block 0 (공간 필터링):** 원시 EEG 채널을 가상 채널로 재결합하여 신호 대 잡음비(SNR)를 높이는 2D 공간 컨볼루션을 수행합니다.
2. **Block k ($k \in J8K$, 시간 특징 추출):** 각 블록은 배치 정규화(batch normalization)와 ReLU 활성화 함수가 적용된 2D 컨볼루션 레이어와 시간적 최대 풀링(temporal max-pooling)으로 구성되어 시간 영역에서 특징을 추출합니다.
3. **Block 9 (분류 및 위치 예측):** 마지막 특징 맵을 입력으로 받아 두 개의 레이어로 구성됩니다:
   - **9-a (분류 레이어):** 각 기본 사건에 대해 사건 유형 또는 '사건 없음'에 대한 확률을 예측합니다.
   - **9-b (위치 레이어):** 각 기본 사건의 인코딩된 중심 및 지속 시간을 예측합니다.

## 📊 Results

- **데이터셋:** MASS SS2 데이터셋 [24]의 19개 기록(256Hz 샘플링)을 사용했으며, 수면 방추는 전문가 E1/E2, K-복합체는 E1에 의해 주석이 달렸습니다.
- **평가 지표:** 사건별 지표(By-event metrics) [2]를 사용하여 IoU(Intersection over Union)를 기준으로 정밀도, 재현율, F1 점수를 계산했습니다.
- **수면 방추(Spindles) 감지:** 제안된 접근 방식은 IoU $0.3$에서의 정밀도/재현율 측면에서 모든 기준선(baselines)을 능가했으며, 모든 IoU 값에서 기준선보다 더 높은 F1 점수를 보였습니다 (그림 2). 또한, E1, E2, E1과 E2의 합집합, E1과 E2의 교집합 등 4가지 '골드 표준(gold standards)'에 대해 일관되고 안정적인 성능을 보였습니다.
- **K-복합체(K-complexes) 감지:** 제안된 접근 방식은 IoU $0.3$에서의 정밀도/재현율 측면에서 비교된 기준선(Lajnef et al. 2017)을 능가했으며, 모든 IoU 값에서 기준선보다 더 높은 F1 점수를 보였습니다 (그림 3).
- **사건 동시 또는 개별 감지:** 수면 방추와 K-복합체를 동시에 감지하도록 훈련했을 때와 개별적으로 감지하도록 훈련했을 때 성능 차이가 거의 없음을 보여주었습니다 (그림 4). 이는 제안된 방법이 여러 유형의 사건을 유연하게 처리할 수 있음을 의미합니다.

## 🧠 Insights & Discussion

- **딥러닝의 효과적인 특징 학습:** 제안된 딥러닝 접근 방식은 다양한 유형의 사건 감지에 적합한 특징 표현을 학습하는 데 매우 효과적임을 입증했습니다. 원시 EEG 신호에서 직접 학습함으로써 복잡한 전처리 과정을 줄였습니다.
- **제한된 데이터에서의 강건성:** 단 10개의 훈련 및 2개의 검증 기록만으로도 뛰어난 성능을 보였으며, 심지어 1개의 훈련 기록으로도 작동 가능함을 추가 실험에서 확인했습니다. 이는 데이터가 제한적인 임상 환경에서 큰 이점으로 작용할 수 있습니다.
- **확장 가능성:** 제안된 방법은 다중 EEG 채널을 처리할 수 있으며, 향후 근전도(EMG), 안구전도(EOG) 등 다른 모달리티(modalities)와 다양한 기본 사건 스케일(default event scales)을 동시에 처리하는 방향으로 확장될 수 있습니다.
- **향후 연구 과제:** 다양한 전문가 주석(골드 표준)에 대해 안정적인 성능을 보였지만, 전문가 간 불일치(inter-scorer agreement)와 비교하여 방법의 성능을 더 면밀히 연구할 필요가 있습니다.

## 📌 TL;DR

이 논문은 수면 중 EEG 신호에서 다양한 유형의 사건(예: 수면 방추, K-복합체)의 **위치, 지속 시간 및 유형을 동시에 감지**하는 새로운 **딥러닝 아키텍처**를 제안합니다. 컴퓨터 비전의 객체 감지 방법에서 영감을 받은 **컨볼루션 신경망(CNN)**을 사용하여 원시 EEG 신호에서 직접 특징을 학습하고, 기본 사건(default events)을 설정한 후 이를 분류 및 정제합니다. 수면 방추 및 K-복합체 감지 실험에서 제안된 접근 방식은 기존 최첨단 방법들보다 **우수한 성능**을 보였으며, **제한된 훈련 데이터**로도 강건하게 작동함을 입증하여 수면 의학에서의 효율성과 정확성 향상에 기여할 잠재력을 보였습니다.
