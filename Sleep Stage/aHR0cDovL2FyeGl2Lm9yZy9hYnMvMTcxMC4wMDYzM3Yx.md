# DEEP CONVOLUTIONAL NEURAL NETWORKS FOR INTERPRETABLE ANALYSIS OF EEG SLEEP STAGE SCORING

Albert Vilamala, Kristoffer H. Madsen and Lars K. Hansen

## 🧩 Problem to Solve

수면 연구는 수면 장애 진단에 필수적이지만, 수면 단계를 수동으로 채점하는 것은 숙련된 전문가의 많은 시간을 소모하는 지루하고 시각적인 작업입니다. 이는 오류가 발생하기 쉽고 비효율적입니다. 기존의 기계 학습 기반 자동 수면 단계 채점 방법들은 데이터셋의 다양성, 적절한 교차 검증 절차, 그리고 특히 모델의 의사 결정 과정에 대한 해석 가능성 부족과 같은 문제들을 안고 있습니다.

## ✨ Key Contributions

- **높은 정확도와 시각적 해석 가능성을 갖춘 프레임워크 제공:** 단일 센서 EEG 수면 단계 자동 분석을 위한 시스템을 제시합니다.
- **시각적으로 해석 가능한 입력 이미지 생성:** Multitaper spectral estimation을 사용하여 수면 패턴을 강조하는 자연 이미지와 유사한 컬러 스펙트로그램 이미지를 EEG 신호로부터 생성합니다. 이는 전문가가 분석하기 쉽도록 합니다.
- **전이 학습을 통한 CNN 활용:** 자연 이미지 시각화 작업에서 뛰어난 성능을 입증한 사전 훈련된 CNN 모델(VGGNet)을 활용하여 수면 단계를 분류합니다. 이를 통해 제한된 의료 데이터 문제(오버피팅)를 극복합니다.
- **민감도 분석 기반의 해석 가능성 제공:** 네트워크의 가장 영향력 있는 특징들을 입력 공간으로 다시 매핑하는 민감도 분석(sensitivity analysis)을 사용하여, 네트워크의 작동 방식에 대한 높은 수준의 해석 가능한 이미지를 제공합니다.
- **최첨단 성능 달성 및 주요 시간-주파수 대역 식별:** 널리 사용되는 공개 데이터셋에서 평균 $86\%$의 정확도를 달성하며, 각 수면 단계 분류에 중요한 시간-주파수 대역을 식별합니다.

## 📎 Related Works

- **수면 단계 분류를 위한 기존 ML 방법:** 완전 연결 인공 신경망(ANN)에 EEG 신호에서 추출한 수동 특징(hand-crafted features)을 사용한 연구([4, 5])와 장기 의존성 또는 단계 전환 규칙을 포착하기 위한 순환 신경망(RNN) 변형 연구([6, 7])가 언급됩니다.
- **시간-주파수 분석 기반 접근:** Tsinalis 등([12])은 EEG 신호의 시간-주파수 분석을 통해 특징을 추출하여 스택형 희소 오토인코더(stacked sparse autoencoders) 앙상블에 입력했습니다.
- **CNN 기반 접근:** Tsinalis 등([13])은 raw EEG 신호와 시간 경과에 따른 주파수별 활동의 2D 스택을 결합한 CNN 아키텍처를 사용하여 종단 간(end-to-end) ANN을 구축했습니다.
- **CNN 아키텍처:** AlexNet([9]), ZFNet([15]), GoogLeNet([16]), VGGNet([10]), ResNet([11]) 등 이미지 인식 분야의 주요 CNN 발전과 전이 학습의 중요성을 강조합니다.
- **전이 학습 연구:** CNN 계층의 일반성-특이성 트레이드오프([17]), 객체 인식 작업에서 학습된 특징의 다른 시각 문제로의 전이성([18]), 불충분한 데이터셋에 대한 전이 학습 적용([19]) 등이 참조됩니다.
- **네트워크 시각화 기법:** ANN의 '블랙박스' 문제를 해결하기 위한 시각화 기술([14, 15])과 민감도 분석([23, 24, 25])이 활용됩니다.

## 🛠️ Methodology

1. **이미지 생성 (Image Creation):**
   - EEG 데이터는 푸리에 분석의 가정을 충족하지 않으므로, 스펙트로그램은 편향될 수 있습니다. 이를 해결하기 위해 **multitaper spectral estimation**([20, 21])을 사용합니다.
   - Multitaper 방법은 여러 테이퍼(taper) 함수를 raw 신호에 적용하고 결과를 평균하여 편향(bias)과 분산(variance)을 모두 줄입니다.
   - 하이퍼파라미터($\omega$(window size), $\sigma$(window step size), $f$(min frequency resolution), $W=\omega f/2$(time-half-bandwidth product), $L=\lfloor2W\rfloor-1$(number of tapers))를 설정하여 스펙트로그램을 계산합니다.
   - 계산된 스펙트로그램 값을 로그 스케일 $x=\log(x)+1$로 변환한 후, $s$ 크기의 에포크(epochs)로 나눕니다.
   - 각 에포크 스펙트로그램은 컬러맵을 적용하여 RGB 컬러 매트릭스(이미지)로 변환됩니다. 본 연구에서는 'Jet' 컬러맵을 사용했습니다.
2. **네트워크 아키텍처 (Network Architecture):**
   - **VGGNet**([10])을 선택했으며, 이는 16개의 가중치 계층으로 구성된 단순하고 유연한 CNN입니다.
   - $3 \times 3$ 컨볼루션 필터와 ReLU 활성화 함수, $2 \times 2$ 맥스 풀링 계층, 그리고 ReLU와 소프트맥스 활성화를 사용하는 완전 연결 계층으로 이루어져 있습니다.
   - **전이 학습(Transfer Learning)**을 사용하여 모든 컨볼루션 계층에 ILSVRC-2014 데이터로 사전 훈련된 가중치를 사용합니다.
   - 완전 연결 계층은 Xavier 초기화([22])를 사용하여 처음부터 초기화되고 드롭아웃(dropout)과 함께 훈련됩니다.
3. **네트워크 시각화 (Network Visualisation):**
   - 네트워크의 의사 결정 과정을 이해하기 위해 **민감도 분석(sensitivity analysis)**([23, 24, 25])을 사용합니다.
   - 특정 클래스를 식별하기 위해 네트워크가 각 입력 특징 $j$ (픽셀의 RGB 컬러 채널)에 부여하는 상대적 중요도는 다음 공식으로 추정됩니다:
     $$\hat{s}^{(j)} = \frac{1}{N} \sum_{n=1}^{N} \left|\frac{\partial \mathcal{L}(f(x),t)}{\partial x^{(j)}}\right|_{x=x_n}$$
     여기서 $\mathcal{L}$은 손실 함수, $f(x)$는 네트워크 출력, $t$는 실제 클래스 레이블, $x^{(j)}$는 입력 특징입니다.
   - $\hat{s}^{(j)}$ 값은 해당 RGB 컬러 매트릭스에 배치되어 **민감도 맵(sensitivity map)**을 생성합니다.

## 📊 Results

- **데이터셋:** PhysioNet의 Sleep-EDF 데이터베이스([26, 27])에서 20명의 건강한 피험자로부터 얻은 EEG 수면 기록을 사용했습니다.
- **실험 시나리오:**
  - **VGG-FE (Feature Extractor):** 컨볼루션 계층은 고정하고 마지막 3개의 완전 연결 계층만 처음부터 훈련했습니다.
  - **VGG-FT (Fine-Tuned):** 네트워크의 모든 가중치를 업데이트했습니다.
- **성능 비교:** 무작위로 초기화된 네트워크는 최적의 분류 정확도를 보여주지 못했으며, VGG-FT보다 수렴 시간이 평균 3배 느렸습니다.
- **VGG-FE 성능:** N3 (89%), R (81%), W (78%), N2 (75%) 순으로 정확도가 높았고, N1 단계는 44%로 가장 분류하기 어려웠습니다. N1의 주요 오분류는 R (25%), W (17%), N2 (13%) 단계였습니다.
- **VGG-FT 성능:** VGG-FE에 비해 모든 클래스에서 균일한 개선을 보였습니다. 특히 N1 클래스의 민감도(sensitivity)가 12% 증가했으며, N1-W 오분류 6%, N1-R 오분류 5%, N1-N2 오분류 1% 감소에 기여했습니다. R 민감도는 6%, N2 민감도는 4% 증가했습니다.
- **최첨단 결과와의 비교:** VGG-FE와 VGG-FT 모두 최첨단 결과([12, 13])와 유사하거나 더 높은 성능을 보였으며, VGG-FT는 기존 최고 모델([12])과 동등한 수준의 정확도(84-86-88%)를 달성했습니다.
- **시각화 결과:** 민감도 맵은 각 수면 단계의 특징적인 EEG 패턴(예: W 단계의 알파 대역, N1의 세타 대역, N2의 스핀들 및 K-복합체, N3의 느린 파동 활동, R 단계의 혼합 주파수 신호)과 일치하는 시간-주파수 영역에서 높은 민감도를 보였습니다. 이는 네트워크의 의사 결정이 생리학적 지식과 부합함을 보여줍니다.

## 🧠 Insights & Discussion

- **수면 단계 분류의 시각적 재해석:** 본 연구는 수면 단계 분류를 멀티테이퍼 스펙트럼 추정으로 생성된 이미지에 CNN을 적용하는 시각적 작업으로 효과적으로 재구성할 수 있음을 입증했습니다.
- **해석 가능성의 중요성:** 제안된 접근 방식은 전문가에게 해석 가능한 패턴과 네트워크의 추론 과정을 쉽게 검사할 수 있는 민감도 분석 프레임워크를 제공하여 도메인 전문가와의 상호작용을 크게 향상시킵니다. 이는 '블랙박스' 모델에 대한 신뢰도를 높이는 데 기여합니다.
- **전이 학습의 효율성:** 제한된 의료 데이터 환경에서 사전 훈련된 CNN 모델을 전이 학습으로 활용하는 것이 새롭게 모델을 훈련하는 것보다 훨씬 효율적이고 효과적임을 보여주었습니다.
- **N1 단계의 분류 어려움:** VGG-FE와 VGG-FT 모두 N1 단계 분류에서 다른 단계보다 낮은 민감도를 보였는데, 이는 문헌에서도 일관된 결과입니다. 이는 N1 단계의 모호한 생리학적 특성 때문일 수 있습니다.
- **일반화 가능성:** 본 연구에서 제시된 도구와 방법론은 EEG 수면 단계 채점을 넘어 EEG 분석의 다른 작업이나 시간-주파수 신호가 기록되는 다른 생물학적 영역(예: EMG)에도 적용될 수 있는 잠재력을 가집니다.
- **향후 연구:** 스펙트럼 이미지 생성 시 하이퍼파라미터 최적화 개선과 VGGNet 계층에 대한 심층 연구를 통해 네트워크의 내부 구조를 더 깊이 이해하는 것이 제안됩니다.

## 📌 TL;DR

수동 수면 단계 채점의 비효율성과 기존 ML 모델의 해석 불가능성을 해결하기 위해, 본 논문은 **multitaper spectral estimation**을 통해 EEG 신호를 시각적으로 해석 가능한 컬러 **스펙트로그램 이미지**로 변환합니다. 이 이미지들을 **전이 학습(transfer learning)**을 적용한 **VGGNet 기반 딥 컨볼루션 신경망(CNN)**에 입력하여 수면 단계를 분류합니다. **민감도 분석(sensitivity analysis)**을 통해 네트워크의 의사 결정 과정을 시각적으로 설명하여 전문가에게 직관적인 인사이트를 제공합니다. Sleep-EDF 데이터셋에서 **$86\%$의 높은 정확도**를 달성하며 최첨단 성능을 보였고, 각 수면 단계의 생리학적 특징과 일치하는 중요한 시간-주파수 대역을 식별하여 모델의 해석 가능성을 입증했습니다.
