# metric-learn: Metric Learning Algorithms in Python

William de Vazelhes, CJ Carey, Yuan Tang, Nathalie Vauquier, AurΓ©lien Bellet

## π§© Problem to Solve

κΈ°μ΅΄ λ¨Έμ‹ λ¬λ‹μ—μ„ μ ν΄λ¦¬λ“(Euclidean), μ½”μ‚¬μΈ(Cosine) λ“± ν‘μ¤€ κ±°λ¦¬ μΈ΅μ •λ²•μ€ νΉμ • λ°μ΄ν„°μ™€ μ‘μ—…μ— μ ν•©ν•μ§€ μ•μ€ κ²½μ°κ°€ λ§μµλ‹λ‹¤. λ„λ©”μΈ μ§€μ‹μ— κΈ°λ°ν• κ±°λ¦¬ μ„¤κ³„λ” μ–΄λ µκΈ° λ•λ¬Έμ—, λ°μ΄ν„°λ΅λ¶€ν„° μ‘μ—…μ— νΉν™”λ κ±°λ¦¬ μΈ΅μ •λ²•μ„ μλ™μΌλ΅ ν•™μµν•λ” κ²ƒμ΄ ν•„μ”ν•©λ‹λ‹¤.

ν„μ¬ μ΅΄μ¬ν•λ” κ±°λ¦¬ ν•™μµ(Metric Learning) μ•κ³ λ¦¬μ¦λ“¤μ€ ννΈν™”λμ–΄ μκ±°λ‚ (Matlab), λ²”μ© λ¨Έμ‹ λ¬λ‹ λΌμ΄λΈλ¬λ¦¬μ™€ ν†µν•©λ ν†µμΌλ APIκ°€ λ¶€μ΅±ν•λ©° (Rμ dml), νΉμ • λ¶„μ•Ό(μ: λ”¥ λ¬λ‹)μ—λ§ μ΄μ μ„ λ§μ¶”κ³  μμµλ‹λ‹¤ (Pythonμ pytorch-metric-learning, pyDML). λ”°λΌμ„ `scikit-learn`κ³Ό νΈν™λλ” ν†µν•©λ νμ΄μ¬ ν¨ν‚¤μ§€μ ν•„μ”μ„±μ΄ μ κΈ°λ©λ‹λ‹¤.

## β¨ Key Contributions

- **μ¤ν” μ†μ¤ νμ΄μ¬ ν¨ν‚¤μ§€**: `metric-learn`μ€ μ§€λ„ ν•™μµ(supervised) λ° μ•½ν• μ§€λ„ ν•™μµ(weakly-supervised) κ±°λ¦¬ ν•™μµ μ•κ³ λ¦¬μ¦μ„ κµ¬ν„ν• μ¤ν” μ†μ¤ νμ΄μ¬ ν¨ν‚¤μ§€μ…λ‹λ‹¤.
- **`scikit-learn` νΈν™μ„±**: `scikit-learn` APIμ™€ μ™„λ²½ν•κ² νΈν™λλ” ν†µμΌλ μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•μ—¬ κµμ°¨ κ²€μ¦, λ¨λΈ μ„ νƒ λ° λ‹¤λ¥Έ `scikit-learn` μ¶”μ •κΈ°μ™€μ νμ΄ν”„λΌμ΄λ‹μ„ μ©μ΄ν•κ² ν•©λ‹λ‹¤.
- **λ‹¤μ–‘ν• μ•κ³ λ¦¬μ¦ κµ¬ν„**: μ§€λ„ ν•™μµ, μ(pair) ν•™μµ, μ‚Όμ¤‘ν•­(triplet) ν•™μµ, μ‚¬μ¤‘ν•­(quadruplet) ν•™μµ λ“± λ‹¤μ–‘ν• κ°λ… μμ¤€μ„ μ§€μ›ν•λ” 10κ°€μ§€ μΈκΈ° μλ” κ±°λ¦¬ ν•™μµ μ•κ³ λ¦¬μ¦μ„ κµ¬ν„ν•©λ‹λ‹¤.
- **Mahalanobis κ±°λ¦¬ ν•™μµ**: λ¨λ“  μ•κ³ λ¦¬μ¦μ€ νΉμ„± κ³µκ°„μ μ„ ν• λ³€ν™ $L$ λλ” Mahalanobis ν–‰λ ¬ $M = L^T L$μ„ ν•™μµν•μ—¬ Mahalanobis κ±°λ¦¬λ¥Ό λ°°μ›λ‹λ‹¤.
- **ν’μ§ λ° μ»¤λ®¤λ‹ν‹°**: μ² μ €ν• ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€(97%), PyPIλ¥Ό ν†µν• MIT λΌμ΄μ„ μ¤ λ°°ν¬, `scikit-learn-contrib` μ΅°μ§μ— ν¬ν•¨λμ–΄ λ†’μ€ ν’μ§κ³Ό μ»¤λ®¤λ‹ν‹° μ°Έμ—¬λ¥Ό λ³΄μ¥ν•©λ‹λ‹¤.

## π“ Related Works

- **Matlab κµ¬ν„**: λ§μ€ κ±°λ¦¬ ν•™μµ μ•κ³ λ¦¬μ¦μ΄ μ €μλ“¤μ— μν•΄ MatlabμΌλ΅ κµ¬ν„λμ—μΌλ‚ κ³µν†µ APIκ°€ λ¶€μ΅±ν•©λ‹λ‹¤.
- **R ν¨ν‚¤μ§€ `dml`**: Rμ—μ„ μ—¬λ¬ κ±°λ¦¬ ν•™μµ μ•κ³ λ¦¬μ¦μ„ ν†µμΌλ μΈν„°νμ΄μ¤λ΅ κµ¬ν„ν•μ§€λ§, λ²”μ© λ¨Έμ‹ λ¬λ‹ λΌμ΄λΈλ¬λ¦¬μ™€ κΈ΄λ°€ν•κ² ν†µν•©λμ§€λ” μ•μ•μµλ‹λ‹¤ (Tang et al., 2018).
- **Python ν¨ν‚¤μ§€ `pyDML`**: μ£Όλ΅ μ™„μ „ μ§€λ„ ν•™μµ λ° λΉ„μ§€λ„ ν•™μµ μ•κ³ λ¦¬μ¦μ„ ν¬ν•¨ν•©λ‹λ‹¤ (SuΓ΅rez et al., 2020).
- **`pytorch-metric-learning`**: PyTorch ν”„λ μ„μ›ν¬λ¥Ό μ‚¬μ©ν•λ” λ”¥ κ±°λ¦¬ ν•™μµμ— μ¤‘μ μ„ λ‘΅λ‹λ‹¤.
- **κ°λ³„ μ•κ³ λ¦¬μ¦**: NCA (Goldberger et al., 2004), LMNN (Weinberger and Saul, 2009), RCA (Shental et al., 2002), LFDA (Sugiyama, 2007), MLKR (Weinberger and Tesauro, 2007), MMC (Xing et al., 2002), ITML (Davis et al., 2007), SDML (Qi et al., 2009), SCML (Shi et al., 2014), LSML (Liu et al., 2012) λ“±μ κΈ°μ΅΄ μ—°κµ¬λ¥Ό μ°Έμ΅°ν•μ—¬ κµ¬ν„ν–μµλ‹λ‹¤.

## π› οΈ Methodology

`metric-learn`μ€ κ±°λ¦¬ ν•¨μ λ§¤κ°λ³€μλ¥Ό μµμ ν™”ν•λ” λ¬Έμ λ΅ κ±°λ¦¬ ν•™μµμ„ κ³µμ‹ν™”ν•©λ‹λ‹¤.

- **Mahalanobis κ±°λ¦¬ ν•™μµ**: ν„μ¬ κµ¬ν„λ λ¨λ“  μ•κ³ λ¦¬μ¦μ€ Mahalanobis κ±°λ¦¬λ¥Ό ν•™μµν•©λ‹λ‹¤. λ‘ μ  $x$μ™€ $x'$ μ‚¬μ΄μ Mahalanobis κ±°λ¦¬λ” $D_L(x, x') = \sqrt{(Lx - Lx')^T(Lx - Lx')}$λ΅ μ •μλ©λ‹λ‹¤. μ΄λ” μ„ ν• λ³€ν™ $L$μ„ μ μ©ν• ν›„μ μ ν΄λ¦¬λ“ κ±°λ¦¬μ™€ λ™μΌν•λ©°, $M=L^T L$μΈ Mahalanobis ν–‰λ ¬ $M$μ„ μ‚¬μ©ν•μ—¬ $D_L(x, x') = \sqrt{(x - x')^T M (x - x')}$μΌλ΅λ„ ν‘ν„λ  μ μμµλ‹λ‹¤.
- **λ‹¤μ–‘ν• κ°λ… μ ν•**:
  - **μ§€λ„ ν•™μµ (Supervised Learners)**: κ° ν›λ ¨ μμ μ— ν•λ‚μ λ μ΄λΈ”μ΄ μλ” λ°μ΄ν„°μ…‹μ—μ„ ν•™μµν•μ—¬ κ°™μ€ ν΄λμ¤μ μ λ“¤μ€ κ°€κΉκ², λ‹¤λ¥Έ ν΄λμ¤μ μ λ“¤μ€ λ©€λ¦¬ λ–¨μ–΄λ¨λ¦½λ‹λ‹¤ (μ: NCA, LMNN, RCA, LFDA, MLKR).
  - **μ ν•™μµ (Pair Learners)**: κ° μμ΄ μ μ‚¬ν•κ±°λ‚ λΉ„μ μ‚¬ν•μ§€ λ μ΄λΈ”μ΄ μ§€μ •λ μ  μ μ§‘ν•©μ—μ„ ν•™μµν•μ—¬ μ μ‚¬ν• μμ€ κ°€κΉκ², λΉ„μ μ‚¬ν• μμ€ λ©€λ¦¬ λ–¨μ–΄λ¨λ¦½λ‹λ‹¤ (μ: MMC, ITML, SDML).
  - **μ‚Όμ¤‘ν•­ ν•™μµ (Triplet Learners)**: 3κ° μ μ νν”μ— λ€ν•΄ ν•™μµν•μ—¬ μ²« λ²μ§Έ (κΈ°μ¤€) μ μ΄ λ‘ λ²μ§Έ μ μ—λ” λ” κ°€κΉκ³  μ„Έ λ²μ§Έ μ μ—λ” λ” λ©€λ¦¬ λ–¨μ–΄μ§€λ„λ΅ ν•©λ‹λ‹¤ (μ: SCML).
  - **μ‚¬μ¤‘ν•­ ν•™μµ (Quadruplet Learners)**: 4κ° μ μ νν”μ— λ€ν•΄ ν•™μµν•μ—¬ μ²« λ²μ§Έ λ‘ μ μ΄ λ§μ§€λ§‰ λ‘ μ λ³΄λ‹¤ λ” κ°€κΉκ² λλ„λ΅ ν•©λ‹λ‹¤ (μ: LSML).
- **μ†ν”„νΈμ›¨μ–΄ μ•„ν‚¤ν…μ² λ° API**:
  - λ¨λ“  κ±°λ¦¬ ν•™μµκΈ°λ” `scikit-learn`μ `BaseEstimator`λ¥Ό μƒμ†λ°›λ” `BaseMetricLearner` μ¶”μƒ ν΄λμ¤λ΅λ¶€ν„° μƒμ†λ°›μµλ‹λ‹¤.
  - `get_metric()` (κ±°λ¦¬ κ³„μ‚° ν•¨μ λ°ν™) λ° `score_pairs()` λ©”μ„λ“λ¥Ό κµ¬ν„ν•΄μ•Ό ν•©λ‹λ‹¤.
  - Mahalanobis κ±°λ¦¬ ν•™μµ μ•κ³ λ¦¬μ¦μ€ λ³€ν™ ν–‰λ ¬ $L$μ— ν•΄λ‹Ήν•λ” `components_` μ†μ„±μ„ κ°€μ§„ `MahalanobisMixin` μΈν„°νμ΄μ¤λ¥Ό μƒμ†λ°›μµλ‹λ‹¤.
  - μ§€λ„ ν•™μµκΈ°λ” `scikit-learn`μ `TransformerMixin`μ„ μƒμ†λ°›μ•„ `sklearn.pipeline.Pipeline`μ„ ν†µν• νμ΄ν”„λΌμ΄λ‹μ„ μ§€μ›ν•©λ‹λ‹¤.
  - μ•½ν• μ§€λ„ ν•™μµ μ•κ³ λ¦¬μ¦μ€ 3μ°¨μ› λ°°μ—΄ ν•νƒμ νν” (μ, μ‚Όμ¤‘ν•­, μ‚¬μ¤‘ν•­)μ— λ€ν•΄ `fit` λ° `predict`λ¥Ό μν–‰ν•©λ‹λ‹¤.

## π“ Results

μ΄ λ…Όλ¬Έμ€ μ£Όλ΅ `metric-learn` ν¨ν‚¤μ§€μ κΈ°λ¥κ³Ό APIλ¥Ό μ„¤λ…ν•λ©°, μƒλ΅μ΄ μ—°κµ¬ κ²°κ³Όλ¥Ό μ μ‹ν•κΈ°λ³΄λ‹¤λ” ν¨ν‚¤μ§€μ μ μ©μ„±μ„ κ°•μ΅°ν•©λ‹λ‹¤.

- **μ„±κ³µμ μΈ μ•κ³ λ¦¬μ¦ κµ¬ν„**: 10κ°€μ§€ μΈκΈ° μλ” κ±°λ¦¬ ν•™μµ μ•κ³ λ¦¬μ¦μ΄ μ„±κ³µμ μΌλ΅ κµ¬ν„λμ–΄ λ‹¤μ–‘ν• κ°λ… μ‹λ‚λ¦¬μ¤λ¥Ό μ²λ¦¬ν•  μ μμµλ‹λ‹¤.
- **λ†’μ€ μ½”λ“ ν’μ§**: 97%μ λ†’μ€ ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€λ¥Ό ν†µν•΄ μ½”λ“μ μ‹ λΆ°μ„±μ„ ν™•λ³΄ν–μµλ‹λ‹¤.
- **`scikit-learn` μƒνƒκ³„ ν†µν•©**: `scikit-learn-contrib` μ΅°μ§μ μΌλ¶€λ΅ μΈμ •λ°›μ•„ `scikit-learn` μƒνƒκ³„ λ‚΄μ—μ„μ νΈν™μ„±κ³Ό ν’μ§μ„ μ…μ¦ν–μµλ‹λ‹¤.
- **μ»¤λ®¤λ‹ν‹° κ΄€μ‹¬**: GitHubμ—μ„ 1000κ° μ΄μƒμ λ³„(stars)κ³Ό 200κ° μ΄μƒμ ν¬ν¬(forks)λ¥Ό κΈ°λ΅ν•λ©° ν™λ°ν• μ»¤λ®¤λ‹ν‹° κ΄€μ‹¬μ„ λ°›μ•μµλ‹λ‹¤.
- **μ‰¬μ΄ ν†µν•© μ‹μ—°**: `scikit-learn.pipeline.Pipeline` λ° `GridSearchCV`μ™€μ ν†µν•© μμ‹λ¥Ό ν†µν•΄ μ§€λ„ ν•™μµ μ„¤μ • (μ: LMNN + KNeighborsClassifier)μ—μ„μ κ°„νΈν• μ‚¬μ©μ„ λ³΄μ—¬μ£Όμ—μµλ‹λ‹¤.
- **μ•½ν• μ§€λ„ ν•™μµ μ§€μ›**: `fetch_lfw_pairs` λ°μ΄ν„°μ…‹μ—μ„ MMCλ¥Ό μ‚¬μ©ν• κµμ°¨ κ²€μ¦ μμ‹λ¥Ό ν†µν•΄ μ•½ν• μ§€λ„ ν•™μµ μ‹λ‚λ¦¬μ¤μ—μ„λ„ APIμ μ‚¬μ© νΈμμ„±μ„ μ‹μ—°ν–μµλ‹λ‹¤.

## π§  Insights & Discussion

- **μλ―Έ**: `metric-learn`μ€ `scikit-learn`κ³Ό μ™„λ²½ν•κ² νΈν™λλ” κ±°λ¦¬ ν•™μµ ν”„λ μ„μ›ν¬λ¥Ό μ κ³µν•¨μΌλ΅μ¨ νμ΄μ¬ λ¨Έμ‹ λ¬λ‹ μƒνƒκ³„μ μ¤‘μ”ν• κ³µλ°±μ„ λ©”μ› μµλ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ κ°•λ ¥ν• κ±°λ¦¬ ν•™μµ κΈ°λ²•μ„ κΈ°μ΅΄ ML μ›ν¬ν”λ΅μ°μ— λ” μ‰½κ² ν†µν•©ν•κ³  μ ‘κ·Ό κ°€λ¥ν•κ² λ§λ“¤μ—μµλ‹λ‹¤.
- **μν–¥**: μ΄ ν¨ν‚¤μ§€λ” μµκ·Όμ ‘ μ΄μ›ƒ(nearest neighbors) κΈ°λ° λ¨λΈ, ν΄λ¬μ¤ν„°λ§(clustering), κ²€μƒ‰(retrieval) λ° μ°¨μ› μ¶•μ†(dimensionality reduction) μ‘μ—…μ μ„±λ¥μ„ ν–¥μƒμ‹ν‚¤λ” λ° κΈ°μ—¬ν•  μ μμµλ‹λ‹¤.
- **μ¥μ **: ν†µμΌλ API, `scikit-learn` νΈν™μ„±, λ‹¤μ–‘ν• κ°λ… μ ν• μ§€μ›, μ¤ν” μ†μ¤ λ° μ ν…μ¤νΈλ μ½”λ“ κΈ°λ°μ€ κ°λ°μμ™€ μ—°κµ¬μμ—κ² ν° μ΄μ μ…λ‹λ‹¤.
- **μ ν• μ‚¬ν•­ λ° ν–¥ν›„ κ³„ν**:
  - **ν™•μ¥μ„±**: λ€κ·λ¨ λ°μ΄ν„°μ…‹ μ²λ¦¬λ¥Ό μ„ν•΄ ν™•λ¥ μ  μ†”λ²„(SGD λ° λ³€ν•) λ° μ¦‰μ„ νν” λ°°μΉ μ²λ¦¬λ¥Ό κµ¬ν„ν•  κ³„νμ…λ‹λ‹¤.
  - **μ•κ³ λ¦¬μ¦ ν™•μ¥**: λ‹¤μ¤‘ λ μ΄λΈ” (Liu and Tsang, 2015) λ° κ³ μ°¨μ› λ¬Έμ  (Liu and Bellet, 2019)λ¥Ό μ²λ¦¬ν•λ” μµμ‹  μ•κ³ λ¦¬μ¦μ„ ν¬ν•¨ν•  μμ •μ…λ‹λ‹¤.
  - **λ‹¤μ–‘ν• κ±°λ¦¬ ν•νƒ μ§€μ›**: μ΄μ„ ν• μ μ‚¬μ„±(bilinear similarities), λΉ„μ„ ν• λ° μ§€μ—­ κ±°λ¦¬(nonlinear and local metrics)μ™€ κ°™μ€ λ‹¤λ¥Έ ν•νƒμ κ±°λ¦¬ ν•™μµμ„ μ§€μ›ν•  κ³„νμ…λ‹λ‹¤.

## π“ TL;DR

**λ¬Έμ **: ν‘μ¤€ κ±°λ¦¬ μΈ΅μ •λ²•μ€ νΉμ • λ¨Έμ‹ λ¬λ‹ μ‘μ—…μ— λ¶€μ ν•©ν• κ²½μ°κ°€ λ§μΌλ©°, κΈ°μ΅΄ κ±°λ¦¬ ν•™μµ μ•κ³ λ¦¬μ¦ κµ¬ν„μ€ `scikit-learn`κ³Ό νΈν™λλ” ν†µν•© νμ΄μ¬ μΈν„°νμ΄μ¤κ°€ λ¶€μ΅±ν–μµλ‹λ‹¤.
**λ°©λ²•**: `metric-learn`μ€ μ§€λ„ ν•™μµ, μ, μ‚Όμ¤‘ν•­, μ‚¬μ¤‘ν•­ ν•™μµ λ“± λ‹¤μ–‘ν• Mahalanobis κ±°λ¦¬ ν•™μµ μ•κ³ λ¦¬μ¦μ„ κµ¬ν„ν• μ¤ν” μ†μ¤ νμ΄μ¬ ν¨ν‚¤μ§€μ…λ‹λ‹¤. μ΄ ν¨ν‚¤μ§€λ” `scikit-learn`κ³Ό μ™„λ²½ν•κ² νΈν™λλ” APIλ¥Ό μ κ³µν•©λ‹λ‹¤.
**λ°κ²¬**: `metric-learn`μ€ κ±°λ¦¬ ν•™μµμ„ λ¨Έμ‹ λ¬λ‹ νμ΄ν”„λΌμΈ, κµμ°¨ κ²€μ¦, λ¨λΈ μ„ νƒκ³Ό μ‰½κ² ν†µν•©ν•  μ μλ” κ°„μ†ν™”λ λ°©λ²•μ„ μ κ³µν•μ—¬ νμ΄μ¬ ML μƒνƒκ³„μ ν•µμ‹¬μ μΈ κ²©μ°¨λ¥Ό ν•΄μ†ν•©λ‹λ‹¤.
