# Few-Shot Segmentation Without Meta-Learning: A Good Transductive Inference Is All You Need?

Malik Boudiaf, Hoel Kervadec, Ziko Imtiaz Masud, Pablo Piantanida, Ismail Ben Ayed, Jose Dolz

## 🧩 Problem to Solve

기존의 Few-Shot Segmentation (FSS) 방법들은 주로 메타 학습(meta-learning) 패러다임과 에피소드 방식의 학습에 의존합니다. 하지만 이러한 접근 방식은 다음과 같은 한계점을 가집니다:

* 표준적인 1-shot 또는 5-shot 시나리오를 넘어서는 일반화 능력이 제한적입니다.
* 메타 학습 시 사용된 샷(shot) 수($K_{\text{train}}$)와 테스트 시 샷 수($K_{\text{test}}$)가 다를 경우 성능이 빠르게 포화됩니다.
* 학습 데이터와 테스트 데이터 간에 도메인 이동(domain shift)이 있는 실제와 같은 시나리오에서 성능이 저하됩니다 (예: 베이스 클래스와 새로운 클래스가 다른 데이터셋에서 추출된 경우).
* 이러한 한계는 현재의 FSS 벤치마크의 타당성과 메타 학습 패러다임의 보편적인 적용 가능성에 대한 의문을 제기합니다.

## ✨ Key Contributions

* 주어진 Few-Shot Segmentation 태스크를 위한 새로운 전도 추론(transductive inference) 방식인 **RePRI (Region Proportion Regularized Inference)**를 제안합니다.
* RePRI는 다음 세 가지 상호 보완적인 항을 통합한 새로운 손실 함수를 최적화합니다:
  * 레이블된 지원(support) 픽셀에 대한 교차 엔트로피(cross-entropy).
  * 쿼리 이미지의 레이블되지 않은 픽셀에 대한 사후 확률(posteriors)의 샤논 엔트로피(Shannon entropy).
  * 예측된 전경(foreground)의 비율에 기반한 전역 쿨백-라이블러(KL) 발산 정규화 항.
* 에피소드 학습 없이 베이스 클래스에 대한 표준 교차 엔트로피 학습만 사용하여 특징 추출기(feature extractor)를 훈련해도, RePRI는 1-shot 시나리오에서 경쟁력 있는 성능을 보이며, 5-shot 및 10-shot 시나리오에서는 최첨단(state-of-the-art) 대비 각각 약 5% 및 6%의 성능 향상을 달성합니다.
* 학습 및 테스트 데이터 분포 간의 클래스 변화 외에 이미지 특징 분포의 변화까지 포함하는 더욱 현실적인 도메인 이동 설정(cross-domain setting)을 도입했으며, 이 시나리오에서 제안된 방법이 최고의 성능을 달성합니다.
* 쿼리 객체의 정확한 영역 비율 정보가 결과에 상당한 개선(평균 13% 향상)을 가져옴을 입증하고, 부정확한 추정치도 큰 성능 향상을 이끌어낼 수 있음을 보여줌으로써 유망한 연구 방향을 제시합니다.

## 📎 Related Works

* **Few-Shot Classification을 위한 메타 학습**:
  * 경사 기반(gradient-based) 접근 방식 (예: MAML [9])과 거리 학습(metric-learning) 접근 방식 (예: Prototypical Networks [31], Matching Networks [35])이 주류입니다.
  * 최근 전도 추론(transductive inference)이 Few-Shot Classification에서 유망한 성능 향상을 보였습니다 [2, 6, 14, 16, 20, 24, 31, 44]. 이는 그래프 기반 레이블 전파, 엔트로피 최소화, 라플라시안 정규화 등 준지도 학습(semi-supervised learning) 개념을 활용합니다.
* **Few-Shot Segmentation**:
  * 픽셀 수준 분류로 간주되며, 주로 특화된 아키텍처 설계에 초점을 맞춥니다.
  * 인기 있는 프로토타입 네트워크에서 영감을 받은 두 개의 브랜치 또는 단일 브랜치 비교 프레임워크를 사용합니다 [29, 25, 42, 30, 37, 38, 21].
  * 지원 이미지에서 클래스 프로토타입을 생성하고 이를 쿼리 이미지 분할에 사용하는 방식이 일반적입니다.
  * 더 나은 가이드 학습 [23, 36, 40], 클래스별 표현 개선 [19, 21, 37, 38], 반복적 개선 [41], 그래프 CNN [36] 등을 포함합니다.

## 🛠️ Methodology

* **베이스 학습**:
  * 메타 학습 방식인 에피소드 학습을 사용하지 않고, 전체 베이스 데이터셋($D_{\text{base}}$)에 대해 **표준 교차 엔트로피 손실**로 특징 추출기($f_{\phi}$)를 훈련합니다.
* **추론 (RePRI - 전도 목적 함수)**:
  * 각 테스트 태스크(지원 세트 $S$와 쿼리 이미지 $x_Q$)에 대해, 단순 선형 분류기(파라미터 $\theta = \{w, b\}$)의 파라미터를 최적화합니다. 여기서 $w$는 전경 프로토타입, $b$는 바이어스입니다.
  * 최적화 목표는 다음과 같습니다:
        $$ \min_{\theta} CE + \lambda_H H + \lambda_{KL} D_{KL} $$
        여기서 $\lambda_H, \lambda_{KL}$은 각 항의 효과를 조절하는 하이퍼파라미터입니다.
  * **손실 함수의 각 항**:
    * **CE (Cross-Entropy)**:
            $$ CE = -\frac{1}{K|\Psi|} \sum_{k=1}^K \sum_{j \in \Psi} \tilde{y}_k(j)^T \log(p_k(j)) $$
            지원 이미지의 다운샘플링된 레이블 $\tilde{y}_k$와 분류기의 예측 $p_k$ 간의 교차 엔트로피. 이 항만 최소화하면 과적합으로 이어질 수 있습니다.
    * **H (Shannon Entropy)**:
            $$ H = -\frac{1}{|\Psi|} \sum_{j \in \Psi} p_Q(j)^T \log(p_Q(j)) $$
            쿼리 이미지 픽셀에 대한 예측 $p_Q$의 샤논 엔트로피. 모델 예측의 확신도를 높여 의사결정 경계를 낮은 밀도 영역으로 밀어냅니다.
    * **D$_{KL}$ (Kullback-Leibler Divergence)**:
            $$ D_{KL} = \hat{p}_Q^T \log \left(\frac{\hat{p}_Q}{\pi}\right) $$
            $\hat{p}_Q = \frac{1}{|\Psi|} \sum_{j \in \Psi} p_Q(j)$는 모델이 예측한 B/F 비율이며, $\pi \in [0,1]^2$는 목표 B/F 비율입니다. 이 항은 모델의 예측 B/F 비율을 목표 $\pi$에 맞추도록 정규화하여 퇴화된(degenerate) 솔루션을 방지하는 데 핵심적인 역할을 합니다.
* **분류기 선택**:
  * 학습 가능한 파라미터 $\theta^{(t)} = \{w^{(t)}, b^{(t)}\}$를 가진 단순 선형 분류기를 사용합니다.
  * 확률은 코사인 유사도(cosine similarity)와 시그모이드(sigmoid) 함수를 통해 계산됩니다: $s^{(t)}_\bullet(j) = \text{sigmoid}(\tau [\cos(z_\bullet(j), w^{(t)}) - b^{(t)}])$.
  * 초기화 시 $w^{(0)}$는 전경 지원 특징의 평균으로, $b^{(0)}$는 쿼리 이미지 전경 예측의 평균으로 설정됩니다.
  * 각 태스크당 50회 경사 하강법(SGD)으로 최적화됩니다.
* **B/F 비율 $\pi$의 공동 추정**:
  * 추가 정보 없이 $\pi$는 분류기 파라미터와 함께 학습됩니다.
  * $\pi^{(t)}$는 최적화 과정의 특정 시점($t_\pi$, 본 논문에서는 10으로 설정)에 한 번 업데이트되어, 모델의 정제된 주변 분포(marginal distribution) $\hat{p}_Q^{(t_\pi)}$를 자체 정규화 목표로 사용합니다.
* **오라클(Oracle) 시나리오**: 쿼리 이미지의 실제 B/F 비율 $\pi^*$를 알고 있는 이상적인 경우를 추가로 조사하여 성능의 상한선을 확인합니다.

## 📊 Results

* **표준 벤치마크 (PASCAL-5$_i$, COCO-20$_i$)**:
  * **1-shot**: 최첨단(SOTA) 방법들과 경쟁력 있는 성능을 보입니다.
  * **5-shot**: SOTA 대비 평균 5% mIoU 향상을 달성합니다.
  * **10-shot**: PASCAL-5$_i$에서 SOTA 대비 6%, COCO-20$_i$에서 4% mIoU 향상을 보이며, 샷 수가 증가할수록 성능 격차가 더 벌어집니다.
* **도메인 이동 (COCO-20$_i$에서 PASCAL-VOC로)**:
  * 기존 방법들을 능가하여 1-shot에서 2%, 5-shot에서 4%의 성능 향상을 달성합니다.
* **오라클 결과 ($\pi^*$를 아는 경우)**:
  * RePRI 자체보다도, 그리고 모든 이전 연구들보다도 인상적인 성능 향상(11-14% mIoU 향상)을 보입니다. 이는 표준 교차 엔트로피 손실로 훈련된 특징 추출기 위에 단순 선형 분류기를 구축하는 것만으로도 메타 학습 모델들을 크게 능가할 수 있음을 시사합니다.
* **어블레이션 연구(Ablation Studies)**:
  * CE 단독 또는 CE+H 손실은 RePRI의 전체 손실(CE+H+D$_{KL}$)에 비해 성능을 크게 저하시킴(각각 20%, 10% 낮은 mIoU)을 확인, $D_{KL}$ 항(비율 정규화)의 결정적인 역할을 입증합니다.
  * $\pi$ 업데이트 시점 $t_\pi$는 5-shot에서 안정적인 성능을 보이며, 1-shot에서는 $[5, 15]$ 범위에서 견고합니다.
  * $\pi$ 추정의 부정확성: 전경 크기 추정에서 $\pm 10-30\%$의 오차가 있어도 70%+의 mIoU(SOTA 대비 10% 향상)를 달성 가능하며, 이는 완벽한 정보 없이도 견고한 성능을 시사합니다.
* **계산 효율성**:
  * 추론 시 각 태스크마다 최적화 단계를 거치므로 순수하게 전방 전달(forward pass)만 하는 방법보다는 FPS가 약간 낮지만, 성능 향상에 비례하여 허용 가능한 수준으로 평가됩니다 (예: PFENet 대비 1-shot에서 3 FPS, 5-shot에서 0.7 FPS 느림).

## 🧠 Insights & Discussion

* **메타 학습 재고**: 본 연구 결과는 Few-Shot Segmentation에서 메타 학습과 에피소드 학습의 필요성에 의문을 제기하며, 특히 복잡하거나 현실적인 시나리오에서 좋은 전도 추론만으로도 충분함을 보여줍니다.
* **전도 추론의 힘**: 레이블되지 않은 쿼리 픽셀과 지원 세트 통계를 효과적으로 활용하여 성능을 크게 향상시킵니다.
* **비율 정규화의 중요성**: $D_{KL}$ 항을 통한 전경 비율 제약은 퇴화된 솔루션을 방지하고 높은 성능을 달성하는 데 필수적입니다.
* **도메인 이동 견고성**: RePRI는 크로스-도메인 설정에서 강력한 성능을 보여, 도메인 이동에 취약한 메타 학습 기반 방법들보다 뛰어난 일반화 능력을 가짐을 입증합니다.
* **미래 연구 방향**: 쿼리 이미지의 전경-배경 비율을 보다 정확하게 추정하는 방법에 대한 연구는 오라클 결과와의 격차를 줄이고 성능을 더욱 향상시킬 수 있는 매우 유망한 방향입니다.
* **한계점**: 추론 시 각 태스크별 최적화 단계로 인해 순수하게 피드포워드 방식인 방법들보다 계산 부담이 약간 증가합니다. 하지만 이는 상당한 성능 향상으로 상쇄됩니다.

## 📌 TL;DR

* **문제**: 기존 Few-Shot Segmentation 방법들은 메타 학습에 의존하며, 샷 수의 다양성이나 도메인 이동과 같은 현실적인 시나리오에서 한계점을 가집니다.
* **제안 방법**: RePRI (Region Proportion Regularized Inference)는 메타 학습을 포기하고, 표준 교차 엔트로피로 훈련된 특징 추출기 위에 전도 추론 방식을 제안합니다. 추론 시에는 지원 세트의 교차 엔트로피, 쿼리 이미지 픽셀의 샤논 엔트로피, 그리고 예측된 전경 비율 기반의 KL-발산 정규화를 포함하는 새로운 손실 함수를 사용하여 단순 선형 분류기를 최적화합니다.
* **핵심 결과**: RePRI는 5-shot 및 10-shot 시나리오에서 최첨단 성능을 달성하고, 도메인 이동 시나리오에서는 기존 메타 학습 방법들보다 훨씬 뛰어난 성능을 보입니다. 전경-배경 비율 정규화는 모델 성능에 결정적인 역할을 하며, 심지어 부정확한 비율 추정으로도 상당한 성능 향상을 이끌어낼 수 있어 미래 연구의 유망한 방향을 제시합니다.
