# POSSIBILITY FOR PROACTIVE ANOMALY DETECTION

Jinsung Jeon, Jaehyeon Park, Sewon Park, Jeongwhan Choi, Minjung Kim, Noseong Park

## 🧩 Problem to Solve

시계열 이상 감지는 실제 애플리케이션에서 오류 및 실패를 감지하여 잠재적 손실을 줄이는 데 매우 중요합니다. 하지만 기존 이상 감지 모델들은 모델 출력과 정답 값(관측된 값) 간의 오차를 통해 이상을 감지하는 **사후 대응(reactive)** 방식에 머물러 있어, 사전에 이상을 방지하는 데는 한계가 있습니다. 일부 이상 현상은 발생하기 전에 작은 전조(precursors)를 보이므로, 이러한 전조를 활용하여 사전에 이상을 예측하고 예방하는 **선제적(proactive)** 접근 방식의 필요성이 제기됩니다.

## ✨ Key Contributions

- **선제적 이상 감지 프레임워크 제안:** 이상 감지에 특화된 시계열 예측 모델과 데이터 기반 이상 감지 모델을 통합한 선제적 이상 감지 접근 방식을 제안합니다.
- **예측 기반 이상 감지:** 학습 데이터를 활용하여 데이터 기반 모델로 이상 임계값을 설정하고, 예측 모델의 출력값이 이 임계값을 초과하는지 여부로 이상을 감지하여, 테스트 데이터의 정답 값 없이 이상을 감지합니다.
- **연속형 및 이산형 특징 처리:** 연속형 및 이산형 값을 모두 포함하는 다변량 시계열 데이터를 처리할 수 있도록 설계된 예측 모델을 개발했습니다.
- **광범위한 평가 및 분석:** 4가지 이상 감지 벤치마크 데이터를 사용하여 모델의 성능을 광범위하게 평가하고, 예측 가능한 이상과 예측 불가능한 이상을 분석하여 제안 방법의 실용성을 고찰했습니다.

## 📎 Related Works

본 논문은 주로 다음 두 가지 유형의 기존 연구를 참조합니다.

- **데이터 기반 이상 감지 (Data-driven anomaly detection):**
  - **분포 기반(Distribution-based):** Gaussian Mixture Model (GMM), Empirical Cumulative Distribution-based Outlier Detection (ECOD). 이들은 학습 데이터의 분포 특성을 학습하고 분포의 꼬리 부분에 있는 데이터를 이상으로 간주합니다.
  - **경계 기반(Boundary-based):** Support Vector Data Description (SVDD), Deep Support Vector Data Description (DeepSVDD). 이들은 고차원 특징 공간에서 정상 데이터를 포괄하는 초구(hypersphere)를 학습하며, 이 초구 밖에 있는 데이터를 이상으로 간주합니다.
- **시계열 이상 감지 및 예측 모델:** LSTM-P, DeepAnT, TCN-S2S-P, MTAD-GAT, GDN, GTA 등 시계열 이상 감지 모델과 NLinear, DLinear, TimesNet, PatchTST 등 시계열 예측 모델과 비교 평가를 진행했습니다.

## 🛠️ Methodology

본 논문에서 제안하는 선제적 이상 감지 접근법은 크게 두 가지 단계로 구성됩니다.

1. **데이터 기반 이상 감지 모델 훈련 및 임계값 설정:**
   - **단계 1:** 훈련 데이터만을 사용하여 데이터 기반 이상 감지 모델(예: GMM, ECOD, DeepSVDD)을 훈련합니다.
   - **단계 2:** 훈련된 모델로부터 훈련 데이터에 대한 이상 점수를 계산하고, 이 점수 분포를 기반으로 이상 임계값을 설정합니다. (예: 훈련 점수 중 최소값)
2. **이상 감지에 특화된 시계열 예측 모델 ($T_N$에서 $T_{N+1}$ 예측)을 활용한 선제적 감지:**
   - **모델 구조 (Figure 1 참고):**
     - **연속형 및 이산형 특징 분리 추출:** 시계열 데이터의 연속형 특징($C_t$)과 이산형 특징($D_t$)을 분리하여 처리합니다.
       - **연속형 특징:** 이동 평균을 통해 추세($C^T_t$)와 계절성($C^S_t$)으로 분해한 후, 각각 선형 레이어(Linear${_trend}$, Linear${_{seasonality}}$)를 통과시켜 예측값($\hat{C}^T_{N+1}$, $\hat{C}^S_{N+1}$)을 얻고 이를 합쳐 최종 연속형 예측값($\hat{C}_{N+1}$)을 생성합니다.
       - **이산형 특징:** 이산형 특징을 원-핫(one-hot) 벡터($O_t$)로 변환한 후, 별도의 선형 레이어(Linear${_{discrete}}$)를 통과시켜 예측값($\hat{O}_{N+1}$)을 얻습니다.
     - **적응형 그래프 컨볼루션(Adaptive Graph Convolution, AGC) 레이어:** 연속형 및 이산형 특징 간의 종속성을 학습하기 위해 적응형 인접 행렬 $A = I + \text{softmax}(\text{ReLU}(EE^T))$을 활용하는 그래프 컨볼루션 레이어를 사용합니다. 여기서 $E$는 학습 가능한 노드 임베딩 행렬입니다. AGC 레이어의 출력 $Z$는 특징 간의 상관관계를 반영합니다.
     - **최종 예측:** 분리된 특징 예측값에 AGC 레이어의 출력 $Z$를 더하여 특징 간의 종속성을 고려한 최종 예측값 $\hat{C}_{N+1}$과 $\hat{O}_{N+1}$을 생성합니다.
     - **손실 함수:** 연속형 특징에는 MSE (Mean Squared Error), 이산형 특징에는 CE (Cross-Entropy) 손실을 사용하여 모델을 훈련합니다. 총 손실은 이 둘의 합입니다.
   - **선제적 이상 감지 (Figure 2 참고):**
     - **단계 3:** 훈련된 시계열 예측 모델에 테스트 데이터의 과거 시점($T_N$)을 입력하여 다음 시점($T_{N+1}$)의 값을 예측합니다.
     - **단계 4:** 예측된 값($\hat{T}_{N+1}$)을 훈련된 데이터 기반 이상 감지 모델에 입력하여 이상 점수를 산출합니다.
     - **단계 5:** 산출된 이상 점수가 미리 설정된 임계값을 초과하는지 여부에 따라 해당 시점을 정상 또는 이상으로 분류합니다.

## 📊 Results

- **벤치마크 데이터셋:** MSL, SMAP (이산형 값 비율 높음), SMD (연속형, 이산형 혼합), PSM (연속형만) 4개 데이터셋을 사용했습니다.
- **예측 성능 (MSE):** 제안 모델은 CE 손실로 이산형 특징을 훈련했음에도 불구하고, 최신 시계열 예측 모델들과 유사하거나 더 나은 MSE 예측 성능을 보였습니다.
- **이상 감지 성능 (F1-@K, F1-Composite, F1-Range):**
  - 이산형 특징의 비율이 높은 MSL 및 SMAP 데이터셋에서 가장 우수한 이상 감지 성능을 기록했습니다 (Table 1에서 랭킹 1위).
  - PSM과 같이 연속형 특징만 있는 데이터셋에서도 유연하게 적응하여 뛰어난 성능을 보였습니다.
  - 특히 SMAP 데이터셋에서 실제 이상 발생 시점보다 1시점 이전에 이상을 감지하는 "선제적 감지"가 가능함을 시각적으로 입증했습니다 (Figure 3).
  - 일부 경쟁 모델(TimesNet)이 MSE 예측 성능은 높았으나, 이산형 특징에 대해 연속형 값을 예측하여 실제 이상 점수와 큰 차이를 보인 반면, 제안 모델은 이산형 값을 정확히 예측하여 실제 값에 더 가까운 이상 점수를 산출했습니다 (Figure A).
- **예측 가능성 분석:**
  - 푸리에 변환을 이용한 분석 결과, 모든 데이터셋에서 훈련 데이터와 테스트 이상 데이터의 기저(bases) 집합이 동일하다는 것을 확인했습니다.
  - 훈련 데이터의 계수 크기로 볼록 껍질(convex hull)을 구성했을 때, SMAP 데이터셋의 이상은 1.2%만이 볼록 껍질 밖에 있어 대부분 예측 가능했습니다. 반면, SMD 데이터셋의 이상은 약 21%가 볼록 껍질 밖에 있어 예측하기 더 어려움을 보였고, 이는 모델 성능 차이와 일치했습니다 (Figure 4).
- **Ablation Study:**
  - **그래프 구조의 효과:** 그래프 구조를 사용한 모델이 그래프 구조가 없는 모델보다 연속형 및 이산형 특징 모두에서 낮은 예측 오차를 보였습니다 (Figure C, "Ours" vs. "w/o graph"). 이는 특징 간의 상관관계를 고려하는 것이 중요함을 입증합니다.
  - **연속형/이산형 특징 분리 훈련의 효과:** 특징 분리 훈련을 하지 않은 모델은 이산형 특징에 대한 교차 엔트로피 손실이 크게 증가하여(Figure C, "Ours" vs. "w/o sep"), 다변량 시계열 이상 감지에서 연속형 및 이산형 특징을 분리하여 훈련하는 것이 필수적임을 보여주었습니다.

## 🧠 Insights & Discussion

- **선제적 이상 감지의 중요성:** 본 연구는 기존 사후 대응적 이상 감지 모델의 한계를 극복하고, 사전에 이상을 예측하고 대응할 수 있는 선제적 접근법의 실현 가능성을 제시합니다. 이는 실제 환경에서 잠재적 피해를 최소화하는 데 큰 이점을 제공합니다.
- **특징별 맞춤형 모델링의 효과:** 연속형 및 이산형 특징을 분리하여 처리하고 각 특징의 특성을 반영한 손실 함수를 사용하는 전략은 혼합형 데이터셋에서 높은 예측 정확도를 달성하는 데 결정적인 역할을 했습니다.
- **그래프 기반 종속성 학습:** 적응형 그래프 컨볼루션 레이어를 통해 특징 간의 복잡한 종속성을 학습함으로써, 모델의 예측 정확도를 향상시키고 이상 감지 성능에 기여했습니다.
- **예측 가능한 이상에 대한 명확한 이해:** 푸리에 변환을 활용한 예측 가능성 분석은 제안 모델이 주로 "전조를 동반하는(forecastable)" 이상을 효과적으로 감지함을 보여주며, "전조 없는(unpredictable)" 이상에 대한 향후 연구 방향을 제시합니다.
- **한계점:** 예측 불가능한 이상에 대해서는 여전히 개선의 여지가 있으며, 이에 대한 추가 연구가 필요합니다.

## 📌 TL;DR

본 논문은 기존의 사후 대응 방식의 한계를 극복하기 위해, 이상 감지에 특화된 시계열 예측 모델과 데이터 기반 이상 감지 모델을 결합한 **선제적 이상 감지(proactive anomaly detection)** 방법을 제안합니다. 제안 모델은 연속형 및 이산형 특징을 개별적으로 처리하고 적응형 그래프 컨볼루션 레이어를 통해 특징 간의 종속성을 학습하여 높은 예측 정확도를 달성합니다. 훈련 데이터로 설정된 이상 임계값을 활용하여 예측된 값이 이 임계값을 넘는지 여부로 사전에 이상을 감지하며, MSL, SMAP 등 벤치마크 데이터셋에서 우수한 성능을 입증했습니다. 또한 푸리에 변환 기반 분석을 통해 예측 가능한 이상에 대한 모델의 효과를 검증하고, 예측 불가능한 이상에 대한 향후 연구 방향을 제시합니다.
