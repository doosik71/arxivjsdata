# Anomaly Detection for a Water Treatment System Using Unsupervised Machine Learning

Jun Inoue, Yoriyuki Yamagata, Yuqi Chen, Christopher M. Poskitt, Jun Sun

## 🧩 Problem to Solve

CPS(Cyber-Physical System)에서 발생하는 비정상적인 행동(이상 징후)을 탐지하는 것은 시스템의 보안, 개발, 유지보수에 매우 중요합니다. 기존의 규칙 기반 또는 모델 기반 접근 방식은 CPS의 복잡한 물리적 프로세스와 알고리즘 제어의 긴밀한 통합 때문에 정확한 모델을 구축하기 어렵습니다. 또한, 실제 이상 징후 데이터가 부족하여 지도 학습(supervised machine learning) 방법을 적용하기도 어렵습니다. 이 논문은 이러한 배경 하에 비지도 기계 학습(unsupervised machine learning)을 사용하여 복잡한 CPS, 특히 정수 시스템에서 이상 징후를 효과적으로 탐지하는 방법을 모색합니다.

## ✨ Key Contributions

- CPS 시계열 데이터에 적용 가능한 두 가지 비지도 학습 기반 이상 징후 탐지 방법인 딥 뉴럴 네트워크(DNN)와 One-class Support Vector Machine(SVM)을 제안하고 평가했습니다.
- 싱가포르 기술 디자인 대학교(SUTD)에서 구축된 실제 규모의 정수 시스템인 Secure Water Treatment(SWaT) 테스트베드에서 수집된 실제 데이터를 사용하여 제안된 방법들을 36가지 공격 시나리오에 대해 광범위하게 평가했습니다.
- DNN이 One-class SVM보다 오탐(false positives)을 더 적게 생성하고 전반적인 F-측정(F measure)에서 약간 더 나은 성능을 보임을 입증했습니다.
- 두 방법의 장단점, 특성, 그리고 특정 유형의 이상 징후(예: 점진적 변화, 액추에이터 동작) 탐지에서의 한계를 분석하고 논의했습니다.

## 📎 Related Works

- **시뮬레이션 및 모델 기반 탐지 [1-7]**: 시스템 구성에 대한 사전 지식과 운영 로그가 필요하며, 복잡한 CPS 모델링의 어려움이 있습니다.
- **지도 기계 학습 [14]**: 제어 요소의 소스 코드 접근과 무작위 오류 주입을 통한 학습이 필요하며, 아직 초기 단계의 연구입니다.
- **Signal Temporal Logic(STL) 기반 접근 [8]**: 알려진 동작을 STL 공식으로 설명하지만, SWaT와 같은 동적, 비선형, 고차원 시스템에는 짧은 설명이 어렵습니다.
- **Local Outlier Factor(LOF) [9, 16]**: 정상 동작에 대한 사전 지식 없이 이상치를 찾는데 사용되지만, 본 연구의 경우 정상 동작이 알려져 있어 부적합합니다.
- **다른 DNN 기반 이상 탐지 [17, 18]**: 예측 오차를 사용하거나(Malhotra et al. [17]) 균일한 임계값 설정의 어려움, 낮은 재현율 등의 문제가 있으며, 혼합 데이터 유형(이산/실수) 처리 및 이상 징후 시간 탐지에 한계가 있습니다.
- **SWaT 테스트베드를 활용한 선행 연구 [14, 19, 20, 21, 22]**: 데이터 분류기 학습, 네트워크 트래픽 모니터링, 프로세스 불변량 모니터링 등을 포함하며, 본 연구는 SWaT 전체 시스템에 대한 비지도 학습 기반 접근으로 차별화됩니다 (Goh et al. [19]는 특정 하위 시스템 및 제한된 공격 시나리오에만 적용).

## 🛠️ Methodology

본 연구에서는 두 가지 비지도 학습 기반 이상 징후 탐지 방법을 사용합니다. 두 방법 모두 정상 조건에서 수집된 SWaT 로그 데이터로 훈련됩니다.

### 1. 딥 뉴럴 네트워크 (Deep Neural Network, DNN)

- **접근 방식**: 확률적 이상치 탐지(probabilistic outlier detection)를 구현하여 데이터 포인트가 낮은 확률로 할당되면 이상치로 판단합니다.
- **구조**: LSTM(Long Short-Term Memory) 계층과 피드포워드 계층으로 구성되어 시계열 데이터의 동적 특성을 포착합니다.
- **이상치 요소 (Outlier Factor) 계산**: $i$번째 로그 엔트리 $l_i \equiv \langle a(i), s(i) \rangle$에 대한 이상치 요소는 $-\log q(l_i | l_{i-1})$로 정의됩니다. 여기서 $a(i)$는 액추에이터 값, $s(i)$는 센서 값입니다. 액추에이터는 이산 분포($q_j$), 센서는 가우시안 분포($r_k$)로 근사하며, 다음과 같이 분해하여 계산합니다:
  $$-\sum_{j=1}^{n} \log q_j(a_j(i)|l_{i-1},a_1(i),...,a_{j-1}(i)) - \sum_{k=1}^{m} \log r_k(s_k(i)|l_{i-1}, a(i),s_1(i),...,s_{k-1}(i))$$
- **훈련**: 실제 확률 분포와 예측된 분포 간의 교차 엔트로피를 비용 함수로 사용하여 최소화합니다. 비용 함수는 훈련 데이터의 모든 이상치 요소의 합입니다. 훈련 후 실험적으로 결정된 임계값을 사용하여 이상치를 식별합니다.

### 2. One-Class Support Vector Machine (SVM)

- **접근 방식**: 시간 시리즈 데이터에서 비정상적인 '형태(shapes)'를 탐지하는 데 중점을 둡니다.
- **데이터 변환**: 시계열 데이터에 슬라이딩 윈도우(sliding window) 방법을 적용합니다. 각 로그 엔트리 $l_i$와 윈도우 크기 $w$를 사용하여 윈도우 $W_i \equiv \langle l_i, l_{i+1}, ..., l_{i+w-1} \rangle$를 생성하여 특징 벡터로 사용합니다.
- **커널**: 비선형 분류 경계를 학습하기 위해 RBF(Radial Basis Function) 커널을 사용합니다.
- **정규화**: SVM의 성능에 큰 영향을 미치므로, 훈련 및 테스트 데이터셋을 각각의 평균과 분산으로 정규화합니다.
- **훈련 및 테스트**: 훈련 데이터의 모든 윈도우를 SVM 훈련 알고리즘에 입력합니다. 테스트 단계에서는 각 윈도우에 포함된 로그 엔트리 중 하나라도 이상 징후로 레이블링되면 해당 윈도우를 '비정상'으로 레이블링하여 평가합니다.

## 📊 Results

- **전반적인 성능 (SWaT 공격 로그)**:
  - **DNN**: 정밀도(Precision) 0.98295, 재현율(Recall) 0.67847, F-측정 0.80281.
  - **One-class SVM**: 정밀도 0.92500, 재현율(Recall) 0.69901, F-측정 0.79628.
  - DNN이 F-측면에서 약간 더 우수하며, 정밀도가 높은 반면 SVM은 재현율이 약간 더 높습니다.
- **오탐 (False Positives)**: SVM은 비정상으로 간주되지 않아야 할 갑작스러운 센서 값 변화를 이상 징후로 보고하는 경향이 있어 더 많은 오탐을 발생시켰습니다 (비공격 윈도우의 약 0.8%에서 오탐).
- **개별 공격 탐지**:
  - **DNN**: 센서 값이 일정하고 비정상적인 값으로 변경되는 공격을 잘 탐지했습니다. 그러나 비정상적인 액추에이터 움직임이나 센서 값의 점진적인 변화를 야기하는 공격은 놓치는 경향이 있었습니다.
  - **One-class SVM**: 범위를 벗어난 값(out of range values)을 탐지하는 데 더 효과적이었지만, 항상 그런 것은 아니었습니다. DNN이 높은 정밀도로 탐지하는 일부 이상 징후를 SVM은 탐지하기 어려워했습니다.
- **계산 비용**:
  - **DNN**: 훈련에 약 2주, 평가에 약 8시간 소요.
  - **One-class SVM**: 최적 성능 파라미터의 경우 훈련에 30분, 평가에 10분 소요. SVM이 훨씬 더 효율적이었습니다.

## 🧠 Insights & Discussion

- **성능 비교**: DNN은 더 높은 정밀도를 보이며 오탐이 적은 반면, One-class SVM은 재현율이 약간 높고 민감도가 더 높지만, 정상적인 급격한 변화를 이상 징후로 오인하여 오탐이 많을 수 있습니다.
- **한계**:
  - 두 방법 모두 센서 값의 **점진적인 변화** 또는 **비정상적인 액추에이터 동작**을 탐지하는 데 어려움을 겪었습니다. 이는 컨트롤러의 로직을 고려해야 할 필요성을 시사합니다.
  - DNN은 범위를 벗어난 값(out of bound values)을 탐지하는 데 어려움이 있었습니다.
  - 연구는 SWaT 테스트베드에 국한되어 다른 CPS로의 일반화 가능성에 한계가 있습니다.
  - 데이터셋은 의도적으로 주입된 공격으로 인한 이상 징후만을 포함하므로, 실제 공격으로 인한 이상 징후와 특성이 다를 수 있습니다.
- **향후 연구**:
  - 두 방법의 성능 향상(특히 재현율).
  - 장기적인 데이터 추세를 특징 벡터에 인코딩하여 성능 개선.
  - 개별 센서 또는 액추에이터에 대한 이상치 요소를 계산하여 이상 징후의 원인 추론.
  - SWaT 시뮬레이터를 활용하여 안전상의 이유로 실제 테스트베드에서 수행하기 어려운 추가 실험 수행.
  - 다른 신경망 기반 방법 및 기계 학습, 통계 방법과의 비교 확장.

## 📌 TL;DR

본 논문은 정수 시스템과 같은 CPS의 이상 징후 탐지를 위해 비지도 기계 학습 방법인 딥 뉴럴 네트워크(DNN)와 One-class Support Vector Machine(SVM)을 비교 평가했습니다. SWaT 테스트베드 데이터셋을 활용하여 정상 작동으로 훈련하고 36가지 공격 시나리오에 대해 테스트한 결과, DNN은 SVM보다 높은 정밀도와 F-측정으로 더 적은 오탐을 보였습니다. 반면 SVM은 재현율이 약간 높았지만 정상적인 급격한 변화를 오탐으로 보고하는 경향이 있었습니다. 두 방법 모두 센서 값의 점진적 변화나 액추에이터의 비정상적 동작 탐지에는 어려움을 겪었으며, DNN은 SVM에 비해 훨씬 높은 계산 비용을 요구했습니다.
