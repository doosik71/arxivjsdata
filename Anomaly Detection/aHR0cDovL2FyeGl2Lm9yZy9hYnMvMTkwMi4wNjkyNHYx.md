# Anomaly Detection with Adversarial Dual Autoencoders

Vu Ha Son, Ueta Daisuke, Hashimoto Kiyoshi, Maeno Kazuki, Sugiri Pranata, Sheng Mei Shen

## 🧩 Problem to Solve

최근 이상 탐지(Anomaly Detection) 분야에서 준지도(semi-supervised) 및 비지도(unsupervised) GAN(Generative Adversarial Network) 기반 방법들이 인기를 얻고 있지만, GAN의 학습은 불안정하고 어렵다는 문제가 있습니다. 생성자와 판별자 간의 불균형으로 인해 모드 붕괴(mode collapse) 및 비수렴(non-convergence)과 같은 문제가 발생하기 쉽습니다. 이 논문은 이러한 학습 안정성 문제를 해결하고 더 나은 탐지 성능을 달성할 수 있는 새로운 GAN 기반 이상 탐지 프레임워크를 제안하는 것을 목표로 합니다.

## ✨ Key Contributions

- **ADAE (Adversarial Dual Autoencoders) 프레임워크 제안:** 학습 안정성을 높이기 위해 두 개의 오토인코더(Autoencoder)를 각각 생성자(Generator)와 판별자(Discriminator)로 활용하는 GAN 기반 이상 탐지 프레임워크를 개발했습니다.
- **판별자 재구성 오차 기반 이상 점수 활용:** 이상 점수(anomaly score) 계산에 생성자의 재구성 오차 대신 판별자의 재구성 오차를 사용하여 더 나은 탐지 성능을 달성했습니다.
- **다양한 데이터셋에서의 강력한 성능 입증:** MNIST, CIFAR-10 벤치마크 데이터셋과 실제 뇌종양 탐지(BRATS 2017) 문제에서 최신 기술(state-of-the-art)에 준하는 또는 이를 능가하는 강력하고 견고한 성능을 보여주었습니다.
- **학습 안정성 향상 기법 적용:** 생성자와 판별자의 학습 속도 균형을 맞추는 기법과 완전 합성곱(fully convolutional) 레이어만을 사용하여 모델의 견고성을 높였습니다.

## 📎 Related Works

- **GANomaly [3]:** 인코더($G_E$)-디코더($G_D$)-인코더($E$) 파이프라인 아키텍처를 사용하여 잠재 공간 재구성 오차를 이상 점수로 활용합니다.
- **EGBAD [4]:** Bidirectional GAN (BiGAN) [5]을 사용하여 인코더를 학습시키고, 재구성 손실($L_G$)과 판별자 기반 손실($L_D$)의 조합으로 이상 점수를 계산합니다.
- **IGMM-GAN [6]:** BiGAN에서 영감을 받아 다중 모드(multimodal) 데이터의 잠재 공간 표현을 학습하고, IGMM(Inferred Gaussian Mixture Model)을 사용하여 클러스터링을 수행합니다. 이상 점수는 가장 가까운 클러스터까지의 마할라노비스 거리(Mahalanobis distance)로 정의됩니다.
- **AnoVAEGAN [7]:** VAE와 GAN을 결합하여 뇌 MR 영상의 비지도 이상 분할(anomaly segmentation)에 사용됩니다.
- **Adversarial Autoencoder (AAE) [8]:** 잠재 공간에서 일관성 제약(consistency constrained)을 적용하여 뇌 영상의 종양을 제외한 부분을 재구성하는 데 사용됩니다.
- **ceVAE [9]:** Context-encoding과 VAE를 사용하여 더 나은 재구성 오차와 모델 내부 변동을 제공하며, ELBO(Evidence Lower Bound)를 통해 이상 점수를 추정합니다.
- **AnoGAN [20]:** 이상 탐지를 위한 GAN 기반 방법으로, 생성자 재구성 오차를 활용하는 초기 접근 방식 중 하나입니다.
- **EBGAN [1] & BEGAN [2]:** 생성자와 판별자가 동일한 유형(오토인코더)으로 구성된 GAN으로, 사실적인 이미지 생성에서 학습 안정성을 개선했습니다. ADAE는 이 아이디어에서 영감을 받았습니다.

## 🛠️ Methodology

ADAE는 두 개의 오토인코더로 구성됩니다. 하나는 생성자($G$) 역할을 하고, 다른 하나는 판별자($D$) 역할을 합니다.

1. **네트워크 구조:**

   - 생성자와 판별자 모두 완전 합성곱 레이어(fully convolutional layers)로 구성됩니다. 풀링/업샘플링 레이어 대신 스트라이드(strides)를 가진 (de)convolutional 레이어를 사용하여 이미지 재구성 품질을 향상시켰습니다.
   - 이를 통해 학습해야 할 파라미터 수를 줄이고 모델의 견고성을 높였습니다.

2. **학습 목표:**

   - **판별자 학습 목표($\mathcal{L}_{D}$):** 판별자는 실제 입력($X$)은 충실하게 재구성하고, 생성된 입력($G(X)$)에 대해서는 재구성에 실패하도록 학습됩니다. 즉, 실제 데이터 분포와 생성된 데이터 분포를 분리하려고 합니다.
     $$ \mathcal{L}\_{D} = \|X - D(X)\|\_1 - \|G(X) - D(G(X))\|\_1 $$
   - **생성자 학습 목표($\mathcal{L}_{G}$):** 생성자는 실제 입력($X$)을 재구성하는 동시에, 생성된 데이터 분포($G(X)$)가 실제 데이터 분포($X$)와 일치하도록 판별자를 "속이려" 합니다.
     $$ \mathcal{L}\_{G} = \|X - G(X)\|\_1 + \|G(X) - D(G(X))\|\_1 $$
   - 재구성 오차는 더 선명한 결과를 위해 픽셀 단위 L1-손실(ℓ1 loss)을 사용합니다.

3. **학습 안정성 개선:**

   - 생성자와 판별자의 학습 속도를 균형 있게 조절하여 더 약하게 작동하는 네트워크가 더 강하게 작동하는 네트워크를 따라잡을 수 있도록 합니다.

4. **이상 점수 계산:**
   - 테스트 단계에서 입력 $\hat{x}$에 대한 이상 점수 $\mathcal{A}(\hat{x})$는 **판별자의 재구성 오차**를 활용하여 계산됩니다.
     $$ \mathcal{A}(\hat{x}) = \|\hat{x} - D(G(\hat{x}))\|\_2 $$
   - 정상 데이터는 생성자에 의해 잘 재구성된 후 판별자에 의해 다시 잘 재구성되므로 오차가 작습니다. 반면, 이상 데이터는 생성자가 충실하게 재구성하는 데 실패하고, 판별자가 이를 정상 데이터 분포에 속하지 않는다고 판단하여 오차가 증폭되어 높은 이상 점수를 발생시킵니다.
   - 이 점수가 미리 정의된 임계값 $\phi$를 초과하면 해당 입력은 이상으로 분류됩니다.

## 📊 Results

- **MNIST 데이터셋:**
  - 평균 AUROC 0.858을 달성하여 GANomaly, EGBAD, AnoGAN을 일관되게 능가했으며, IGMM-GAN(평균 AUROC 0.852)보다 약간 더 나은 성능을 보였습니다.
- **CIFAR-10 데이터셋:**
  - 더 복잡한 데이터셋임에도 불구하고 평균 AUROC 0.610을 달성하여 기존의 모든 방법들보다 우수한 성능을 보였습니다.
- **BRATS 2017 (뇌종양 탐지) 데이터셋:**
  - 슬라이스 단위 종양 탐지(slice-wise tumor detection)에서 0.892 AUROC 점수를 기록하여 ceVAE, VAE, AE와 같은 일반적인 방법들을 능가하는 성능을 보였습니다.
  - 정상 뇌 이미지는 충실하게 재구성하지만, 종양이 있는 이미지는 종양 없는 정상 뇌 이미지로 재구성되어 종양 위치에서 큰 차이를 보여 이상 탐지 능력을 정성적으로도 입증했습니다.

## 🧠 Insights & Discussion

- ADAE는 생성자와 판별자를 모두 오토인코더로 구성함으로써 GAN 학습의 고질적인 문제인 불안정성을 효과적으로 개선했습니다. 이 구조적 변화는 두 네트워크 간의 역량 균형을 맞추어 안정적인 학습과 우수한 성능으로 이어졌습니다.
- 이상 점수를 판별자의 재구성 오차로 정의한 것이 핵심적인 통찰력입니다. 이는 생성자의 재구성 오차만을 사용하는 기존 방식과 달리, 비정상적인 입력에 대해 생성자가 재구성에 실패하고 판별자가 이를 정상 분포에 속하지 않는다고 판단하여 오차를 증폭시키는 메커니즘이 더 효과적인 이상-정상 클래스 분리를 가능하게 합니다.
- MNIST, CIFAR-10과 같은 벤치마크 데이터셋뿐만 아니라 뇌종양 탐지와 같은 실제 의료 영상 분석 문제에서도 강력하고 견고한 성능을 보여, 다양한 시나리오에 적용 가능함을 입증했습니다.
- 모델이 학습된 정상 데이터 분포에서 벗어나는 이상(예: 뇌종양)을 효과적으로 감지할 수 있음을 정량적(AUROC) 및 정성적(재구성 이미지 비교)으로 보여주었습니다.

## 📌 TL;DR

이 논문은 불안정한 GAN 학습 문제를 해결하기 위해 두 개의 오토인코더로 구성된 새로운 이상 탐지 프레임워크인 **ADAE (Adversarial Dual Autoencoders)**를 제안합니다. ADAE는 생성자와 판별자가 모두 오토인코더로 작동하여 학습 안정성을 높였고, **판별자의 재구성 오차**를 이상 점수로 활용하여 비정상적인 입력에 대한 감지 성능을 극대화했습니다. MNIST, CIFAR-10 및 뇌종양 탐지(BRATS 2017) 데이터셋 실험에서 ADAE는 기존 최첨단 방법들을 능가하는 강력하고 견고한 성능을 입증하며, 다양한 문제 영역에서 이상 탐지를 위한 효과적인 솔루션임을 보여주었습니다.
