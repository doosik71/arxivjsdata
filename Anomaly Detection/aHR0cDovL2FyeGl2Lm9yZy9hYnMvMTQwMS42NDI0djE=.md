# Toward Supervised Anomaly Detection

Nico Görnitz, Marius Kloft, Konrad Rieck, Ulf Brefeld

## 🧩 Problem to Solve

이상 탐지는 일반적으로 알려지지 않은 분포에서 발생하는 희귀하고 적대적인 사건을 다루므로 비지도 학습 작업으로 간주됩니다. 그러나 순수하게 비지도 방식의 이상 탐지는 많은 경우에 필요한 탐지율을 달성하지 못하며, 모델 생성을 안내할 레이블링된 데이터의 필요성이 존재합니다. 기존의 지도 분류기에서 파생된 준지도 학습 접근 방식은 새로운 미지의 이상 징후를 거의 탐지하지 못하여 부적절합니다. 따라서 비지도 학습 패러다임에 기반하면서도 레이블 정보를 효과적으로 활용하여 미지의 사건에 대처하고 예측 성능을 향상시키는 새로운 준지도 이상 탐지 방법론이 필요합니다.

## ✨ Key Contributions

- 고전적인 준지도 학습 접근 방식(지도 분류기 기반)이 새로운 미지의 이상 징후를 탐지하는 데 부적절함을 보여주었습니다.
- 비지도 학습 패러다임에 기반한 새로운 준지도 이상 탐지(SSAD: Semi-Supervised Anomaly Detection) 알고리즘을 제안했습니다.
- 본질적으로 비볼록(non-convex)인 SSAD 최적화 문제가 비교적 완화된 가정(예: 변환 불변 커널) 하에서 볼록(convex) 등가 공식으로 변환될 수 있음을 증명했습니다.
- 레이블링 후보를 자동으로 필터링하는 능동 학습(active learning) 전략을 제안하여, 모델 개선 및 새로운 이상 징후 클러스터의 신속한 탐지를 지원합니다.
- 네트워크 침입 탐지 데이터에 대한 실증적 연구를 통해, 제안된 학습 방법론이 최신 기술보다 훨씬 적은 레이블링된 데이터를 필요로 하면서도 더 높은 탐지 정확도를 달성함을 입증했습니다.

## 📎 Related Works

- **준지도 학습 (Semi-supervised learning):** 데이터의 클러스터 구조를 가정하며, Transductive SVM (TSVM), Low Density Separation (LDS) 등이 있습니다.
- **비지도 이상 탐지 (Unsupervised anomaly detection):** One-class SVM (OCSVM) 및 Support Vector Data Description (SVDD)가 대표적입니다.
- **지도 이상 탐지 (Supervised anomaly detection):** 이상 탐지를 다중 클래스 분류 문제로 재구성하는 접근 방식이 있습니다.
- **기존 준지도 이상 탐지 (Existing semi-supervised anomaly detection):** SVDD$_{neg}$는 음성 레이블링된 포인트를 활용하지만 비볼록성 문제와 이중성(duality) 간극이 있을 수 있습니다.
- **긍정 및 비레이블링된 예제로부터 학습 (Learning from Positive and Unlabeled Examples, LPUE):** SVDD$_{neg}$가 LPUE의 한 예로 간주됩니다.

## 🛠️ Methodology

- **SSAD (Semi-supervised Anomaly Detection)의 기본 원리:**
  - SVDD(Support Vector Data Description)를 기반으로 하며, 데이터의 "정상" 모델을 나타내는 초구(hypersphere)를 계산합니다.
  - 새로운 인스턴스 $x$에 대한 이상 점수는 초구의 중심 $c$까지의 거리와 반지름 $R$에 의해 계산됩니다: $f(x) = ||\phi(x) - c||^2 - R^2$.
  - $f(x) > 0$이면 이상 징후로 간주됩니다.
- **준지도 학습 통합:**
  - 레이블링되지 않은 데이터 $x_i$는 초구 내부에 있도록 허용됩니다.
  - 레이블링된 데이터 $(x_j^*, y_j^*)$는 다음과 같이 처리됩니다:
    - $y_j^* = +1$ (정상 데이터)인 경우: 초구 내부에 있도록 요구됩니다.
    - $y_j^* = -1$ (이상 징후)인 경우: 초구 외부에 있도록 요구됩니다.
  - 이러한 요구 사항을 만족시키기 위해 페널티 항과 슬랙 변수 $\xi_i$, $\xi_j^*$를 도입하는 최적화 문제로 정식화됩니다 (식 2).
- **비제약 최적화 문제로 전환:**
  - 슬랙 변수를 힌지 손실(hinge loss)과 같은 손실 함수 $l(t)$로 대체하여 비제약 문제로 변환합니다.
  - 커널 함수 $k(x_i, x_j) = \phi(x_i)^T \phi(x_j)$를 사용하여 문제를 커널만으로 표현합니다 (식 5).
  - 이 문제는 비볼록(non-convex)하지만, Huber 손실과 같은 미분 가능한 손실 함수를 사용하여 기울기 기반 최적화 방법으로 해결할 수 있습니다.
- **볼록 등가 공식 (Convex Equivalent Formulation):**
  - 일부 가정(예: $\phi(x)$가 피처 공간에서 단위 노름을 가짐) 하에, Fenchel-Legendre conjugate 함수를 사용하여 볼록 최적화 문제 (P) 및 그 쌍대(dual) 문제 (D)로 재정의될 수 있음을 보입니다. 이는 기존 방법의 이중성 간극 문제를 해결합니다.
- **능동 학습 전략 (Active Learning Strategy):**
  - 모델의 개선을 극대화하기 위해 레이블링할 인스턴스를 효율적으로 선택합니다.
  - **마진 전략 (Margin Strategy):** 결정 경계에 가장 가까운 점을 쿼리합니다 (식 8).
  - **클러스터 전략 (Cluster Strategy):** 레이블이 거의 지정되지 않은 영역의 점을 쿼리하여 새로운 클러스터를 탐색합니다 (식 9).
  - **결합 전략 (Combined Strategy):** 마진 전략과 클러스터 전략의 가중치 합으로 (식 10) 결정 경계에 가깝고 잠재적으로 이상 징후 클러스터에 속하는 인스턴스를 쿼리합니다.

## 📊 Results

- **합성 데이터 실험:**
  - 학습 및 테스트 분포가 다른 환경(새로운 이상 징후 클러스터 출현)에서, 지도 학습 기반의 준지도 방식(SVM, LDS)은 성능이 크게 저하되었습니다.
  - 비지도 방식(SVDD)은 안정적이지만 낮은 성능을 보였습니다.
  - 제안된 SSAD는 모든 기존 방법을 능가하며, 적은 레이블링 데이터(예: 15% 레이블)로도 높은 탐지율을 달성했습니다.
- **실제 네트워크 침입 탐지:**
  - **일반 공격:** 모든 방법이 유사한 높은 탐지 정확도를 보였습니다.
  - **클로킹된 공격 (난독화된 공격):**
    - 비지도 SVDD의 성능은 70% AUC로 크게 떨어졌습니다.
    - SVDD$_{neg}$는 약간의 개선만 보였습니다.
    - SSAD는 두 기준선을 명확히 능가했으며, 15%의 무작위 레이블링 데이터로 거의 완벽한 분리를 달성했습니다.
    - **능동 학습 전략 적용 시:** SSAD는 단 3%의 레이블링 데이터만으로도 거의 완벽한 분리를 달성했습니다 (무작위 레이블링 시 25% 필요). 이는 레이블링 노력을 크게 줄였습니다.
- **임계값 조정 (Threshold Adaptation):** 능동 학습 전략은 SVDD와 같은 기존 이상 탐지기의 임계값을 조정하는 데 효과적이며, 무작위 샘플링보다 훨씬 적은 레이블링 데이터로 합리적인 반지름을 찾아냈습니다.

## 🧠 Insights & Discussion

- 이상 탐지 시나리오에서 지도 학습 패러다임에서 파생된 준지도 방법은 새로운 이상 징후에 대처하지 못해 부적절합니다. 오히려 레이블 정보를 무시하는 비지도 방법이 더 나은 성능을 보일 수도 있습니다.
- 본 연구에서 제안된 SSAD는 비지도 학습 패러다임에 기반하면서 레이블 정보를 효과적으로 통합하여 기존 방법들을 뛰어넘는 성능을 보였습니다. 특히 난독화된 공격과 같은 까다로운 시나리오에서 강건함을 입증했습니다.
- 최적화 문제의 본질적인 비볼록성은 미분 가능한 Huber 손실과 같은 기법을 통해 효율적인 기울기 기반 최적화가 가능하며, 특정 가정 하에서는 볼록 등가 공식이 존재하여 안정적인 해를 보장합니다.
- 능동 학습은 이상 탐지의 실용화를 위한 핵심 요소로, 레이블링 노력(예: 전문가의 수동 검토)을 크게 줄이면서 예측 정확도를 향상시킵니다. 몇 개의 레이블링된 인스턴스만으로도 성능을 크게 향상시킬 수 있다는 점은 레이블링 비용이 높은 분야(예: 네트워크 보안)에서 특히 중요합니다.
- **향후 연구 방향:** 희소성을 유도하는 $L_1$-노름 정규화로 자동 특징 선택 통합, 학습 과정에 계층 구조를 통합하는 구조화된 정규화, 다중 레이블을 위한 다중 작업 학습 등이 있습니다.

## 📌 TL;DR

**문제:** 기존의 비지도 이상 탐지는 정확도가 낮고, 지도 학습 기반의 준지도 방식은 '새로운' 이상 징후 탐지에 실패합니다.
**방법:** 본 논문은 비지도 학습 패러다임(SVDD 기반) 내에서 레이블링된 데이터를 통합하는 새로운 준지도 이상 탐지(SSAD) 방법을 제안합니다. SSAD는 비볼록 최적화 문제를 처리하기 위해 미분 가능한 손실 함수를 사용하거나 볼록 등가 공식을 제시하며, 효율적인 레이블링을 위한 능동 학습 전략을 포함합니다.
**결과:** SSAD는 특히 난독화된 공격과 같은 새로운 이상 징후에 대해 기존 방법보다 훨씬 뛰어난 탐지 정확도를 달성하며, 능동 학습 전략을 통해 매우 적은 수의 레이블링된 데이터만으로도 높은 성능을 유지합니다.
