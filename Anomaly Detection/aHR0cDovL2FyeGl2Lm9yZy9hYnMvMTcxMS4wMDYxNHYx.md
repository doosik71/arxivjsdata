# A Multimodal Anomaly Detector for Robot-Assisted Feeding Using an LSTM-based Variational Autoencoder

Daehyung Park, Yuuna Hoshi, and Charles C. Kemp

## 🧩 Problem to Solve

로봇 보조 급식과 같은 보조 조작(assistive manipulation)은 구조적 복잡성, 작업 가변성, 센서 불확실성으로 인해 잠재적인 위험을 내포합니다. 이러한 로봇 작업의 비정상적인 실행(anomaly)을 신속하게 감지하여 위험을 예방하거나 줄이는 것이 중요합니다. 특히, 고차원적이고 이질적인 다중 모달 센서 신호들을 효과적으로 융합하여 광범위한 이상 상황을 감지하는 것이 어려운 문제입니다. 기존 방법들은 차원 축소나 수작업으로 특징을 추출하는 경우가 많았는데, 이는 정보 손실을 초래하거나 상당한 엔지니어링 노력을 필요로 했습니다.

## ✨ Key Contributions

- **LSTM-VAE 기반 다중 모달 이상 감지기 제안**: 다중 모달 신호들을 융합하고 기대 분포를 재구성하는 LSTM-VAE(Long Short-Term Memory based Variational Autoencoder)를 도입했습니다.
- **재구성 기반 이상 점수 및 상태 기반 임계값**: 재구성 기반 이상 점수(reconstruction-based anomaly score)와 작업의 상태에 따라 동적으로 변하는 상태 기반 임계값(state-based threshold)을 사용하는 감지기를 제시했습니다.
- **최고 성능 달성**: 12가지 대표적인 이상 유형을 포함하는 1,555회의 로봇 보조 급식 실행 데이터셋에서 5가지 기존 베이스라인 감지기보다 높은 AUC(Area Under the Receiver Operating Characteristic Curve) 0.8710을 달성했습니다.
- **효과적인 다중 모달 융합 입증**: 4개의 수작업 특징(hand-engineered features)을 사용했을 때보다 17개의 원시(raw) 센서 신호를 사용했을 때 AUC가 0.064 더 높게 나타나, 특징 엔지니어링 노력 없이도 효과적인 다중 모달 융합이 가능함을 입증했습니다.
- **상태 기반 임계값의 유용성**: 상태 기반 임계값을 통해 더 민감한 이상 감지와 낮은 오탐(false alarm)을 위한 조밀하거나 느슨한 의사결정 경계를 설정할 수 있음을 보여주었습니다.

## 📎 Related Works

- **일반적인 이상 감지**: 다른 분야에서는 novelty detection, outlier detection, event detection 등으로 불립니다.
- **로봇 공학의 이상 감지**: bin picking [7], bottle opening [8]과 같은 조작 작업의 실패 감지에 사용되었습니다.
- **고전적인 기계 학습 접근법**: SVM [9], [10], SOM [11], kNN [12] 등이 활용되었습니다. 시계열 신호에는 HMM [3], Kalman filter [13] 등이 사용되었습니다.
- **차원 축소의 한계**: PCA [9], [14]는 고차원 입력의 차원을 줄이는 데 사용되지만, 이상치(outlier)의 압축된 표현이 잠재 공간(latent space)에서는 정상 데이터(inlier)로 보일 수 있습니다.
- **재구성 기반 감지**: Autoencoder(AE) [15]는 고차원 입력을 압축하고 재구성하여 재구성 오류로 이상을 감지합니다. 슬라이딩 윈도우 방식으로 시계열 데이터를 처리하기도 하지만 [16], 인접 윈도우 간의 종속성을 표현하기 어렵습니다.
- **시계열 모델링**: LSTM [17]은 RNN의 한 종류로, 장기 종속성을 활용하고 vanishing gradient 문제를 피할 수 있습니다.
  - LSTM 기반 예측 오류 감지 (예: Malhorta et al.의 LSTM-AD [20])는 예측 불가능한 외부 변화에 취약할 수 있습니다.
  - RNN 및 LSTM 기반 오토인코더를 사용한 재구성 기반 이상 감지 (예: Malhorta et al.의 EncDec-AD [21])는 본 논문에서도 베이스라인으로 사용됩니다.
- **변분 오토인코더 (VAE)**: AE와 달리 베이즈 추론에 기반하여 관측 데이터의 기저 확률 분포를 모델링합니다 [24]. Sölch et al. [26]은 VAE를 이용해 로봇 이상을 단일 모달 신호로 감지하는 연구를 진행했습니다.

## 🛠️ Methodology

1. **LSTM-VAE 구조**:
   - 시간 의존성을 활용하기 위해 기존 VAE의 피드포워드 네트워크를 LSTM으로 대체합니다.
   - **인코더**: 시점 $t$의 다중 모달 입력 $x_t \in \mathbb{R}^D$를 받아 LSTM을 통과시킨 후, 두 개의 선형 모듈을 사용하여 잠재 변수 $z_t \in \mathbb{R}^K$의 평균 $\mu_{z_t}$와 공분산 $\Sigma_{z_t}$를 추정하여 $p(z_t|x_t)$를 근사합니다.
   - **디코더**: $p(z_t|x_t)$에서 샘플링된 $z_t$를 디코더의 LSTM에 입력하여 재구성된 분포의 평균 $\mu_{x_t}$와 공분산 $\Sigma_{x_t}$를 출력합니다.
2. **노이즈 제거 오토인코딩(Denoising Autoencoding)**:
   - LSTM-VAE에 노이즈 제거 오토인코딩 기준 [5]을 적용하여, 입력에 가우시안 노이즈 $\tilde{x} = x + \epsilon$ (여기서 $\epsilon \sim N(0, \sigma_{\text{noise}})$)를 추가합니다.
   - 정체 함수(identity function) 학습을 방지하고 표현 능력을 향상시키기 위해 노이즈 제거 변분 하한 $L_{\text{dvae}}$을 최대화하도록 학습합니다.
   - $$L_{\text{dvae}} = -D_{\text{KL}}(\tilde{q}_{\phi}(z_t|x_t)||p_{\theta}(z_t)) + E_{\tilde{q}_{\phi}(z_t|x_t)}[\log p_{\theta}(x_t|z_t)]$$
3. **진행 기반 사전 분포(Progress-based Prior)**:
   - 기존의 정적인 $N(0,1)$ 사전 분포 대신, 작업 실행의 진행도에 따라 중심 $\mu_p$가 선형적으로 변화하는 동적인 정규 분포 $N(\mu_p, \Sigma_p)$를 사용합니다 (여기서 $\Sigma_p = I$).
   - 이는 시계열 데이터의 시간 종속성을 기저 분포에 도입하여 VAE가 근사된 사후 분포와 사전 분포 간의 차이를 최소화하는 데 도움을 줍니다.
4. **이상 점수(Anomaly Score)**:
   - 관측값 $x_t$가 재구성된 분포 $N(\mu_{x_t}, \Sigma_{x_t})$에 대해 가질 음의 로그 우도(negative log-likelihood)로 정의됩니다.
   - $$f_s(x_t, \phi, \theta) = -\log p(x_t; \mu_{x_t}, \Sigma_{x_t})$$
   - 점수가 높을수록 현재 입력이 LSTM-VAE에 의해 잘 재구성되지 못했음을 의미하며, 이는 비정상적인 입력임을 나타냅니다.
5. **상태 기반 임계값(State-based Thresholding)**:
   - 작업 실행의 추정된 상태 $z$에 따라 변화하는 동적인 임계값 $\eta = \hat{f}_s(z) + c$을 사용합니다.
   - $\hat{f}_s: z \rightarrow s$는 비정상 데이터셋에서 추출된 잠재 공간 표현 $Z$와 해당 이상 점수 $S$를 사용하여 훈련된 SVR(Support Vector Regression) 모델입니다.
   - 상수 $c$는 감지기의 민감도를 조절합니다.
6. **학습 및 테스트 프레임워크**:
   - **학습**: 비정상 훈련/검증 데이터를 전처리(리샘플링, 정규화)한 후, $L_{\text{dvae}}$를 최대화하도록 LSTM-VAE를 훈련합니다. 검증 데이터에서 잠재 공간 표현과 이상 점수를 추출하여 SVR을 학습시켜 $\hat{f}_s$를 만듭니다.
   - **테스트**: 실시간으로 다중 모달 입력을 받아 전처리한 후, 잠재 변수와 재구성 분포 파라미터를 추정합니다. 현재 이상 점수가 $\hat{f}_s(z) + c$보다 높으면 이상으로 판단합니다.

## 📊 Results

- **데이터셋**: 24명의 참가자로부터 수집된 1,555회의 로봇 보조 급식 실행 데이터 (1,203회는 비정상, 352회는 이상 상황 포함). 12가지 대표적인 이상 유형이 포함되었습니다.
- **재구성 성능**:
  - 정상적인 실행에서는 관측된 특징과 재구성된 분포의 평균이 유사한 패턴을 보였습니다(Fig. 6a).
  - 이상 실행(예: 얼굴-숟가락 충돌)에서는 '누적 힘(accumulated force)' 재구성에서 큰 편차를 보였으며, 이는 이상 점수의 점진적인 증가로 이어졌습니다(Fig. 6b).
- **이상 점수의 유효성**: 비정상 실행의 이상 점수는 특정 패턴을 보이며 이상 실행의 점수보다 평균 및 분산이 작아 이상 상황을 쉽게 구별할 수 있음을 보여주었습니다(Fig. 7).
- **상태 기반 임계값의 효과**: 고정된 임계값보다 더 조밀한 의사결정 경계를 제공하여, 동일한 오탐율에서 더 높은 참탐율(true positive rate)을 달성했습니다 (AUC 향상, Fig. 8).
- **베이스라인 비교 (Table I)**:
  - **4가지 수작업 특징**: 제안된 LSTM-VAE (AUC 0.8564)는 HMM-GP (0.8121), AE (0.8123), EncDec-AD (0.7995)를 포함한 모든 베이스라인보다 높은 성능을 보였습니다.
  - **17가지 원시 센서 신호**: LSTM-VAE (AUC 0.8710)는 모든 베이스라인보다 가장 높은 성능을 보였습니다. 특히 HMM-GP는 고차원 입력으로 인해 학습에 실패했으며, EncDec-AD (0.8075)보다 0.064 높은 AUC를 달성했습니다.
  - 원시 센서 신호를 직접 사용했을 때의 성능이 수작업 특징보다 높아, 특징 엔지니어링 노력 없이 고차원 다중 모달 신호를 효과적으로 처리할 수 있음을 입증했습니다.

## 🧠 Insights & Discussion

- LSTM-VAE는 고차원적이고 이질적인 다중 모달 신호의 기저 분포와 시간 종속성을 성공적으로 모델링하며, 특징 엔지니어링에 대한 상당한 노력 없이도 이상 감지 작업을 수행합니다. 이는 로봇 보조 시스템 개발의 효율성을 높일 수 있습니다.
- 재구성 기반 이상 점수와 이를 활용한 온라인 감지 기능은 로봇 시스템의 실시간 안전 보장에 매우 유용합니다.
- 작업 진행도에 따라 사전 분포를 조절하는 '진행 기반 사전 분포'와 '노이즈 제거 오토인코딩' 기준은 모델의 학습 능력과 표현력을 향상시킵니다.
- '상태 기반 임계값'은 로봇 작업의 다양한 단계에서 발생할 수 있는 재구성 품질의 변화에 맞춰 의사결정 경계를 유연하게 조정함으로써, 오탐을 줄이고 이상 감지 민감도를 높이는 데 핵심적인 역할을 합니다.
- 본 연구 결과는 로봇이 다양한 센서 데이터를 종합적으로 이해하고 예기치 않은 상황에 대한 자율적인 인식 능력을 갖추는 데 중요한 진전을 제공합니다.

## 📌 TL;DR

본 논문은 로봇 보조 급식을 위한 LSTM-VAE 기반의 다중 모달 이상 감지기를 제안합니다. 이 감지기는 고차원적이고 이질적인 센서 신호들을 융합하여 기대 분포를 재구성하고, 재구성 오류 기반의 이상 점수와 작업 상태에 따라 동적으로 변하는 상태 기반 임계값을 사용하여 이상 상황을 감지합니다. 이 방법은 광범위한 이상 유형을 포함하는 데이터셋에서 기존 베이스라인 대비 0.8710의 높은 AUC를 달성했으며, 수작업 특징 엔지니어링 없이 원시 센서 신호를 직접 활용하여 탁월한 성능을 보여주었습니다. 이는 로봇 보조 시스템의 안전한 온라인 이상 감지를 위한 효과적인 솔루션을 제공합니다.
