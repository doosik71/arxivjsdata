# BBAM: Bounding Box Attribution Map for Weakly Supervised Semantic and Instance Segmentation

Jungbeom Lee, Jihun Yi, Chaehun Shin, Sungroh Yoon

## 🧩 Problem to Solve

픽셀 단위 분할 주석은 많은 노력과 비용이 필요합니다 (평균 2.8개 객체 이미지당 4분 소요). 약지도 학습 분할 방법은 경계 상자와 같은 덜 상세한 주석을 사용하지만, 기존의 경계 상자 기반 방법은 주로 이미지의 저수준 정보(예: GrabCut, MCG)에 의존하여 마스크 품질이 제한적이며, 추가적인 정교화 단계가 필요합니다. 또한 객체 탐지기가 학습한 고수준 의미론적 정보를 충분히 활용하지 못합니다. 본 논문의 목표는 경계 상자 주석으로부터 고품질의 픽셀 단위 마스크를 생성하여 약지도 의미론적 및 인스턴스 분할에 활용하는 것입니다.

## ✨ Key Contributions

- 객체 탐지기가 학습한 풍부한 의미론적 정보를 활용하여 의미론적 및 인스턴스 분할 네트워크 훈련을 위한 의사(pseudo) 정답을 생성하는 경계 상자 기여 맵(BBAM)을 제안합니다.
- PASCAL VOC 2012 및 MS COCO 2017 벤치마크에서 약지도 의미론적 및 인스턴스 분할 분야의 기존 최신 방법들을 크게 능가하는 성능을 달성했습니다.
- BBAM의 특성에 대한 심층적인 이해를 제공하기 위해 제안된 방법론을 다양한 관점에서 상세히 분석합니다.

## 📎 Related Works

- **클래스 레이블을 사용한 약지도 학습**: CAM(Class Activation Map)은 객체의 판별적인 영역을 식별하지만 전체 객체를 포괄하지 못하며, 인스턴스 분할에는 한계가 있습니다.
- **경계 상자를 사용한 약지도 학습**: 개별 객체 위치 정보를 제공하며 픽셀 단위 마스크보다 저렴하지만, 대부분의 기존 방법들은 MCG(Multiscale Combinatorial Grouping) 또는 GrabCut과 같은 저수준 마스크 제안 기법에 의존하여 경계 상자와 관련된 의미론적 정보를 충분히 활용하지 못합니다.
- **시각적 중요도 맵(Visual Saliency Map) 방법**: DNN(Deep Neural Network) 예측을 설명하는 방법들로, 대부분 분류기에 초점을 맞추었으며, 객체 탐지기와 같은 다른 작업에 대한 연구는 부족합니다. 기울기(gradient) 기반 방법들은 분류기와 객체 탐지기 간의 구조적 차이 때문에 객체 탐지기에 쉽게 확장되지 않습니다.

## 🛠️ Methodology

BBAM은 훈련된 객체 탐지기가 원본 이미지와 거의 동일한 예측을 생성하는 최소 이미지 영역을 식별합니다. 이 과정은 다음과 같습니다:

1. **객체 탐지기 재검토**: Faster R-CNN과 같은 2단계 객체 탐지기 (RPN, RoIAlign, 분류 헤드 $f_{cls}$, 경계 상자 회귀 헤드 $f_{box}$)를 기반으로 합니다.
2. **BBAM 생성**:
    - 변형 함수 $\Phi(I, M) = I \circ M + \mu \circ (1-M)$를 사용하여 이미지 $I$에 마스크 $M$을 적용합니다.
    - 다음 손실 함수를 최소화하여 최적의 마스크 $M^*$를 찾습니다:
        $$M^* = \text{argmin}_{M \in [0,1]^{\Omega}} \lambda ||M||_1 + L_{perturb}$$
        $$L_{perturb} = \mathbf{1}_{box} ||t_c - f_{box}(\Phi(I,M),o)||_1 + \mathbf{1}_{cls} ||p_c - f_{cls}(\Phi(I,M),o)||_1$$
        여기서 $t_c$는 원본 이미지의 박스 오프셋, $p_c$는 클래스 확률입니다.
    - **적응형 스트라이드**: 고정된 스트라이드 대신, 예측된 경계 상자 면적과 이미지 면적의 비율 $a$에 따라 $s(a) = 16 + 48\sqrt{a}$와 같은 적응형 스트라이드를 사용하여 다양한 객체 크기에 대응합니다.
3. **의사 정답 생성**:
    - 훈련된 객체 탐지기를 사용합니다.
    - 원본 경계 상자를 무작위로 미세 조정하여 객체 제안을 생성하고, 이 중 올바른 클래스를 예측하고 IoU(Intersection over Union)가 0.8보다 큰 '양성 제안'을 선택합니다.
    - 이러한 양성 제안들로부터 얻은 BBAM을 통합하여 단일 마스크를 생성합니다 (분류 헤드와 박스 헤드의 기여는 상호 보완적이므로 모두 사용).
    - 마스크 정교화: CRF(Conditional Random Fields)를 사용하여 마스크를 정교화하고, $\theta_{fg}$ (전경 임계값) 및 $\theta_{bg}$ (배경 임계값)를 사용하여 픽셀을 분류하며, MCG(Multiscale Combinatorial Grouping) 제안을 활용하여 마스크를 추가로 정교화합니다.
4. **분할 네트워크 훈련**:
    - **인스턴스 분할**: Mask R-CNN을 사용하며, 훈련 중 무시된 픽셀을 위해 시드 성장(seed growing) 기법을 적용합니다.
    - **의미론적 분할**: DeepLab-v2를 사용하며, 인스턴스 수준의 의사 레이블을 클래스 수준으로 변환합니다.

## 📊 Results

- **약지도 인스턴스 분할**:
  - PASCAL VOC 2012에서 기존 최신 경계 상자 기반 방법들보다 AP$_{50}$ 및 AP$_{70}$에서 6.0%p 높은 성능을 달성했습니다. 완전 지도 Mask R-CNN의 AP$_{50}$ 성능의 92.2%를 달성했습니다.
  - MS COCO 2017에서 기존 최고 성능 경계 상자 기반 방법 대비 AP$_{75}$에서 6.7%p 높은 성능을 달성했습니다.
- **약지도 의미론적 분할**:
  - PASCAL VOC 2012의 검증(val) 및 테스트(test) 이미지 모두에서 73.7%의 mIoU(mean Intersection-over-Union)를 기록하여, 이미지 수준 태그 또는 경계 상자를 사용하는 모든 방법 중 최신 최고 성능을 달성했습니다.
  - 네트워크 수정이나 추가 훈련 기법 없이 순수한 DeepLab-v2로 달성되었으며, 완전 지도 모델 대비 상대 성능에서 Box2Seg [34]보다 우수합니다 (BBAM은 96.7% 대 Box2Seg의 88.4%).
- **기여도 분석 (Ablation Study)**:
  - MCG 제안은 인스턴스 분할 성능을 향상시킵니다.
  - 박스 헤드와 분류 헤드를 함께 사용하는 것이 인스턴스 및 의미론적 분할 모두에서 가장 좋은 성능을 보입니다.
  - 매개변수 ($\theta_{fg}, \theta_{bg}, \lambda$)에 대한 민감도가 낮고 성능이 안정적입니다.

## 🧠 Insights & Discussion

- **BBAM의 특성**: BBAM은 객체의 경계와 판별적인 부분에서 높은 값을 나타내며, 객체 탐지에 유용한 정보를 제공합니다.
- **박스 및 분류 헤드의 상호 보완적 작동**: 박스 헤드의 기여는 주로 객체의 *경계* 근처에서, 분류 헤드의 기여는 주로 객체의 *내부*에서 나타납니다. 이는 각 헤드의 기여가 독특하고 상호 보완적임을 시사하며, 두 헤드를 함께 사용할 때 성능이 향상되는 이유를 설명합니다.
- **레이블 노이즈에 대한 견고성**: BBAM은 부정확한 경계 상자 좌표에 대해 기존 방법보다 더 견고한 성능을 보입니다.
- **적응형 스트라이드 $s(a)$의 효과**: 적응형 스트라이드는 고정된 스트라이드와 달리 다양한 객체 크기를 효과적으로 처리하여, 매우 작거나 큰 객체에서 발생하는 아티팩트를 방지합니다.
- **기울기 기반 방법과의 비교**: SimpleGrad와 같은 기울기 기반 기여 방법은 객체 탐지기에서 효과가 떨어지는 반면, BBAM의 교란 기반 접근 방식은 우수한 성능을 입증합니다.
- **의의**: BBAM은 저렴한 경계 상자 주석으로부터 고품질의 픽셀 수준 의사 정답을 제공하여 약지도 분할 분야의 최신 기술 수준을 향상시켰으며, 객체 탐지기가 학습한 의미론적 정보를 활용하는 강력한 방법을 보여줍니다.

## 📌 TL;DR

문제: 경계 상자 주석만을 사용하여 약지도 의미론적 및 인스턴스 분할을 위한 고품질 픽셀 단위 마스크를 생성하는 것입니다.
제안 방법: 훈련된 객체 탐지기의 예측을 보존하는 최소 이미지 영역을 찾는 BBAM(Bounding Box Attribution Map)을 제안합니다. 적응형 스트라이드를 사용하고 박스 헤드와 분류 헤드의 기여를 결합하여 견고한 의사 정답을 생성합니다.
주요 결과: PASCAL VOC 및 MS COCO 데이터셋에서 약지도 의미론적 및 인스턴스 분할 모두에서 최신 최고 성능을 달성하며, 기존 방법 대비 우수한 마스크 품질과 견고성을 입증했습니다.
