# Beyond Forward Shortcuts: Fully Convolutional Master-Slave Networks (MSNets) with Backward Skip Connections for Semantic Segmentation

Abrar H. Abdulnabi, Stefan Winkler, Gang Wang

## 🧩 Problem to Solve

기존의 심층 CNN(Convolutional Neural Network)과 FCN(Fully Convolutional Network)은 고해상도(위치 정보)를 가진 하위 계층의 특징을 상위 계층에서 재사용하기 위한 전방향 스킵 연결(forward skip connections)을 포함합니다. 이는 정보 손실을 완화하고 세부 사항 복구에 도움이 됩니다. 그러나 추론 과정에서 하위 계층은 상위 계층의 특징(문맥적 고수준 의미 정보)을 알지 못하며, 이는 하위 계층이 이후 계층을 위해 더 유익한 특징을 적응적으로 추출하는 데 방해가 됩니다. 즉, 하위 계층이 미리 문맥을 이해한다면, 더 정보적인 특징을 추출할 수 있을 것이라는 점에 착안하여, 네트워크가 하위 계층에서 특징을 추출할 때 이미 상위 계층의 정보를 인지하도록 하는 방법을 연구하는 것이 본 논문의 핵심 문제입니다.

## ✨ Key Contributions

- **후방향 스킵 연결(Backward Skip Connections) 제안**: 피드포워드 네트워크의 순환 루프 문제 없이 상위 계층의 특징을 하위 계층으로 직접 전달하는 새로운 후방향 스킵 연결의 개념을 제안했습니다.
- **마스터-슬레이브 네트워크 (Master-Slave Network, MSNet) 아키텍처 개발**: 후방향 스킵 연결을 구현하기 위해 두 개의 FCN-8s 기반 네트워크, 즉 최종 예측을 생성하는 '마스터' 네트워크와 마스터 네트워크에 후방향 스킵 연결을 제공하는 '슬레이브' 네트워크로 구성된 독창적인 완전 합성곱 모델을 설계했습니다.
- **전방향 스킵 연결 개선된 강한 베이스라인 제시**: 기존 FCN-8s 모델에 추가적인 전방향 스킵 연결을 추가하여 FCN-8s-F1 및 FCN-8s-F2와 같은 더 강력한 베이스라인을 구축했습니다.
- **후방향 스킵 연결의 효과 검증**: ADE20K, PASCAL-Context, PASCAL VOC 2011 데이터셋에서 후방향 스킵 연결의 도입이 하위 계층의 특징 추출에 고수준 특징이 중요하며, 전방향 스킵 연결과 상호 보완적임을 실험적으로 입증했습니다. 특히, 후방향 스킵 연결만 포함된 모델(MSNet-B1/B2)이 전방향 스킵 연결이 강화된 베이스라인(FCN-8s-F1/F2)보다 뛰어난 성능을 보이는 경우도 있음을 확인했습니다.
- **다른 문맥 모델링 방법론과의 상호 보완성 입증**: MSNet이 CRF(Conditional Random Fields)와 같은 후처리 기법과 결합될 때 추가적인 성능 향상을 가져와, 기존 프레임워크와 상호 보완적임을 보여주었습니다.

## 📎 Related Works

- **CNN의 스킵 연결 진화**:
  - **Highway Networks [33]**: 게이팅 유닛을 통해 흐름을 단축하여 매우 깊은 CNN 훈련을 용이하게 합니다.
  - **ResNets [17]**: 유사한 항등 매핑 연결을 통해 흐름을 단축하여 경쟁력 있는 결과를 보입니다.
  - **FCNs [26]**: 이미지 분할을 위해 다중 스케일 특징 맵을 통합하는 스킵 연결을 제안합니다.
  - **DenseNets [18, 20]**: 각 계층이 모든 이전 계층에 조밀하게 연결되는 매우 조밀한 전방향 스킵 연결을 제안합니다.
  - **Stochastic Depth [19], Swapout [32]**: 다양한 스타일의 스킵(짧거나 긴)을 제공하는 후속 연구들입니다.
  - **Wide ResNets [39, 34]**: 더 넓은 버전의 CNN에서 스킵을 제안합니다.
  - 본 논문은 이러한 모든 `전방향 스킵 연결`과는 다르게 `후방향 스킵 연결`을 제안합니다.
- **CNN과 문맥 모델링**:
  - **RNN/LSTM/GRU [43, 30]**: CNN 내부에 순환 계층을 쌓아 이미지 영역 간의 의존성을 인코딩하여 전역 문맥 정보를 로컬 표현으로 인코딩합니다.
  - **Atrous 및 Dilated Convolutions [38, 7]**: 컨볼루션 연산에 집중하여 문맥 모델링을 수행합니다.
  - **CRF/MRF [7, 42, 24]**: 분류 계층 위에 CRFs를 쌓아 라벨 간의 문맥적 의존성을 모델링하며, 일반적으로 후처리 단계로 사용됩니다.
  - 본 모델은 기존 FCN 구조를 개선하는 데 중점을 두며, 이러한 문맥 모델링 방법론들과 `상호 보완적`이라고 언급합니다.

## 🛠️ Methodology

본 논문은 생물학적 뇌의 시각 시스템에서 영감을 받아 FCN에 후방향 스킵 연결을 추가하는 Master-Slave Network (MSNet)를 제안합니다.

1. **베이스라인 모델 (FCN-8s 확장)**:

   - 기본 FCN-8s [26] 구조를 기반으로 합니다.
   - **FCN-8s-F1**: 각 합성곱 블록 내부에 하나의 스킵 연결($N=1$)을 추가합니다.
     $$ y_L = F(x_L) + W_L x_L $$
        여기서 $F(.)$는 합성곱 블록 함수이며, $W_L$은 특징 차원을 일치시키기 위한 합성곱 변환입니다.
   - **FCN-8s-F2**: 이전 블록들로부터 더 많은 스킵($N=3$)을 추가합니다.
     $$ y*L = F(x_L) + W_L x_L + W*{L-1} x*{L-1} + W*{L-2} x*{L-2} $$
     여기서 $W*{L-1}$ 및 $W_{L-2}$는 특징 맵 공간 차원을 일치시키기 위해 추가 풀링 계층과 함께 사용될 수 있습니다.

2. **마스터-슬레이브 네트워크 (MSNet) 설계**:
   - 순환 루프를 피하기 위해 두 개의 FCN-8s 네트워크(매개변수 비공유)를 사용합니다.
   - **슬레이브 네트워크**: 마스터 네트워크에 필요한 후방향 스킵 연결을 제공합니다. 슬레이브 네트워크 자체는 후방향 스킵 연결을 받지 않으며 예측은 무시됩니다.
   - **마스터 네트워크**: 최종 라벨 예측을 생성합니다. 슬레이브 네트워크의 상위 계층에서 마스터 네트워크의 하위 계층으로 후방향 스킵 연결을 받습니다.
   - **후방향 스킵 연결 공식**: 마스터 네트워크의 블록 $L$에 $P$개의 후방향 스킵 연결을 추가합니다.
     $$ y*{m_L} = F(x*{m*L} + \sum*{l=L}^{L+(P-1)} U*l y*{s*l}) $$
     여기서 $y*{m*L}$은 마스터 네트워크의 블록 $L$의 출력, $y*{s_l}$은 슬레이브 네트워크의 블록 $l$의 출력, $U_l$은 슬레이브 네트워크의 특징 맵에 적용되는 합성곱 변환입니다.
   - **통합 모델 (MSNet-FB1/FB2)**: 마스터 네트워크에 전방향 스킵 연결(FCN-8s-F1 또는 FCN-8s-F2)과 후방향 스킵 연결을 모두 통합합니다.
     $$ y*{m_L} = F(x*{m*L} + \sum*{l=L}^{L+(P-1)} U*l y*{s*l}) + \sum*{l=L-(N-1)}^{L} W*l x*{m_l} $$
        여기서 $W_l$과 $U_l$은 합성곱 변환입니다.
   - **훈련**: 마스터와 슬레이브 네트워크는 모두 유사한 손실을 최소화하도록 종단 간(end-to-end) 훈련됩니다 (교차 엔트로피 로그 손실). 슬레이브 네트워크에서 전방향 패스가 시작된 후, 후방향 스킵 연결에 도달하면 마스터 네트워크의 전파가 시작되는 방식으로 번갈아 가며 실행됩니다. 역방향 패스는 순서가 역전됩니다.

## 📊 Results

- **데이터셋**: ADE20K (150 클래스), PASCAL-Context (59 클래스), PASCAL VOC 2011 (21 클래스)에서 평가되었습니다.
- **평가 지표**: Pixel Accuracy (PA), Per-class Accuracy (CA), Intersection-Over-Union (IU).
- **후방향 스킵 연결의 효과**:
  - MSNet-B1은 FCN-8s 대비 IU 기준 ADE20K에서 3.5%, PASCAL-Context에서 2.6%, PASCAL VOC 2011에서 2.8% 성능 향상을 보였습니다.
  - MSNet-B2는 FCN-8s 대비 IU 기준 ADE20K에서 3.9%, PASCAL-Context에서 0.6%, PASCAL VOC 2011에서 3.1% 성능 향상을 보였습니다.
  - 이는 상위 계층의 특징이 하위 계층의 특징 추출 과정에서 중요하며, 고수준 문맥이 더 정보적인 하위 특징을 학습하는 데 도움을 줌을 시사합니다.
- **전방향 및 후방향 스킵 연결의 상호 보완성**:
  - MSNet-FB1은 FCN-8s-F1 대비 IU 기준 각각 1.1%, 1.4%, 1.7% 성능 향상을 보였습니다.
  - MSNet-FB2는 FCN-8s-F2 대비 IU 기준 각각 2.1%, 1.1%, 2.3% 성능 향상을 보였습니다.
  - 두 가지 스킵 연결 유형 모두 상호 보완적이며 중요함을 보여줍니다.
- **후방향 스킵 연결의 우수성**: 흥미롭게도 후방향 스킵 연결만 포함된 MSNet-B2는 모든 데이터셋에서 FCN-8s-F1 및 FCN-8s-F2를 능가했습니다. 이는 고수준 특징이 더 정보적인 하위 특징을 추출하는 데 실제로 유익함을 나타냅니다.
- **CRF와의 상호 보완성**: MSNet-FB1/FB2에 Fully-connected CRF를 후처리로 적용했을 때, IU 기준 최소 1.0% 이상의 추가적인 성능 향상을 보였습니다. 이는 제안된 방법이 다른 기존 프레임워크와 상호 보완적임을 입증합니다.
- **정성적 결과**: Figure 5에서 볼 수 있듯이, MSNet 모델은 베이스라인 모델에 비해 라벨 예측 품질을 크게 향상시켰습니다.

## 🧠 Insights & Discussion

- **고수준 문맥의 중요성**: 본 연구는 심층 CNN에서 하위 계층이 상위 계층의 문맥적 정보에 미리 접근하는 것이 특징 추출 효율성을 극대화하는 데 결정적인 역할을 함을 명확히 보여줍니다. 이는 생물학적 뇌의 피드백 연결과 유사한 메커니즘이 인공 신경망에서도 유효함을 시사합니다.
- **네트워크 디자인의 유연성**: 마스터-슬레이브 아키텍처는 기존 피드포워드 네트워크의 구조를 크게 변경하지 않고도 후방향 연결이라는 새로운 유형의 정보 흐름을 안전하게 통합할 수 있는 실용적인 방법을 제공합니다.
- **상호 보완적인 스킵 연결**: 전방향 스킵 연결(해상도 복구, 정보 손실 완화)과 후방향 스킵 연결(고수준 문맥 주입, 특징 추출 최적화)이 서로 다른 이점을 제공하며 함께 사용될 때 시너지 효과를 낼 수 있음을 확인했습니다. 이는 네트워크 설계 시 다양한 정보 흐름 유형을 고려해야 함을 의미합니다.
- **제한 사항**: VGG 기반 네트워크를 사용했으며, 배치 정규화(Batch Normalization)나 추가 학습 데이터(MS COCO 등)를 사용하지 않았습니다. 더 깊은 ResNet이나 Dilated convolutions를 사용하는 최신 방법론들과 직접적인 비교는 제한적일 수 있으나, 제안된 후방향 스킵 기법은 이러한 고급 모델에도 적용되어 성능을 향상시킬 수 있는 잠재력을 가집니다.
- **모델 복잡도 및 훈련 데이터**: MSNet-FB2가 PASCAL Context에서 MSNet-FB1보다 성능이 낮은 경우가 있었는데, 이는 MSNet-FB2의 복잡성(더 조밀한 연결)이 훈련 데이터의 양에 따라 일반화 능력에 영향을 미칠 수 있음을 시사합니다. 데이터셋의 크기가 클수록 (예: ADE20K), 더 복잡한 모델이 더 잘 수행됩니다.

## 📌 TL;DR

본 논문은 시맨틱 분할(semantic segmentation)을 위해 기존 CNN의 한계, 즉 하위 계층이 특징 추출 시 상위 계층의 문맥 정보를 알지 못하는 문제를 해결합니다. 이를 위해 **후방향 스킵 연결(backward skip connections)** 개념을 제안하고, 이를 구현하기 위해 **마스터-슬레이브 네트워크(MSNet)**라는 새로운 아키텍처를 개발했습니다. 마스터 네트워크는 최종 예측을 생성하고, 슬레이브 네트워크는 순환 루프 없이 마스터의 하위 계층에 고수준 문맥 정보를 제공합니다. 실험 결과, 후방향 스킵 연결은 하위 계층이 더 유익한 특징을 추출하도록 돕고, 기존의 전방향 스킵 연결과 상호 보완적으로 작용하여 ADE20K, PASCAL-Context, PASCAL VOC 2011 데이터셋에서 베이스라인 모델보다 상당한 성능 향상을 달성했습니다. 이는 뇌의 피드백 연결에서 영감을 얻은 새로운 정보 흐름 방식이 심층 학습 모델의 성능을 향상시킬 수 있음을 보여줍니다.
