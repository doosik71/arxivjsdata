# Visual Tracking을 위한 Multi-Domain Convolutional Neural Networks 학습

Hyeonseob Nam, Bohyung Han

## 🧩 Problem to Solve

기존 Convolutional Neural Network (CNN) 기반 시각 추적(visual tracking) 알고리즘은 다음과 같은 한계를 가지고 있습니다:

- 대규모의 추적 전용 학습 데이터셋 확보의 어려움.
- ImageNet과 같은 대규모 분류 데이터셋으로 사전 학습된 CNN을 사용하더라도, 분류(객체 클래스 예측)와 추적(임의의 클래스 대상 위치 파악) 문제 간의 근본적인 불일치로 인해 추적 성능이 제한적임.
- 서로 다른 비디오 시퀀스들은 대상의 클래스, 움직임, 외형, 배경 특성이 모두 다르며, 폐색(occlusion), 변형, 조명 변화, 모션 블러 등 시퀀스별 특수한 도전 과제를 포함하여 통합된 표현 학습이 어려움.
- 일반적인 분류 태스크 기반의 학습 방법은 이러한 시퀀스 간의 변이 및 불일치를 포착하는 데 부적합하며, 시퀀스 독립적인 정보(domain-independent information)를 효과적으로 학습하는 방법이 필요합니다.

## ✨ Key Contributions

- **멀티 도메인 학습(Multi-Domain Learning) 프레임워크 제안**: CNN 기반의 멀티 도메인 학습 프레임워크인 MDNet을 제안하여, 도메인 독립적인 정보와 도메인 특화된 정보를 분리하고 공유 표현(shared representations)을 효과적으로 캡처합니다.
- **시각 추적에 성공적인 적용**: 멀티 도메인 학습으로 사전 학습된 CNN이 새로운 시퀀스(도메인)에 적응하기 위해 온라인으로 업데이트되는 추적 프레임워크를 개발하여, 도메인 특화된 정보를 적응적으로 학습합니다.
- **뛰어난 성능 입증**: 두 개의 공개 추적 벤치마크(Object Tracking Benchmark 및 VOT2014)에서 최신 기술 대비 탁월한 성능을 시연합니다.

## 📎 Related Works

- **시각 추적 알고리즘**:
  - **생성(Generative) 방식**: 대상 외형을 생성 모델로 기술하고 모델에 가장 잘 맞는 영역을 탐색 (예: 희소 표현, 밀도 추정, 점진적 부분 공간 학습).
  - **판별(Discriminative) 방식**: 대상 객체와 배경을 구별하는 모델 학습 (예: 다중 인스턴스 학습, P-N 학습, 온라인 부스팅, 구조화된 출력 SVM).
  - **상관 필터(Correlation Filters)**: MOSSE, KCF, DSST, MUSTer 등. 계산 효율성과 경쟁력 있는 성능을 보이지만, 저수준의 수작업 특징(hand-crafted features)에 의존하여 조명 변화, 폐색, 변형 등 동적 상황에 취약합니다.
- **CNN 기반 시각 추적**: 초기의 CNN 기반 추적 알고리즘은 미리 정의된 대상 클래스만 처리 가능하거나, 데이터 부족으로 깊은 네트워크 학습에 어려움이 있었습니다. ImageNet으로 사전 학습된 CNN을 전이하는 방식은 분류와 추적 태스크 간의 근본적인 차이로 인해 효과가 제한적이었습니다 (예: CNN-SVM).
- **멀티 도메인 학습**: 자연어 처리 분야에서 활발하며, 컴퓨터 비전에서는 도메인 적응(domain adaptation) 접근 방식에서 논의됩니다. 이 논문은 대규모 시각 추적 데이터를 활용하여 CNN을 사전 학습하는 멀티 도메인 학습 방식을 채택합니다.

## 🛠️ Methodology

### 3. Multi-Domain Network (MDNet)

1. **네트워크 아키텍처**:

   - 입력: $107 \times 107$ RGB 이미지.
   - 구성: 3개의 컨볼루션 계층(conv1-3), 2개의 완전 연결 계층(fc4-5)으로 구성된 **공유 계층(shared layers)**, 그리고 $K$개의 도메인(훈련 시퀀스)에 해당하는 $K$개의 **도메인 특화 계층(domain-specific layers)** (fc6$_1$ - fc6$_K$)으로 이루어져 있습니다.
   - conv 계층은 VGG-M 네트워크를 기반으로 하며, fc4-5는 각각 512개의 출력 유닛을 가집니다.
   - 각 fc6$_k$ 브랜치는 해당 도메인에서 대상과 배경을 이진 분류하는 역할을 하며, 소프트맥스 교차 엔트로피 손실을 사용합니다.
   - AlexNet, VGG-Net과 같은 일반적인 인식 태스크 네트워크보다 작은 아키텍처를 사용하여 추적에 더 적합하도록 설계되었습니다 (낮은 복잡도, 공간 정보 보존, 작은 대상 처리, 효율성).

2. **학습 알고리즘**:
   - 목표: 임의의 도메인에서 대상과 배경을 구별하는 멀티 도메인 CNN을 학습합니다.
   - 학습 과정: SGD(Stochastic Gradient Descent) 방식을 사용하며, 각 반복(iteration)에서 하나의 도메인만 처리합니다. $k$번째 반복에서는 $(k \text{ mod } K)$번째 시퀀스에서 추출된 미니배치를 사용하여 네트워크를 업데이트하며, 해당 도메인의 fc6 브랜치만 활성화됩니다.
   - 이 과정을 통해 도메인 독립적인 정보는 공유 계층에, 도메인 특화 정보는 각 브랜치에 모델링되어 유용한 일반 특징 표현을 얻습니다.

### 4. Online Tracking using MDNet

사전 학습이 완료되면, 테스트 시퀀스에 대해 기존의 $K$개 도메인 특화 계층(fc6$_1$ - fc6$_K$)을 제거하고 새로운 단일 fc6 브랜치를 구성합니다. 그리고 이 새로운 fc6 계층과 공유 네트워크 내의 완전 연결 계층(fc4-5)을 온라인으로 미세 조정(fine-tune)합니다.

1. **추적 제어 및 네트워크 업데이트**:

   - **강건성(Robustness)** 및 **적응성(Adaptiveness)**을 위해 장기(long-term) 및 단기(short-term) 업데이트를 수행합니다.
   - **장기 업데이트**: 주기적인 간격으로 장기간 수집된 긍정 샘플을 사용하여 수행됩니다.
   - **단기 업데이트**: 잠재적인 추적 실패(추정된 대상이 배경으로 분류될 때) 감지 시 단기간의 긍정 샘플을 사용하여 수행됩니다.
   - 음성 샘플은 항상 단기간에 관찰된 것을 사용합니다.
   - 대상 상태 추정: 이전 대상 상태 주변에서 $N$개의 후보 $x_1, ..., x_N$을 샘플링하고 네트워크의 긍정 점수 $f^+(x_i)$와 음성 점수 $f^-(x_i)$를 평가하여 최대 긍정 점수를 갖는 예시를 최적 대상 상태 $x^* = \text{argmax}_{x_i} f^+(x_i)$로 결정합니다.

2. **하드 미니배치 마이닝(Hard Minibatch Mining)**:

   - 추적-탐지(tracking-by-detection) 방식에서 대부분의 음성 예시는 사소하거나 중복되므로, 분류기 학습에 효과적인 방해되는 음성 샘플만 중요합니다.
   - 각 학습 반복에서 미니배치는 $M^+$개의 긍정 샘플과 $M^-_h$개의 하드 음성 샘플로 구성됩니다.
   - 하드 음성 예시는 $M^-$개의 음성 샘플을 테스트하여 가장 높은 긍정 점수를 가진 상위 $M^-_h$개를 선택하여 식별됩니다.

3. **바운딩 박스 회귀(Bounding Box Regression)**:

   - CNN 특징의 높은 수준의 추상화와 데이터 증강 전략으로 인해 네트워크가 때때로 대상을 정확하게 둘러싸는 바운딩 박스를 찾지 못할 수 있습니다.
   - 대상 위치의 정확도를 높이기 위해 객체 탐지에서 사용되는 바운딩 박스 회귀 기술을 적용합니다.
   - 테스트 시퀀스의 첫 프레임에서만 학습되며, 이후 프레임에서는 $f^+(x^*) > 0.5$일 경우 추정된 대상 위치를 조정합니다.

4. **구현 세부 사항**:
   - 사전 학습된 CNN 필터 중 conv 계층 $w_{1:3}$은 고정하고, 완전 연결 계층 $w_{4:6}$만 온라인으로 업데이트합니다. 이는 계산 효율성을 높이고 과적합을 방지하며 도메인 독립 정보를 보존하는 데 도움이 됩니다.
   - 후보 생성: 이전 대상 상태를 중심으로 가우시안 분포에서 $N=256$개의 샘플을 생성합니다.
   - 학습 데이터: 오프라인 학습 시 각 프레임에서 50개의 긍정 및 200개의 음성 샘플($IoU \ge 0.7$, $\le 0.5$)을 수집합니다. 온라인 학습 시 50개의 긍정 및 200개의 음성 샘플($IoU \ge 0.7$, $\le 0.3$)을 수집합니다.
   - 학습률, 모멘텀, 가중치 감소 등의 파라미터는 실험적으로 설정됩니다. 미니배치는 32개의 긍정 샘플과 1024개의 음성 샘플 중 선택된 96개의 하드 음성 샘플로 구성됩니다.

## 📊 Results

- **OTB 벤치마크**:
  - MDNet은 OTB50 및 OTB100 벤치마크에서 기존 최첨단 추적기(MUSTer, CNN-SVM, MEEM, DSST, KCF 등)를 정밀도 및 성공률 모두에서 현저히 능가합니다.
  - 특히, MDNet은 '빠른 움직임', '배경 혼란', '조명 변화', '평면 내 회전', '저해상도', '폐색', '시야 이탈', '크기 변화' 등 다양한 도전적인 상황에서 효과적으로 대상을 추적하며, 특히 저해상도 환경에서 다른 저수준 특징 기반 추적기들을 압도합니다.
- **VOT2014 데이터셋**:
  - MDNet은 정확도(accuracy)와 강건성(robustness) 모두에서 전반적으로 최고의 순위를 차지했습니다. 정확도에서 1위, 강건성에서 1위 또는 2위를 기록했습니다.
  - 적은 재초기화(re-initialization) 횟수에도 불구하고 훨씬 나은 정확도를 보여줍니다.
  - 'region_noise' 실험(정확하지 않은 재초기화)에서도 잘 작동하여 재탐지 모듈과의 효과적인 결합 가능성을 시사합니다.
- **구성 요소 분석(Ablation Study)**: 멀티 도메인 사전 학습, 바운딩 박스 회귀, 하드 음성 마이닝 각각이 MDNet의 성능 향상에 기여함을 입증했습니다. (MDNet > MDNet-BB > SDNet > MDNet-BB-HM 순으로 성능 우수)
- **속도**: NVIDIA Tesla K20m GPU를 사용하여 약 1 fps의 속도를 보입니다.
- **실패 사례**: 미미한 대상 외형 변화(Coupon 시퀀스) 또는 극적인 외형 변화(Jump 시퀀스)에서 추적 실패가 관찰되었습니다.

## 🧠 Insights & Discussion

- **CNN의 추적 효율성 극대화**: 이 연구는 대규모 분류 데이터셋에서 사전 학습된 CNN을 직접 사용하는 것의 한계를 명확히 하고, 추적 태스크에 특화된 방식으로 CNN을 효과적으로 활용하는 새로운 방법을 제시했습니다.
- **도메인 분리와 통합의 중요성**: 멀티 도메인 학습 프레임워크를 통해 비디오 시퀀스 간의 다양한 특성(도메인 특화 정보)과 모든 시퀀스에 공통적으로 적용될 수 있는 정보(도메인 독립 정보)를 효과적으로 분리하고 학습할 수 있음을 보여주었습니다. 이는 강건하고 일반화된 대상 표현 학습에 필수적입니다.
- **온라인 적응 능력**: 사전 학습된 일반적인 표현에 온라인 학습을 통해 새로운 시퀀스의 특정 조건에 적응하는 능력을 결합함으로써, 추적 과정 중 발생하는 대상 외형 변화에 효과적으로 대처합니다.
- **효율적인 모델 설계**: ImageNet 분류 모델보다 훨씬 작은 CNN 아키텍처를 사용하여 추적 문제의 특성(적은 클래스, 작은 대상, 실시간 요구)에 더 적합하고 효율적인 솔루션을 제공합니다.
- **한계**: 여전히 급격한 대상 외형 변화나 예측하기 어려운 드리프트(drift) 현상에 취약한 부분이 존재하며, 이는 향후 연구에서 보완해야 할 과제로 남습니다.

## 📌 TL;DR

이 논문은 시각 추적을 위한 **MDNet(Multi-Domain Network)**이라는 새로운 CNN 기반 알고리즘을 제안합니다. 주요 문제는 기존 CNN이 분류용으로 사전 학습되어 추적 문제에 직접 적용하기 어렵고, 추적 데이터의 부족 및 시퀀스별 도메인 차이로 인해 일반화된 특징 학습이 어렵다는 점입니다. 이를 해결하기 위해, MDNet은 공유 계층과 다수의 도메인 특화 계층으로 구성되어, 여러 비디오 시퀀스를 개별 도메인으로 간주하여 반복적으로 사전 학습됩니다. 추적 시에는 사전 학습된 공유 계층에 새로운 도메인 특화 계층을 추가하고, 이를 온라인으로 미세 조정하며 하드 음성 마이닝과 바운딩 박스 회귀를 통해 정교한 추적을 수행합니다. 결과적으로 MDNet은 OTB 및 VOT2014 벤치마크에서 최첨단 성능을 뛰어넘어, 다양한 도전적인 시나리오에서도 강건하고 정확한 추적 능력을 입증했습니다.
