# Learning What Not to Segment: A New Perspective on Few-Shot Segmentation

Chunbo Lang, Gong Cheng, Binfei Tu, Junwei Han

## 🧩 Problem to Solve

기존 Few-Shot Segmentation (FSS) 모델들은 메타 학습 프레임워크를 사용하지만, 이는 학습된(seen) 클래스에 대한 **편향(bias)을 유발하여** 모델이 이상적으로 **클래스에 구애받지 않는(class-agnostic) 상태를 방해**합니다. 이로 인해 **새로운 개념(novel concepts)을 인식하는 데 어려움**이 발생하며, 특히 쿼리 샘플이 기본 클래스와 유사한 카테고리를 공유할 때 일반화 성능이 저하될 수 있습니다.

## ✨ Key Contributions

* 쿼리 이미지에서 기본 클래스 영역을 명시적으로 예측하는 추가 브랜치(base learner)를 도입하여 FSS 모델의 **기존 클래스 편향 문제를 해결하는 간단하지만 효율적인 프레임워크를 제안**했습니다.
* 메타 학습자의 민감도로 인해 발생하는 부정적인 영향을 완화하기 위해 **쿼리-지원 이미지 쌍 간의 장면 차이를 그램(Gram) 행렬을 통해 추정**하는 방법을 제안했습니다.
* 두 개의 단순한 학습자(plain learners)만으로도 모든 FSS 벤치마크 설정에서 **새로운 최첨단(state-of-the-art) 성능을 달성**했습니다.
* 기본 클래스와 새로운 클래스의 대상을 동시에 식별해야 하는 보다 도전적인 설정인 **일반화된 FSS(generalized FSS)로 제안하는 접근 방식을 확장**하여 강력한 기준선을 제시했습니다.

## 📎 Related Works

* **의미론적 분할 (Semantic Segmentation):** FCN [35] 기반의 발전이 있었으며, Dilated Convolution [63], 인코더-디코더 구조 [45], 다단계 특징 집계 [26], 어텐션 메커니즘 [18] 등의 기술이 사용되었습니다. 본 연구에서는 메타 학습자에 ASPP [4]를, 기본 학습자에 PSPNet [68]을 도입했습니다.
* **소수샷 학습 (Few-Shot Learning, FSL):** 메타 학습 프레임워크 [54]가 주로 사용되며, 이는 (i) 거리 기반(metric-based) [24, 49, 50], (ii) 최적화 기반(optimization-based) [11, 19, 42], (iii) 증강 기반(augmentation-based) [5, 6]으로 나뉩니다. 본 연구는 거리 기반 접근 방식과 밀접하게 관련되어 있습니다.
* **소수샷 분할 (Few-Shot Segmentation, FSS):** 지원(support) 브랜치와 쿼리(query) 브랜치의 두 가지 구조가 일반적으로 사용됩니다. 선구적인 연구로는 OSLSM [46]이 있으며, 마스크 평균 풀링(Masked Average Pooling, MAP) [67]이 이후 작업의 기반이 되었습니다. CANet [66], PFENet [51] 등 최근 연구들은 고정된 백본 네트워크 위에 강력한 블록을 구축하는 데 중점을 두었지만, 본 연구는 일반화 성능 저하 문제 자체를 해결하는 데 집중합니다.

## 🛠️ Methodology

제안하는 BAM 모델은 두 개의 상호보완적인 학습자(기본 학습자, 메타 학습자)와 앙상블 모듈로 구성됩니다. 두 학습자는 인코더를 공유하며, 훈련은 **두 단계(사전 훈련 및 메타 훈련)**로 진행됩니다.

* **기본 학습자 (Base Learner):**
  * **목표:** 쿼리 이미지 내 기본 클래스(base classes) 영역을 명시적으로 예측합니다.
  * **작동 방식:** 쿼리 이미지 $x_{q}$에서 공유 인코더 $E$와 컨볼루션 블록 $F_{conv}$를 통해 중간 특징 맵 $f_{q}^{b}$를 추출합니다. 이후 디코더 $D_{b}$를 통해 확률 맵 $p_{b}$를 생성합니다.
  * **학습:** 표준 지도 학습 패러다임을 따르며, 크로스 엔트로피(Cross Entropy, CE) 손실 $L_{base}$를 사용하여 훈련합니다.
  * **특징:** 메타 학습자의 일반화를 위해 백본 네트워크의 파라미터를 고정하는 반면, 기본 학습자는 파라미터를 업데이트해야 하므로, 두 학습자를 동시에 학습하기 어렵다는 문제 때문에 **2단계 학습 전략**을 채택합니다.

* **메타 학습자 (Meta Learner):**
  * **목표:** 지원 세트 $S = \{(x_{s}, m_{s})\}$의 안내에 따라 쿼리 이미지 $x_{q}$에서 지원 이미지와 동일한 카테고리의 객체를 분할합니다.
  * **작동 방식:** 지원 이미지 $x_{s}$와 쿼리 이미지 $x_{q}$에서 공유 인코더 $E$를 통해 중간 특징 맵 $f_{s}^{m}$, $f_{q}^{m}$을 추출합니다. $f_{s}^{m}$과 $m_{s}$를 바탕으로 마스크 평균 풀링(Masked Average Pooling, MAP) [67]을 통해 프로토타입 $v_{s}$를 계산합니다. 이후 $v_{s}$와 $f_{q}^{m}$를 사용하는 안내 모듈 $F_{guidance}$와 디코더 $D_{m}$를 통해 최종 예측 $p_{m}$을 생성합니다.
  * **학습:** 에피소드(episodic) 학습 방식으로, 이진 교차 엔트로피(Binary Cross Entropy, BCE) 손실 $L_{meta}$를 사용하여 훈련합니다.

* **앙상블 모듈 (Ensemble Module):**
  * **목표:** 두 학습자(기본 학습자, 메타 학습자)의 예측 결과를 통합하여, 기본 클래스의 잘못 활성화된 영역을 억제하고 정확한 분할 예측을 생성합니다.
  * **배경 예측:** 기본 학습자의 전경 확률 맵 $p_{f}^{b} = \sum_{i=1}^{N_{b}} p_{i}^{b}$를 통합하여 소수샷 작업에 대한 배경 영역 예측을 얻습니다.
  * **조정 인자 $\psi$:** 지원 이미지와 쿼리 이미지의 저수준 특징($f_{s}^{low}$, $f_{q}^{low}$)에서 그램(Gram) 행렬을 계산한 후, 이들의 차이에 대한 프로베니우스 노름(Frobenius norm) $\left\|G_{s} - G_{q}\right\|_{F}$을 통해 전반적인 지표 $\psi$를 얻습니다. 이 인자는 장면 간의 차이를 평가합니다.
  * **통합 과정:** 메타 학습자의 예측 $p_{m}$과 기본 학습자의 예측 $p_{b}$가 조정 인자 $\psi$의 안내에 따라 통합됩니다. $p_{0}^{f} = F_{ensemble}(F_{\psi}(p_{0}^{m}), p_{f}^{b})$ 및 $p_{f} = p_{0}^{f} \oplus F_{\psi}(p_{1}^{m})$ 공식을 통해 최종 분할 예측 $p_{f}$를 생성합니다. 여기서 $F_{\psi}$는 메타 학습자의 결과를 조정하고, $F_{ensemble}$은 두 학습자를 통합하며, $\oplus$는 채널 차원에서의 연결(concatenation)을 의미합니다.
  * **전체 손실:** 메타 훈련 단계의 전체 손실은 $L = L_{final} + \lambda L_{meta}$로 계산됩니다.

* **K-샷 설정 (K-Shot Setting):**
  * 일반적인 K-샷 설정에서 지원 이미지의 프로토타입을 평균화하는 방식은 각 샘플의 기여도가 동일하다고 가정하여 최적이 아닐 수 있습니다.
  * **제안 방식:** 각 지원 샘플의 조정 인자 $\psi_{i}$를 기반으로 퓨전 가중치 $\eta$를 적응적으로 추정합니다. $\psi_{i}$ 값이 작을수록 기여도가 크다고 판단하여 가중치를 부여합니다.

* **일반화된 FSS 확장 (Extension to Generalized FSS):**
  * **목표:** 쿼리 이미지 내 기본 클래스와 새로운 클래스 픽셀을 모두 결정합니다.
  * **방법:** 학습 가능한 파라미터 없이, 기본 학습자의 결과 $\hat{m}_{b}$와 앙상블 후의 최종 결과 $p_{f}$를 미리 정의된 임계값 $\tau$ (예: 0.9)에 따라 간단히 병합하여 전체 분할 예측 $\hat{m}_{g}$를 생성합니다.

## 📊 Results

* **정량적 결과:**
  * PASCAL-5${}_{i}$ 및 COCO-20${}_{i}$ 벤치마크에서 제안하는 BAM 모델은 모든 설정에서 기존의 최첨단 FSS 모델들을 상당한 마진으로 능가하며 새로운 최고 성능(state-of-the-art)을 달성했습니다.
  * VGG16 백본을 사용한 PASCAL-5${}_{i}$에서 1-샷 시 4.71%p, 5-샷 시 4.66%p의 평균 IoU(mIoU) 개선을 보였습니다.
  * ResNet50 백본을 사용한 COCO-20${}_{i}$에서는 1-샷 시 7.03%p, 5-샷 시 4.26%p mIoU 개선을 보여, 복잡한 태스크 처리 능력을 입증했습니다.
  * PASCAL-5${}_{i}$에서 전경-배경 IoU(FB-IoU) 측면에서도 상당한 개선을 이루었습니다.
* **정성적 결과:**
  * 시각화된 결과(그림 4)를 통해, 제안하는 BAM은 기존의 베이스라인 방법에 비해 기본 클래스의 잘못 활성화된(falsely activated) 객체(방해물)를 현저히 억제하여, 기본 학습자 및 앙상블 모듈의 효과를 입증했습니다.

## 🧠 Insights & Discussion

* **편향 문제 완화:** 제안하는 방식의 핵심 아이디어는 기본 학습자를 활용하여 쿼리 이미지 내의 혼동될 수 있는(기본) 영역을 식별하고, 이를 통해 메타 학습자의 예측을 정제하는 것입니다.
* **효율성:** 두 개의 "단순한(plain)" 학습자를 사용했음에도 불구하고, FSS 벤치마크에서 새로운 최첨단 성능을 달성했다는 점은 이 방식의 효율성과 잠재력을 보여줍니다.
* **학습 전략의 중요성:** 기본 학습자의 사전 훈련과 메타 학습자 및 앙상블 모듈의 공동 메타 훈련으로 구성된 **2단계 학습 전략이 더 나은 성능**을 보였습니다. 이는 일반화를 위해 백본 파라미터를 고정하려는 메타 학습자와 판별적 특징 추출을 위해 파라미터를 업데이트하려는 기본 학습자 간의 균형을 엔드-투-엔드 학습에서 맞추기 어렵기 때문입니다.
* **앙상블 모듈의 역할:** 앙상블 모듈의 초기 가중치 설정(메타 학습자 1, 기본 학습자 0)이 성능에 큰 영향을 미쳤으며, **장면 차이를 추정하는 조정 인자 $\psi$가 모델 앙상블 예측에 필수적**임을 확인했습니다.
* **K-샷 퓨전 개선:** 조정 인자 $\psi$에 기반한 적응형 지원 샘플 가중치 조정은 K-샷 설정에서 성능 향상을 가져왔으며, 이미지 간의 차이를 측정하는 것이 FSS 작업에 중요함을 시사합니다.
* **강건성:** 픽셀 단위 주석 대신 경계 상자 주석을 사용한 지원 이미지로도 경쟁력 있는 결과를 도출하여, 제안하는 방식의 **강력한 강건성(robustness)**을 보여주었습니다.
* **일반화된 FSS:** 앙상블 모듈은 단순히 새로운 클래스뿐만 아니라 새로운 클래스와 기본 클래스 모두에 걸쳐 분할 모델의 성능을 향상시켰습니다.

## 📌 TL;DR

Few-Shot Segmentation (FSS) 모델이 학습된(base) 클래스에 편향되어 새로운 개념 인식에 어려움을 겪는 문제를 해결하기 위해, 본 논문은 **"무엇을 분할하지 않을 것인가"**에 대한 새로운 관점을 제시합니다. 기존 메타 학습자 외에 **기본 클래스 영역(분할할 필요 없는 영역)을 명시적으로 식별하는 추가 브랜치(기본 학습자)를 도입**합니다. 두 학습자의 초기 예측은 **장면 차이를 반영하는 조정 인자($\psi$)에 의해 안내되는 적응형 앙상블 모듈을 통해 통합**됩니다. 이 간단하지만 효과적인 접근 방식은 PASCAL-5${}_{i}$ 및 COCO-20${}_{i}$ 벤치마크에서 새로운 최첨단 성능을 달성했으며, 일반화된 FSS 설정에도 성공적으로 확장되었습니다.
