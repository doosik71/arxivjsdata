# DDANet: Dual Decoder Attention Network for Automatic Polyp Segmentation
Nikhil Kumar Tomar, Debesh Jha, Sharib Ali, Håvard D. Johansen, Dag Johansen, Michael A. Riegler, and Pål Halvorsen

## 🧩 Problem to Solve
결장경 검사는 대장 용종을 감지하는 표준 방법이지만, 용종의 크기, 모양, 질감의 다양성과 노이즈로 인해 자동 용종 분할은 어렵습니다. 수동 라벨링은 시간이 많이 걸리고 오류(병변 누락 등) 발생 가능성이 있어, 자동화되고 정확하며 빠른 분할 시스템이 임상 진단 및 치료 계획에 필수적입니다. 이 연구는 Endotect 챌린지에서 미공개 데이터셋에 대한 용종 분할 성능을 벤치마킹하는 것을 목표로 합니다.

## ✨ Key Contributions
*   자동 용종 분할을 위한 이중 디코더 어텐션 네트워크(DDANet)라는 새로운 딥러닝 아키텍처를 제안했습니다.
*   단일 인코더를 공유하는 두 개의 병렬 디코더를 사용합니다. 첫 번째 디코더는 분할 네트워크 역할을 하고, 두 번째 디코더는 오토인코더 네트워크 역할을 합니다.
*   오토인코더 네트워크는 보조 작업 훈련을 통해 인코더 네트워크의 특징 맵을 강화하고 어텐션 맵을 생성하는 데 사용됩니다.
*   생성된 어텐션 맵은 각 디코더에서 특징 맵의 의미론적 표현을 개선하여 네트워크의 전체 성능을 향상시키는 데 활용됩니다.
*   미공개 데이터셋에서 0.7874의 Dice 계수와 0.7010의 mIoU를 달성하며 우수한 일반화 능력을 입증했습니다. 또한 70.23 FPS의 효율적인 처리 속도를 보여줍니다.

## 📎 Related Works
이 논문은 자동 용종 분할을 위한 기존의 여러 컴퓨터 비전 문제 해결 노력 및 벤치마킹 대회를 언급합니다. 특히, 다음과 같은 인코더-디코더 기반 네트워크들과 차별점을 제시합니다:
*   U-Net [14]
*   ResUNet++ [13]
*   DoubleUNet [11]
또한, Endotect 챌린지 [8] 및 Kvasir-SEG 데이터셋 [12]과 같은 최근 경연 대회 및 데이터셋이 모델 벤치마킹에 중요함을 강조합니다.

## 🛠️ Methodology
제안하는 DDANet 아키텍처는 ResUNet++ [13]과 유사한 인코더-디코더 설계를 따릅니다.
1.  **잔여 블록(Residual Block):**
    *   두 개의 $3 \times 3$ 컨볼루션, 배치 정규화(Batch Normalization), ReLU 활성화 함수로 구성됩니다.
    *   입력을 잔여 블록의 출력과 연결하는 스킵 연결(skip-connection)을 통해 그래디언트 소실/폭발 문제를 해결하고 그래디언트 흐름을 개선합니다.
2.  **Squeeze and Excitation (SE) 블록:**
    *   채널별 어텐션 메커니즘으로, 모든 특징 채널의 중요도를 재조정하여 더 정확한 특징 맵을 생성합니다.
    *   전역 평균 풀링(global average pooling)으로 특징 맵을 압축한 다음, 2계층 신경망을 사용하여 특징 벡터를 생성하고 이를 통해 특징 채널의 가중치를 조절합니다.
3.  **DDANet 아키텍처:**
    *   **단일 인코더:** RGB 입력 이미지를 추상적인 특징 표현으로 인코딩하며 점진적으로 다운샘플링합니다. 4개의 인코더 블록으로 구성됩니다.
    *   **이중 디코더:** 인코더 네트워크의 출력을 공유하는 두 개의 디코더로 구성됩니다. 각 디코더는 4개의 디코더 블록을 포함합니다.
        *   **분할 브랜치 (첫 번째 디코더):** 최종적으로 용종 분할 마스크를 출력합니다.
        *   **오토인코더 브랜치 (두 번째 디코더):** 입력 RGB 이미지의 재구성된 그레이스케일 이미지를 출력하는 보조 작업입니다.
    *   **스킵 연결:** 인코더 네트워크의 해당 특징 맵을 사용하여 디코더의 특징 표현 강도를 높이고 그래디언트 흐름의 대체 경로 역할을 합니다.
    *   **어텐션 메커니즘:** 오토인코더 브랜치의 두 번째 디코더 블록 출력에 $1 \times 1$ 컨볼루션과 시그모이드 활성화 함수를 적용하여 어텐션 맵을 생성합니다. 이 어텐션 맵은 분할 브랜치의 첫 번째 디코더 블록 출력에 곱해져 다음 분할 디코더 블록의 입력으로 사용됩니다.
4.  **구현 및 훈련:**
    *   PyTorch 1.6 프레임워크 사용, NVIDIA DGX-2 (V100 Tensor Core GPUs).
    *   입력 이미지 해상도 $512 \times 512$.
    *   손실 함수: 분할 마스크 예측에는 이진 교차 엔트로피와 Dice Loss의 조합을, 그레이스케일 이미지 재구성에는 이진 교차 엔트로피를 사용합니다.
    *   옵티마이저: Adam (학습률 $1e^{-4}$), 200 에포크 훈련.
    *   데이터셋: Kvasir-SEG [12] 데이터셋 (훈련 88%, 개발-테스트 12%). 미공개 테스트 데이터셋 200개 사용.

## 📊 Results
*   **Kvasir-SEG (내부 검증) 데이터셋:**
    *   Dice 계수 (DSC): 0.8576
    *   평균 IoU (mIoU): 0.7800
    *   재현율 (Recall): 0.8880
    *   정밀도 (Precision): 0.8643
    *   초당 프레임 수 (FPS): 69.59
*   **미공개 (Endotect 챌린지) 데이터셋:**
    *   Dice 계수 (DSC): 0.7874
    *   평균 IoU (mIoU): 0.7010
    *   재현율 (Recall): 0.7987
    *   정밀도 (Precision): 0.8577
    *   초당 프레임 수 (FPS): 70.23
*   정성적 결과: DDANet은 크고 작은 용종을 모두 효과적으로 분할하지만, 편평한 용종 식별에는 여전히 어려움이 있습니다. 그레이스케일 이미지 재구성 성능은 거의 완벽합니다.

## 🧠 Insights & Discussion
*   제안된 DDANet 모델은 다양한 크기의 용종을 효과적으로 분할할 수 있음을 입증했습니다.
*   다만, 편평하거나 무경성 용종(sessile polyps)과 같은 특정 용종 유형에 대한 분할은 여전히 도전 과제로 남아 있습니다.
*   그레이스케일 이미지의 거의 완벽한 재구성은 오토인코더 브랜치가 인코더의 특징 맵을 효과적으로 강화하고 있음을 시사합니다.
*   높은 정밀도, 재현율, Dice 계수 및 mIoU는 제안된 방법의 유효성을 검증합니다.
*   평균 70 FPS의 빠른 처리 속도는 DDANet이 실시간 컴퓨터 지원 진단(CADx) 시스템에 적용될 잠재력이 있음을 보여줍니다.
*   향후 연구에서는 그레이스케일 이미지 재구성 대신 이미지 초해상도(super-resolution) 기법을 사용하고, 후처리 및 최적 파라미터 분석을 통해 아키텍처를 더욱 개선할 계획입니다.

## 📌 TL;DR
**문제:** 대장 용종의 자동 분할은 임상 진단에 중요하지만, 용종의 다양한 형태와 수동 라벨링의 한계로 인해 정확하고 빠른 시스템 개발이 필요합니다.
**제안 방법:** DDANet은 공유 인코더와 분할 및 오토인코더 역할을 하는 두 개의 병렬 디코더로 구성된 새로운 딥러닝 아키텍처입니다. 오토인코더 브랜치는 보조 작업을 통해 어텐션 맵을 생성하여 분할 디코더의 특징 표현을 강화합니다.
**주요 발견:** DDANet은 Kvasir-SEG 데이터셋에서 우수한 성능(DSC 0.8576)을 달성했으며, 미공개 데이터셋에서도 강력한 일반화 능력(DSC 0.7874)과 실시간 처리 속도(약 70 FPS)를 보여주어 임상 CADx 시스템에 대한 높은 잠재력을 입증했습니다.