# Iterative Instance Segmentation

Ke Li, Bharath Hariharan, Jitendra Malik

## 🧩 Problem to Solve

기존 픽셀 단위 라벨링(pixel-wise labelling) 방식은 라벨링의 내재된 구조를 무시하여 시각적으로 불가능한 예측을 자주 생성합니다. 모델에 구조를 통합하는 것은 어려움이 따르는데, 구조적 제약의 형태를 수동으로 지정하는 것은 비현실적일 수 있으며, 제약이 주어지더라도 고차(higher-order) 또는 비서브모듈러(non-submodular) 포텐셜(potential)로 인해 추론이 종종 불가능해집니다. 특히 인스턴스 분할(Instance Segmentation) 작업에서, 인접한 동일 카테고리의 인스턴스가 있을 때 지역적 단서만으로는 픽셀이 어떤 인스턴스에 속하는지 식별하기 어렵습니다 (Figure 1 참조).

## ✨ Key Contributions

- 구조적 예측 문제를 일련의 제약 없는 예측 문제로 환원하는 반복적 방법을 제안합니다.
- 명시적인 사전 지정 없이 데이터로부터 형상(shape), 영역 예측의 연속성, 영역 윤곽선의 부드러움에 대한 암묵적 사전 지식(prior)을 자동으로 발견할 수 있음을 입증합니다.
- 인스턴스 분할 작업에서 최신 기술(state-of-the-art)을 능가하는 성능을 달성합니다: 50% IoU(Intersection-over-Union)에서 63.6%의 meanAP$_{r}$ (Region Average Precision), 70% IoU에서 43.3%의 meanAP$_{r}$를 기록합니다.
- 모델이 이전 실수를 수정하도록 학습함으로써 출력의 내재된 구조를 암묵적으로 학습한다는 것을 보여줍니다.

## 📎 Related Works

- **인스턴스 분할 태스크 정의 및 측정:** Yang et al. [34]가 인스턴스 분할 태스크를 처음 설명했으며, Tighe et al. [31]와 Hariharan et al. [14]는 평가 지표를 상세히 제시했습니다. Dai et al. [8]은 CNN 기반 제안 분류 속도를 향상시켰습니다.
- **검출된 객체 분할:** Borenstein and Ullman [3] 등은 카테고리별 정보를 사용하여 분할 정확도를 높이는 방법을 제시했습니다. 최근 CNN의 발전과 함께 Hariharan et al. [16]은 R-CNN [12] 검출에 CNN 특징을 활용했습니다.
- **구조 및 제약 통합:** 대부분의 기존 접근 방식은 픽셀을 독립적으로 예측하지만, 이미지 픽셀 간의 상호 의존성을 간과합니다. 지역적 부드러움은 이미지 윤곽선 정렬 [5], 슈퍼픽셀 투영 [16], CRF [28, 24, 19] 등으로 모델링되었습니다. 고차 포텐셜(higher-order potentials) [18, 21]이나 심층 볼츠만 머신(deep Boltzmann machine) [9] 같은 생성 모델도 연구되었습니다. Zheng et al. [36]은 CRF를 반복 신경망(recurrent neural networks)으로 보고 CNN과 함께 훈련했습니다.
- **반복 예측/추론 방법:** Auto-context [33] 및 추론 머신(inference machines) [27]은 명시적인 사후 분포(posterior distribution) 모델링 없이 효율적인 반복 추론 절차를 통해 장거리 공간 정보(distant spatial information)를 활용합니다. 반복 오류 피드백(Iterative Error Feedback, IEF) [6]은 인간 자세 추정에서 예측을 직접 정제하는 유사한 접근 방식을 사용했습니다. 본 논문은 이러한 반복적 접근 방식을 고차원 픽셀 단위 예측으로 확장하는 데 중점을 둡니다.

## 🛠️ Methodology

1. **작업 및 설정:** 인스턴스 분할(동시 감지 및 분할, SDS)은 이미지 내 각 객체 인스턴스에 대한 분할 마스크를 예측하는 것을 목표로 합니다. 파이프라인의 첫 단계에서 Fast R-CNN [11] 기반의 객체 감지 시스템이 후보 바운딩 박스를 생성합니다.
2. **분할 시스템:** Hariharan et al. [16]의 Hypercolumn net (VGG 16-layer 기반 "O-Net") 아키텍처를 기반으로 한 CNN을 사용합니다. 224x224 패치를 입력으로 받아 50x50 히트맵(heatmap) 예측을 출력합니다. PASCAL VOC 2012 훈련 세트와 SBD(Semantic Boundaries Dataset) [13]의 정답 인스턴스 분할 마스크로 종단간(end-to-end) 훈련됩니다.
3. **알고리즘 (반복적 예측):**
   - **핵심 아이디어:** 구조적 예측 문제를 일련의 제약 없는 예측 문제로 환원합니다. 모델이 단일 단계에서 입력과 구조에 일관된 예측을 생성하도록 강제하는 대신, 초기에는 구조를 무시하도록 허용하고, 여러 단계를 거쳐 구조를 무시함으로써 발생하는 실수를 수정하도록 훈련합니다.
   - **훈련 절차 (Algorithm 1):**
     - 초기 단계의 이전 예측 $p^{(0)}_x$는 모든 픽셀에 대해 1/2로 설정됩니다.
     - $t=1$부터 $N$ 단계까지 반복하며, 각 단계에서 현재까지의 훈련 데이터를 사용하여 모델 $f$를 훈련하고 새로운 예측 $p^{(t)}_x = f(x, p^{(t-1)}_x)$를 생성합니다.
   - **테스트 절차 (Algorithm 2):**
     - 초기 예측 $\hat{y}^{(0)}$은 1/2로 설정됩니다.
     - $t=1$부터 $M$ 반복까지 $\hat{y}^{(t)} = f(x, \hat{y}^{(t-1)})$를 수행하며, 최종 예측은 $\hat{y}^{(M)}$입니다.
   - 이는 복잡한 구조 매니폴드(manifold)를 직접 모델링하는 대신, 매니폴드를 정의하는 암묵적 함수의 기울기(gradient)를 학습하는 것으로 볼 수 있습니다.
4. **구현 세부 사항:**
   - Hypercolumn net에 20개의 카테고리 종속 채널을 입력 레이어에 추가합니다. 이전 단계의 히트맵은 해당 카테고리 채널에 들어가고, 나머지 채널은 0으로 채워집니다.
   - 이전 단계의 50x50 히트맵은 바이리니어 보간법(bilinear interpolation)으로 224x224로 업샘플링됩니다. 히트맵 값은 $[-127, 128]$ 범위로 재조정됩니다.
   - 손실 함수는 픽셀 단위 음수 로그 우도(negative log likelihood)의 합입니다. SGD(Stochastic Gradient Descent)를 사용하여 훈련하며, 훈련은 4단계, 테스트는 3번의 반복으로 수행됩니다.
   - 선택적으로 슈퍼픽셀 투영(superpixel projection) 및 SVM(Support Vector Machine) 기반 재점수화(rescoring)를 통한 후처리(post-processing)를 적용할 수 있습니다.
5. **평가:** 영역 평균 정밀도(Region Average Precision, AP$_{r}$)를 사용하여 평가하며, 예측과 정답 분할 마스크 간의 픽셀 단위 IoU를 기준으로 겹침을 계산합니다. PASCAL VOC 2012 검증 세트의 SBD 인스턴스 분할 주석을 사용합니다.

## 📊 Results

- **정량적 결과:**
  - 제안된 방법은 기존 모든 방법을 능가하는 meanAP$_{r}$ 성능을 달성했습니다: 50% IoU에서 63.6%, 70% IoU에서 43.3% (Hypercolumn의 50% IoU 62.4%, 70% IoU 39.4% 대비).
  - 특히 원시 픽셀 단위 예측 성능에서 70% IoU에서 Hypercolumn 대비 9.3포인트 향상을 보여, 후처리 의존도를 줄였습니다.
- **정성적 결과 (시각화):**
  - **훈련 진행 (Figure 3):** 훈련 단계가 진행됨에 따라 예측 품질이 꾸준히 향상되며, 모델이 놓쳤던 객체 부분을 복구하고 다른 객체의 부분을 억제하는 것을 학습합니다.
  - **Hypercolumn net과의 비교 (Figure 4):** 제안된 방법은 시각적으로 더 일관성 있고, 노이즈가 적으며, 형상에 더 부합하는 히트맵을 생성합니다. 예컨대, 스포츠캐스터 및 유아 이미지에서 노이즈가 적고 높은 신뢰도로 전경 픽셀을 식별하며, 자전거 이미지에서 더 정확한 분할을 수행합니다. 말 이미지에서 가려진 머리를 환각하는 현상은 형상 사전 지식 학습의 증거입니다. 생성된 영역 예측은 구멍이 적고 윤곽선이 더 부드러운 경향이 있습니다.
  - **도전적인 장면 (Figure 5):** 인접한 객체의 부분을 성공적으로 억제하여, 지역적 단서만으로는 구분이 어려운 경우에도 영역 가설을 명확히 합니다.
  - **겹침(Overlap) 개선 (Figure 6):** 감지의 76%에서 정답과의 겹침이 개선되었으며, 이미 우수한 예측에 대해서도 (예: 75% 겹침) 겹침을 최대 15%까지 향상시켜 90% 이상에 도달하는 경우가 많았습니다.
  - **형상 사전 지식 학습의 증거 (Figure 7):** 시각적으로 특징이 거의 없는 패치에 임의의 카테고리(새, 말, 자전거, TV) 레이블을 부여했을 때, 모델은 해당 카테고리에 해당하는 그럴듯한 형상(예: 새 날개, 말 다리)을 환각했습니다. 이는 모델이 카테고리별 형상 사전 지식을 성공적으로 학습했음을 직접적으로 보여줍니다.

## 🧠 Insights & Discussion

- **반복적 접근 방식의 강력함:** 형상과 같은 추상적인 제약의 복잡성과 수동 지정의 어려움, 고차 및 비서브모듈러 포텐셜로 인한 추론 불가능성 때문에 전통적인 구조적 예측은 어려움을 겪습니다. 제안된 다단계 예측 절차는 복잡한 구조 매니폴드를 직접 모델링하는 대신 지역적 수정(암묵적 함수의 기울기)을 모델링함으로써 더 강력한 성능을 발휘합니다.
- **암묵적 학습:** 모델은 형상, 영역 연속성, 윤곽선 부드러움에 대한 사전 지식을 명시적인 정의나 편향 없이 데이터로부터 자동으로 발견합니다.
- **후처리 의존도 감소:** 향상된 원시 픽셀 단위 예측 덕분에 슈퍼픽셀 투영과 같은 후처리 기술에 대한 의존도가 줄어듭니다. 이러한 후처리는 때때로 예측 오류를 가리거나 세부 사항을 놓칠 수 있습니다.
- **도전적인 시나리오에 대한 강건함:** 학습된 형상 사전 지식은 복잡한 장면(예: 여러 인접 객체)에서 지역적 외관 단서만으로는 불충분한 경우에도 영역 가설을 명확히 하는 데 도움을 줍니다.
- **우수한 예측의 정제:** 이미 정확한 예측을 크게 개선할 수 있는 능력은 모델이 학습된 사전 지식을 미세 정제(fine-grained refinement)에 효과적으로 사용함을 시사합니다.
- **일반적 적용 가능성:** 이 방법은 픽셀 단위 입력 이미지 레이블링을 요구하는 다른 태스크에도 일반적으로 적용될 수 있습니다.

## 📌 TL;DR

- **문제:** 기존 픽셀 단위 이미지 분할은 형상 등 암묵적인 구조를 무시하여 시각적으로 불가능한 결과를 내며, 구조 제약을 명시하거나 추론하기 어렵습니다.
- **해결책:** 이 논문은 구조적 예측 문제를 일련의 제약 없는 예측 문제로 분해하는 반복적 방법을 제안합니다. 모델이 초기 오류를 점진적으로 수정하도록 학습시켜 데이터로부터 형상, 영역 연속성, 윤곽선 부드러움과 같은 암묵적 구조를 자동 학습합니다.
- **주요 발견:** 제안된 방법은 인스턴스 분할에서 최첨단 성능을 달성했으며 (50% IoU에서 63.6% meanAP$_{r}$, 70% IoU에서 43.3% meanAP$_{r}$), 시각적으로 더 일관되고 정확한 세그먼테이션을 생성하여 암묵적인 형상 및 영역 우선순위 학습을 입증했습니다.
