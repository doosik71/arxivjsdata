# Simultaneous Detection and Segmentation

Bharath Hariharan, Pablo Arbel ́aez, Ross Girshick, and Jitendra Malik

## 🧩 Problem to Solve

기존 객체 인식 연구는 객체 검출(Object Detection)과 의미론적 분할(Semantic Segmentation)로 나뉘어 진행되었습니다. 객체 검출은 이미지 내 특정 카테고리 객체들의 경계 상자(bounding box)를 찾는 반면, 의미론적 분할은 이미지의 모든 픽셀에 카테고리 레이블을 할당합니다. 이 두 태스크는 각각 다음 한계점을 가집니다:

- **객체 검출의 한계**: 객체의 위치를 경계 상자로만 파악하여 정밀한 공간적 범위 정보를 제공하지 못합니다.
- **의미론적 분할의 한계**: "stuff" 카테고리(예: 잔디, 하늘)와 "thing" 카테고리(예: 사람, 자동차)를 동일하게 처리하여 개별 객체 인스턴스(instance)를 구별하지 못합니다. 예를 들어, 이미지에 여러 마리의 개가 있을 경우, 모든 개 픽셀을 "개"로 레이블링하지만, 몇 마리의 개가 있는지, 각 개체의 정확한 공간적 범위는 알려주지 않습니다.

이 논문은 이러한 한계를 극복하기 위해 **동시 검출 및 분할(Simultaneous Detection and Segmentation, SDS)**이라는 새로운 통합 태스크를 제안합니다. SDS는 이미지 내 특정 카테고리의 모든 객체 인스턴스를 검출하고, 각 인스턴스에 속하는 픽셀들을 정확하게 표시하는 것을 목표로 합니다. 이는 경계 상자나 픽셀 레벨 카테고리 레이블보다 더 풍부하고 유용한 출력을 제공합니다.

## ✨ Key Contributions

- **새로운 태스크 정의**: 객체 인스턴스 검출과 정밀한 픽셀 단위 분할을 동시에 수행하는 SDS 태스크를 정의하고, 이에 적합한 평가 메트릭($AP_r$, $AP_{r}^{vol}$)을 제시했습니다.
- **새로운 CNN 아키텍처 제안**: R-CNN [16]을 기반으로, 영역 제안(region proposal)의 경계 상자 및 영역 전경(region foreground)으로부터 특징을 추출하기 위해 두 가지 경로(two pathways)를 갖는 CNN을 제안하고, 이를 종단 간(end-to-end)으로 공동 학습하는 방법을 개발했습니다.
- **영역 세분화(Region Refinement) 기법**: 초기 생성된 영역 제안을 카테고리별 상향식-하향식(top-down) 예측을 통해 더욱 정밀하게 조정하는 방법을 제시하여 분할 정확도를 높였습니다.
- **성능 향상**:
  - SDS 태스크에서 기존 R-CNN 대비 $AP_r$ 기준 7%($16\%$ 상대적) 성능 향상을 달성했습니다.
  - 의미론적 분할에서 기존 최첨단(state-of-the-art) 대비 5%($10\%$ 상대적) 성능 향상을 이루었습니다.
  - 객체 검출에서도 최첨단 성능을 달성했습니다.
- **진단 도구 제공**: SDS 태스크에서 발생하는 흔한 오류 모드를 분석하고 향후 연구 방향을 제시하는 진단 도구를 개발했습니다.

## 📎 Related Works

- **의미론적 분할**: 객체 검출기의 활성화(activation)를 분할에 활용하려는 시도 (Yang et al. [32], Arbelaez et al. [2], Ladicky et al. [22], Tighe et al. [31]).
- **검출 보완을 위한 분할**: GrabCut [26] 또는 일반적인 인스턴스 및 카테고리 외형 모델 [7]을 사용하여 검출된 객체의 경계 상자를 개선하는 연구.
- **객체 제안(Object Proposal) 기반 접근**: 분할을 통해 객체 제안을 생성하고 이를 분류하는 방식. Selective Search [27]나 MCG [1]와 같은 방법론이 검출 및 분할 시스템의 기반으로 사용됩니다.
- **CNN 기반 방법론**: SIFT [24]나 HOG [8]와 같은 기존 특징 대신 CNN을 활용하는 경향 (Krizhevsky et al. [21], Donahue et al. [10]). 특히 Girshick et al.의 R-CNN [16]은 CNN을 영역 제안 분류에 활용하여 객체 검출에서 획기적인 성능 향상을 달성했으며, 본 논문의 기반이 됩니다.

## 🛠️ Methodology

본 논문에서 제안하는 SDS 알고리즘은 다음과 같은 4단계로 구성됩니다.

1. **영역 제안 생성 (Proposal Generation)**

   - 목표: 카테고리에 독립적인 상향식(bottom-up) 객체 영역 제안을 생성합니다. 분할 결과가 필요하므로 경계 상자 대신 영역 제안(region proposal)이 필요합니다.
   - 방법: MCG (Multiscale Combinatorial Grouping) [1]를 사용하여 이미지당 2000개의 영역 후보를 생성합니다. MCG는 객체 수준 Jaccard index 메트릭에서 다른 방법들을 능가하는 고품질 후보를 생성합니다.

2. **특징 추출 (Feature Extraction)**

   - 목표: 각 영역 제안에 대해 CNN을 사용하여 특징을 추출합니다.
   - **A (Baseline)**: R-CNN [16]을 기반으로 MCG 경계 상자를 사용하여 ImageNet으로 사전 학습된 CNN을 파인튜닝합니다. 특징은 경계 상자(bounding box)와 배경이 마스크된 영역 전경(region foreground) 모두에서 추출하여 연결(concatenate)합니다. 이 CNN은 경계 상자 중첩도(bounding box overlap)를 기반으로 학습됩니다.
   - **B (Region-specific finetuning)**: A의 한계를 개선하기 위해, 영역 전경으로부터 특징을 추출하는 데 최적화된 별도의 CNN을 파인튜닝합니다. 이 네트워크는 영역과 실제 마스크 간의 중첩도(segmentation overlap)를 기반으로 학습됩니다.
   - **C (Joint Training)**: A, B의 단점을 보완하기 위해, 두 개의 경로(pathways)를 가진 단일 CNN 아키텍처를 제안합니다 (Fig. 2 참조).
     - 첫 번째 경로는 잘라낸 경계 상자에, 두 번째 경로는 배경이 마스크된 영역 전경에 적용됩니다.
     - 두 경로는 마지막 분류 레이어에서만 결합됩니다.
     - 이 네트워크는 Box 경로와 Region 경로에 각각 B에서 파인튜닝된 네트워크 가중치로 초기화된 후, 전체 네트워크를 영역 중첩도 기반으로 공동으로 파인튜닝합니다.

3. **영역 분류 (Region Classification)**

   - 목표: 추출된 CNN 특징을 사용하여 선형 SVM을 학습하여 각 후보 영역에 카테고리별 점수를 할당합니다.
   - 학습: 초기 SVM은 ground truth를 양성, ground truth와 중첩이 20% 미만인 영역을 음성으로 사용하여 학습됩니다. 이후, 각 ground truth에 대해 50% 이상 중첩되는 MCG 후보 중 가장 높은 점수를 받은 후보를 양성으로 재정의하여 재학습합니다.
   - 추론: 분류된 영역들에 대해 엄격한 비최대 억제(Non-Maximum Suppression, NMS)를 수행합니다 (영역 중첩 임계값 0 사용).

4. **영역 세분화 (Region Refinement)**
   - 목표: 하향식(top-down) 카테고리별 정보로 초기 영역 제안의 픽셀 지원(pixel support)을 정밀화합니다.
   - 과정:
     1. **초기 마스크 예측**: 예측된 영역의 경계 상자를 10x10 그리드로 이산화(discretize)하고, 각 그리드 셀이 전경에 속할 확률을 예측하는 로지스틱 회귀 분류기를 학습합니다. 이 분류기는 CNN 특징과 10x10 그리드로 이산화된 영역의 전경-배경 마스크를 특징으로 사용합니다.
     2. **슈퍼픽셀(Superpixel) 기반 결합**: 이 거친 마스크를 슈퍼픽셀에 투영하여 각 슈퍼픽셀에 해당 그리드 셀의 평균값을 할당합니다.
     3. **최종 분류**: 각 슈퍼픽셀을 재분류합니다. 이때 특징으로는 투영된 거친 마스크 값과 해당 슈퍼픽셀이 원래 영역 후보에 속하는지 여부(0 또는 1)를 사용합니다. 이를 통해 상향식 윤곽선 정보를 존중하면서 하향식 예측을 통합하여 정밀한 분할 결과를 얻습니다.

## 📊 Results

논문은 PASCAL VOC 2012 val 및 test 세트에서 다양한 평가 메트릭을 사용하여 제안된 방법의 성능을 입증했습니다.

- **SDS 성능 ($AP_r$ 및 $AP_{r}^{vol}$)**:

  - 제안된 C+ref (최종 모델)는 PASCAL VOC 2012 val 세트에서 평균 $AP_r$ 49.7% 및 평균 $AP_{r}^{vol}$ 41.4%를 달성했습니다.
  - 이는 가장 단순한 베이스라인(A) 대비 $AP_r$에서 7%p, $AP_{r}^{vol}$에서 4.4%p 향상된 수치입니다.
  - SegDPM [14]과의 비교에서 C+ref는 50.3%의 평균 $AP_r$를 달성하여 SegDPM의 31.3% 상한치보다 월등히 높은 성능을 보였습니다.

- **객체 검출 성능 ($AP_b$ 및 $AP_{b}^{vol}$)**:

  - PASCAL VOC 2012 val 세트에서 C는 평균 $AP_b$ 53.0%, 평균 $AP_{b}^{vol}$ 44.2%를 달성했습니다.
  - 이는 R-CNN [16]의 $AP_b$ 51.0%, $AP_{b}^{vol}$ 41.9%보다 향상된 수치입니다.
  - PASCAL VOC 2012 test 세트에서 C는 평균 $AP_b$ 50.7%를 달성하여 R-CNN의 49.6% 및 SegDPM [14]의 40.7%보다 우수합니다.

- **의미론적 분할 성능 (Pixel IU)**:
  - PASCAL VOC 2011 Test 세트에서 C+ref는 Pixel IU 52.6%를 달성하여 O$_{2}$P [5] (47.6%) 및 R-CNN [16] (47.9%) 등 기존 최첨단 방법 대비 약 5%p 향상된 성능을 보여주었습니다.
  - PASCAL VOC 2012 Test 세트에서는 51.6%를 달성했습니다.

## 🧠 Insights & Discussion

- **공동 학습(Joint Training) 및 세분화(Refinement)의 효과**: 두 개의 경로를 가진 CNN을 공동 학습하고(C), 이후 영역 세분화 단계를 추가하는 것(C+ref)이 SDS 성능 향상에 크게 기여했습니다. 특히 영역 세분화는 높은 품질의 MCG 후보 영역에도 불구하고 카테고리별 정밀화가 여전히 큰 이점을 제공함을 입증했습니다.
- **임계값 변화에 따른 견고성**: 제안된 개선 사항들은 다양한 중첩 임계값에 걸쳐 $AP_r$ 성능을 지속적으로 향상시켜, 특정 임계값에 과적합되지 않았음을 보여줍니다.
- **오류 진단**:
  - **오위치화(Mislocalization)의 영향**: 오류 진단 도구를 통해 오위치화가 가장 지배적인 오류 원인임을 밝혔습니다. 오위치화 수정 시 $AP_r$가 약 16%p 향상되는 것으로 나타났습니다. 배경과의 혼동이나 유사 카테고리 간의 혼동은 거의 미미한 수준이었습니다.
  - **오위치화의 유형**: 픽셀 정밀도($AP_{pp}$)와 픽셀 재현율($AP_{pr}$)을 비교하여 오위치화가 주로 '과잉 예측(overshooting, 배경 포함)'인지 '미달 예측(undershooting, 객체 일부 누락)'인지를 파악할 수 있음을 보여주었습니다. 예를 들어, '사람'이나 '새' 카테고리에서는 픽셀 누락 경향이 있는 반면, '자전거' 카테고리에서는 배경으로 새어 나가는 경향이 있었습니다.
- **향후 연구 방향**: 오위치화 문제가 가장 큰 성능 병목임을 확인했으며, 이를 개선하는 것이 SDS 성능 향상의 핵심 과제임을 시사했습니다.

## 📌 TL;DR

본 논문은 객체 검출(경계 상자)과 의미론적 분할(인스턴스 미구분)의 한계를 극복하기 위해 **동시 검출 및 분할(SDS)**이라는 새로운 컴퓨터 비전 태스크를 제안합니다. 이 태스크는 이미지 내 모든 객체 인스턴스를 검출하고 각 인스턴스의 픽셀을 정밀하게 분할하는 것을 목표로 합니다. 저자들은 MCG 영역 제안과 공동으로 학습된 이중 경로(two-pathway) CNN (C)을 활용한 새로운 아키텍처를 제시하고, 추가적으로 카테고리별 영역 세분화(refinement) 단계를 포함하는 파이프라인을 구축했습니다. 제안된 방법은 SDS, 객체 검출, 의미론적 분할의 세 가지 태스크에서 모두 최첨단 성능을 달성했으며, 특히 오위치화(mislocalization)가 주요 오류 원인임을 진단 도구를 통해 밝히고 향후 연구 방향을 제시했습니다.
