# Instance-sensitive Fully Convolutional Networks

Jifeng Dai, Kaiming He, Yi Li, Shaoqing Ren, Jian Sun

## 🧩 Problem to Solve

기존의 완전 컨볼루션 네트워크(FCN)는 이미지의 픽셀 단위로 객체 카테고리를 분류하여 의미론적 분할(Semantic Segmentation)에 성공적이었지만, 각 객체의 **인스턴스(Instance)를 구분하지 못했습니다.** 즉, 동일한 카테고리의 여러 객체를 하나의 덩어리로 인식하여 개별 객체 세그먼트를 분리해내는 데 한계가 있었습니다. 이 논문은 이러한 FCN의 한계를 극복하고 **인스턴스 수준의 세그먼트 후보를 제안**할 수 있는 새로운 FCN 구조를 개발하는 것을 목표로 합니다.

## ✨ Key Contributions

- **인스턴스-민감 스코어 맵(Instance-sensitive Score Maps) 제안:** 기존 FCN이 하나의 스코어 맵을 생성하는 것과 달리, 이 논문은 객체 인스턴스에 대한 상대적 위치(예: 왼쪽, 오른쪽, 위쪽 등)를 분류하는 $k^2$개의 스코어 맵을 생성하도록 FCN을 설계했습니다.
- **간단한 조립 모듈(Assembling Module):** 생성된 인스턴스-민감 스코어 맵들을 활용하여 각 슬라이딩 윈도우 내에서 객체 인스턴스 세그먼트를 효과적으로 "조립"하는 간단한 모듈을 도입했습니다. 이 모듈은 학습 가능한 파라미터가 없으며 복사-붙여넣기 연산으로 이루어져 효율적입니다.
- **지역적 일관성(Local Coherence) 활용:** 마스크 해상도와 관련된 고차원 레이어를 사용하지 않고 이미지의 지역적 일관성을 활용하여, 파라미터 수를 획기적으로 줄이고 오버피팅 위험을 낮췄습니다. 이는 DeepMask와 같은 기존 방법론과의 주요 차이점입니다.
- **완전 컨볼루션 방식의 인스턴스 세그먼트 제안:** FCN의 기본 철학(엔드-투-엔드, 픽셀-투-픽셀 분류)을 유지하면서 인스턴스 수준의 세그먼트 제안을 수행하는 최초의 완전 컨볼루션 모델인 InstanceFCN을 제안했습니다.
- **경쟁력 있는 성능:** PASCAL VOC와 MS COCO 벤치마크에서 기존의 세그먼트 제안 방법론들과 비교하여 경쟁력 있는 또는 우수한 성능을 달성했습니다.

## 📎 Related Works

- **Fully Convolutional Networks (FCN) [1]:** 의미론적 분할을 위한 선구적인 엔드-투-엔드 완전 컨볼루션 모델로, 각 출력 픽셀이 객체 카테고리에 대한 분류기 역할을 합니다. 본 연구는 FCN의 인스턴스 인식 부족 문제를 해결하고자 합니다.
- **DeepMask [8]:** 컨볼루션 네트워크 기반의 인스턴스 세그먼트 제안 방법론으로, 슬라이딩 윈도우에서 $m^2$차원 벡터(마스크 해상도)를 예측하기 위해 고차원 완전 연결(FC) 레이어를 사용합니다. InstanceFCN은 DeepMask와 달리 마스크 해상도와 관련된 고차원 레이어를 사용하지 않습니다.
- **Region Proposal Network (RPN) in Faster R-CNN [19]:** 완전 컨볼루션 방식으로 바운딩 박스 수준의 인스턴스를 제안하는 데 사용됩니다. RPN은 마스크 수준의 제안을 생성하지 않습니다.
- **Multi-task Network Cascade (MNC) [20]:** 박스 수준 영역을 제안하고, 해당 영역에서 세그먼트 마스크를 회귀하며, 마스크를 분류하는 다단계 캐스케이드 네트워크입니다. MNC의 마스크 회귀는 고차원 FC 레이어를 통해 이루어지며, 이는 InstanceFCN과 대조됩니다.

## 🛠️ Methodology

InstanceFCN은 기존 FCN을 인스턴스 인식 가능하도록 확장한 모델입니다.

1. **네트워크 아키텍처:**

   - **특징 추출:** ImageNet으로 사전 학습된 VGG-16 네트워크를 기반으로 합니다. `pool4` 레이어의 스트라이드를 1로 줄이고 `conv5` 필터에 "hole algorithm"을 적용하여 특징 맵의 해상도를 높입니다(최종 유효 스트라이드 $s=8$).
   - **두 개의 완전 컨볼루션 브랜치:**
     - **인스턴스-민감 스코어 맵 생성 브랜치:** 특징 맵 위에 `1x1` 컨볼루션(`512-d`, ReLU) 및 `3x3` 컨볼루션 레이어를 적용하여 $k^2$개의 출력 채널을 가진 인스턴스-민감 스코어 맵 세트를 생성합니다. 각 채널은 슬라이딩 윈도우 내 객체 인스턴스의 특정 상대적 위치(예: $k=3$일 때 9개의 스코어 맵)를 나타냅니다.
     - **객체성 스코어 맵 생성 브랜치:** `3x3` 컨볼루션(`512-d`, ReLU) 및 `1x1` 컨볼루션 레이어를 사용하여 각 슬라이딩 윈도우의 객체성(objectness) 점수를 예측하는 스코어 맵을 생성합니다. 이 점수는 해당 윈도우가 객체 인스턴스를 포함하는지를 나타냅니다.

2. **인스턴스 조립 모듈:**

   - 인스턴스-민감 스코어 맵 세트 위에서 $m \times m$ 크기의 윈도우를 슬라이딩합니다.
   - 각 스코어 맵에서 해당하는 $\frac{m}{k} \times \frac{m}{k}$ 서브 윈도우 값을 가져와 $k^2$개의 서브 윈도우를 원래 상대적 위치에 따라 재배치하여 새로운 $m \times m$ 해상도의 인스턴스 마스크를 조립합니다.
   - 이 모듈은 학습 가능한 파라미터가 없으며, 복사-붙여넣기 연산으로 이루어져 효율적입니다.

3. **지역적 일관성 활용 (Local Coherence):**

   - DeepMask와 달리, 본 방법은 마스크 해상도($m^2$)에 의존하는 고차원 FC 레이어를 사용하지 않습니다. 대신 각 픽셀은 낮은 차원의 분류기입니다.
   - 윈도우가 한 칸 이동할 때, 이미지 좌표계의 동일한 픽셀은 동일한 스코어 맵에서 값을 복사해오기 때문에 예측 값이 동일하게 유지됩니다 (상대적 위치 분할 경계 부근 제외). 이는 파라미터 수를 크게 줄여 오버피팅을 방지하고 계산 효율성을 높입니다.

4. **학습 (Training):**

   - 엔드-투-엔드 방식으로 학습됩니다.
   - 이미지 중심(image-centric) 전략을 사용하며, 무작위로 256개의 슬라이딩 윈도우를 샘플링하여 손실 함수를 계산합니다.
   - **손실 함수:**
     $$
     \sum_{i} (L(p_{i}, p^{*}_{i}) + \sum_{j} L(S_{i,j}, S^{*}_{i,j}))
     $$
     여기서 $i$는 샘플링된 윈도우 인덱스, $p_{i}$는 예측된 객체성 점수, $p^{*}_{i}$는 정답 객체성 점수 (양성 1, 음성 0), $S_{i,j}$는 조립된 세그먼트 인스턴스의 $j$번째 픽셀 값, $S^{*}_{i,j}$는 정답 세그먼트 인스턴스의 $j$번째 픽셀 값, $L$은 로지스틱 회귀 손실입니다.
   - 양성/음성 샘플링 비율은 1:1로 설정됩니다.
   - 다양한 스케일의 이미지에 대응하기 위해 스케일 지터링(scale jittering)을 적용합니다.
   - SGD 옵티마이저를 사용하며, 총 40k 이터레이션을 수행합니다.

5. **추론 (Inference):**
   - 네트워크를 통해 인스턴스-민감 스코어 맵과 객체성 스코어 맵을 생성합니다.
   - 조립 모듈은 이 맵들 위에서 윈도우를 조밀하게 슬라이딩하여 각 위치에서 세그먼트 인스턴스를 생성합니다. 각 인스턴스는 객체성 스코어 맵에서 얻은 점수와 연결됩니다.
   - 다중 스케일 추론을 위해 여러 크기로 이미지를 리사이징하여 모든 인스턴스를 계산합니다.
   - 이진 마스크를 형성하기 위해 값을 자르고, 객체성 점수와 박스-레벨 IoU 기반의 비최대 억제(NMS)를 적용하여 최종 세그먼트 제안을 생성합니다.

## 📊 Results

- **PASCAL VOC 2012:**

  - **$k^2$ 값에 대한 분석:** $k=3$ (9개 맵)일 때도 좋은 성능을 보였고, $k=5$ 또는 $k=7$일 때 약간의 성능 향상을 보였지만 큰 차이는 없었습니다. 이는 제안된 방법이 상대적 위치의 세분화에 크게 민감하지 않음을 보여줍니다.
  - **DeepMask 방식과의 비교:** `~DeepMask` (본 논문에서 재구현한 DeepMask)와 비교하여, 224x224 이미지 크롭으로 학습했을 때도 InstanceFCN이 더 높은 AR(Average Recall)을 달성했습니다. 전체 크기 이미지로 학습했을 때는 성능이 더욱 향상되어, 완전 컨볼루션 방식의 장점을 입증했습니다. InstanceFCN은 DeepMask에 비해 마스크 생성 레이어의 파라미터 수가 500배 이상 적었습니다 (약 0.1M vs. 53M).
  - **최신 세그먼트 제안 방법과의 비교:** Selective Search(SS), Multiscale Combinatorial Grouping(MCG), `~DeepMask`, Multi-task Network Cascade(MNC) 등과 비교하여, InstanceFCN은 특히 AR@10에서 MNC보다 5.5% 높은 성능을 보이며 전반적으로 경쟁력 있는 결과를 달성했습니다.
  - **인스턴스 의미론적 분할 성능:** 다운스트림 분류기와 함께 사용했을 때, InstanceFCN은 mAP@0.7에서 43.0%로 가장 높은 점수를 기록했습니다. 이는 MNC의 두 단계 학습 버전보다도 우수한 결과입니다.

- **MS COCO:**
  - DeepMask, DeepMaskZoom 등 기존 방법론들과 비교하여, InstanceFCN은 AR@10, AR@100, AR@1000 모든 지표에서 더 높은 AR 점수를 기록하며 우수한 인스턴스 세그먼트 제안 성능을 입증했습니다.

## 🧠 Insights & Discussion

- **FCN의 확장성 입증:** 이 연구는 FCN이 의미론적 분할을 넘어 인스턴스 수준의 세그먼트 제안 문제에도 효과적으로 적용될 수 있음을 보여주며, FCN 계열의 응용 분야를 확장했습니다.
- **효율적인 모델 설계:** 마스크 해상도에 의존하는 고차원 레이어를 사용하지 않고도 인스턴스 분할을 수행할 수 있도록 설계된 것은 중요한 발전입니다. 이는 모델의 파라미터 수를 대폭 줄여 계산 비용을 절감하고, 특히 PASCAL VOC와 같은 소규모 데이터셋에서의 오버피팅 위험을 낮추는 데 기여했습니다.
- **지역적 일관성 활용의 중요성:** 이미지의 지역적 일관성 특성을 활용하여 픽셀 단위 예측을 효과적으로 재사용할 수 있었던 점은, 복잡한 인스턴스 분할 문제에 대한 효율적인 해결책을 제시했습니다.
- **범용성:** 제안된 InstanceFCN은 다양한 크기의 입력 이미지를 처리할 수 있으며, 다중 스케일 추론을 통해 견고한 성능을 보여줍니다.
- **향후 연구 방향:** 이 연구의 성공은 FCN 패러다임을 유지하면서 더 복잡한 비전 문제를 해결할 수 있는 새로운 가능성을 열었으며, 이는 FCN 아키텍처의 지속적인 발전을 기대하게 합니다.

## 📌 TL;DR

이 논문은 기존 FCN이 인스턴스 분할을 수행하지 못하는 문제를 해결하기 위해 **인스턴스-민감 완전 컨볼루션 네트워크(InstanceFCN)**를 제안합니다. InstanceFCN은 객체 인스턴스에 대한 **상대적 위치를 분류하는 $k^2$개의 스코어 맵**을 생성하고, 이를 **간단한 조립 모듈**로 결합하여 인스턴스 세그먼트 후보를 만듭니다. DeepMask와 달리 **마스크 해상도에 의존하는 고차원 레이어 없이** 이미지의 지역적 일관성을 활용하여 파라미터 수를 대폭 줄이고 오버피팅 위험을 낮췄습니다. PASCAL VOC와 MS COCO에서 경쟁력 있는 세그먼트 제안 성능을 달성하여, FCN이 인스턴스 분할에도 효과적으로 적용될 수 있음을 입증했습니다.
