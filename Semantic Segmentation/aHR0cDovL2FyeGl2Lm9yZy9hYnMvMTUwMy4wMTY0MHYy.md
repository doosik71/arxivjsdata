# BoxSup: Exploiting Bounding Boxes to Supervise Convolutional Networks for Semantic Segmentation
Jifeng Dai, Kaiming He, Jian Sun

## 🧩 Problem to Solve
최근 의미론적 세그멘테이션(Semantic Segmentation) 분야에서 딥 컨볼루션 네트워크(CNNs)가 뛰어난 성능을 보이고 있지만, 이들은 픽셀 단위의 정교한 세그멘테이션 마스크 주석에 의존합니다. 이러한 픽셀 단위 주석은 시간과 비용이 매우 많이 소요되어, 네트워크 성능 향상에 필수적인 대규모 훈련 데이터 확보를 어렵게 만듭니다. 또한, 많은 최첨단 방법들이 세밀한 픽셀 단위 주석을 충분히 활용하지 못하는 경우도 있습니다. 이에 본 연구는 비교적 쉽게 얻을 수 있는 바운딩 박스(Bounding Box) 주석만으로도 경쟁력 있는 세그멘테이션 성능을 달성할 수 있는 방법을 탐구합니다.

## ✨ Key Contributions
*   **바운딩 박스만으로 지도 학습 가능성 입증**: 픽셀 단위 마스크 주석 없이 바운딩 박스만으로 딥 컨볼루션 네트워크를 훈련하여, 완전한 마스크 기반 지도 학습과 견줄 만한 의미론적 세그멘테이션 정확도를 달성했습니다 (예: 62.0% mIoU 대 63.8% mIoU).
*   **반복적인 마스크 정제 및 네트워크 훈련 프레임워크 제안**: 자동으로 영역 제안을 생성하고 이를 통해 네트워크를 훈련하는 과정을 반복하여, 초기의 부정확한 마스크 추정치를 점진적으로 개선하고 네트워크 성능을 향상시킵니다.
*   **대규모 바운딩 박스 데이터 활용의 효과 입증**: 기존에 풍부하게 존재하는 대규모 바운딩 박스 주석 데이터셋(예: COCO)을 효과적으로 활용하여 딥 컨볼루션 네트워크의 잠재력을 최대한 발휘하고, PASCAL VOC 2012 및 PASCAL-CONTEXT 벤치마크에서 최신(state-of-the-art) 성능을 달성했습니다.
*   **반지도 학습 방식 제시**: 픽셀 단위 마스크와 바운딩 박스 주석이 혼합된 시나리오에서, 대부분의 마스크 주석을 바운딩 박스로 대체하더라도 동등한 정확도를 유지할 수 있음을 보여주어 주석 비용을 크게 절감할 수 있음을 시사합니다.
*   **오류 분석 및 통찰**: 바운딩 박스 데이터가 주로 객체 인식 정확도(객체 내부 영역)를 향상시키며, 이는 학습된 컨볼루션 네트워크의 특징 품질 개선에 기인함을 분석적으로 밝혔습니다.

## 📎 Related Works
*   **딥 컨볼루션 네트워크 (CNNs) 기반 세그멘테이션**: FCN (Fully Convolutional Networks), DeepLab, CFM (Convolutional Feature Masking) 등 CNN을 활용한 최신 의미론적 세그멘테이션 방법들이 언급됩니다. 이들은 풍부한 계층적 특징 추출기로서 CNN을 활용합니다.
*   **전이 학습 (Transfer Learning)**: 대규모 ImageNet 데이터셋에서 사전 훈련된 딥 네트워크를 객체 감지(R-CNN)나 세그멘테이션과 같은 다른 작업에 미세 조정하는 전략이 널리 채택됩니다.
*   **훈련 데이터 크기의 중요성**: 훈련 데이터셋의 크기가 증가할수록 CNN의 정확도가 향상된다는 점이 강조되며, VOC 2007과 VOC 2012 데이터셋의 결합이나 비디오 추적 결과로부터 훈련 데이터 확장 사례가 언급됩니다.
*   **바운딩 박스 활용 기존 연구**: 이전에도 바운딩 박스 주석을 활용한 세그멘테이션 연구(GrabCut, WSSL 등)가 있었으나, 본 연구는 이를 딥 컨볼루션 네트워크 훈련에 직접적으로 적용하는 방법을 제안합니다.

## 🛠️ Methodology
BoxSup는 바운딩 박스 주석만을 사용하여 컨볼루션 네트워크를 훈련하기 위해 다음과 같은 반복적인 훈련 알고리즘을 제안합니다.

1.  **초기 후보 세그먼트 마스크 생성**:
    *   MCG(Multiscale Combinatorial Grouping)와 같은 비지도 영역 제안(unsupervised region proposal) 방법을 사용하여 각 훈련 이미지에 대한 고정된 후보 세그먼트 마스크 집합을 생성합니다.
    *   **주목**: 이 후보 제안은 오직 훈련을 위해서만 사용되며, 테스트 시에는 훈련된 FCN이 직접 픽셀 단위 예측을 생성하므로 추론 효율성에는 영향을 미치지 않습니다.

2.  **결합된 목표 함수 정의**:
    *   네트워크 매개변수 $\theta$와 각 후보 세그먼트 $S$에 할당된 라벨 $l_S$를 최적화하기 위해 두 가지 항을 결합한 목표 함수를 최소화합니다:
        $$ \min_{\theta, \{l_S\}} \sum_i (E_o + \lambda E_r) $$
        여기서 $i$는 훈련 이미지에 대한 합산이며, $\lambda=3$은 고정된 가중치 매개변수입니다.

    *   **$E_o$ (겹침 목표 함수)**:
        *   지면 진실 바운딩 박스 $B$와 후보 세그먼트 $S$의 바운딩 박스 사이의 IoU (Intersection-over-Union)를 통해, 지면 진실 박스에 잘 맞는 후보 마스크를 선택하도록 유도합니다.
        $$ E_o = \frac{1}{N} \sum_S (1 - \text{IoU}(B, S)) \delta(l_B, l_S) $$
        여기서 $l_B$는 지면 진실 박스의 라벨, $l_S$는 세그먼트 $S$에 할당된 라벨이며, $\delta$는 라벨이 일치할 때 1, 그렇지 않으면 0입니다.

    *   **$E_r$ (회귀 목표 함수)**:
        *   네트워크의 픽셀별 예측 $X_{\theta}(p)$를 추정된 세그먼트 라벨 $l_S(p)$에 회귀하는 픽셀별 손실 함수입니다 (FCN의 훈련 목표와 유사).
        $$ E_r = \sum_p e(X_{\theta}(p), l_S(p)) $$

3.  **탐욕적인 반복 훈련 알고리즘**:
    *   네트워크 매개변수 $\theta$와 세그먼트 라벨링 $\{l_S\}$을 번갈아 업데이트하며 지역 최적해를 찾습니다.
    *   **세그먼트 라벨 업데이트**:
        *   네트워크 매개변수 $\theta$가 고정된 상태에서, 각 지면 진실 바운딩 박스에 대해 가장 적은 비용($E_o + \lambda E_r$)을 갖는 상위 $k=5$개의 후보 세그먼트 중에서 무작위로 하나를 선택하여 해당 바운딩 박스의 라벨을 할당합니다. 나머지 픽셀은 배경으로 처리됩니다. (무작위 샘플링은 샘플 분산을 증가시켜 훈련 성능을 향상시킴)
    *   **네트워크 매개변수 $\theta$ 업데이트**:
        *   세그먼트 라벨링 $\{l_S\}$이 고정된 상태에서, SGD(Stochastic Gradient Descent)를 사용하여 FCN 훈련 방식과 동일하게 네트워크 매개변수 $\theta$를 업데이트합니다.
    *   이 두 단계를 매 epoch마다 반복합니다. 네트워크는 ImageNet 분류 데이터셋으로 사전 훈련된 모델로 초기화됩니다.

4.  **반지도 학습 적용**:
    *   일부 샘플에 마스크 주석이 있고 다른 샘플에 바운딩 박스 주석만 있는 경우에도 적용 가능합니다. 마스크 주석이 있는 샘플은 실제 라벨을 사용하고, 바운딩 박스만 있는 샘플은 위에서 설명한 후보 제안을 통해 라벨을 할당합니다.

## 📊 Results
*   **PASCAL VOC 2012 유효성 검사 (Validation) 세트**:
    *   **바운딩 박스만 사용**: BoxSup는 62.0%의 mIoU를 달성하여, 완전 마스크 지도 학습 baseline (DeepLab-CRF의 63.8%)과 비교하여 1.8%의 작은 성능 하락만 보였습니다.
    *   **반지도 학습 (9/10 바운딩 박스)**: 원본 이미지의 마스크와 나머지 이미지의 바운딩 박스를 사용했을 때 63.5% mIoU를 달성하여, 완전 마스크 지도 학습 baseline과 거의 동일한 성능을 보였습니다.
    *   **대규모 데이터 활용**: COCO 데이터셋의 123k 바운딩 박스 주석을 추가로 활용하여 68.2% mIoU를 달성, VOC 마스크만 사용한 경우(63.8%)보다 4.4% 향상되었습니다.
    *   **마스크 추정 방법 비교**: BoxSup의 반복적 마스크 업데이트(62.0%)는 직사각형 마스크(52.3%)나 GrabCut 마스크(55.2%)를 고정적으로 사용한 경우보다 월등히 우수함을 보여주었습니다.
    *   **영역 제안 방법 비교**: MCG(62.0%)가 Selective Search(59.5%)나 GOP(60.4%)보다 높은 정확도를 보여, 고품질 영역 제안의 중요성을 입증했습니다.

*   **PASCAL VOC 2012 테스트 (Test) 세트**:
    *   바운딩 박스만으로 지도 학습된 BoxSup는 64.6% mIoU를 기록하여, 유사한 방법인 WSSL(60.4%)보다 우수했습니다.
    *   VOC 마스크와 COCO 바운딩 박스를 활용한 반지도 학습 BoxSup는 71.0% mIoU를 달성, 이는 최신 완전 마스크 지도 학습 방법(WSSL의 70.4%)보다 높으면서도 훨씬 약한 주석 정보를 사용한 결과입니다.
    *   VOC 2007 박스 데이터까지 추가 활용하여 73.1%까지 성능이 향상되었고, 간단한 테스트 시간 증강(test-time augmentation)을 통해 75.2%까지 도달하여, 마스크 주석 없이도 최신 완전 지도 학습 결과와 견줄 만한 성능을 보였습니다.

*   **PASCAL-CONTEXT 유효성 검사 세트**:
    *   COCO 바운딩 박스로 사전 훈련된 BoxSup 모델은 40.5% mIoU를 달성, baseline(35.7%)보다 4.8% 향상되어 대규모 박스 주석이 네트워크 훈련에 긍정적인 영향을 미침을 재확인했습니다.

*   **오류 분석**: BoxSup는 대규모 바운딩 박스를 통해 주로 **객체 인식 정확도**(객체 내부 영역의 mIoU)를 크게 향상시켰으며, 객체 **경계** 영역의 개선은 상대적으로 작았습니다. 이는 대규모 박스 데이터가 모델의 특징 품질을 개선하여 전반적인 인식 성능을 향상시킨다는 것을 시사합니다.

## 🧠 Insights & Discussion
*   **주석 효율성 극대화**: BoxSup는 값비싼 픽셀 단위 세그멘테이션 마스크 주석의 필요성을 크게 줄여주면서도 경쟁력 있는 성능을 유지함으로써, 대규모 데이터셋 구축 및 활용에 있어 비용 효율적인 대안을 제시합니다.
*   **대규모 약한 주석 데이터의 잠재력 발현**: 이미 풍부하게 존재하는 바운딩 박스 주석 데이터를 효과적으로 활용하여 기존의 완전 지도 학습 방식으로는 달성하기 어려웠던 성능 향상을 이끌어냈습니다. 이는 약한 주석 데이터를 통해 딥러닝 모델의 규모를 확장하는 중요한 방향을 제시합니다.
*   **객체 인식 능력 향상**: 오류 분석을 통해 대규모 바운딩 박스 데이터가 주로 네트워크의 객체 인식 능력(객체 내부 영역에 대한 정확도)을 향상시킨다는 점이 밝혀졌습니다. 이는 세그멘테이션 성능 향상이 단순한 경계 개선을 넘어, 모델이 객체를 더 잘 '이해'하고 '구분'하는 능력에서 비롯됨을 시사합니다.
*   **반복적 정제 과정의 중요성**: 초기에는 부정확한 마스크 추정치에서 시작하지만, 네트워크 피드백을 통해 마스크를 점진적으로 정제하고 이 마스크를 다시 네트워크 훈련에 활용하는 반복적인 과정이 성능 향상에 결정적인 역할을 합니다. 훈련 중 무작위 샘플링 전략이 성능 향상에 기여한 점도 주목할 만합니다.
*   **한계 및 향후 연구**: 바운딩 박스는 픽셀 단위 경계 정보가 없으므로, 경계의 정교한 세그멘테이션은 여전히 추가적인 연구가 필요할 수 있습니다. 그러나 이 연구는 약한 주석을 활용한 의미론적 세그멘테이션 분야의 중요한 발전이며, 더 나아가 다양한 비전 작업에 적용될 수 있는 잠재력을 가지고 있습니다.

## 📌 TL;DR
본 논문은 의미론적 세그멘테이션에서 값비싼 픽셀 단위 마스크 주석 대신 쉽게 얻을 수 있는 바운딩 박스 주석만을 사용하여 딥 컨볼루션 네트워크를 훈련하는 **BoxSup** 방법을 제안합니다. BoxSup는 비지도 영역 제안으로 마스크를 추정하고, 이 마스크를 바탕으로 네트워크를 훈련하며, 훈련된 네트워크의 피드백을 통해 마스크를 점진적으로 정제하는 반복적인 과정을 사용합니다. 이 방법은 바운딩 박스만으로도 완전 마스크 지도 학습과 경쟁력 있는 성능을 달성하며, 대규모 바운딩 박스 데이터(예: COCO)를 활용하여 최신 결과를 기록했습니다. 이는 주석 비용을 크게 줄이면서 딥 네트워크의 잠재력을 최대한 활용할 수 있는 효과적인 접근 방식을 제시합니다.