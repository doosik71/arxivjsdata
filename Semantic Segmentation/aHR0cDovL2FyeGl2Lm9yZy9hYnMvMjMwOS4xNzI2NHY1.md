# A FOUNDATION MODEL FOR GENERAL MOVING OBJECT SEGMENTATION IN MEDICAL IMAGES

Zhongnuo Yan, Tong Han, Yuhao Huang, Lian Liu, Han Zhou, Jiongquan Chen, Wenlong Shi, Yan Cao, Xin Yang, Dong Ni

## 🧩 Problem to Solve

의료 영상 분할은 임상 진단 및 치료 계획에 필수적입니다. 그러나 고정밀 딥러닝 분할 모델을 구축하기 위해서는 방대한 양의 고품질 주석 데이터가 필수적입니다. 특히 의료 비디오나 3D 볼륨의 경우, 거대한 레이블링 공간과 프레임 간 일관성 부족으로 인해 수동 주석 작업이 매우 번거롭고 시간이 많이 소요됩니다. 자연 이미지 분야에서는 움직이는 객체 분할(Moving Object Segmentation, MOS)이 최소한의 주석으로 움직이는 객체를 분할하는 데 상당한 진전을 보였으나, 의료 영상에 특화된 MOS 연구는 아직 부족합니다. 기존 2D 분할 모델(예: SAM)을 의료 비디오나 3D 볼륨에 직접 적용하는 것은 추가적인 어려움을 야기하며, 여러 프레임/슬라이스 분할을 위해 상당한 수동 프롬프트가 필요하여 유연성과 편의성이 제한됩니다. 이 연구는 이러한 의료 영상 MOS 분야의 공백을 해결하고자 합니다.

## ✨ Key Contributions

* **의료 영상 MOS를 위한 최초의 파운데이션 모델 제안**: 의료 영상에서 움직이는 객체 분할(MOS)을 위한 최초의 파운데이션 모델인 iMOS를 제안했습니다.
* **단일 프레임 주석 기반의 양방향 분할 성능 달성**: 시퀀스 내 단 하나의 이미지(프레임/슬라이스)에 대한 주석만으로 전체 시퀀스에 걸쳐 움직이는 객체의 추적 및 분할을 만족스러운 수준으로 수행하며, 전방향 및 후방향 분할이 가능합니다.
* **광범위한 멀티모달 의료 데이터셋에서의 유효성 검증**: CT, MRI, 초음파, 내시경, 전자 현미경 등 5가지 모달리티를 포함하는 대규모 멀티모달 의료 데이터셋에서 iMOS의 유효성과 일반화 능력을 광범위한 실험을 통해 검증했습니다.
* **강력한 일반화 능력 입증**: 훈련 과정에서 보지 못했던 객체에 대해서도 우수한 분할 성능을 보여, 제안된 MOS 모델의 강력한 일반화 능력을 입증했습니다.

## 📎 Related Works

이전 MOS 연구들은 크게 비지도(Unsupervised) 및 준지도(Semi-supervised) 접근 방식으로 나눌 수 있습니다.

* **비지도 MOS**: 수동 개입 없이 객체 시퀀스를 분할하는 것을 목표로 합니다.
  * **전통적인 방법**: 유사성 계산, 움직임 경계, 임계값 등을 사용했으나, 폐색, 대비, 복잡한 구조에 취약했습니다.
  * **딥러닝 기반 방법**: 광학 흐름, 시간적 일관성, 움직임 정보 강화를 통해 객체 움직임 정보를 모델링했지만, 감독 부족으로 인해 견고성과 효율성이 부족했습니다.
* **준지도 MOS**: 첫 프레임 또는 초기 프레임의 마스크를 감독 정보로 사용합니다.
  * **초기 접근법**: 데이터 증강 기반 방법은 효율성이 제한적이고 처리 속도가 느렸습니다.
  * **추적 기반 방법**: 움직이는 객체 모니터링에 능숙했지만, 시간이 지남에 따라 오류가 누적되는 경향이 있었습니다.
  * **메모리 기반 방법**: XMem [7]과 같이 뛰어난 성능과 간단한 아키텍처로 인해 현재 MOS의 주요 접근 방식으로 부상했습니다.
* **한계**: 위에 언급된 모든 방법은 자연 이미지 분할을 위해 구축되었으며, 의료 영상의 고유한 특성(복잡한 구조, 낮은 대비, 아티팩트 등)과 도전 과제를 해결하는 데는 한계가 있었습니다.

## 🛠️ Methodology

iMOS는 XMem [7]을 기반으로 구축된 준지도 MOS 모델이며, 단일 프레임에 대한 수동 주석만으로 전체 시퀀스의 분할을 완료합니다.

* **아키텍처 구성**: iMOS는 세 가지 학습 가능한 모듈(쿼리 인코더, 디코더, 값 인코더)과 세 가지 메모리 시스템(감각 기억, 작업 기억, 장기 기억)으로 구성됩니다.

* **메모리 읽기 (Memory Reading)**:
  * 주어진 이미지 시퀀스와 첫 프레임의 타겟 객체 마스크를 사용하여 감각 기억과 작업 기억을 초기화합니다.
  * 후속 이미지의 경우, 쿼리 $q$와 메모리 키 $k$ 사이의 유사도 $W$를 기반으로 메모리 값 $v$에서 읽기 피처 $F$를 추출합니다.
  * 디코더는 $F$와 이전 시간 단계의 감각 기억으로부터의 숨겨진 표현 $h_{t-1}$을 사용하여 마스크를 생성합니다.
  * 값 인코더는 매 $r$번째 프레임마다 이미지와 마스크를 인코딩하여 새로운 메모리 값을 생성합니다.
  * 메모리 읽기 과정은 $F = vW(k,q)$로 표현됩니다.

* **메모리 업데이트 (Memory Updating)**:
  * **감각 기억 (Sensory Memory)**: 가장 빠른 빈도로 업데이트되어 단기 정보를 유지하며, 모든 프레임에서 디코더의 다중 스케일 피처를 활용하고 GRU를 통해 업데이트됩니다. 매 $r$번째 프레임마다 값 인코더가 생성한 메모리 값을 사용하여 또 다른 GRU를 통해 업데이트되어 불필요한 정보를 제거합니다.
  * **작업 기억 (Working Memory)**: 몇 초 동안의 정밀 매칭에 사용되며, 매 $r$번째 프레임마다 쿼리에서 복사된 메모리 값과 메모리 키가 작업 기억에 추가됩니다. 과도한 메모리 사용을 피하기 위해 작업 기억 프레임 수는 $T_{min}$과 $T_{max}$ 사이로 제한됩니다.
  * **장기 기억 (Long-term Memory)**: 압축되고 대표적인 피처를 저장합니다. 작업 기억이 저장 한계 $T_{max}$에 도달하면, 첫 프레임과 가장 최근의 $T_{min}-1$ 프레임을 제외한 모든 프레임은 프로토타입 선택(Prototype Selection) 및 메모리 증강(Memory Potentiation) 알고리즘을 통해 장기 기억에 추가됩니다.
    * **프로토타입 선택 (Prototype Selection)**: 작업 기억 내에서 가장 높은 사용 빈도(누적 총 유사도)를 가진 후보 키 $k_c$로부터 대표적인 부분집합인 프로토타입 키 $k_p$를 선택합니다.
    * **메모리 증강 (Memory Potentiation)**: 희소한 프로토타입 키 문제를 해결하기 위해 후보 키 $k_c$와 프로토타입 키 $k_p$ 사이의 유사도 행렬 $W(k_c, k_p)$를 사용하여 후보 값 $v_c$로부터 프로토타입 값 $v_p$를 추출합니다: $v_p = v_c W(k_c, k_p)$.

* **파라미터 효율적인 튜닝 (Parameter Efficient Tuning)**:
  * 모델의 빠르고 효율적인 미세 조정을 위해 Conv. Parallel 구조 [17] 기반의 어댑터 모듈을 도입했습니다.
  * 쿼리 인코더와 값 인코더의 파라미터를 고정하고 어댑터를 적용하여 의료 이미지와 자연 이미지 간의 잔차 표현을 학습하도록 합니다.

## 📊 Results

* **데이터셋**: CT, MRI, 초음파, 내시경, 전자 현미경 등 5가지 모달리티를 포함하는 대규모 공개 데이터셋을 수집하여 사용했습니다. 각 비디오/3D 볼륨은 첫 프레임부터 마지막 프레임까지 객체를 추적하도록 구성되었습니다.
* **평가 지표**: 영역 유사도 $J$ [22], 윤곽 유사도 $F$ [23], 그리고 이들의 평균 $J\&F$를 사용하여 종합적인 평가를 수행했습니다.
* **유효성 실험 (Validity Experiment)**: 모델 미세 조정 후 모든 5가지 모달리티에서 성능이 향상되었으며, 특히 MRI에서 $J\&F$가 28.7% 증가하는 가장 높은 개선을 보였습니다.
* **일반화 실험 (Generalizability Experiment)**: 거의 모든 카테고리에서 $F > 0.8$을 달성했으며, 일부는 $0.9$에 도달하여 윤곽 정확도에서 iMOS의 우수한 성능을 나타냈습니다. 훈련 세트에 포함되지 않은 카테고리(*로 표시)에 대해서도 좋은 분할 결과를 달성하여 강력한 일반화 능력을 입증했습니다.
* **정성적 결과**: 단일 프레임 수동 주석만으로 이미지 시퀀스 내의 객체를 정확하게 추적 및 분할할 수 있었습니다. 작거나 분할된 객체에서도 잘 작동했으며, 3D 볼륨 분할(예: 폐) 및 양방향(전방향 및 후방향) 분할에서도 일관되고 양호한 성능을 보였습니다.

## 🧠 Insights & Discussion

* **혁신적인 솔루션**: iMOS는 의료 영상에서 움직이는 객체 분할이라는 새로운 과제를 해결하기 위한 선구적인 파운데이션 모델을 제시합니다. 이는 기존 자연 영상 기반 MOS 모델의 한계를 극복하고 의료 영상 특유의 복잡성과 정밀성 요구 사항을 충족시킵니다.
* **실용적 효용성**: 단 하나의 프레임에 대한 수동 주석만으로 시퀀스 전체를 분할할 수 있는 능력은 의료 전문가의 주석 속도를 획기적으로 가속화하고 주석 품질을 최적화할 잠재력을 가지고 있습니다. 이는 특히 시간 소모적인 의료 비디오 및 3D 볼륨 주석 작업에서 큰 이점을 제공합니다.
* **강력한 일반화**: 훈련 세트에서 보지 못한 새로운 해부학적 구조나 병변에 대해서도 뛰어난 분할 성능을 보여준다는 점은 iMOS가 실제 임상 환경에서 광범위하게 적용될 수 있는 강력한 일반화 능력을 갖추고 있음을 시사합니다.
* **의료 AI 발전 기여**: iMOS는 의료 비디오 또는 3D 볼륨 주석 작업 보조를 위한 기술 축적에 기여하며, 궁극적으로 의료 영상 분석 커뮤니티의 발전을 촉진할 것으로 기대됩니다.

## 📌 TL;DR

이 논문은 의료 영상에서 움직이는 객체 분할(MOS)을 위한 최초의 파운데이션 모델인 iMOS를 제안합니다. 기존 의료 영상 주석의 높은 비용과 비효율성을 해결하기 위해, iMOS는 단 하나의 프레임(비디오의 첫 프레임 또는 3D 볼륨의 첫 슬라이스)에 대한 수동 주석만으로 전체 시퀀스에 걸쳐 움직이는 객체를 자동으로 분할하고 추적합니다. 광범위한 멀티모달 의료 데이터셋에 대한 실험을 통해 iMOS의 유효성, 강력한 일반화 능력, 그리고 전방향 및 후방향 분할 가능성을 입증했으며, 이는 의료 영상 주석 속도와 품질을 크게 향상시키고 의료 AI 발전에 기여할 잠재력을 보여줍니다.
