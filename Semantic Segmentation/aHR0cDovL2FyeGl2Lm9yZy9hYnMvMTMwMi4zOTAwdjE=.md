# Robust Image Segmentation in Low Depth Of Field Images

Franz Graf, Hans-Peter Kriegel, and Michael Weiler

## 🧩 Problem to Solve

이 논문은 낮은 피사계 심도(Low Depth Of Field, DOF) 이미지에서 관심 객체(Object Of Interest, OOI)를 완전 자동으로, 강건하게, 그리고 매개변수 없이 분할하는 문제를 다룹니다. 낮은 DOF 이미지는 주로 OOI는 선명하고 배경은 흐릿하게 표현되는데, 이러한 이미지에서 OOI와 배경 사이의 경계가 모호하고 점진적으로 변하기 때문에 기존 알고리즘으로는 정확한 분할이 어렵습니다. 또한, 이미지의 DOF 정도, 배경의 복잡성, 이미지 해상도, 색상 정보 유무 등 다양한 요인에 구애받지 않는 범용적인 분할 알고리즘의 필요성이 증가하고 있습니다.

## ✨ Key Contributions

* **매개변수 없는(Parameterless) 알고리즘 제안**: 사용자 설정이 필요 없는 완전 자동 알고리즘을 제안하여, 다양한 이미지 유형에 적용 가능합니다.
* **뛰어난 강건성(Superior Robustness) 입증**: 기존의 유사한 세 가지 알고리즘과 비교하여 낮은 DOF 이미지는 물론, DOF가 비교적 커서 배경에 상당한 구조가 있는 이미지에서도 뛰어난 분할 정확도를 보입니다.
* **$L^*a^*b^*$ 색 공간 활용**: 인간의 시각적 인지 차이를 더 잘 반영하는 $L^*a^*b^*$ 색 공간을 사용하여 선명도 및 색상 유사도를 계산합니다.
* **밀도 기반 클러스터링(DBSCAN) 적용**: 밀도 기반 클러스터링 알고리즘인 DBSCAN을 활용하여 노이즈(배경의 작은 선명 영역)를 효과적으로 제거하고 주요 OOI 영역을 식별합니다.
* **이미지 유사도에 대한 영향 분석**: 낮은 DOF 분할이 내용 기반 이미지 검색(CBIR) 시스템에서 이미지 유사도 측정 정확도를 향상시킬 수 있음을 실험적으로 보여줍니다.

## 📎 Related Works

* **초기 접근법**:
  * [12, 14]: 낮은 DOF 이미지 분할에 대한 초기 접근법으로, [14]는 엣지 기반 알고리즘을, [12]는 블록 기반 다중 해상도 웨이블릿 변환을 사용했습니다. 단, [12]는 낮은 DOF, 완전 초점 OOI, 높은 해상도에 의존한다는 한계가 있었습니다.
  * [16, 15]: 높은 주파수 웨이블릿을 사용하여 분할을 수행했지만, 단독으로 사용 시 강건성이 떨어진다는 단점이 있었습니다 [9].
* **초점 맵(Focus Map) 기반**:
  * [10]: 국소적 블라인드 역합성(localized blind deconvolution)을 통해 초점 맵을 생성했으나, 순수한 이미지 분할 알고리즘은 아니며, 색상 정보를 활용하지 않았습니다.
* **형태학적 필터링 기반**:
  * [7]: 형태학적 필터링을 사용하여 분할하는 알고리즘으로 본 논문의 주요 비교 대상 중 하나입니다. 배경에 유의미한 구조가 있거나 높은 ISO 값으로 촬영된 이미지, 공간적으로 분리된 OOI에 문제가 있었습니다.
* **비디오 시퀀스 및 기타**:
  * [9, 13, 7, 8]: DOF 이미지 및 비디오 시퀀스 분할에 대한 연속 연구들입니다.
  * [11]: 비디오의 단일 프레임을 살리언시 맵으로 처리하고 형태학적 필터를 적용하여 트라이맵(tri-map)을 생성하는 방식입니다. 본 논문의 비교 대상 중 하나입니다.
  * [18]: 평균 이동(mean shift)을 이용해 이미지를 영역으로 분리한 후, 색상 특징과 웨이블릿 모듈러스 최대 엣지 포인트 밀도를 사용하고 퍼지 집합(fuzzy set)을 비퍼지화(defuzzification)하여 OOI를 분할하는 퍼지 분할(fuzzy segmentation) 접근법입니다. 본 논문의 비교 대상 중 하나입니다.

## 🛠️ Methodology

제안된 알고리즘은 다음 다섯 가지 단계로 구성됩니다:

1. **Deviation Scoring (편차 점수 계산)**:
    * 원본 이미지를 $L^*a^*b^*$ 색 공간으로 변환합니다.
    * 가우시안 커널($\sigma = \Theta_\sigma = \frac{1}{10}$)로 이미지를 필터링하여 노이즈를 제거한 후 $I'$를 얻습니다.
    * $I'$에 다시 가우시안 커널을 적용하여 $I'_\sigma$를 생성합니다.
    * 각 픽셀 $p(x,y)$에 대해, $I'$와 $I'_\sigma$에서 $r$-이웃 평균 색상과 픽셀 자체의 색상 간 $\Delta E^*$ 거리를 계산하여 이웃 편차 $\Delta \eta_r$를 구합니다.
    * $I'$의 $\Delta \eta_r(x,y)$와 $I'_\sigma$의 $\Delta \eta_r(x,y)$ 간의 차이 제곱을 통해 픽셀의 최종 점수 $\mu(x,y)$를 계산합니다.
    * $\mu(x,y)$가 임계값 $\Theta_{score}=50$을 초과하는 픽셀만 OOI 후보(candidate)로 선정합니다.

2. **Score Clustering (점수 클러스터링)**:
    * OOI 후보 픽셀 집합 $I_{score}$에 밀도 기반 클러스터링 알고리즘 DBSCAN을 적용합니다.
    * DBSCAN의 매개변수 $\epsilon$은 이미지 크기 $|I|$에 비례하여 $\epsilon = \sqrt{|I|} \cdot \Theta_\epsilon$로, $minPts$는 $\epsilon$과 $I_{score}$의 분포에 따라 자동으로 결정됩니다. ($\Theta_\epsilon=0.025$)
    * 가장 큰 클러스터 크기의 절반 미만인 작은 클러스터들은 노이즈로 간주하여 제거합니다.

3. **Mask Approximation (마스크 근사)**:
    * 남아있는 클러스터의 모든 코어 포인트(core point)의 $\epsilon$-이웃에 대한 볼록 껍질(convex hull)을 생성합니다.
    * 이러한 볼록 껍질 다각형 내에 위치하는 픽셀들을 1로, 나머지를 0으로 표시하여 이진 근사 마스크 $I_{app}$를 만듭니다.
    * 근사 마스크에 형태학적 닫힘(morphological closing)과 재구성 팽창(dilation by reconstruction) 연산을 적용하여 작은 구멍을 메우고 마스크를 부드럽게 합니다. (구조 요소 크기는 $\sqrt{|I_{app}|} \cdot \Theta_{rec}$, $\Theta_{rec}=\frac{1}{3}$)

4. **Color Segmentation (색상 분할)**:
    * 근사 마스크 $I_{app}$ 내의 픽셀들을 원본 이미지 $I$에서 유사한 색상을 가진 그룹으로 나눕니다.
    * $L^*a^*b^*$ 색 공간에서 두 픽셀 간의 $\Delta E^*$ 거리가 임계값 $\Theta_{dist}=25$ 미만인 경우 유사한 색상으로 간주하여 재귀적으로 영역을 확장합니다.

5. **Region Scoring (영역 점수 계산)**:
    * 각 색상 영역 $r \in R_{color}$에 대해 마스크 관련성(Mask Relevance) $MR_r = SBO_r \cdot MBO_r$ 값을 계산합니다.
        * $SBO_r$ (Score Boundary Overlap): 영역 $r$이 주변 스코어 값 $\mu$에 얼마나 인접한지 나타냅니다.
        * $MBO_r$ (Mask Boundary Overlap): 영역 $r$이 근사 마스크 $I_{app}$에 얼마나 인접한지 나타냅니다.
    * $MR_r$ 값이 임계값 $\Theta_{rel}=\frac{2}{3}$보다 낮은 영역들을 근사 마스크 $I_{app}$에서 반복적으로 제거하여 최종 분할 마스크를 생성합니다.

## 📊 Results

* **성능 비교**: 65개의 실제 이미지 데이터셋에서 [7], [11], [18]의 세 가지 참조 알고리즘과 비교 평가했습니다.
  * **공간 왜곡(Spatial Distortion)**: 제안된 알고리즘은 평균 0.21의 공간 왜곡을 보이며, 이는 최고의 경쟁 알고리즘(0.51)보다 두 배 이상 낮은 수치입니다. 최소 오류는 0.01로, 다른 알고리즘(0.02)보다 우수했습니다.
  * **강건성**: 배경이 복잡하거나 DOF가 비교적 큰 이미지에서도 참조 알고리즘보다 훨씬 뛰어난 분할 결과를 보였습니다.
  * **해상도 영향**: 제안된 알고리즘은 입력 이미지의 해상도가 높을수록 정확도가 향상되는 경향을 보였으며, 이는 해상도가 커질수록 정확도가 떨어지는 경쟁 알고리즘과 대조됩니다.
  * **런타임**: 평균 28초로, [7](9초) 및 [11](2.7초)보다는 길지만, [18](54.2초)보다는 빠릅니다. 해상도 400x400 이상에서는 점수 클러스터링 단계에서 이미지 스케일링을 통해 런타임 증가가 둔화됩니다.
* **DOF가 유사도에 미치는 영향**: 내용 기반 이미지 검색(CBIR) 환경에서 OOI 분할이 이미지 유사도 측정에 긍정적인 영향을 미침을 입증했습니다. OOI를 분할하여 히스토그램 유사도를 측정했을 때, 클래스 내 거리는 평균 67%로 감소했고, 클래스 간 거리는 평균 81%로 감소하여 클래스 내/외 거리 차이가 평균 14% 향상되었습니다.

## 🧠 Insights & Discussion

* **매개변수 없는 설계의 강점**: 제안된 알고리즘은 수동으로 설정해야 할 매개변수가 없으므로, 다양한 종류의 이미지(회색조/컬러, 풍경/인물, 저/고해상도, 다양한 카메라 설정)에 대해 보편적으로 적용 가능하며 안정적인 성능을 제공합니다. 이는 실제 대규모 이미지 데이터 처리 시스템에 통합될 때 큰 이점으로 작용합니다.
* **$L^*a^*b^*$ 색 공간 및 DBSCAN의 효과**: $L^*a^*b^*$ 색 공간을 사용하여 색상 차이를 인간의 시각에 가깝게 측정하고, DBSCAN을 통해 밀집된 선명 영역을 OOI로 식별하고 배경의 노이즈를 효과적으로 걸러내는 것이 알고리즘의 핵심적인 강건성에 기여합니다.
* **단계별 정교화**: 편차 점수 계산부터 클러스터링, 마스크 근사, 색상 분할, 영역 점수 계산에 이르는 다단계 접근 방식은 초기 선명도 정보를 점진적으로 정교화하여 최종 OOI 마스크의 정확도를 높입니다.
* **CBIR의 잠재적 향상**: OOI 분할 정보가 이미지 유사도 측정에 활용될 때, 객체 기반 검색의 정확도를 크게 향상시킬 수 있음을 보여주며, 이는 낮은 DOF 이미지가 많은 데이터셋에서 특히 유용합니다.
* **한계 및 향후 연구**: 현재로서는 처리 속도 개선이 필요하며, 향후 비디오에 적용하거나 이미지의 DOF 여부를 자동으로 감지하는 기능 추가도 고려하고 있습니다.

## 📌 TL;DR

이 논문은 낮은 DOF 이미지에서 OOI를 완전 자동으로 분할하는 강력한 매개변수 없는 알고리즘을 제안합니다. $L^*a^*b^*$ 색 공간 기반의 편차 점수 계산, DBSCAN 클러스터링, 형태학적 필터링을 통한 마스크 근사, 그리고 색상 및 영역 관련성 점수 계산을 통해 복잡한 배경에서도 OOI를 정확히 분할합니다. 실험 결과, 기존 알고리즘 대비 훨씬 낮은 공간 왜곡(평균 0.21)과 뛰어난 강건성을 보여주었으며, OOI 분할이 내용 기반 이미지 검색 시스템에서 이미지 유사도 측정 정확도를 향상시킴을 입증했습니다.
