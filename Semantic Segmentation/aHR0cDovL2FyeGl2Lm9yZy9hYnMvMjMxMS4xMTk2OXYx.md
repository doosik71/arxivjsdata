# SA-Med2D-20M Dataset: Segment Anything in 2D Medical Imaging with 20 Million masks

Jin Ye, Junlong Cheng, Jianpin Chen, Zhongying Deng, Tianbin Li, Haoyu Wang, Yanzhou Su, Ziyan Huang, Jilong Chen, Lei Jiang, Hui Sun, Min Zhu, Shaoting Zhang, Junjun He, Yu Qiao

## 🧩 Problem to Solve

Segment Anything Model (SAM)과 같은 최신 파운데이션 모델이 자연 이미지 분할에서 뛰어난 성능을 보이지만, 의료 영상에 직접 적용할 경우 성능이 저조합니다. 이는 자연 영상과 의료 영상 간의 현저한 도메인 차이 때문이며, SAM과 같은 모델이 의료 지식을 학습하는 데 필요한 대규모, 다양하며 주석이 달린 의료 영상 데이터가 부재하기 때문입니다. 기존의 공개 의료 영상 데이터셋은 규모가 작고, 특정 모달리티나 해부학적 구조에 한정되어 다양성이 부족하여 강력한 범용 의료 비전 파운데이션 모델을 훈련하기에 역부족입니다.

## ✨ Key Contributions

* **SA-Med2D-20M 데이터셋 구축 및 공개:** 460만 개의 2D 의료 영상과 1,970만 개의 해당 마스크로 구성된 현존하는 최대 규모의 의료 영상 분할 데이터셋을 구축하고 공개했습니다.
* **광범위한 다양성 제공:** CT, MRI, X-ray 등 10가지 모달리티와 31개 주요 장기, 271개 레이블 클래스를 포함하여 거의 전신을 아우르는 광범위한 객체 유형과 높은 다양성을 제공합니다.
* **체계적인 데이터 처리 파이프라인 제안:** 다양한 원본 데이터셋으로부터 데이터를 수집하고, 3D/2D 영상 정규화 및 마스크 처리(다중 레이블 분할, 연결 요소 분리, 오버랩 영역 통합, 작은 마스크 제거) 과정을 상세히 설명합니다.
* **포괄적인 통계 및 분석 제공:** 데이터셋의 특성 및 활용도를 높이기 위해 모달리티, 해부학적 구조, 레이블 분포에 대한 상세한 통계와 분석을 제시합니다.
* **의료 비전 파운데이션 모델 개발 촉진:** 대규모 데이터셋을 통해 SAM과 같은 모델에 의료 지식을 통합하고, 의료 영상 분석 분야의 발전을 위한 핵심 자원을 제공합니다.

## 📎 Related Works

* **대규모 시각 모델 (LVMs):** CLIP, DALL·E 2, SegGPT, SEEM, SAM과 같은 모델들이 대규모 자연 영상 데이터셋 학습을 통해 뛰어난 일반화 능력을 보였으나, 의료 영상 도메인에 특화된 데이터셋 부족으로 의료 분야 성능이 제한적임을 언급합니다.
* **의료 영상 분할:** U-Net 및 그 변형 모델(U-Net++, ResU-Net, nnU-Net)과 같은 기존의 태스크별 모델은 특정 조건에서만 효과적입니다. 최근 SAM을 의료 영상에 적용하려는 시도(SAM 디코더 미세 조정, SAM 인코더 어댑터 설계, SAM 프롬프트 조작 등)가 있었으나, 제한된 데이터로 인해 충분한 효과를 보지 못했습니다.
* **대규모 의료 영상 데이터셋:** AbdomenCT-1K, BraTS21, AutoPET, TotalSegmentator 등 기존 공개 대규모 의료 데이터셋은 수천 건의 사례만 포함하여 자연 영상 데이터셋에 비해 규모가 현저히 작고 다양성이 부족하며, SA-Med2D-20M이 이러한 격차를 해소하고자 함을 강조합니다.

## 🛠️ Methodology

SA-Med2D-20M 데이터셋은 다음과 같은 체계적인 단계로 구축되었습니다.

1. **공개 리소스에서 데이터 수집:** TCIA, OpenNeuro, Grand Challenge, Synapse, GitHub 등 다양한 웹 소스에서 공개된 의료 영상 분할 데이터셋을 광범위하게 수집합니다.
2. **영상 정규화 (Image Normalization):**
    * **픽셀 값 정규화:** 다양한 모달리티와 수집 방법에 따라 상이한 픽셀 값을 가지는 원본 영상을 다음의 `Self-Min-Max normalization`을 사용하여 $[0, 255]$ 범위로 정규화합니다.
        $$x' = \lceil \frac{x - x_{min}}{x_{max} - x_{min}} \times 255 \rceil$$
        여기서 $x$는 원본 픽셀 값, $x_{min}$ 및 $x_{max}$는 해당 영상 내 최소 및 최대 픽셀 값입니다.
    * **차원 통합 (3D to 2D):** CT, MR, PET 등 3D 영상은 세 가지 축(axial, sagittal, coronal)으로 슬라이스하여 2D 영상으로 변환합니다.
    * **극단적인 종횡비 이미지 제거:** 짧은 변의 길이가 긴 변의 절반 미만인 슬라이스 이미지는 극도로 흐릿한 타겟 영역을 방지하기 위해 제외합니다.
    * 모든 처리된 영상은 "PNG" 형식으로 저장됩니다.
3. **마스크 처리 (Mask Processing):**
    * **다중 레이블 마스크를 이진 마스크로 분할:** 원본 마스크에 포함된 각 레이블 ID에 따라 개별 이진 전경(foreground) 마스크로 분리합니다.
    * **이진 전경 분리 및 중첩 영역 통합:**
        * 단일 이진 마스크 내의 여러 연결된 구성 요소를 별개의 객체(예: 병리 영상의 개별 세포)로 분리합니다.
        * 더 큰 타겟(예: 종양을 포함한 신장) 안에 포함된 작은 분할 타겟을 통합하여 중첩된 영역이 단일 레이블을 가지도록 합니다.
    * **작은 마스크 제거:** 타겟 영역이 전체 이미지 영역의 0.153% ($256 \times 256$ 해상도에서 100픽셀에 해당) 미만인 마스크는 정밀도를 높이고 노이즈를 줄이기 위해 제거합니다.
    * **메타데이터 및 명명 규칙:** 각 마스크에 대한 원본 카테고리 정보는 "JSON" 파일에 기록하며, 영상과 마스크에 통일된 명명 규칙(예: `{modality}--{dataset}--{oriname}--{dimsliceid}.png` for images)을 적용합니다.

## 📊 Results

SA-Med2D-20M은 다음과 같은 주요 통계적 특성을 가집니다.

* **총 데이터 규모:** 460만 개의 2D 의료 영상과 1,970만 개의 해당 마스크로 구성됩니다.
* **모달리티 다양성:** CT, MR, PET, 초음파, X-ray, 내시경, 피부경, 조직병리, 안저 촬영, 현미경 등 총 10가지 모달리티를 포함하며, CT와 MR이 영상 및 마스크 수에서 압도적인 비중을 차지합니다.
* **해부학적 구조 커버리지:** Head and Neck, Thorax, Abdomen, Pelvic, Lesion, Others 등 6가지 주요 범주로 분류됩니다. Head and Neck 카테고리가 가장 많은 영상과 마스크를 포함하며, Lesion(병변/종양) 관련 데이터셋이 가장 큰 비중을 차지하여 의료 전문가 지원에 대한 높은 관심을 반영합니다.
* **레이블 카테고리:** 총 219개의 고유 레이블을 포함하며, "enhancing tumor" 및 "edema"와 같은 BraTS 데이터셋의 카테고리가 가장 높은 빈도를 보입니다. 데이터셋 내 레이블 분포는 일부 카테고리에 데이터가 집중되는 Long-tailed Problem(긴 꼬리 문제)을 보입니다.

## 🧠 Insights & Discussion

* **의료 비전 파운데이션 모델의 발전 촉진:** SA-Med2D-20M은 자연 영상 분야의 성공적인 LVM들이 의료 도메인에 적용될 수 있는 중요한 기반을 제공합니다. 이 대규모 데이터셋은 의료 영상 분석의 데이터 부족 문제를 해결하고, 지도 학습 및 자기 지도 학습을 위한 풍부한 자원으로 활용될 수 있어 의료 AI의 진단, 영상 분석, 지식 공유 및 교육 분야 발전에 기여할 잠재력이 큽니다.
* **연구 효율성 증대:** 모달리티, 해부학적 구조, 레이블별로 잘 조직된 데이터셋은 연구자들이 특정 응용 분야에 필요한 데이터를 효율적으로 선택하고, 데이터 수집에 필요한 시간을 크게 단축시킬 수 있도록 돕습니다.
* **한계점:**
  * **마스크 무결성:** 초기 버전은 원본 데이터셋의 관심 영역 마스크에 의존하므로, 원본 데이터셋에서 주석이 없는 "비관심 영역"에 대한 마스크가 누락될 수 있습니다.
  * **데이터 불균형:** 일부 모달리티 및 카테고리에서 공개 데이터셋이 제한적이어서 데이터 불균형(긴 꼬리 문제)이 여전히 존재합니다.
  * **데이터 형식 통합의 한계:** 원본 데이터를 RGB 형식으로 변환하는 Self-Min-Max 정규화 방식은 데이터 정보를 완전히 보존하지 못하며, 다양한 모달리티에 걸쳐 효과적인 데이터 형식 정규화 방법을 찾는 것은 여전히 중요한 도전 과제입니다.
* **향후 연구:** SAM의 데이터 엔진과 유사한 의사(pseudo) 레이블링 및 수동 정제 방법을 통해 마스크 무결성을 개선하고, 공개된 레이블 없는 데이터를 활용하여 데이터 불균형 문제를 해결하며, 커뮤니티의 추가 데이터 기여를 장려할 계획입니다.

## 📌 TL;DR

이 논문은 자연 이미지 기반의 대규모 모델(SAM)이 의료 영상에서 부족한 성능을 보이는 문제를 해결하고자, 460만 개의 2D 의료 영상과 1,970만 개의 마스크로 구성된 현존 최대 규모의 의료 영상 분할 데이터셋인 **SA-Med2D-20M**을 제안합니다. 다양한 공개 데이터셋을 수집하여 정교한 이미지 및 마스크 처리 과정을 거쳐 구축된 이 데이터셋은 10가지 모달리티와 271개 이상의 카테고리를 아우르는 높은 다양성을 제공하며, 의료 비전 파운데이션 모델 개발을 위한 핵심 자원으로 기능합니다. 그러나 마스크 무결성, 데이터 불균형, 데이터 형식 통합 등의 한계가 있으며, 이는 향후 연구를 통해 개선될 예정입니다.
