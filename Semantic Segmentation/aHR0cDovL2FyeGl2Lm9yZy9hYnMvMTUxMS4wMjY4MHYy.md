# Bayesian SegNet: Model Uncertainty in Deep Convolutional Encoder-Decoder Architectures for Scene Understanding

Alex Kendall, Vijay Badrinarayanan, Roberto Cipolla

## 🧩 Problem to Solve

기존의 딥러닝 기반 픽셀 단위 의미론적 분할(semantic segmentation) 모델들은 예측 결과에 대한 모델 불확실성(model uncertainty) 측정을 제공하지 않습니다. 자율 주행이나 로봇 상호작용과 같은 실제 의사 결정 시스템에서는 모델이 자신의 예측을 얼마나 신뢰하는지에 대한 불확실성 측정이 필수적입니다. 이 연구는 이 문제를 해결하고, 불확실성 측정을 제공하면서도 정확한 픽셀 단위 의미론적 분할을 수행하는 실용적인 시스템을 제시하는 것을 목표로 합니다.

## ✨ Key Contributions

- **Bayesian SegNet 제안**: 확률적 픽셀 단위 의미론적 분할을 위한 딥러닝 프레임워크인 Bayesian SegNet을 최초로 제시합니다.
- **테스트 시 드롭아웃(Dropout)을 통한 불확실성 추정**: 추가적인 파라미터 없이 테스트 시 드롭아웃을 이용한 몬테카를로 샘플링(Monte Carlo sampling)을 통해 픽셀 클래스 레이블의 사후 분포(posterior distribution)를 생성하고 모델 불확실성을 측정합니다.
- **성능 향상 입증**: 불확실성 모델링이 SegNet, FCN, Dilation Network와 같은 최첨단 아키텍처 전반에 걸쳐 분할 성능을 2-3% 향상시킨다는 것을 보여줍니다.
- **소규모 데이터셋에서의 효과**: 데이터 양이 적어 불확실성 모델링이 더 효과적인 소규모 데이터셋에서 특히 큰 성능 향상을 관찰합니다.
- **다양한 벤치마크 평가**: 실내 SUN Scene Understanding 및 실외 CamVid 운전 장면 데이터셋에서 Bayesian SegNet의 성능을 벤치마킹하여 최고 성능을 달성합니다.
- **모델 불확실성의 효과성 분석**: 모델 불확실성 측정이 예측 신뢰도를 이해하는 데 효과적임을 입증합니다.

## 📎 Related Works

- **초기 픽셀 레이블링**: TextonBoost [32], TextonForest [30], Random Forest Based Classifiers [31]와 같은 저수준 시각 특징 기반 접근법이 사용되었습니다.
- **딥러닝 기반 분할 아키텍처**: SegNet [3], Fully Convolutional Networks (FCN) [25], Dilation Network [40] 등이 제안되어 현재 벤치마크를 설정하고 있습니다.
- **후처리 기법**: HyperColumn [16], DeConvNet [27]은 영역 제안(region proposals)을 사용하고, DeepLab [6]은 Conditional Random Fields (CRFs)를, CRF-RNN [42]은 순환 신경망(RNNs)을 사용하여 성능을 향상시키지만, 모델 불확실성 측정은 제공하지 않습니다.
- **베이지안 신경망(Bayesian Neural Networks)**: 신경망 가중치에 대한 분포를 추론하여 불확실성을 모델링하지만, 종종 계산 비용이 매우 높고 추론이 어렵습니다.
- **드롭아웃(Dropout)**: 합성곱 신경망에서 과적합(overfitting)을 방지하는 정규화(regularizer) 기법으로 널리 사용됩니다 [36].
- **드롭아웃을 베이지안 추론으로 해석**: Gal과 Ghahramani [12, 13]는 드롭아웃을 신경망 가중치에 대한 근사 베이지안 추론으로 해석하여, 테스트 시 드롭아웃을 통해 몬테카를로 샘플을 얻고 불확실성을 모델링할 수 있음을 보였습니다. 본 논문은 이 방법을 픽셀 단위 의미론적 분할에 적용합니다.

## 🛠️ Methodology

1. **기반 아키텍처**: SegNet [3] 및 SegNet-Basic [2] 아키텍처를 기본 모델로 사용합니다. SegNet은 인코더-디코더 구조를 가지며, 인코더의 맥스 풀링(max-pooling) 인덱스를 디코더에서 업샘플링(upsampling)에 재사용하여 경계 세부 정보를 유지하고 파라미터 수를 줄입니다.
2. **베이지안 추론 적용**: 테스트 시 드롭아웃을 활용하여 베이지안 신경망의 근사 추론을 수행합니다 [12]. 이는 모델의 사후 분포에서 샘플을 얻는 방법으로 해석됩니다.
   - 네트워크의 가중치 $W$에 대한 사후 분포 $p(W|X,Y)$를 근사하기 위해 Kullback-Leibler (KL) 발산 $\text{KL}(q(W)||p(W|X,Y))$을 최소화하는 변분 분포(variational distribution) $q(W)$를 학습합니다.
   - 드롭아웃 확률 $p_i$는 0.5로 고정합니다 [36].
3. **불확실성 측정**:
   - 테스트 시 드롭아웃을 사용하여 네트워크를 여러 번 샘플링(예: 50개의 몬테카를로 샘플)하여 소프트맥스 클래스 확률의 사후 분포를 얻습니다.
   - **분할 예측**: 이 샘플들의 **평균(mean)**을 최종 분할 예측으로 사용합니다.
   - **모델 불확실성**: 각 클래스에 대한 **분산(variance)**을 모델 불확실성으로 사용하고, 전체 모델 불확실성은 클래스별 분산 측정값의 평균으로 계산합니다.
4. **확률적 변형(Probabilistic Variants) 탐색**:
   - 드롭아웃을 모든 합성곱 계층 뒤에 삽입하는 것이 너무 강한 정규화 효과를 내 학습을 느리게 함을 발견했습니다.
   - 대신, 인코더/디코더 유닛의 다양한 부분에 드롭아웃을 적용하는 여러 변형(예: Bayesian Encoder, Bayesian Decoder, Bayesian Encoder-Decoder, Bayesian Center 등)을 실험했습니다.
   - 최적의 구성은 **가장 깊은 인코더 및 디코더 유닛의 절반**에 드롭아웃을 적용하는 것(Central Enc-Dec variant)으로 나타났습니다. 이는 저수준 특징보다 고수준 특징이 베이지안 가중치로 더 효과적으로 모델링될 수 있음을 시사합니다.
5. **학습 및 추론**:
   - 중앙 주파수 클래스 균형(median frequency class balancing) [10]과 배치 정규화(batch normalisation) [17]를 사용하여 종단 간(end-to-end) 학습을 수행합니다.
   - Caffe 라이브러리 [18]로 구현되었으며, GPU에서 SegNet은 프레임당 35ms, Bayesian SegNet (10개 샘플)은 프레임당 90ms의 실시간 성능을 보여줍니다.

## 📊 Results

- **CamVid 데이터셋**: 기존 모든 방법(깊이, 비디오, CRF 활용 포함) 및 다른 딥러닝 아키텍처를 능가하는 최고 성능을 달성했습니다. 특히 작거나 드문 클래스에서 정확도가 크게 향상되었습니다.
- **SUN RGB-D 데이터셋**: RGB 입력만 사용했음에도 불구하고, 깊이(depth) 정보를 활용한 기존 벤치마크를 포함한 모든 방법을 능가하는 최고 성능을 달성했습니다.
- **Pascal VOC 2012 데이터셋**: 다른 복잡한 기법(다단계 학습, 사전 학습, 객체 제안, CRF 후처리 등) 없이 순수하게 종단 간 학습만으로 경쟁력 있는 정확도를 달성했습니다.
- **일반적인 적용 가능성**: FCN [25] 및 Dilation Network [40]에 몬테카를로 드롭아웃 샘플링을 적용했을 때, 2-3%의 IoU(Intersection over Union) 성능 향상이 관찰되어 이 방법이 다양한 딥러닝 아키텍처에 보편적으로 적용 가능함을 입증했습니다.
- **모델 불확실성 분석**:
  - **정성적 관찰**: 모델은 객체 경계, 시각적으로 식별하기 어려운 객체(가려지거나 멀리 있는 객체), 그리고 시각적으로 모호한 객체(예: 자전거 탑승자와 보행자, 의자와 소파)에서 높은 불확실성을 보였습니다.
  - **정량적 관찰**: 클래스 정확도와 불확실성 사이에 **강한 역관계**가 있음을 발견했습니다 (더 정확한 클래스에서 불확실성이 낮음). 또한, 데이터셋 내 클래스 빈도와 불확실성 사이에도 역관계가 있음을 보였습니다 (더 자주 나타나는 클래스에서 불확실성이 낮음).
  - **예측 신뢰도 측정**: 90번째 백분위수(가장 확신하는 10% 픽셀) 이상의 불확실성 값을 가진 픽셀에서 매우 높은 정확도(CamVid 99.7%, SUN RGB-D 97.6%)를 보여, 모델의 불확실성이 예측 신뢰도의 효과적인 척도임을 증명했습니다.

## 🧠 Insights & Discussion

- **불확실성의 중요성**: Bayesian SegNet이 제공하는 모델 불확실성 측정은 자율 주행과 같은 중요한 의사 결정 상황에서 예측 결과에 대한 신뢰도를 이해하는 데 결정적인 역할을 합니다.
- **정확도 향상**: 불확실성 모델링이 단순한 신뢰도 제공을 넘어 실제 분할 성능 자체를 향상시킨다는 점이 중요합니다. 특히 훈련 데이터가 부족한 경우에 더 큰 이점을 제공합니다.
- **드롭아웃 배치 효과**: 깊은 계층에서 추출되는 고수준 특징(모양, 문맥 관계)에 베이지안 가중치를 적용하는 것이 얕은 계층의 저수준 특징보다 효과적임을 보여, 모델의 어떤 부분이 불확실성 모델링으로부터 가장 큰 이득을 얻는지에 대한 통찰을 제공합니다.
- **실시간 성능**: 몬테카를로 샘플링은 추론 시간을 증가시키지만, GPU에서 병렬로 계산하여 실시간 애플리케이션에서도 충분히 활용될 수 있음을 입증했습니다. 불확실성 측정이 필요하지 않을 경우, 가중치 평균(weight averaging) 기법을 사용하여 추론 시간을 단축할 수 있습니다.

## 📌 TL;DR

**문제**: 기존 딥러닝 의미론적 분할 모델은 예측의 불확실성을 제공하지 않아, 자율 주행 등 중요한 의사 결정에 활용하기 어렵습니다.

**제안 방법**: 본 논문은 **Bayesian SegNet**을 제안하며, 이는 SegNet과 같은 인코더-디코더 아키텍처에 테스트 시 몬테카를로 드롭아웃을 적용하여 베이지안 추론을 근사합니다. 이를 통해 각 픽셀에 대한 클래스 예측(샘플의 평균)과 함께 모델 불확실성(샘플의 분산)을 제공합니다.

**주요 발견**:

1. Bayesian SegNet은 CamVid 및 SUN RGB-D 데이터셋에서 기존 방법들을 능가하는 최고 수준의 분할 성능을 달성합니다.
2. 불확실성 모델링은 추가적인 파라미터 없이도 SegNet, FCN, Dilation Network 등 다양한 최첨단 아키텍처의 분할 정확도를 2-3% 향상시킵니다.
3. 특히 데이터가 적은 경우에 더 큰 성능 향상을 보이며, 객체 경계, 시각적으로 모호하거나 어려운 객체에서 높은 불확실성을 나타냅니다.
4. 측정된 불확실성은 예측의 신뢰도를 나타내는 효과적인 지표임을 정량적으로 입증하여, 신뢰할 수 있는 픽셀 단위 예측을 가능하게 합니다.
