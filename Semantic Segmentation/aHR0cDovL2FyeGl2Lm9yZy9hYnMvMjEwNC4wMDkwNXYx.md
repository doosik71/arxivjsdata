# Background-Aware Pooling and Noise-Aware Loss for Weakly-Supervised Semantic Segmentation

Youngmin Oh, Beomjun Kim, Bumsub Ham

## 🧩 Problem to Solve

의미론적 분할(Semantic segmentation)은 픽셀 단위의 정교한 레이블이 필요하며, 이는 주석(annotation) 작업에 막대한 노동력을 요구합니다. 바운딩 박스 주석을 활용하는 약지도 의미론적 분할(Weakly-Supervised Semantic Segmentation, WSSS)은 비용 효율적인 대안을 제공하지만, 바운딩 박스는 객체의 존재와 대략적인 위치만을 알려줄 뿐 정확한 경계를 명시하지 않습니다. 이로 인해 다음과 같은 문제가 발생합니다:

1. 바운딩 박스에서 고품질의 픽셀 단위 의사(pseudo) 분할 레이블을 생성하는 것.
2. 객체 경계에서 잡음이 포함될 수 있는 이러한 의사 레이블을 사용하여 CNN(Convolutional Neural Network)을 의미론적 분할을 위해 효과적으로 훈련하는 것.

## ✨ Key Contributions

* **배경 인식 풀링 (Background-Aware Pooling, BAP) 도입:** 바운딩 박스 주석을 활용하여 객체 내부의 전경 및 배경 영역을 효과적으로 구별하고, 고품질의 의사 분할 레이블을 생성하는 새로운 풀링 방법을 제안합니다.
* **잡음 인식 손실 (Noise-Aware Loss, NAL) 제안:** 예측을 위한 CNN 특징과 분류기 가중치 간의 거리를 활용하여 부정확한 레이블의 영향을 줄이는 NAL을 도입합니다.
* **최첨단 성능 달성:** PASCAL VOC 2012 데이터셋에서 약지도 및 준지도 의미론적 분할의 새로운 최첨단 성능을 달성합니다. 포괄적인 실험 분석과 어블레이션 연구를 제공합니다.

## 📎 Related Works

* **이미지 레벨 레이블을 활용한 WSSS:** CAM(Class Activation Map) [63]을 통해 객체를 지역화하고, DenseCRF [23, 28, 49, 60] 또는 점진적 확산 방법 [22, 32, 55, 56]을 사용하여 의사 GT(Ground Truth)를 생성합니다. SeeNet [22]은 배경 영역을 명시적으로 정의하여 CAM이 배경으로 퍼지는 것을 방지합니다.
* **바운딩 박스 레이블을 활용한 WSSS:** BoxSup [8], WSSL [42], SDI [27] 등은 객체 바운딩 박스를 감독 신호로 활용하며, MCG [44]나 GrabCut [48]과 같은 기성 분할 방법을 사용하여 의사 레이블을 추정합니다.
* **잡음 레이블 학습 (Learning from Noisy Labels):** 잡음 레이블을 교정하거나 필터링하는 여러 연구 [15, 25, 41, 46, 50, 61]가 있습니다. WSSS 맥락에서는 SDI [27]가 다른 레이블을 가진 영역을 버리거나 BCM [52], Box2Seg [31]가 채우기 비율 제약(filling rate constraint)을 통해 부정확한 픽셀을 걸러냅니다.

## 🛠️ Methodology

본 논문의 접근 방식은 세 가지 주요 단계로 구성됩니다:

1. **BAP를 이용한 이미지 분류 네트워크 학습:**
    * **특징 추출:** CNN 특징 추출기에서 특징 맵 $f$를 추출합니다.
    * **배경 관심 맵 ($A$) 생성:** 배경 영역이 이미지 내에서 부분적으로 지각적으로 일관된다는 점에 착안하여, 바운딩 박스 외부의 확실한 배경 영역($M$)에서 쿼리 $q_j$를 추출합니다:
        $$q_j = \frac{\sum_{p \in G(j)} M(p)f(p)}{\sum_{p \in G(j)} M(p)}$$
        이 쿼리 $q_j$와 특징 맵 $f$ 내의 특징 간의 코사인 유사도를 계산하여 배경 관심 맵 $A(p)$를 생성합니다:
        $$A(p) = \frac{1}{J} \sum_j A_j(p) \quad \text{where } A_j(p) = \text{ReLU} \left( \frac{f(p)}{\|f(p)\|} \cdot \frac{q_j}{\|q_j\|} \right)$$
        $A(p)$는 바운딩 박스 내부의 픽셀이 배경에 속할 가능성을 나타냅니다.
    * **BAP 적용:** 관심 맵 $A$를 사용하여 각 바운딩 박스 $B_i$ 내의 전경 특징 $r_i$를 가중 평균 풀링으로 집계합니다:
        $$r_i = \frac{\sum_{p \in B_i} (1-A(p))f(p)}{\sum_{p \in B_i} (1-A(p))}$$
        이는 분류기가 전경 객체 학습에 더 집중할 수 있도록 돕습니다.
    * **손실 함수:** 표준 교차 엔트로피 손실을 사용하여 전경 특징 $r_i$와 배경 쿼리 $q_j$를 분류하는 (L+1)-way 소프트맥스 분류기를 훈련합니다.

2. **의사 분할 레이블 생성:**
    * **$Y_{crf}$ 생성 (DenseCRF 기반):** BAP에서 얻은 CAMs($u_c$)와 배경 관심 맵 $A$ ($u_0$)를 단항 항(unary term)으로 사용하여 DenseCRF [29]를 적용하여 의사 레이블 $Y_{crf}$를 얻습니다. $u_c(p)$는 객체 클래스 $c$의 CAM을 정규화한 것이고, $u_0(p) = A(p)$입니다.
    * **$Y_{ret}$ 생성 (고수준 특징 검색 기반):** $Y_{crf}$로 분류된 각 클래스 영역에서 대표 특징(prototypical feature) $q_c$를 추출하고, 이를 쿼리로 사용하여 특징 맵 $f$에서 유사한 특징을 검색하여 상관 관계 맵 $C_c(p)$를 생성합니다.
        $$q_c = \frac{1}{|Q_c|} \sum_{p \in Q_c} f(p)$$
        $$C_c(p) = \frac{f(p)}{\|f(p)\|} \cdot \frac{q_c}{\|q_c\|}$$
        $C_c(p)$에 argmax 함수를 적용하여 추가적인 의사 레이블 $Y_{ret}$를 얻습니다.

3. **NAL을 이용한 의미론적 분할 네트워크 학습:**
    * **신뢰성 있는 영역 ($S$)의 손실:** $Y_{crf}$와 $Y_{ret}$가 동일한 레이블을 할당하는 신뢰성 있는 영역 $S$에 대해서는 표준 교차 엔트로피 손실 $L_{ce}$를 계산합니다:
        $$L_{ce} = -\frac{1}{\sum_c |S_c|} \sum_c \sum_{p \in S_c} \log H_c(p)$$
    * **잡음 인식 손실 ($L_{wce}$):** $Y_{crf}$와 $Y_{ret}$가 다른 레이블을 할당하는 신뢰성이 낮은 영역 $\sim S$에 대해서는 잡음 인식 손실 $L_{wce}$를 사용합니다. 이는 CNN 특징 $\varphi(p)$와 분류기 가중치 $W_c$ 간의 상관 관계 $D_c(p)$를 기반으로 픽셀별 신뢰도 맵 $\sigma(p)$를 계산하여 적용합니다:
        $$D_c(p) = 1 + \left( \frac{\varphi(p)}{\|\varphi(p)\|} \cdot \frac{W_c}{\|W_c\|} \right)$$
        $$\sigma(p) = \left( \frac{D_{c^*}(p)}{\max_c (D_c(p))} \right)^\gamma$$
        여기서 $c^*$는 $Y_{crf}(p)$에 의한 레이블입니다. $\sigma(p)$를 가중치로 사용하여 가중 교차 엔트로피 손실을 계산합니다:
        $$L_{wce} = -\frac{1}{\sum_c \sum_{p \in \sim S_c} \sigma(p)} \sum_c \sum_{p \in \sim S_c} \sigma(p) \log H_c(p)$$
    * **최종 손실:** 전체 NAL은 $L = L_{ce} + \lambda L_{wce}$로 정의됩니다.

## 📊 Results

* **의사 레이블 정확도:** PASCAL VOC 2012 데이터셋에서 제안된 BAP를 사용한 $Y_{crf}$는 기존 WSSL [42] 및 SDI [27]보다 월등히 높은 mIoU(79.2% vs 71.1%, 60.5%)를 달성했습니다. $Y_{crf}$와 $Y_{ret}$를 결합한 의사 레이블은 가장 높은 mIoU (85.3% on train set)를 보여주어, 두 의사 레이블이 상호 보완적임을 입증했습니다. MS-COCO 데이터셋 교차-데이터셋 평가에서도 본 모델의 일반화 능력을 보여주었습니다.
* **CAM 품질 및 Filling Rate:** BAP는 GAP보다 객체 전체 영역을 더 잘 포착하는 고품질의 CAM을 생성하며, 배경 노이즈를 억제합니다. 또한, 본 연구의 의사 레이블로 계산된 Filling Rate 분포는 실제 GT(Ground Truth)에 더 가깝습니다.
* **NAL 효과:** 신뢰성이 낮은 영역 $\sim S$에 대해 NAL을 적용하면, 기존의 영역 무시 또는 다른 손실 함수(Entropy Regularization, Bootstrapping) 사용 대비 mIoU 성능이 향상되었습니다 (68.1% vs 67.5%). 이는 $\sim S$ 영역에도 올바른 레이블이 포함되어 있고 NAL이 이를 효과적으로 활용함을 시사합니다.
* **최종 분할 성능:**
  * **PASCAL VOC 2012:** DeepLab-V1/V2를 사용하여 약지도 및 준지도 설정 모두에서 새로운 최첨단 성능을 달성했습니다. 특히 NAL을 적용한 모델은 DeepLab-V1에서 69.4%(test set), DeepLab-V2에서 76.1%(test set) mIoU를 기록하여, Box2Seg [31]와 같은 복잡한 아키텍처를 사용하는 모델에 버금가는 성능을 보였습니다.
  * **MS-COCO:** Mask-RCNN [19]을 이용한 인스턴스 분할 태스크에서도 우수한 성능을 보여주며, 본 방법의 일반화 능력과 고품질 의사 레이블의 중요성을 재확인했습니다.

## 🧠 Insights & Discussion

* **고품질 의사 레이블의 중요성:** 이 연구는 WSSS에서 고품질 의사 레이블을 생성하는 것이 핵심적이며, BAP가 이를 효과적으로 달성함을 보여줍니다. 바운딩 박스 정보만으로도 기존의 CAM 기반 방법이나 기성 분할 도구보다 우수한 의사 레이블을 생성할 수 있습니다.
* **배경 인식의 역할:** 배경이 지각적으로 일관적이라는 가정을 활용한 배경 관심 맵 생성은 전경과 배경을 더 잘 분리하여 CAM의 품질을 크게 향상시킵니다. 이는 분류 네트워크가 객체의 판별적인 부분뿐만 아니라 전체 영역을 학습하도록 유도합니다.
* **잡음 레이블 강건성:** NAL은 의사 레이블의 불확실한 영역까지도 신뢰도 맵을 통해 적응적으로 활용하여, 부정확한 레이블에 대한 네트워크의 민감도를 줄입니다. 이는 기존의 불확실한 영역을 완전히 버리는 방식보다 효과적입니다.
* **강력한 일반화 능력:** 제안된 의사 레이블 생성기는 훈련 시 보지 못한 클래스에 대해서도 합리적인 의사 레이블을 생성할 수 있음을 MS-COCO 교차-데이터셋 평가를 통해 입증했습니다.
* **한계:** Box2Seg [31]와 같은 최신 모델은 UPerNet [58]과 같은 더 복잡한 네트워크 아키텍처를 사용하여 더 높은 성능을 달성하는데, 이는 본 모델이 단순한 DeepLab 아키텍처를 사용한 결과와 직접 비교하기에는 차이가 있을 수 있습니다. 하지만 본 연구는 추가적인 복잡한 모듈 없이도 SOTA에 근접한 성능을 달성했다는 점에서 의미가 있습니다.

## 📌 TL;DR

바운딩 박스 기반 약지도 의미론적 분할(WSSS)에서, 논문은 **배경 인식 풀링(BAP)**을 도입하여 바운딩 박스 내의 전경 및 배경을 효과적으로 분리하고 고품질의 의사 분할 레이블을 생성합니다. 또한, 생성된 의사 레이블의 잡음을 완화하기 위해 특징과 분류기 가중치 간의 상관 관계를 활용하는 **잡음 인식 손실(NAL)**을 제안합니다. 실험 결과, BAP를 통한 의사 레이블 생성만으로도 기존 SOTA를 능가하며, NAL을 통해 성능이 더욱 향상되어 PASCAL VOC 및 MS-COCO 데이터셋에서 최첨단 성능을 달성함으로써, 고품질 의사 레이블 생성과 잡음 강건성 학습의 중요성을 입증했습니다.
