# RSAM-Seg: A SAM-based Approach with Prior Knowledge Integration for Remote Sensing Image Semantic Segmentation

Jie Zhang, Xubing Yang, Rui Jiang, Wei Shao and Li Zhang

## 🧩 Problem to Solve

고해상도 원격 감지 이미지는 방대하고 복잡하며, 물체 가림, 흐릿함, 불완전한 커버리지 등의 문제로 인해 특정 목표물 분할이 어렵습니다. 최근 제안된 범용 이미지 분할 모델인 SAM(Segment Anything Model)은 뛰어난 성능을 보이지만, 복잡한 원격 감지 이미지의 특성(예: 흐릿함, 가림, 불규칙한 형태)으로 인해 직접 적용 시 만족스러운 결과를 얻기 어렵습니다. 또한 SAM은 분할을 위해 수동으로 프롬프트(점, 바운딩 박스 등)를 입력해야 하므로, 대규모 원격 감지 작업에 비효율적입니다.

## ✨ Key Contributions

* SAM을 원격 감지 이미지의 객체 분할 작업에 최초로 적용하고, RSAM-Seg가 원격 감지 이미지에 더 나은 적응력을 가짐을 입증했습니다.
* 수동 프롬프트 입력 없이 자동 분할을 수행하여 SAM의 작업 흐름을 간소화했습니다.
* 사용자 정의 도메인별 사전 정보를 통합하여 다양한 원격 감지 작업에 유연하게 적용할 수 있도록 했습니다.
* 클라우드, 건물, 들판, 도로 등 여러 시나리오에서 기존 SAM 및 U-Net보다 우수한 성능을 보였습니다. 또한, 데이터셋의 Ground Truth에서 누락된 영역을 식별하고 few-shot 학습 시나리오에서도 뛰어난 성능을 입증했습니다.

## 📎 Related Works

* **전통적인 방법**: 임계값 기반 알고리즘, 고전적인 머신러닝 알고리즘(SVM, Random Forest) 등이 사용되었으나, 높은 비용, 긴 처리 시간, 낮은 재현성 등의 한계가 있었습니다.
* **딥러닝 기반 방법**:
  * **지도 학습**: CNN 기반 모델인 DeepLab, DeepLab V3, DeepLab V3+, U-Net 및 그 변형 모델(L-UNet, C-UNet)이 원격 감지 이미지 분할에 활용되었습니다.
  * **약지도 학습 (Weakly-supervised Learning)**: Class Activation Maps (CAMs), WSF-Net, U-CAM, FCD(fix-point GAN), RS-WSOD, CRGNet 등 라벨링 복잡성 문제를 해결하기 위한 방법들이 연구되었습니다.
  * **비지도 학습 (Unsupervised Learning)**: MAN(Memory Adapt Net), RoadDA(GAN 기반), MCD(Memory-Contracted) 모듈 등 주석 데이터 의존성과 도메인 전환 문제를 해결하는 데 중점을 두었습니다.
* **Few-shot 학습**: 제한된 데이터셋 문제를 해결하기 위해 NTRENet, SPNet, SCL-MLNet 등이 제안되었습니다.
* **범용 비전 분할 모델**: Meta의 SAM은 대규모 데이터로 사전 학습되어 프롬프트 엔지니어링을 통해 다양한 하위 작업에 일반화될 수 있는 새로운 범용 비전 분할 모델입니다.

## 🛠️ Methodology

RSAM-Seg는 SAM을 백본으로 사용하며, 디코더 구조의 대부분을 유지하되 인코더 부분을 원격 감지 작업에 특화되도록 수정했습니다. 수동 프롬프트 없이 이미지에서 직접 특징 정보를 추출합니다.

* **RSAM-Seg 아키텍처**:
  * 원격 감지 이미지의 특징 정보를 추출하기 위해 SAM의 ViT 블록을 수정합니다.
  * 추출된 특징($F_{pe}$ 및 $F_{hfc}$)을 바탕으로 이미지 정보가 포함된 프롬프트($P_i$)를 생성합니다.
    $$P_i = MLP_{up}(GELU(MLP_{i}^{tune}(F_{pe} + F_{hfc})))$$
  * 마스크 디코더는 원래 SAM과 동일하게 유지되며, 사전 학습된 모델로 미세 조정됩니다.

* **인코더 수정 상세**:
  * **Adapter-Scale**: 각 ViT 블록 내부에 두 개의 Adapter-Scale 모듈이 삽입됩니다. 첫 번째는 Multi-Head Attention 블록과 잔차 연결 전에, 두 번째는 MLP의 잔차 구조 내부에 위치합니다. Downscale(MLP), ReLU, Upscale(MLP)로 구성되며 임베딩 차원을 조절합니다. 각 어댑터에 0.5의 스케일 팩터가 적용됩니다.
  * **Adapter-Feature**: ViT 레이어 사이에 삽입되며 두 개의 MLP로 구성됩니다. $MLP_{tune}$은 원격 감지 이미지에서 프롬프트로 사용될 특징을 추출하고, $MLP_{up}$은 특징 차원을 ViT 레이어 입력에 맞게 조정합니다.

* **사전 지식 통합**:
  * **임베딩 특징 ($F_{pe}$)**: 선형 레이어와 스케일 팩터를 사용하여 원본 임베딩 차원을 변경합니다.
  * **고주파 성분 (HFC) 특징 ($F_{hfc}$)**: 고속 푸리에 변환(FFT) 및 역변환(IFFT)을 통해 이미지의 고주파 정보를 추출하고, 마스크($M_{i,j}^{h}(\tau)$)를 사용하여 선택적으로 필터링합니다. 여기서 $\tau$는 마스킹된 영역의 비율을 나타냅니다.
    $$M_{i,j}^{h}(\tau) = \begin{cases} 0, & \frac{4 |(i-\frac{H}{2})(j-\frac{W}{2})|}{HW} \le \tau \\ 1, & \text{otherwise} \end{cases}$$
    $$I_{hfc} = ifft(fM_h(\tau))$$
  * **학습**: ViT-L/14 버전의 SAM을 백본으로 사용하며, AdamW 옵티마이저, 코사인 감쇠 학습률, BCE(Binary Cross-Entropy) 손실 함수를 사용하여 60 epoch 동안 학습합니다.

## 📊 Results

* **다양한 시나리오 성능**: RSAM-Seg는 클라우드, 들판, 건물, 도로의 네 가지 원격 감지 시나리오에서 U-Net 및 원본 SAM (center+, center- 모드 모두)에 비해 지속적으로 우수한 성능을 보였습니다.
  * **클라우드**: SAM 대비 평균 36.7%의 성능 향상을 보였으며, 얇은 클라우드 분할에서 특히 강점을 나타냈습니다.
  * **들판**: SAM 대비 F1 점수 56% 향상, 전체 정확도 28.5% 향상을 달성했으며, 복잡하고 불균일한 지형에서도 효과적이었습니다.
  * **건물**: SAM 대비 평균 42.71%의 정확도 향상을 보였고, 복잡한 도시 환경에서 건물 구조와 산개된 건물을 정확하게 구분했습니다.
  * **도로**: U-Net 대비 F1 점수 11% 향상을 보였으며, 밀집된 도로망을 명확하게 분할하는 능력을 입증했습니다.
* **제거 연구 (Ablation Study)**: Adapter-Feature 내의 고주파 성분 특징($F_{hfc}$)이 가장 크게 성능을 향상시키며, 원격 감지 이미지 분할에서 고주파 정보의 중요성을 확인했습니다. 임베딩 특징($F_{pe}$)과 Adapter-Scale 모듈 또한 전반적인 성능에 기여했습니다.
* **Few-shot 시나리오**: 제한된 훈련 데이터(1%, 10%, 30%, 70%)에서도 높은 정확도를 유지했으며, 데이터셋 크기가 증가함에 따라 성능이 향상되었습니다. 10%의 데이터만으로도 U-Net과 유사한 효과를 보였습니다.
* **Ground Truth를 넘어서는 능력**: DeepGlobe 도로 데이터셋 실험에서 RSAM-Seg는 Ground Truth에서 누락된 도로 영역을 성공적으로 분할하여, 보조 주석 도구로서의 잠재력을 시사했습니다.

## 🧠 Insights & Discussion

RSAM-Seg는 SAM에 도메인 특화된 사전 지식을 통합하여, 수동 프롬프트 없이 원격 감지 이미지 분할을 자동화하는 효과적인 방법을 제공합니다. 이 모델의 핵심은 이미지의 임베딩 특징과 고주파 성분을 프롬프트로 활용하는 Adapter-Scale 및 Adapter-Feature 모듈입니다. 특히 고주파 성분은 복잡한 원격 감지 장면에서 정확한 분할에 필수적인 역할을 합니다.

RSAM-Seg의 뛰어난 few-shot 학습 능력은 라벨링된 데이터가 부족한 원격 감지 분야에 큰 가치를 제공합니다. 또한, 기존 Ground Truth에서 누락된 영역을 식별하는 능력은 수동 주석 작업의 부담과 비용을 줄여 데이터셋 구축 프로세스를 개선할 수 있는 강력한 보조 도구로서의 가능성을 보여줍니다. 이는 원격 감지 이미지 분석의 효율성과 정확도를 크게 향상시킬 잠재력을 가집니다.

향후 연구는 few-shot 시나리오에서 다중 객체 분할의 정확도를 더욱 향상시키고, 모델의 효율성 및 경량화를 최적화하는 데 집중될 것입니다.

## 📌 TL;DR

**문제**: SAM은 복잡한 원격 감지 이미지 분할에 직접 적용 시 성능이 저조하고 수동 프롬프트가 필요하다.

**방법**: RSAM-Seg는 SAM의 인코더에 Adapter-Scale과 Adapter-Feature를 통합하여 이미지의 임베딩 특징($F_{pe}$)과 고주파 성분($F_{hfc}$)을 자동으로 프롬프트로 활용한다.

**발견**: RSAM-Seg는 클라우드, 건물, 들판, 도로 등 4가지 원격 감지 시나리오에서 기존 SAM 및 U-Net보다 우수한 성능을 보였다. 적은 양의 데이터(few-shot)로도 높은 정확도를 달성하며, 심지어 기존 Ground Truth에서 누락된 영역까지 식별하여 보조 주석 도구로서의 잠재력을 입증했다.
