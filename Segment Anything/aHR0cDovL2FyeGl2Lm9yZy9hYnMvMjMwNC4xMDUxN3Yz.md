# Segment Anything Model for Medical Image Analysis: an Experimental Study

Maciej A. Mazurowski, Haoyu Dong, Hanxue Gu, Jichen Yang, Nicholas Konz, Yixin Zhang

## 🧩 Problem to Solve

의료 영상 분야에서는 제한된 데이터 어노테이션 때문에 효과적인 영상 분할(segmentation) 모델을 훈련하는 것이 어렵습니다. Segment Anything Model (SAM)은 자연 영상에서 사용자가 정의한 객체를 대화형으로 분할하도록 설계된 파운데이션 모델입니다. 이 연구는 SAM이 다양한 양식(modality)과 해부학적 구조를 가진 의료 영상에서 어느 정도의 분할 성능을 보이는지, 그리고 의료 영상 특유의 과제들을 SAM이 어떻게 처리하는지를 광범위하게 평가하는 것을 목표로 합니다.

## ✨ Key Contributions

* **광범위한 평가:** 다양한 양식(X-ray, MRI, CT, US, PET/CT)과 해부학적 구조를 포함하는 19개 의료 영상 데이터셋(총 28개 분할 작업)에서 SAM의 성능을 체계적으로 평가했습니다.
* **성능의 가변성:** SAM의 단일 프롬프트 기반 성능은 데이터셋과 작업에 따라 IoU $0.1135$ (척추 MRI)부터 $0.8650$ (고관절 X-ray)까지 크게 달라짐을 발견했습니다.
* **객체 특성과의 연관성:** 명확하게 경계 지어진 객체(well-circumscribed objects)와 모호함이 적은 프롬프트(예: 엉덩이 X-ray)에 대해 성능이 더 좋고, 뇌종양 분할과 같은 복잡한 시나리오에서는 성능이 떨어지는 경향을 확인했습니다.
* **프롬프트 유형의 중요성:** 점(point) 프롬프트보다 박스(box) 프롬프트가 SAM의 분할 성능을 현저히 향상시킴을 입증했습니다. 특히 객체의 각 개별 부분을 박스로 지정하는 방식(Mode 4)이 가장 좋은 성능을 보였습니다.
* **타 모델과의 비교:** 단일 점 프롬프트 설정에서 SAM은 RITM, SimpleClick, FocalClick 등 유사한 상호작용 분할 방법들보다 거의 모든 작업에서 뛰어난 성능을 보였습니다.
* **반복적 프롬프트의 한계:** 여러 개의 점 프롬프트가 반복적으로 제공될 때, SAM의 성능은 단지 약간만 향상되는 반면, 다른 방법들은 성능이 크게 개선되어 SAM의 점 기반 성능을 능가하는 수준에 도달함을 발견했습니다. 이는 SAM이 초기 프롬프트 이후 추가적인 정보로부터 얻는 이점이 적음을 시사합니다.

## 📎 Related Works

* **의료 영상 분할의 발전:** 딥러닝을 통한 의료 영상 분할의 상당한 발전 [13, 30]과 장기 [31], 이상 병변 [3], 뼈 [17] 분할 등 다양한 응용 분야가 있습니다.
* **파운데이션 모델 및 제로샷 학습:** 대규모 데이터로 훈련되어 제로샷 학습 능력을 보이는 파운데이션 모델 [39] 및 제로샷 학습 [6]의 중요성이 강조됩니다.
* **Segment Anything Model (SAM):** 자연 영상에서 유망한 제로샷 분할 성능을 달성한 최근 개발된 파운데이션 모델 [18]입니다.
* **비교 대상 상호작용 분할 방법:** RITM [34], SimpleClick [21], FocalClick [7]은 SAM과의 성능 비교를 위해 사용된 기존의 상호작용 분할 방법들입니다.
* **SAM의 의료 분야 적용 관련 동시 연구:** SAM 출시 후 의료 영상 및 방사선 영상 분야에서 SAM을 평가하고 확장하는 여러 선행 연구들 [8, 12, 15, 22, 23]이 등장했습니다.

## 🛠️ Methodology

1. **데이터셋 구성:** X-ray, MRI, CT, 초음파(US), PET/CT를 포함한 19개의 공개 의료 영상 데이터셋을 수집하여 총 28개의 분할 작업을 평가 대상으로 삼았습니다. 3D 영상은 2D 슬라이스로 처리되었습니다.
2. **프롬프트 전략:**
    * **비반복적 프롬프트 (5가지 모드):**
        * **모드 1:** 관심 객체의 *가장 큰* 연속 영역 중심에 하나의 점 프롬프트.
        * **모드 2:** 객체의 *각 개별* 연속 영역 중심에 점 프롬프트 (최대 3개).
        * **모드 3:** 관심 객체의 *가장 큰* 연속 영역을 타이트하게 감싸는 하나의 박스 프롬프트.
        * **모드 4:** 객체의 *각 개별* 연속 영역을 타이트하게 감싸는 박스 프롬프트 (최대 3개).
        * **모드 5:** *전체* 객체 마스크를 타이트하게 감싸는 하나의 박스 프롬프트.
        (점 프롬프트는 마스크 경계에서 가장 먼 지점에 배치되었습니다.)
    * **반복적 프롬프트:** 모델의 예측을 본 후 프롬프트를 생성하는 상호작용 방식을 시뮬레이션했습니다 (Algorithm 1 참조). 모델이 예측을 생성하면, 오차 맵(false positive와 false negative)을 계산하고, 다음 프롬프트는 이 오차 마스크의 가장 큰 구성 요소의 중앙, 즉 0에서 가장 먼 지점에 배치됩니다. 프롬프트의 레이블은 새로운 위치가 전경인지 배경인지에 따라 결정됩니다.
    * **프롬프트 모호성 및 오라클 성능:** SAM은 모호한 프롬프트에 대해 여러 개의 출력을 제공합니다. "오라클 성능"은 SAM의 세 가지 예측 중 실제 마스크(ground truth)와 IoU가 가장 높은 예측을 선택하여 평가했습니다.
3. **타 모델과의 비교:** RITM [34], SimpleClick [21], FocalClick [7] 등 세 가지 기존 상호작용 분할 방법과 SAM을 비교했습니다.
4. **성능 평가 지표:** SAM의 원 논문 [18]과 동일하게 IoU (Intersection over Union)를 사용했습니다.

## 📊 Results

* **SAM의 성능 가변성:** 28개 분할 작업에서 SAM의 성능은 IoU $0.1136$ (MRI-Spine)에서 $0.9118$ (hip X-ray)까지 매우 다양하게 나타났습니다.
* **프롬프트 모드별 성능:**
  * 박스 프롬프트가 점 프롬프트보다 일관되게 우수했습니다.
  * 모드 4 (객체의 각 부분에 박스 프롬프트 제공)가 평균 IoU $0.6542$로 가장 좋은 성능을 보였습니다.
  * 오라클 모드는 기본 모드에 비해 중간 정도의 성능 향상을 보였습니다.
* **단일 프롬프트 설정에서 타 모델과의 비교:**
  * SAM은 28개 작업 중 24개(오라클 모드에서는 26개)에서 RITM, SimpleClick, FocalClick보다 우수한 성능을 나타냈습니다.
  * 평균 IoU는 SAM $0.4595$, SAM (오라클) $0.5137$, FocalClick $0.2240$, SimpleClick $0.1910$, RITM $0.1322$였습니다.
  * SAM이 박스 프롬프트(Mode 3)를 사용했을 경우 평균 IoU $0.5891$로, 단 하나의 작업을 제외하고 모든 경쟁 모델을 능가했습니다.
* **반복적 분할 성능:**
  * SAM은 2~3개 이상의 점 프롬프트가 추가될 때 성능 향상이 미미했습니다.
  * 반면, SimpleClick과 RITM은 추가적인 프롬프트에 따라 성능이 현저히 개선되어 5개 이상의 프롬프트에서는 SAM의 점 기반 성능을 넘어섰습니다.
  * SAM은 다수의 비연속적인(non-contiguous) 영역을 가진 객체 분할에 어려움을 겪었으며, 추가 프롬프트가 새로운 영역을 대상으로 할 때만 유의미한 이점이 있었습니다.
* **프롬프트 모호성:** SAM의 가장 높은 신뢰도 예측은 강도(intensity)가 유사한 연결된 영역을 분할하는 경향이 있었고, 낮은 신뢰도 예측은 더 넓은 영역을 커버하며 다양성을 보였습니다.
* **객체 크기와의 관계:** 객체 크기가 클수록 SAM의 성능이 향상되는 경향이 있었으나, 통계적으로 유의미한 상관관계는 아니었습니다.
* **Segment-Everything 모드:** 의료 영상에서 혼합된 유용성을 보였으며, 프롬프트 수에 따라 결과가 달라졌습니다. 잠재적으로 주석을 생성하는 "시작점"으로 활용될 수 있습니다.

## 🧠 Insights & Discussion

* SAM의 제로샷 의료 영상 분할 정확도는 평균적으로 중간 수준이며, 데이터셋 내에서도 상당한 가변성을 보였습니다. 이는 SAM을 의료 분야에 적용할 때 각 데이터셋 및 작업에 맞는 적절한 프롬프트 전략이 필수적임을 의미합니다.
* 박스 프롬프트, 특히 관심 객체의 각 개별 부분에 박스를 제공하는 방식이 가장 효과적인 것으로 나타났습니다. 이는 의료 영상에서 객체가 여러 개의 분리된 부분으로 나타날 수 있다는 특성을 고려할 때 중요한 발견입니다.
* SAM은 단일 비반복적 점 프롬프트 설정에서 기존의 상호작용 분할 방법들보다 우수한 성능을 보였지만, 반복적으로 정제되는 점 프롬프트의 추가 정보로부터 얻는 이점은 제한적이었습니다.
* 객체 크기와 SAM 성능 사이에 약한 양의 상관관계가 있었지만, 통계적으로 유의미하지는 않았습니다. 이는 SAM이 다양한 크기의 객체를 처리할 수 있음을 시사하지만, 여전히 특정 크기 범위에서 성능 최적화가 필요할 수 있습니다.
* 본 연구에서 제안된 5가지 상호작용 분할 모드는 의료 영상에서 흔히 발견되는 다중 구성 요소 객체에 대한 SAM의 다양한 활용 가능성을 보여줍니다. 향후 연구에서는 더 높은 성능을 달성하기 위한 프롬프트 엔지니어링에 집중할 수 있습니다.
* SAM은 의료 영상 분야에서 중요한 역할을 할 잠재력을 가지고 있으며, 이미 여러 동시 연구에서 그 가능성이 입증되고 있습니다. 그러나 의료 영상 특성을 고려한 적절한 프롬프트 전략과 3D 분할로의 확장을 위한 추가적인 연구가 필요합니다.

## 📌 TL;DR

의료 영상 분할은 어노테이션 부족으로 어려움을 겪고 있으며, 본 연구는 파운데이션 모델인 SAM의 제로샷 의료 영상 분할 성능을 평가했습니다. 19개 데이터셋(28개 작업)에 대한 광범위한 실험 결과, SAM의 성능은 데이터셋과 작업에 따라 매우 가변적이며, 점 프롬프트보다 박스 프롬프트(특히 객체의 각 개별 부분에 대한 박스)에서 가장 좋은 성능을 보였습니다. 단일 점 프롬프트 설정에서는 기존 상호작용 분할 방법들보다 우수했지만, 반복적인 프롬프트로부터 얻는 이점은 제한적이었습니다. SAM은 의료 영상 분석에 큰 잠재력을 가지고 있으나, 특정 데이터셋과 작업에 맞는 신중한 프롬프트 전략이 필요합니다.
