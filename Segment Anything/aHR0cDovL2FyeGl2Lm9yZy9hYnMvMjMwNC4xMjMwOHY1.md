# Segment Anything in 3D with Radiance Fields

Jiazhong Cen, Jiemin Fang, Zanwei Zhou, Chen Yang, Lingxi Xie, Xiaopeng Zhang, Wei Shen, and Qi Tian,Fellow, IEEE

## 🧩 Problem to Solve

Segment Anything Model (SAM)은 2D 이미지 분할에서 강력한 성능을 보이는 비전 파운데이션 모델입니다. 본 논문은 SAM의 2D 분할 능력을 3D 객체 분할로 확장하는 것을 목표로 합니다. 3D 데이터 수집 및 주석 과정이 비용이 많이 들고 비실용적이라는 문제에 직면하여, 저자들은 2D SAM을 3D 인지 능력으로 효율적으로 확장할 수 있는 방법을 모색합니다. 특히, 멀티뷰 2D 이미지를 3D 공간에 연결하는 저렴하고 기성품(off-the-shelf) 표현인 래디언스 필드(radiance field)를 활용하여 3D 분할을 수행하는 것이 주요 과제입니다.

## ✨ Key Contributions

* **SA3D 프레임워크 제안:** 2D SAM의 능력을 래디언스 필드와 통합하여 3D 객체 분할로 일반화하는 SA3D(Segment Anything in 3D) 프레임워크를 제안합니다.
* **효율적인 3D 분할 솔루션:** 3D 데이터셋 구축 없이, 학습된 래디언스 필드와 단일 뷰의 2D 프롬프트(예: 점)만을 활용하여 3D 객체를 분할합니다.
* **반복적인 3D 마스크 정제 과정:** "마스크 역 렌더링(mask inverse rendering)"과 "크로스-뷰 자체 프롬프트(cross-view self-prompting)"의 두 단계를 교대로 수행하여 3D 마스크를 점진적으로 정제합니다.
  * **마스크 역 렌더링:** SAM으로 얻은 2D 마스크를 래디언스 필드의 밀도 분포를 활용하여 3D 공간에 투영하고 3D 마스크를 정제합니다.
  * **크로스-뷰 자체 프롬프트:** 부정확한 3D 마스크에서 렌더링된 2D 마스크로부터 신뢰할 수 있는 프롬프트를 자동으로 추출하여 SAM의 입력으로 제공, 더 정확한 2D 마스크를 생성합니다.
* **속도 가속 메커니즘:** SAM 인코더의 특징 추출 결과를 미리 캐시하는 "특징 캐시(feature cache)" 메커니즘을 도입하여 SA3D의 추론 속도를 크게 향상시켰습니다 (최대 6.9배 이상).
* **다양한 래디언스 필드와의 호환성 및 효율성:** Vanilla-NeRF, TensoRF, 3D Gaussian Splatting (3D-GS) 등 다양한 래디언스 필드에 SA3D를 성공적으로 적용했으며, 특히 3D-GS와 통합 시 단 몇 초 (최소 2초) 만에 고품질 3D 분할을 달성합니다.
* **정성적/정량적 유효성 검증:** 다양한 데이터셋 및 장면(forward-facing, $360^{\circ}$ 장면)에서 객체 분할, 부분 분할, 텍스트-프롬프트 분할 등 다양한 설정에서 SA3D의 효과성과 효율성을 입증했습니다.

## 📎 Related Works

* **래디언스 필드:** NeRF [2]를 시작으로 훈련 및 렌더링 속도 개선을 위한 Instant-NGP [3], TensoRF [5] 등의 연구가 진행되었습니다. 최근에는 실시간 렌더링을 가능하게 하는 3D Gaussian Splatting (3D-GS) [7]이 주목받고 있습니다.
* **2D 분할:** FCN [32] 이후 Mask R-CNN [34], Panoptic Segmentation [35], DeepLab [36], Transformer 기반 모델 [39, 40] 등이 발전했습니다. SAM [1]은 프롬프트 기반 분할 패러다임을 도입하며 새로운 연구 붐을 일으켰으며, 효율적인 파인튜닝 [46-48], 가속화 [49, 50], 의료 영상 [51] 및 3D BEV 감지 [59] 등 다양한 도메인으로 확장되고 있습니다. SEEM [60]은 오픈-어휘 분할 능력을 보여줍니다.
* **3D 분할 및 인지:** RGB-D 이미지 [61], 포인트 클라우드 [65], 복셀 [68] 등의 다양한 3D 표현을 활용한 연구가 이루어졌습니다. CLIP [82]과 같은 2D 비전-언어 모델(VLM)의 인지 능력을 3D 표현에 주입하여 언어 기반 3D 인지 작업을 수행하는 LERF [11], LangSplat [74] 등의 연구가 있습니다. SA3D는 이와 달리 사용자 프롬프트 기반의 미세한 분할에 중점을 둡니다.
* **래디언스 필드 내 분할:**
  * **의미 정보 통합:** Semantic-NeRF [83], NVOS [9] 등은 래디언스 필드에 의미 정보를 통합하거나 3D 특징을 학습하여 분할합니다.
  * **2D 특징 3D 리프팅:** N3F [84], LERF [11], LangSplat [74], ISRF [86] 등은 2D 시각 특징을 3D로 정렬하여 3D 분할에 활용합니다.
  * **2D 마스크 전파:** MVSeg [10]는 2D 자가 지도 모델(DINO [90])을 사용하여 2D 마스크를 뷰 간에 전파하지만, 3D 위치 정보를 통합하지 않아 복잡한 장면에서 노이즈가 많고 성능이 저조할 수 있습니다. SA3D의 크로스-뷰 자체 프롬프트 메커니즘은 이 문제를 해결합니다.
  * **SAM 기반 자동 마스크 추출:** Cen et al. [91], OmniSeg3D [94] 등은 SAM을 사용하여 멀티뷰 이미지에서 마스크를 자동으로 생성하고 이를 3D 특징 필드로 증류합니다. 하지만 인간 개입이 없어 자동 추출 단계에서 놓친 객체나 특정 세분화 요구사항에 실패할 수 있습니다. SA3D는 사용자가 요구하는 정확한 3D 분할을 가능하게 합니다.
  * **클래스-특정 분할:** 기존 인스턴스/의미 분할 접근법 [95-101]은 사전 정의된 클래스에 집중하지만, SA3D는 2D SAM의 파운데이션 모델 능력을 활용하여 *모든* 클래스의 객체를 분할할 수 있습니다.

## 🛠️ Methodology

SA3D는 사전 훈련된 래디언스 필드와 단일 뷰의 2D 프롬프트가 주어졌을 때, 반복적인 마스크 정제 과정을 통해 3D 마스크를 생성합니다.

1. **전체 파이프라인 (그림 2):**
    * **특징 캐시 구축:** 분할 시작 전, SAM 인코더 $S_e$를 사용하여 모든 입력 이미지 $I$의 특징 $f_I$를 추출하고 특징 캐시 $F = \{f_I | I \in I\}$를 구축합니다.
    * **초기 2D 마스크 생성:** 사용자가 특정 뷰 $I^{(1)}$에서 대상 객체에 대한 2D 프롬프트 $P^{(1)}$(예: 점)을 제공하면, SAM 디코더 $S_d$가 해당 뷰의 2D 마스크 $M^{(1)}_{SAM} = S_d(f_{I^{(1)}}, P^{(1)})$를 생성합니다.
    * **반복적 정제:** 이후 SA3D는 "마스크 역 렌더링"과 "크로스-뷰 자체 프롬프트"의 두 단계를 교대로 수행하며 3D 마스크를 점진적으로 정제합니다.

2. **3D 마스크 표현 (Section 4.2):**
    * **NeRFs용:** 3D 복셀 그리드 $V \in \mathbb{R}^{L \times W \times H}$를 사용하여 각 그리드 정점에 마스크 신뢰도 점수를 저장합니다. 2D 마스크 렌더링은 다음과 같습니다:
        $$ M(r) = \int_{t_n}^{t_f} \omega(r(t))V(r(t))dt $$
        여기서 $V(r(t))$는 3D 마스크 그리드에서 보간된 마스크 신뢰도 점수입니다.
    * **3D-GS용:** 각 3D 가우시안 $g_i$에 0으로 초기화된 마스크 신뢰도 점수 $m_{g_i}$를 새로운 속성으로 통합합니다. 2D 마스크 렌더링은 다음과 같습니다:
        $$ M(r) = \sum_{i=1}^{|G_r|} \omega_{g_i} m_{g_i} $$
        이는 NeRF용 복셀 그리드보다 메모리 효율적이며 계산 비용이 낮습니다.

3. **마스크 역 렌더링 (Section 4.3):**
    * SAM이 생성한 2D 마스크 $M_{SAM}(r)$를 3D 공간에 투영하여 3D 마스크를 정제합니다.
    * 래디언스 필드에서 학습된 밀도 분포(가중치 $\omega(r(t))$ 또는 $\{\omega_{g_i}\}$)를 활용하여 객체의 3D 구조를 반영합니다.
    * 마스크 투영 손실(mask projection loss)은 다음과 같습니다:
        $$ L_{proj} = -\sum_{r \in R(I)} M_{SAM}(r) \cdot M(r) + \lambda \sum_{r \in R(I)} (1 - M_{SAM}(r)) \cdot M(r) $$
        여기서 $\lambda$는 음수 항의 강도를 조절하는 하이퍼파라미터입니다. 음수 정제 항은 SAM이 여러 뷰에서 일관되게 전경으로 예측하는 영역만 3D 마스크에서 전경으로 표시되도록 하여 멀티뷰 일관성을 강화합니다.

4. **크로스-뷰 자체 프롬프트 (Section 4.4):**
    * **새로운 뷰에 대한 마스크 렌더링:** 현재의 3D 마스크로부터 새로운 뷰에 대한 2D 마스크 $M^{(n)}$를 렌더링합니다. 이 마스크는 초기 단계에서는 부정확할 수 있습니다.
    * **자체 프롬프트 전략 (Section 4.4.1, 그림 3):** 렌더링된 $M^{(n)}$와 래디언스 필드가 제공하는 3D 기하학적 사전 정보(3D geometry prior)를 사용하여 프롬프트 포인트 $P_s$를 자동으로 추출합니다.
        * 가장 높은 마스크 신뢰도를 가진 점을 첫 프롬프트로 선택합니다.
        * 기존 프롬프트 점과의 3D 거리에 기반한 신뢰도 감쇠 항 $\Delta M^{(n)}(p)$를 도입하여, 새로운 프롬프트가 높은 신뢰도를 가지면서도 기존 프롬프트에 가까운 곳에 있도록 유도합니다:
            $$ \Delta M^{(n)}(p) = \min\{M^{(n)}(\hat{p}) \cdot d(G(p),G(\hat{p})) | \hat{p} \in P_s\} $$
            감쇠된 마스크 신뢰도 점수 $\tilde{M}^{(n)}(p) = M^{(n)}(p) - \Delta M^{(n)}(p)$를 계산하고, 가장 높은 점수를 가진 점을 프롬프트 세트에 추가합니다. 이 과정은 프롬프트 수가 $n_p$에 도달하거나 $\tilde{M}^{(n)}(p)$의 최대값이 0보다 작아질 때까지 반복됩니다.
    * **IoU-aware 뷰 거부 (Section 4.4.2):** 렌더링된 마스크 $M^{(n)}$와 SAM 예측 $M^{(n)}_{SAM}$ 간의 IoU가 임계값 $\tau$ 미만이면, SAM의 예측을 거부하고 마스크 역 렌더링 단계를 건너뛰어 부정확한 정보를 3D 마스크에 반영하는 것을 방지합니다.

5. **3D-GS의 모호한 가우시안 제거 (Section 4.5):**
    * 선택적으로, 3D-GS의 객체 경계면에 나타나는 모호한 가우시안(ambiguous Gaussians) 아티팩트를 제거하는 전략을 제공합니다. 배경 가우시안 제거 후, 보존된 2D 마스크를 사용하여 추가적인 역 렌더링 라운드를 수행함으로써 대부분의 모호한 가우시안을 제거합니다.

## 📊 Results

* **NVOS 데이터셋 (표 1):** SA3D-GS (w/ FC)는 92.2%의 mIoU를 달성하여 OmniSeg3D (91.7%), ISRF (83.8%), NVOS (70.1%) 등 기존 방법들을 크게 능가합니다. 특징 캐시 덕분에 전체 3D 분할 시간은 2초(특징 캐시 30초 제외)로 매우 효율적입니다.
* **SPIn-NeRF 데이터셋 (표 2):** SA3D의 모든 변형(NeRF, TensoRF, 3D-GS)은 MVSeg 및 "Single view" 방식보다 우수한 성능을 보였습니다. 특히 SA3D-TensoRF (w/ FC)는 93.7%의 평균 IoU를, SA3D-GS (w/ FC)는 93.2%의 평균 IoU를 달성했습니다. Vanilla-NeRF는 기하학적 학습의 한계로 인해 다른 래디언스 필드에 비해 성능이 약간 낮았습니다.
* **Replica 데이터셋 (표 3):** SA3D-TensoRF (w/ FC)는 82.7%의 mIoU로 MVSeg (32.4%)보다 훨씬 높은 성능을 보였습니다. SA3D-GS (w/ FC)는 79.1%의 mIoU를 기록했는데, 이는 Replica 데이터셋의 약한 텍스처로 인해 3D-GS가 학습한 3D 기하학적 구조에 투명한 아티팩트가 많이 발생했기 때문으로 분석됩니다.
* **정성적 결과 (그림 5, 6, 7, 8):**
  * **객체 및 부분 분할:** SA3D는 작은 객체부터 Lego 불도저의 버킷이나 꽃다발 속의 꽃 한 송이 같은 복잡한 객체의 부분까지 정확하게 분할하는 능력을 보여줍니다.
  * **텍스트 프롬프트 분할:** Grounding-DINO [108]와 결합하여 "테이블", "꽃병"과 같은 텍스트 프롬프트에 따라 3D 객체를 성공적으로 분할할 수 있습니다.
  * **다중 객체 동시 분할:** 3D 마스크에 추가 차원을 부여하여 여러 객체를 동시에 분할하는 것도 가능합니다.
  * **특징 필드 기반 방법 대비 우수성 (그림 8):** SA3D는 T-렉스 해골과 같이 특정 사용자 요구사항에 따라 미세한 분할을 필요로 하는 경우, OmniSeg3D와 같은 특징 필드 기반 방법보다 훨씬 정확하게 분할합니다. 이는 특징 필드 기반 방법이 자동으로 추출된 마스크에 의존하여 학습되기 때문입니다.

## 🧠 Insights & Discussion

* **래디언스 필드를 통한 SAM 분할 품질 향상:** SA3D는 래디언스 필드의 정교한 깊이 추정(기하학적 정보)을 활용하여 SAM의 2D 분할 오류(예: 작은 구멍, 가장자리)를 제거하고 디테일을 효과적으로 포착할 수 있습니다 (그림 11). 특히 투영 손실의 음수 정제 항(식 8)은 SAM이 놓친 작은 구멍을 통해 배경에 투영된 마스크를 다른 뷰에서 전경 예측에 포함되지 않을 때 효과적으로 억제합니다.
* **잘못 학습된 기하학적 구조의 영향:** 반대로, 래디언스 필드가 잘못 학습한 3D 기하학적 구조(예: Replica 데이터셋에서 3D-GS가 생성한 투명한 아티팩트)는 분할 모델을 혼란스럽게 하여 성능 저하를 초래할 수 있습니다 (표 3, 그림 12). 이는 래디언스 필드의 고품질 3D 재구축이 SA3D의 성능에 매우 중요함을 시사합니다.
* **어블레이션 스터디:**
  * **뷰 개수 (표 4):** 뷰 개수가 많아질수록 분할 결과가 향상되지만, 특징 캐시 덕분에 시간 비용은 미미하게 증가합니다. SA3D-GS (w/ FC)는 5개 뷰로 2초 이내에 3D 분할을 완료할 수 있습니다.
  * **하이퍼파라미터 (표 5, 6, 그림 9):**
    * IoU 거부 임계값 $\tau$: 너무 작으면 노이즈 유입, 너무 크면 정보 부족. 0.5가 기본값으로 적절.
    * 손실 균형 계수 $\lambda$: 작은 음수 항(0.1-0.3)이 노이즈 감소에 기여. 너무 크면 마스크 완성 과정이 불안정. 0.15가 기본값으로 적절.
    * 자체 프롬프트 점 $n_p$: 분할 대상에 따라 다름. 크고 복잡한 객체에는 더 많은 점이 필요할 수 있으나, 일반적으로 3개가 적절.
  * **자체 프롬프트 전략 (표 7):** 3D 거리 기반 신뢰도 감쇠 항은 깊이 변화가 큰 복잡한 장면(예: LLFF-trex)에서 부정확한 영역에 프롬프트가 생성되는 것을 방지하여 성능 향상에 크게 기여합니다.
  * **2D 분할 모델 (표 8):** SA3D는 SEEM, SimpleClick 등 다른 프롬프트 기반 2D 분할 모델과 통합 시에도 안정적인 성능을 보여 일반화 능력을 입증했습니다.
  * **시간 비용 분석 (표 9):** SA3D-GS (w/ FC)는 초당 10~17프레임 이상의 최적의 효율성을 달성합니다. 특징 캐시가 없을 때는 SAM 인코더의 순방향 패스가 병목 현상을 일으키고, NeRF/TensoRF는 마스크 렌더링/역 렌더링이 주요 병목입니다.
  * **마스크 그리드 해상도 (표 10):** 마스크 그리드 해상도는 분할 결과에 미미한 영향을 미치며, 저해상도 명시적 그리드와 삼선형 보간으로도 경쟁력 있는 결과를 얻을 수 있습니다. MLP를 사용한 3D 마스크 표현은 불안정한 최적화로 인해 성능이 저하됩니다.
  * **모호한 가우시안 제거 (그림 10):** 3D-GS의 아티팩트, 특히 색상이 유사한 객체 경계면에서 발생하는 모호한 가우시안을 효과적으로 제거합니다. 1초 이내로 완료되어 전체 파이프라인에 미미한 시간 오버헤드를 추가합니다.

## 📌 TL;DR

**문제:** 강력한 2D 분할 모델인 SAM의 능력을 고비용의 3D 데이터셋 구축 없이 효율적으로 3D 객체 분할로 확장하는 것입니다.
**방법:** SA3D는 사전 훈련된 래디언스 필드(NeRF, TensoRF, 3D-GS)를 3D 구조적 사전 정보로 활용하고, 단일 뷰의 2D 프롬프트로부터 시작하여 3D 마스크를 반복적으로 정제합니다. 이 과정은 "마스크 역 렌더링" (SAM의 2D 마스크를 3D로 투영)과 "크로스-뷰 자체 프롬프트" (렌더링된 3D 마스크에서 자동으로 새로운 2D 프롬프트를 생성, 3D 기하학적 정보를 통합)를 교대로 수행합니다. 특징 캐시 메커니즘을 통해 SAM 인코더의 연산 병목을 해소하여 빠른 속도를 달성합니다.
**주요 결과:** SA3D는 높은 품질의 3D 분할을 효율적으로 수행하며 (3D-GS 및 특징 캐시 사용 시 2초 이내), 다양한 장면 및 분할 유형(객체, 부분, 텍스트 프롬프트)에 잘 일반화됩니다. 이 연구는 2D SAM의 능력을 래디언스 필드를 통해 3D 공간으로 효과적으로 "들어 올리는" 자원 효율적인 방법론을 제시하며, 견고한 3D 기하학적 구조의 중요성을 강조합니다.
