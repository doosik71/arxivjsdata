# Learning Spatially Regularized Correlation Filters for Visual Tracking

Martin Danelljan, Gustav Häger, Fahad Shahbaz Khan, Michael Felsberg

## 🧩 Problem to Solve

강건하고 정확한 시각 추적은 컴퓨터 비전 분야에서 매우 도전적인 문제 중 하나입니다. 특히 훈련 데이터의 부족으로 인해 강력한 목표 외형 모델을 구축하는 것이 중요합니다. 최근 차별적으로 학습된 상관 필터(Discriminative Correlation Filter, DCF) 기반 방법론이 추적 문제에 성공적으로 적용되었지만, 이러한 방법들은 훈련 샘플에 대한 주기성 가정(periodic assumption)을 활용하여 효율성을 얻는 동시에 다음과 같은 문제점을 야기합니다:

- **원치 않는 경계 효과(Boundary Effects)**: 주기성 가정은 훈련 패치에 주기적인 반복을 도입하여 이미지 내용을 부정확하게 표현하게 하고, 이는 추적 모델의 품질을 심각하게 저하시킵니다.
- **제한적인 음성 훈련 샘플**: 부정확한 음성 훈련 패치는 학습된 모델의 판별력(discriminative power)을 감소시킵니다.
- **제한된 탐지 영역**: 탐지 점수가 영역 중앙에서만 정확하고 나머지 점수는 주기적인 반복에 크게 영향을 받으므로, 매우 제한된 목표 검색 영역만 사용할 수 있게 됩니다. 이는 빠른 목표 움직임, 변형, 가려짐 후 재탐지 등에 취약하게 만듭니다.
- **긍정 샘플 손상**: 상관 필터 훈련에 사용되는 이미지 영역을 단순히 확장할 경우, 긍정 훈련 샘플 내에 상당한 양의 배경 정보가 포함되어 모델의 판별력을 저하시킬 수 있습니다.

## ✨ Key Contributions

본 논문은 표준 DCF의 주기성 가정으로 인한 문제를 해결하기 위해 **공간 정규화된 차별적 상관 필터(Spatially Regularized Discriminative Correlation Filters, SRDCF)**를 제안합니다.

- **공간 정규화 구성 요소 도입**: DCF 학습 공식에 공간 위치에 따라 상관 필터 계수에 페널티를 부과하는 공간 정규화 구성 요소를 도입했습니다.
- **더 넓은 음성 샘플 세트 활용**: 제안된 공간 정규화 덕분에 필터가 긍정 샘플을 손상시키지 않고 훨씬 더 큰 음성 훈련 샘플 세트에서 학습될 수 있게 되어, 더욱 판별력 있는 모델을 얻을 수 있습니다.
- **효율적인 온라인 최적화 전략**: 제안된 SRDCF의 효율적인 온라인 학습을 위해 반복적인 Gauss-Seidel 방법을 기반으로 하는 최적화 전략을 제안했습니다. 이 방법은 Fourier Domain에서 공간 정규화 함수의 희소성(sparsity)을 활용합니다.
- **서브-그리드 탐지**: 탐지 점수를 서브-그리드(sub-grid) 정밀도로 최대화하는 전략을 추가했습니다.
- **최고 수준의 성능 달성**: OTB-2013, ALOV++, OTB-2015, VOT2014 등 네 가지 벤치마크 데이터셋에서 모두 최첨단(state-of-the-art) 결과를 달성했습니다. 특히 OTB-2013 및 OTB-2015에서 기존 최고 트래커 대비 평균 겹침 정밀도(mean overlap precision)에서 각각 8.0% 및 8.2%의 절대적인 성능 향상을 보였습니다.

## 📎 Related Works

- **MOSSE (Bolme et al., 2010) [5]**: grayscale 샘플만을 사용하여 상관 필터를 처음 추적에 도입했습니다.
- **Multi-channel DCF**: HOG [7] 또는 Color-Names [31]와 같은 다차원 특징에 대한 다중 채널 필터 학습을 통해 상당한 개선을 이루었으나 [9, 8, 10, 20, 24], 계산 효율성을 위해 표준 DCF 공식의 강한 근사치를 사용했습니다.
- **오프라인 학습 DCF**: 객체 탐지 [13, 18] 및 인식 [4]을 위한 오프라인 학습 DCF도 연구되었으나, 온라인 추적 애플리케이션에는 계산 비용이 너무 높습니다.
- **경계 효과 문제 해결 시도**: Galoogahi et al. [14] (CFLB)은 단일 채널 DCF의 경계 효과 문제를 조사하고 ADMM (Alternating Direction Method of Multipliers)을 사용하여 제약된 최적화 문제를 해결했습니다. 그러나 이는 각 ADMM 반복마다 공간 및 Fourier Domain 간의 전환이 필요하여 계산 복잡도가 증가합니다. 본 논문은 목적 함수에 공간 정규화 구성 요소를 제안하고, 정규화 장치의 희소성을 활용하여 Fourier Domain에서 필터를 직접 효율적으로 최적화한다는 점에서 차이가 있습니다. 특히 HOG와 같은 다차원 특징 문제를 다룹니다.

## 🛠️ Methodology

SRDCF는 표준 DCF의 주기성 가정으로 인한 문제를 해결하기 위해 공간 정규화(Spatial Regularization)를 도입합니다.

1. **공간 정규화 도입**:

   - 표준 DCF 손실 함수 $\varepsilon_{t}(f)$ 의 정규화 항을 더 일반적인 Tikhonov 정규화로 대체합니다.
   - 공간 가중치 함수 $w : \Omega \to \mathbb{R}$ 를 도입하여 필터 계수 $f_{l}$ 의 크기에 공간 위치에 따라 페널티를 부과합니다. 목표 영역 외부의 계수에는 높은 $w$ 값을 할당하여 억제하고, 목표 영역 내부에는 낮은 $w$ 값을 할당합니다.
   - 새로운 최적화 문제는 다음과 같습니다:
     $$ \varepsilon(f) = \sum*{k=1}^{t} \alpha*{k} \| S*{f}(x*{k}) - y*{k} \|^2 + \sum*{l=1}^{d} \| w \cdot f*{l} \|^2 $$
     여기서 $S*{f}(x) = \sum*{l=1}^{d} x*{l} \* f*{l}$ 이고, $\alpha*{k} \ge 0$ 는 각 훈련 샘플의 영향력을 결정합니다.
   - 실제로 $w(m,n)$ 는 샘플 중앙에서 최소값을 갖는 2차 함수 $w(m,n) = \mu + \eta(m/P)^2 + \eta(n/Q)^2$ 로 구성됩니다. ($P \times Q$는 목표 크기, $\mu=0.1$, $\eta=3$). $w$의 Fourier 계수 중 임계값 이하인 작은 계수들은 제거하여 $\hat{w}$의 희소성을 확보합니다.

2. **Fourier Domain에서의 문제 변환**:

   - Parseval의 정리를 적용하여 손실 함수 $\varepsilon(f)$ 를 Fourier Domain에서의 등가 손실 함수 $\tilde{\varepsilon}(\tilde{f})$ 로 변환합니다. 이는 컨볼루션 연산을 점별 곱셈으로 변환하여 효율적인 계산을 가능하게 합니다.
   - Hermitian 대칭성을 유지하기 위해 $\hat{f}_{l}$ 를 실수 값으로 재구성한 변수 $\tilde{f}_{l}$ 를 사용합니다.
   - 최종적으로 최적화 문제는 다음과 같은 정규 방정식(normal equations)의 해를 찾는 것으로 귀결됩니다:
     $$ A*{t} \tilde{f} = \tilde{b}*{t} $$
        여기서 $A_{t} = \sum_{k=1}^{t} \alpha_{k} D_{k}^{T} D_{k} + W^{T}W$ 이고, $\tilde{b}_{t} = \sum_{k=1}^{t} \alpha_{k} D_{k}^{T} \tilde{y}_{k}$ 입니다. $D_{k}$ 와 $W$ 는 각 샘플 및 공간 정규화와 관련된 블록 행렬입니다. $W^{T}W$ 는 공간 정규화로 인해 표준 DCF와 달리 블록 대각선 구조를 갖지 않지만, $\hat{w}$의 희소성을 통해 $A_{t}$도 희소 행렬이 됩니다.

3. **효율적인 온라인 최적화**:

   - 정규 방정식 $A_{t} \tilde{f} = \tilde{b}_{t}$ 를 효율적으로 해결하기 위해 반복적인 **Gauss-Seidel 방법**을 사용합니다.
   - Gauss-Seidel은 $A_{t}$ 를 하삼각 행렬 $L_{t}$ 와 엄격한 상삼각 행렬 $U_{t}$ 로 분해한 후 다음 시스템을 반복적으로 풉니다:
     $$ L*{t} \tilde{f}^{(j)} = \tilde{b}*{t} - U*{t} \tilde{f}^{(j-1)} $$
        $L*{t}$ 와 $U_{t}$ 의 희소성을 활용하여 효율적으로 해결됩니다.
   - 모델은 학습률 $\gamma=0.025$ 를 사용하여 지수적으로 감쇠하는 방식으로 $A_{t}$ 와 $\tilde{b}_{t}$ 를 업데이트합니다.
   - 각 프레임에서 $N_{GS}=4$ 번의 Gauss-Seidel 반복을 수행하여 필터 계수를 계산합니다. 초기 프레임에서는 직접 희소 행렬 솔버를 사용하여 필터를 계산하여 Gauss-Seidel의 시작점으로 사용합니다.

4. **추적 프레임워크**:
   - **훈련 단계**: 목표 위치를 중심으로 새로운 훈련 샘플을 추출하고, 위에서 설명한 방식으로 $A_{t}$ 와 $\tilde{b}_{t}$ 를 업데이트한 후 Gauss-Seidel 반복을 통해 필터를 갱신합니다.
   - **탐지 단계**: 이전 프레임에서 업데이트된 필터를 사용하여 새로운 프레임에서 목표 위치를 추정합니다.
     - 다중 해상도로 필터를 적용하여 목표 크기 변화를 추정합니다.
     - **고속 서브-그리드 탐지**: 특징 추출 시 격자(grid)를 사용하여 탐지 점수를 계산하므로, 픽셀 단위의 정확한 탐지 점수를 얻기 위해 삼각 다항식 보간(interpolation)을 사용합니다. 계산된 DFT 계수를 활용하여 탐지 점수 $S_{f}(z)$ 의 DFT $\hat{s}$ 를 얻고, 이를 통해 연속적인 위치 $(u,v)$ 에서의 점수를 계산합니다.
       $$ s(u,v) = \frac{1}{MN} \sum*{m=0}^{M-1} \sum*{n=0}^{N-1} \hat{s}(m,n)e^{i2\pi \left(\frac{m}{M}u+\frac{n}{N}v\right)} $$
     - 최대 점수에 해당하는 서브-그리드 위치를 찾기 위해 Newton's method를 사용하여 (14)를 반복적으로 최대화합니다.
   - **특징**: HOG 특징을 사용하며, 샘플 영역은 목표 경계 상자 면적의 $4^2$ 배로 설정하고 Hann window를 적용합니다. 레이블 함수 $y_{t}$ 는 목표 크기에 비례하는 표준 편차를 가진 가우시안으로 설정합니다.

## 📊 Results

본 논문은 OTB-2013, OTB-2015, ALOV++, VOT2014의 4가지 벤치마크 데이터셋에서 포괄적인 실험을 수행했습니다.

- **OTB-2013 & OTB-2015**:
  - **Mean Overlap Precision (OP)**: OTB-2013에서 78.1%, OTB-2015에서 72.9%를 달성하여 기존 최고 트래커들(MEEM, SAMF) 대비 각각 **8.0% 및 8.2%**의 상당한 성능 향상을 보였습니다.
  - **Success Plot (AUC)**: OTB-2013에서 63.3%, OTB-2015에서 60.5%의 AUC 점수를 기록하며 기존 최고 트래커들(SAMF)을 각각 **5.6% 및 5.7%** 능가했습니다.
- **ALOV++**:
  - 평균 F-score에서 **0.787**을 달성하여 24개 비교 트래커 중 가장 우수한 종합 성능을 기록했습니다 (MEEM의 0.708 대비).
- **VOT2014**:
  - 최종 순위(Final Rank)에서 **8.26**으로 DSST와 SAMF를 능가하며 가장 높은 순위를 차지했습니다. 정확도 및 견고성 측면에서 모두 우수함을 입증했습니다.
- **공간 정규화의 효과**:
  - 기존 DCF가 큰 샘플 크기에서 50.1%의 OP를 보이는 반면, SRDCF는 동일한 큰 샘플 크기에서 **78.1%**의 OP를 달성하여 **7.0%**의 큰 성능 이득을 보여주었습니다. 이는 공간 정규화가 긍정 샘플을 손상시키지 않고도 더 많은 배경 정보를 학습할 수 있게 함을 명확히 입증합니다.
  - CFLB [14]와의 공정한 비교에서도 5.7% 더 우수한 성능을 보였습니다.
- **초기화 견고성**: OTB-2013의 공간 견고성(SRE) 및 시간 견고성(TRE) 평가 모두에서 기존 최고 트래커들 대비 일관된 성능 향상을 보였습니다.
- **속성 기반 분석**: OTB-2013의 11가지 속성 중 10가지 속성에서 기존 트래커들을 능가했습니다. 특히 모션 블러 및 빠른 움직임과 같은 표준 DCF 트래커가 취약한 시나리오에서 성능이 크게 개선되었습니다.

## 🧠 Insights & Discussion

- **핵심 문제 해결**: 본 논문은 표준 DCF 기반 추적기의 가장 큰 한계인 주기성 가정을 성공적으로 해결했습니다. 이는 공간 정규화를 통해 필터가 목표 영역의 시각 정보에 더 집중하고, 경계 효과를 완화하며, 더 넓은 이미지 영역에서 효과적인 음성 샘플을 학습할 수 있도록 함으로써 이루어졌습니다.
- **판별력 및 견고성 향상**: 더 많은 유효한 음성 샘플을 포함할 수 있게 됨으로써 학습된 모델의 판별력이 크게 향상되었고, 이는 과적합을 줄이는 데 기여합니다. 또한, 제한된 탐지 영역 문제가 해결되어 빠른 움직임, 스케일 변화, 가려짐 등 도전적인 추적 시나리오에서 추적기의 견고성이 크게 향상되었습니다.
- **실용적인 효율성**: Fourier Domain에서의 최적화와 Gauss-Seidel 방법의 적용은 온라인 추적에 필수적인 계산 효율성을 유지하면서 복잡한 공간 정규화를 가능하게 합니다. 희소성을 활용하는 방식 또한 중요합니다. Matlab 구현에서 5 FPS의 속도를 보여 실시간에 근접한 성능을 제공합니다.
- **광범위한 적용 가능성**: 제안된 방법은 HOG와 같은 다차원 특징에 효과적으로 적용될 수 있으며, 다양한 벤치마크 데이터셋에서 지속적으로 최고 성능을 달성함으로써 그 일반성과 효과를 입증했습니다. 명시적인 가려짐 처리 구성 요소가 없음에도 가려짐 상황에서 유리하게 작동한다는 점이 주목할 만합니다.

## 📌 TL;DR

본 논문은 표준 DCF(Discriminative Correlation Filter) 기반 시각 추적기의 주기성 가정으로 인한 경계 효과 및 제한된 음성 샘플 학습 문제를 해결하기 위해 **공간 정규화된 DCF (SRDCF)**를 제안합니다. SRDCF는 필터 계수에 공간 위치 기반 가중치를 부여하여 더 넓은 이미지 영역에서 모델의 판별력을 높입니다. Fourier Domain에서의 효율적인 **Gauss-Seidel 기반 최적화** 전략을 통해 온라인 학습이 가능하며, 서브-그리드 탐지 기능을 포함합니다. OTB, ALOV++, VOT 등 주요 벤치마크에서 기존 최고 트래커들을 압도하는 State-of-the-art 성능을 달성하며, 특히 빠른 움직임, 스케일 변화, 가려짐 등 어려운 상황에서 뛰어난 견고성을 입증했습니다.
