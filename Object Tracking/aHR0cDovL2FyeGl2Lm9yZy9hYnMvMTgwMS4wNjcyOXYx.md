# EnKCF: Ensemble of Kernelized Correlation Filters for High-Speed Object Tracking
Burak Uzkent, YoungWoo Seo

## 🧩 Problem to Solve
임베디드 시스템에서 구동되는 실제 애플리케이션을 위한 고속(예: 300-450 fps) 객체 추적 알고리즘을 개발하는 것이 목표입니다. 기존의 단일 객체 추적 알고리즘, 특히 커널화된 상관 필터(KCF) 기반 방식은 장기 추적 시 드리프트(drift)에 취약하며, 객체의 스케일 및 변환 변화에 효율적으로 대응하기 어렵습니다. 이러한 변화를 다루기 위해 여러 KCF를 동시에 실행하거나 ROI(Region of Interest)를 스캔하는 방법은 실행 시간을 크게 저하시키는 문제가 있습니다. 또한, 외관 모델 업데이트 시 안정성-유동성 딜레마로 인해 모델이 특정 이미지에 과적합될 위험이 있습니다.

## ✨ Key Contributions
*   **EnKCF(Ensemble of Kernelized Correlation Filters) 제안:** 고속 단일 객체 추적을 위해 KCF 앙상블을 활용하는 새로운 방법을 제시합니다.
*   **교대 KCF 배포 전략:** 객체의 스케일 및 변환 변화에 효율적으로 대응하기 위해 세 가지 특수 KCF(작은 영역 변환 필터 R$_{S_t}$, 스케일 필터 R$_s$, 큰 영역 변환 필터 R$_{L_t}$)를 매 프레임마다 동시에 적용하는 대신 교대로 배포하여 높은 실행 속도를 유지합니다.
*   **파티클 필터 도입:** 개별 KCF 간 전환 시 발생할 수 있는 잠재적 드리프트를 줄이고 추적의 견고성을 향상시키기 위해 파티클 필터를 개발했습니다.
*   **다양한 피처 탐색:** 제안된 EnKCF의 유연성을 높이기 위해 수작업 피처(fHoG + Color-naming) 외에 다양한 추상화 수준의 딥 컨볼루션 피처를 탐색했습니다.
*   **우수한 성능 달성:** OTB100 데이터셋에서 340fps, UAV123 데이터셋에서 416fps의 높은 속도를 달성하면서도 다른 고속 추적기보다 정밀도와 성공률에서 더 나은 성능을 입증했습니다.

## 📎 Related Works
이 연구는 상관 필터(Correlation Filter, CF) 기반 추적 알고리즘의 발전에 기반하고 있습니다.
*   **상관 필터 기반 추적기:**
    *   **MOSSE [2], CSK [11], KCF [12]:** 초기 상관 필터 기반 추적기들로, KCF는 다중 채널 피처를 사용해 인상적인 성능을 보였으나 드리프트에 취약합니다.
    *   **STC [26], DSST [5], SAMF [16]:** 스케일 적응을 시도한 추적기들입니다. DSST는 1D 스케일 필터와 33개 후보 스케일을 사용합니다.
    *   **LCT [18]:** 다중 KCF를 순차적으로 적용하여 변환과 스케일을 학습하지만, 실행 속도가 느립니다(≤ 50 fps). EnKCF는 LCT의 아이디어에 영감을 받았지만, 더 효율적인 방식을 제안합니다.
*   **딥 컨볼루션 피처 활용 추적기:**
    *   **[6], [17]:** VGGNet 등 사전 학습된 CNN 피처를 추적에 통합한 연구들로, 더 높은 추상화 능력의 피처가 성능 향상에 기여함을 보여주었습니다. 하지만 [17]은 여러 KCF를 순차적으로 실행하여 속도 저하가 발생합니다.
*   **기타 온라인 추적 알고리즘:**
    *   **ECO [4], CCOT [7]:** 최근 높은 성능을 보여주는 추적기들이지만, 일반적으로 속도가 느립니다.
    *   **SCT [3], Struck [10], MUSTER [13], TLD [14], OAB [27]:** 다양한 기법을 활용한 온라인 추적 알고리즘들입니다.

## 🛠️ Methodology
EnKCF는 세 가지 KCF를 교대로 사용하여 객체의 스케일 및 변환 변화에 대응하고, 파티클 필터를 통해 추적의 견고성을 높입니다.

1.  **앙상블 KCF(EnKCF) 구성:**
    *   **세 가지 KCF:**
        *   **R$_{S_t}$ (Small Area Translation Filter):** 목표 영역과 작은 배경을 학습하여 미세한 변환 변화에 대응합니다. fHoG 피처를 사용합니다.
        *   **R$_s$ (Scale Filter):** 오직 목표의 스케일 학습에 집중합니다. fHoG와 Color-naming 피처를 함께 사용하며, 더 작은 템플릿($64 \times n$)과 3개의 스케일 후보({1.05, 1.0, 1/1.05})를 탐색합니다.
        *   **R$_{L_t}$ (Large Area Translation Filter):** 목표 영역과 더 넓은 배경을 학습하여 큰 변환 변화에 대응하고 잠재적 드리프트를 복구합니다. fHoG와 Color-naming 피처를 함께 사용합니다.

2.  **교대 배포 전략 (Algorithm 1):**
    *   **프레임 1:** 초기 바운딩 박스를 이용해 추적 알고리즘과 파티클 필터를 초기화합니다.
    *   **프레임 `i`와 `i+1` (조건 2):** R$_{L_t}$를 적용하여 변환을 추정하고 모델을 업데이트합니다.
    *   **프레임 `i+2`와 `i+3` (조건 3):** R$_{S_t}$를 적용하여 변환을 추정하고 모델을 업데이트합니다.
    *   **프레임 `i+4` (조건 1):** R$_s$를 적용하여 스케일을 추정하고 모델을 업데이트합니다.
    *   이 순서가 마지막 프레임까지 반복됩니다. R$_{L_t}$는 R$_s$ 적용 직후에 실행되어 스케일 필터 적용으로 발생할 수 있는 드리프트를 최소화하고, R$_{S_t}$는 R$_{L_t}$ 적용 후 실행되어 더 정확한 위치를 파악합니다.

3.  **KCF 핵심 원리:**
    *   KCF는 빈도 영역에서 능선 회귀(ridge regression) 문제를 효율적으로 해결합니다.
    *   훈련 샘플을 순환 행렬(circulant matrix)로 표현하고, 이 행렬이 이산 푸리에 변환(DFT)에 의해 대각화될 수 있다는 특성을 활용하여 계산 복잡도를 $O(n^3)$에서 $O(n \log(n))$으로 줄입니다.
    *   정규화된 목적 함수 $E_h = \min_h \frac{1}{2}\|y - \sum_{c=1}^C h_c \ast x_c\|^2 + \frac{\lambda}{2}\sum_{c=1}^C \|h_c\|^2$를 통해 최적의 $h$를 찾으며, 빈도 영역에서의 해는 $\hat{\alpha} = \hat{y}(\hat{k}_{xx'} + \lambda)^{-1}$로 주어집니다.
    *   모델 업데이트는 학습률 $\beta$를 사용하여 $\hat{\alpha}_t = (1-\beta)\hat{\alpha}_{t-1} + \beta\hat{\alpha}_t$ 및 $\hat{x}_t = (1-\beta)\hat{x}_{t-1} + \beta\hat{x}_t$ 방식으로 수행됩니다.

4.  **피처 추출:**
    *   **수작업 피처:** fHoG (형태)와 Color-naming (색상)을 사용합니다. R$_{L_t}$와 R$_s$는 이 둘을 모두 사용하여 판별력을 높이고, R$_{S_t}$는 fHoG만을 사용합니다.
    *   **딥 컨볼루션 피처 (DeepEnKCF):** VGGNet의 사전 학습된 피처를 활용합니다.
        *   `conv224-VGG` 설정: R$_{L_t}$와 R$_{S_t}$는 VGGNet의 2차 컨볼루션 레이어(109x109x64) 피처를, R$_s$는 4차 컨볼루션 레이어(26x26x128) 피처를 사용합니다. 이는 스케일 필터가 더 적은 공간 정보를 학습하므로 더 깊은 추상화 수준의 피처가 효과적이라고 가정합니다.
        *   `conv222-VGG` 설정: 모든 KCF에 VGGNet의 2차 컨볼루션 레이어 피처를 사용합니다.

5.  **파티클 필터를 이용한 KCF 간 전환 부드럽게 하기:**
    *   파티클 필터는 목표의 픽셀 좌표와 속도 $X_t = \{x, y, v_x, v_y\}$를 상태로 설정합니다.
    *   일정한 속도 운동 모델을 사용하여 다음 상태를 예측하고, EnKCF의 응답 맵($y_R$)을 관측치로 사용하여 상태를 업데이트합니다. 파티클 가중치는 $w_p^t(x_t,y_t) = \sum_{N}^{i=1}\sum_{M}^{j=1}y_R(x_t-i,y_t-j)$로 계산됩니다.
    *   효과적인 샘플 수가 사전 정의된 임계값보다 낮을 경우에만 리샘플링을 수행합니다.

## 📊 Results
EnKCF의 성능은 UAV123 (도전적인 데이터셋) 및 OTB100 (일반적인 데이터셋) 벤치마크에서 평가되었습니다.

*   **UAV123 데이터셋 (수작업 피처 사용 EnKCF):**
    *   **정밀도 (20 픽셀 기준):** EnKCF(54.5%)는 다른 고속 추적기(KCF, DCF 등)보다 3-15%p 우수한 성능을 보였습니다. SAMF, DSST, Struck과 같은 저속 추적기들은 약 5%p 더 높은 정확도를 보였으나, EnKCF가 10-20배 더 빨랐습니다. ECO 및 CCOT는 15%p 더 높았지만, 10-15배 느렸습니다.
    *   **성공률 (AUC 기준):** EnKCF(40.2%)는 전체 추적기 중 네 번째로 높은 AUC를 기록했으며, 다른 고속 추적기보다 20-25%p 우수했습니다. Struck, DSST와 같은 일부 저속 추적기보다도 5-10%p 더 나은 AUC를 보이면서도 10-30배 더 빨랐습니다.
    *   **실행 속도:** OTB100에서 340fps, UAV123에서 416fps를 달성하여 KCF(292fps) 및 DCF(292fps)보다 빨랐습니다.
*   **OTB100 데이터셋 (수작업 피처 사용 EnKCF):**
    *   UAV123과 유사한 성능을 보였습니다. 고속 추적기 중 가장 높은 정밀도와 성공률을 기록했습니다. DSST를 능가했으나, SAMF보다는 약 5%p 뒤처졌습니다. ECO 및 CCOT는 15-20%p 더 높았지만, 10-20배 느렸습니다.
*   **UAV123$_{10fps}$ 데이터셋 (수정된 EnKCF):**
    *   낮은 프레임률 데이터셋에 대한 견고성 평가를 위해 R$_{L_t}$를 매 프레임 실행하고 파티클 필터를 제거하여 실험했습니다.
    *   정밀도(46.2%)는 KCF, DSST 등 다른 고속 CF 기반 추적기보다 15-20%p 우수했으며, SAMF와 유사한 정밀도를 보였습니다. AUC 기준 4위를 기록했으며, 상위 3개 추적기보다 10-100배 빨랐습니다.
*   **파티클 필터 기여도:** UAV123 데이터셋 중 카메라 움직임이 크지 않은 50개 시퀀스에 인위적인 노이즈를 추가하여 테스트한 결과, 파티클 필터를 사용한 EnKCF는 사용하지 않은 경우보다 정밀도(20px)에서 6.32%p 향상된 51.98%를 기록했습니다.
*   **최적의 KCF 조합 및 배포 순서:** 다양한 KCF 조합 및 실행 순서에 대한 실험(표 1)을 통해 EnKCF의 교대 전략이 추적 정확도와 실행 속도 모두에서 최적임을 확인했습니다. 예를 들어, 모든 KCF를 매 프레임 순차적으로 실행하는 방식은 정확도를 4.26%p 높일 수 있지만, 실행 속도가 416fps에서 317fps로 크게 감소했습니다.
*   **딥 피처 활용 (DeepEnKCF on UAV123):**
    *   딥 피처를 사용한 DeepEnKCF는 수작업 피처를 사용한 EnKCF보다 정밀도(20px)에서 약 3-5%p, 성공률(AUC)에서 2%p 향상된 성능을 보였습니다.
    *   `conv224-VGG` 설정이 `conv222-VGG`보다 정밀도에서 약간 더 나은 결과를 보여, 작은 ROI에 대해 더 높은 수준의 피처 추상화가 효과적임을 시사했습니다.
    *   딥 피처 사용 시 CPU에서 평균 30-35fps로 실행되어, 수작업 피처 대비 속도는 크게 저하되었습니다.

## 🧠 Insights & Discussion
*   **효율적인 교대 배포:** EnKCF의 핵심 통찰은 객체의 외관이 연속적인 프레임에서 급격하게 변하지 않는다는 점입니다. 이를 활용하여 각기 다른 KCF(변환, 스케일)를 동시에 실행하는 대신 교대로 배포함으로써, 큰 정확도 손실 없이 상당한 속도 향상을 이루어냈습니다.
*   **특수화된 KCF의 시너지:** R$_{S_t}$, R$_s$, R$_{L_t}$ 각 KCF는 추적의 특정 측면(미세 변환, 스케일, 큰 변환/드리프트 복구)을 처리하도록 특수화되어 있으며, 이들이 유기적으로 결합하여 전체 추적 성능을 향상시킵니다.
*   **파티클 필터의 견고성 기여:** 파티클 필터는 KCF 간의 전환, 특히 스케일 업데이트가 드물게 이루어질 때 발생할 수 있는 드리프트를 효과적으로 완화하여 추적의 견고성을 높입니다.
*   **피처의 중요성:**
    *   수작업 피처(fHoG + Color-naming)만으로도 임베디드 시스템에서 고속 및 우수한 정확도를 달성할 수 있음을 보여줍니다. 특히 Color-naming 피처는 넓은 탐색 영역에서 판별력을 높이는 데 기여합니다.
    *   딥 피처는 저대비 ROI와 같은 어려운 경우에 객체의 저수준 피처를 더 잘 표현함으로써 성능을 약 10% 향상시킵니다. 그러나 딥 피처 사용은 상당한 계산 비용을 수반하여(300+fps 대비 30-35fps), 초고속 시나리오에는 덜 적합할 수 있습니다.
*   **제한 및 향후 연구:** 본 연구는 코너 케이스 분석(알고리즘 실패 조건)이 아직 충분히 이루어지지 않았다는 한계가 있습니다. 향후에는 가려짐, 조명 변화, 급격한 카메라 움직임 등으로 인해 목표를 놓쳤을 때의 재초기화(re-initialization) 방법을 탐구할 계획입니다.

## 📌 TL;DR
*   **문제:** 고속 실행 및 오프라인 훈련이 필요 없는 실용적인 단일 객체 추적 알고리즘의 부재와 기존 KCF 기반 방식의 드리프트 및 스케일/변환 변화 대응 한계.
*   **제안 방법:** **EnKCF**는 세 가지 전문화된 KCF(R$_{S_t}$, R$_s$, R$_{L_t}$)를 교대로 배포하여 객체의 스케일 및 변환 변화에 효율적으로 대응하고 속도를 유지합니다. KCF 전환 시 발생할 수 있는 드리프트를 줄이기 위해 파티클 필터를 통합했습니다.
*   **주요 결과:** EnKCF는 OTB100에서 340fps, UAV123에서 416fps의 초고속을 달성하면서도, 다른 고속 추적기보다 평균적으로 20 픽셀 정밀도에서 5%p, AUC 성공률에서 10-20%p 더 우수한 성능을 보였습니다. 딥 피처 사용 시 성능이 약 10% 향상되지만, 속도는 저하됩니다.