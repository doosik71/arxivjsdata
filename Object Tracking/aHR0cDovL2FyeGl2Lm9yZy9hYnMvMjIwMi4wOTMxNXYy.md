# Dynamical Variational Autoencoder를 이용한 비지도 다중 객체 추적
Xiaoyu Lin, Laurent Girin, Xavier Alameda-Pineda

## 🧩 Problem to Solve
다중 객체 추적(MOT)은 입력 시계열에서 알 수 없는 수의 소스 궤적을 복구하는 핵심 패턴 인식 작업입니다. 이 작업에는 객체 관측치 추출, 객체 움직임의 역학 모델링, 시간에 걸친 관측치-객체 연관성 부여, 그리고 궤적의 생성 및 소멸 처리라는 네 가지 주요 과제가 있습니다.

기존의 선형 동적 모델(예: 칼만 필터)은 샘플링 속도가 낮거나, 카메라 움직임이 있거나, 객체 속도가 빠르거나, 방향 전환이 급격하거나, 가려짐이 있는 복잡한 시나리오에서는 한계가 있어 오탐(false negatives) 및 ID 전환(identity switches)과 같은 추적 오류를 야기합니다. 순환 신경망(RNN)을 사용하는 정교한 비선형 모델이 제안되었으나, 이를 훈련하기 위해서는 많은 양의 주석이 달린 데이터가 필요하며, 이러한 데이터는 얻기 어렵고 많은 자원을 소모합니다.

이 논문은 특히 (ii) 객체 움직임의 역학 모델링과 (iii) 관측치-객체 연관성 부여라는 두 가지 과제에 초점을 맞춰, 사람의 주석이 달린 다중 객체 훈련 데이터 없이도 복잡한 객체 움직임과 데이터 연관성을 다룰 수 있는 **비지도 확률적 MOT 모델**을 개발하는 것을 목표로 합니다.

## ✨ Key Contributions
*   **DVAE-UMOT 모델 제안**: 동적 변이형 오토인코더(DVAE)를 기반으로 하는 새로운 비지도 확률적 다중 객체 추적(MOT) 모델인 DVAE-UMOT를 제안합니다.
*   **비지도 학습**: 인간의 주석이 달린 실제 데이터 없이 모델을 훈련합니다. DVAE는 레이블이 없는 합성 단일 객체 궤적 데이터셋으로 사전 훈련되며, 전체 DVAE-UMOT 모델은 추적할 각 다중 객체 시퀀스에서 변이형 추론(VI) 원리를 사용하여 추정됩니다.
*   **복잡한 동적 모델링**: 기존의 선형 동적 모델로는 처리하기 어려운 복잡하고 비선형적인 객체 움직임 패턴을 DVAE를 통해 효과적으로 모델링합니다.
*   **강력한 데이터 연관성**: 관측치-객체 할당 잠재 변수를 DVAE와 결합하여 데이터 연관성 문제를 해결하고, 탐지 노이즈를 걸러내어 부드러운 궤적을 형성합니다.
*   **경쟁력 있는 성능**: MOT17에서 파생된 데이터셋에 대한 실험에서, DVAE-UMOT는 두 가지 최신 확률적 MOT 모델(하나는 MOT17 주석으로 훈련됨)과 비교하여 경쟁력 있는 성능을 보이거나 심지어 능가합니다. 특히 장기 추적(300프레임)에서 우수한 성능을 나타냅니다.
*   **코드 및 데이터 공개**: 연구의 재현성을 위해 코드와 데이터가 공개적으로 제공됩니다.

## 📎 Related Works
*   **MOT의 모션 모델**:
    *   **Tracking-by-detection**: 시각적 특징을 이용한 접근법 [4, 26-30]이 있지만, 유사한 외관이나 가려짐에 취약합니다.
    *   **칼만 필터 기반**: 선형 동적 모델(일정 속도 가정)을 사용하여 모션 정보를 활용 [4, 10, 12, 14, 31]. 인접 프레임 간의 시간적 의존성만 고려하여 장기적인 가려짐에 비효율적입니다.
    *   **RNN 기반 비선형 모델**: 객체 모션 예측, 트랙릿 스티칭 등을 위해 RNN을 활용 [9, 15, 16, 17, 18, 19, 20, 21]. 긴 시퀀스에 대한 결정론적 RNN의 한계가 있습니다.
    *   **확률론적 자기회귀 네트워크**: 장기적인 시간적 의존성을 추출하고 다중 객체 궤적에 대한 확률적 생성 모델을 학습 [11, 32]. 그러나 MOT 알고리즘과 원칙적인 방식으로 결합되지 않았습니다.
*   **비지도 MOT**:
    *   **트랙릿 기반**: 공간-시간적 일관성을 이용해 객체를 짧은 트랙릿으로 그룹화한 다음, 시각적 유사성을 기반으로 장기 일관성 있는 트랙을 형성 [33, 34].
    *   **기하학적 렌더링 및 시각적 재구성**: 추적된 객체를 비디오 프레임으로 렌더링하여 재구성된 프레임을 비교하는 방식 [35, 36].
*   **DVAE 모델**:
    *   **VAE (Variational Autoencoder)** [23, 24]: 고차원 데이터를 생성하는 저차원 잠재 공간을 학습하는 강력한 심층 확률적 생성 모델.
    *   **DVAE (Dynamical Variational Autoencoder)** [22]: VAE를 시간 상관 데이터 시퀀스 모델링으로 확장. RNN 또는 상태 공간 모델(SSM)과 VAE 구조를 결합합니다. SRNN(Stochastic Recurrent Neural Network) 모델 [47]이 복잡성과 모델링 능력 사이의 좋은 균형을 보여 채택되었습니다. 본 논문은 MOT 작업에 DVAE가 사용된 첫 사례입니다.

## 🛠️ Methodology
DVAE-UMOT는 잠재 변수 생성 모델(LVGM)과 변이형 추론(VI) 방법론을 기반으로 합니다.
1.  **문제 정의 및 변수**:
    *   $N$개의 추적 객체. 각 객체 $n$의 시간 $t$에서의 실제 위치 벡터 $s_{tn} \in \mathbb{R}^4$ (바운딩 박스 좌표).
    *   시간 $t$에서의 $K_t$개 감지된 바운딩 박스 $o_{tk} \in \mathbb{R}^4$.
    *   각 객체 $n$의 잠재 변수 $z_{tn} \in \mathbb{R}^L$ ($L=4$).
    *   관측치-객체 할당 변수 $w_{tk} \in \{1,...,N\}$.

2.  **전반적인 원리**:
    *   모든 변수 ($o, s, z, w$)의 매개변수화된 결합 분포 $p_\theta(o,s,z,w)$를 정의합니다.
    *   VI를 사용하여 매개변수 $\theta$와 근사 사후 분포 $q_\phi(s,z,w|o)$를 추정합니다.
    *   이는 각 다중 객체 테스트 시퀀스에서 직접적으로 수행되며, 레이블이 지정된 다중 객체 훈련 데이터셋을 통한 사전 지도 학습이 필요 없습니다. (DVAE 모델의 사전 훈련은 예외)

3.  **생성 모델 $p_\theta(o,w,s,z)$**:
    *   $p_\theta(o,w,s,z) = p_\theta^o(o|w,s)p_\theta^w(w)p_\theta^{sz}(s,z)$로 분해됩니다.
    *   **관측 모델 $p_\theta^o(o|w,s)$**: $\prod_{t=1}^T \prod_{k=1}^{K_t} p_\theta^o(o_{tk}|w_{tk}, s_{t,:})$로 팩터링되며, $p_\theta^o(o_{tk}|w_{tk}=n,s_{tn}) = \mathcal{N}(o_{tk}; s_{tn}, \Phi_{tk})$ (가우시안 분포)로 모델링됩니다. $\Phi_{tk}$는 관측 노이즈 공분산 행렬입니다.
    *   **할당 모델 $p_\theta^w(w)$**: $\prod_{t=1}^T \prod_{k=1}^{K_t} p_\theta^w(w_{tk})$로 팩터링되며, $p_\theta^w(w_{tk}) = \frac{1}{N}$ (균일 사전 분포)으로 가정됩니다.
    *   **동적 모델 $p_\theta^{sz}(s,z)$**: DVAE(본 논문에서는 SRNN 모델)로 모델링됩니다. 추적되는 객체들은 서로 독립적이라고 가정합니다: $\prod_{n=1}^N p_\theta^{sz}(s_{:,n}, z_{:,n})$.
        *   SRNN 생성 모델: $p_\theta^{sz}(s_{1:T},z_{1:T}) = \prod_{t=1}^T p_\theta^s(s_t|s_{1:t-1},z_t)p_\theta^z(z_t|s_{1:t-1},z_{t-1})$.

4.  **추론 모델 $q_\phi(s,z,w|o)$**:
    *   $q_\phi(s,z,w|o) = q_\phi^w(w|o)q_\phi^z(z|s)q_\phi^s(s|o)$로 근사적으로 팩터링됩니다.
    *   $q_\phi^z(z|s)$ (DVAE 추론 모델)도 각 객체에 대해 독립적이라고 가정합니다: $\prod_{n=1}^N q_\phi^z(z_{:,n}|s_{:,n})$.
        *   SRNN 추론 모델 (인과적): $q_\phi^z(z_{1:T}|s_{1:T}) = \prod_{t=1}^T q_\phi^z(z_t|s_{1:t},z_{t-1})$.

5.  **DVAE-UMOT 알고리즘 (EM-유사 반복)**:
    *   **E-S Step** (사후 분포 $q_\phi^s(s|o)$ 계산): $q_\phi^s(s_{tn}|s^{(i)}_{1:t-1,n},z^{(i)}_{1:t,n},o) = \mathcal{N}(s_{tn};m_{tn},V_{tn})$ 형태의 가우시안 분포로 근사됩니다. 여기서 $m_{tn}$은 관측치 $o_{tk}$와 DVAE 예측 $\mu_{\theta_s,tn}^{(i)}$의 가중 평균이며, 할당 확률 $\eta_{tkn}$과 공분산 $\Phi_{tk}, v_{\theta_s,tn}^{(i)}$에 따라 균형이 조절됩니다.
    *   **E-Z Step** (DVAE 매개변수 $\theta_s, \theta_z, \phi_z$ 업데이트): 사전 훈련된 DVAE 모델을 파인튜닝합니다. ELBO 항의 몬테카를로 추정치를 SGD로 최적화합니다.
    *   **E-W Step** (사후 분포 $q_\phi^w(w|o)$ 계산): 할당 변수 $w_{tk}$의 확률 $\eta_{tkn} = q_\phi^w(w_{tk}=n|o)$는 닫힌 형태(closed form)로 계산됩니다.
    *   **M Step** (관측 모델 공분산 행렬 $\Phi_{tk}$ 추정): ELBO를 최대화하는 $\Phi_{tk}$를 계산합니다. 실제 구현에서는 수렴 안정화를 위해 $\Phi_{tk}$를 특정 고정 값으로 설정합니다.

6.  **세부 구현**:
    *   **DVAE 사전 훈련**: MOT17 훈련 데이터셋의 감지에서 추정된 매개변수를 사용하여 합성 단일 객체 바운딩 박스 궤적 데이터셋을 생성하고 SRNN 모델을 훈련합니다.
    *   **초기화**: 긴 시퀀스는 서브 시퀀스로 분할하고, 초기 $m_{tn}$ 값은 서브 시퀀스 시작 프레임의 탐지된 바운딩 박스를 기준으로 연쇄적으로 초기화됩니다. $\Phi_{tk}$는 초기 바운딩 박스 크기의 제곱에 비례하는 고정 값 $r_\Phi^2$으로 설정됩니다.
    *   **샘플링 순서**: $z$ 변수를 샘플링한 다음, $s$ 변수를 샘플링하는 순서로 각 객체와 시간 프레임에 대해 순차적으로 샘플링을 수행합니다.

## 📊 Results
DVAE-UMOT는 MOT17 훈련 세트에서 파생된 MOT17-3T 데이터셋(길이 $T=60, 120, 300$ 프레임의 세 가지 다른 서브셋)에서 평가되었으며, ArTIST [11] 및 VKF [31]와 비교되었습니다.

*   **주요 성능 지표 (MOTA)**:
    *   **DVAE-UMOT는 모든 세 가지 시퀀스 길이($T=60, 120, 300$ 프레임)에서 가장 높은 MOTA 점수를 달성했습니다.** 이는 MOT17 훈련 데이터셋으로 훈련된 ArTIST와 비교했을 때, DVAE-UMOT가 비지도 방식임에도 불구하고 우수한 성능을 보였다는 점에서 주목할 만합니다.
    *   특히, 300프레임의 긴 시퀀스에서 DVAE-UMOT는 8개 지표 중 6개에서 ArTIST보다 우수하며, FP 및 FN에서도 더 나은 결과를 보여 장기 추적에 강점을 보였습니다.

*   **ID 보존 및 정밀도 (IDF1, IDS)**:
    *   DVAE-UMOT와 VKF는 ArTIST보다 훨씬 낮은 IDS(ID 전환)와 훨씬 높은 IDF1 점수를 보였습니다. 이는 VI 기반 할당 방식이 추적 중 정확한 객체 ID를 유지하는 데 더 효율적임을 시사합니다.
    *   DVAE-UMOT는 VKF보다 이 두 지표에서 더 나은 점수를 보였으며, 이는 DVAE 기반 동적 모델이 선형 동적 모델보다 ID 보존 성능이 우수함을 의미합니다.
    *   MOTP(정밀도) 점수는 세 알고리즘 모두 유사했습니다.

*   **오류 유형 (FP, FN)**:
    *   짧거나 중간 길이의 시퀀스에서는 ArTIST가 낮은 FP 및 FN 비율을 보였지만, DVAE-UMOT의 더 나은 ID 보존 능력으로 인해 전반적인 MOTA 점수가 더 높았습니다.

*   **DVAE 모델의 우월성**:
    *   DVAE-UMOT는 모든 데이터셋에서 VKF보다 전반적으로 훨씬 더 나은 성능을 보였습니다. 이는 DVAE 모델을 사용한 객체 동역학 모델링이 단순한 선형-가우시안 동적 모델보다 우수하며 추적 성능을 크게 향상시킬 수 있음을 명확하게 보여줍니다.
    *   VKF가 300프레임 시퀀스에서 더 나은 성능을 보인 것은, 해당 시퀀스에서 객체의 평균 속도가 짧거나 중간 시퀀스보다 낮아 선형 동적 모델이 비교적 잘 작동했기 때문으로 분석됩니다.

*   **정성적 분석 (예시)**:
    *   **장기 탐지 부재**: ArTIST는 즉각적인 ID 전환을 보이며 불안정한 궤적을 생성했습니다. VKF는 객체들이 겹쳐 하나의 객체로 할당되는 경향을 보였습니다. DVAE-UMOT는 장기 탐지 부재에도 불구하고 합리적인 바운딩 박스를 생성하며 일관된 추적을 유지했습니다.
    *   **객체 교차**: ArTIST는 잦은 ID 전환과 부정확한 바운딩 박스 추정을 보였습니다. VKF는 객체들이 가까이 있을 때 동일한 대상으로 할당하는 문제를 보였습니다. DVAE-UMOT는 겹치는 구간에서도 일관된 추적을 유지하고 ID 전환 없이 객체 교차를 올바르게 포착했습니다.

*   **절삭 연구 (Ablation Study) - $r_\Phi$의 영향**:
    *   관측 공분산 행렬 비율 $r_\Phi$ 값은 MOTA 점수에 큰 영향을 미칩니다. $r_\Phi$가 $0.04$ 또는 $0.05$일 때 최적의 성능을 보였으며, 이는 사용된 SDP 탐지기의 평균 오류 비율(0.047~0.053)과 일치합니다.
    *   $r_\Phi$ 값이 너무 높으면 모델의 수렴이 불안정해지고 성능이 저하되는 경향을 보였습니다.

*   **절삭 연구 - SRNN 파인튜닝의 영향**:
    *   **SRNN을 파인튜닝하지 않는 것이 전반적인 MOTA 성능에서 더 나은 결과를 보였습니다.**
    *   파인튜닝은 MOTP를 증가시키고 IDS를 감소시킬 수 있지만, FP와 FN 수를 증가시켜 전반적인 MOTA 점수를 낮췄습니다.
    *   이는 파인튜닝이 모델을 탐지 노이즈에 더 민감하게 만들 수 있기 때문으로 추정됩니다.

## 🧠 Insights & Discussion
*   **DVAE의 강력한 동역학 모델링 능력**: DVAE-UMOT는 선형 동적 모델(VKF)과 비교하여 객체의 복잡하고 비선형적인 움직임을 더 정확하게 모델링할 수 있음을 입증했습니다. 이는 장기 추적 성능 향상 및 ID 전환 감소에 결정적인 역할을 합니다.
*   **비지도 학습의 효과**: DVAE-UMOT는 MOT17 훈련 데이터셋으로 훈련된 지도 학습 모델인 ArTIST보다 여러 핵심 지표에서 더 나은 성능을 달성했으며, 특히 장기 시퀀스에서 두각을 나타냈습니다. 이는 주석이 달린 데이터 없이도 MOT 작업을 효과적으로 수행할 수 있는 비지도 모델의 큰 잠재력을 보여줍니다.
*   **변이형 추론 프레임워크의 유연성**: VI 방법론은 객체 위치 추정 및 관측치-객체 할당을 통합하는 데 효과적이며, 특히 탐지 누락이나 잦은 가려짐 상황에서도 견고한 추적 성능을 유지하는 데 기여했습니다.
*   **모델의 한계 및 향후 연구**:
    *   현재 모델은 객체 간 상호작용을 고려하지 않습니다. 이는 향후 연구에서 확장될 수 있습니다.
    *   객체 외관 정보는 활용되지 않았습니다. 동적 정보와 함께 외관 정보를 통합하면 추적 성능이 더욱 향상될 수 있습니다.
    *   궤적의 생성/소멸(birth/death) 프로세스를 모델링하지 않았습니다. 완전한 MOT 시스템 설계를 위해서는 이 두 가지 측면을 고려해야 합니다.
*   **하이퍼파라미터의 중요성**: 관측 공분산 행렬 비율 $r_\Phi$와 같은 하이퍼파라미터는 모델의 성능과 수렴에 중요한 영향을 미치므로, 적절한 값 설정이 필요합니다. 탐지기 성능에 맞게 $r_\Phi$를 조정하는 것이 중요함을 실험을 통해 보여주었습니다.
*   **파인튜닝 전략**: DVAE 모델을 DVAE-UMOT 내에서 파인튜닝하는 것이 항상 성능 향상으로 이어지지 않았습니다. 오히려 파인튜닝하지 않는 것이 전반적인 MOTA 점수에서 더 나은 결과를 보였는데, 이는 파인튜닝이 탐지 노이즈에 대한 모델의 민감도를 증가시킬 수 있음을 시사합니다.

## 📌 TL;DR
*   **문제**: 복잡한 객체 움직임과 데이터 연관성을 다루면서 주석 데이터 없이 다중 객체를 추적하는 비지도 방법이 필요합니다.
*   **제안 방법**: DVAE-UMOT는 동적 변이형 오토인코더(DVAE)를 활용한 비지도 확률적 MOT 모델입니다. DVAE는 합성 단일 객체 궤적 데이터로 사전 훈련되어 비선형 객체 동역학을 모델링하고, 전체 모델은 변이형 추론(VI)을 통해 각 테스트 다중 객체 시퀀스에서 객체 위치 및 할당을 추정합니다.
*   **핵심 결과**: DVAE-UMOT는 지도 학습 기반의 최신 MOT 모델(ArTIST)과 비교하여 MOTA 점수에서 우위를 점하며, 특히 장기 추적에서 뛰어난 성능을 보였습니다. 또한 단순 선형 모델(VKF)보다 훨씬 나은 동역학 모델링과 ID 보존 능력을 입증하며, 탐지 누락 및 가려짐 상황에서도 견고한 추적을 제공합니다.