# High-Speed Tracking with Kernelized Correlation Filters

João F. Henriques, Rui Caseiro, Pedro Martins, and Jorge Batista

## 🧩 Problem to Solve

최신 비주얼 추적기의 핵심 요소는 대상과 주변 환경을 구별하는 판별 분류기입니다. 이러한 분류기는 일반적으로 변환되거나 스케일링된 샘플 패치를 사용하여 학습됩니다. 그러나 이러한 샘플 패치 세트에는 중복성이 많고, 실시간 추적의 시간 제약으로 인해 수많은 음성(negative) 샘플을 모두 활용하기 어렵습니다. 기존의 추적기들은 음성 샘플링을 불충분하게 하거나, 높은 계산 비용을 감수하며 샘플을 명시적으로 반복하거나 검색해야 하는 문제를 안고 있습니다. 이 논문은 이러한 제한을 극복하고 수천 개의 변환된 샘플을 명시적인 반복 없이 효율적으로 통합할 수 있는 분석적 도구를 개발하는 것을 목표로 합니다.

## ✨ Key Contributions

- 수천 개의 변환된 패치 데이터셋에 대한 분석적 모델을 제안했으며, 그 결과 데이터 행렬이 순환(circulant)임을 보였습니다.
- 순환 행렬을 이산 푸리에 변환(DFT)으로 대각화할 수 있음을 입증하여, 저장 공간과 계산량을 $O(N^3)$에서 $O(N \log N)$으로 획기적으로 줄였습니다.
- 선형 회귀의 경우, 이 공식화가 기존의 빠르고 경쟁력 있는 추적기에서 사용되는 상관 필터(correlation filter)와 동일함을 보였습니다.
- 커널 회귀를 위해 새로운 **Kernelized Correlation Filter (KCF)**를 도출했습니다. 이는 다른 커널 알고리즘과 달리 선형 필터와 정확히 동일한 복잡성을 가집니다.
- 선형 커널을 통해 선형 상관 필터의 빠른 다중 채널 확장인 **Dual Correlation Filter (DCF)**를 제안했습니다.
- KCF와 DCF는 50개의 비디오 벤치마크에서 Struck 또는 TLD와 같은 최고 성능 추적기들을 능가하며, 수백 FPS로 실행되고 코드 몇 줄(Algorithm 1)로 구현될 수 있음을 입증했습니다.
- 추가 개발을 장려하기 위해 추적 프레임워크를 오픈 소스로 공개했습니다.

## 📎 Related Works

- **탐지 기반 추적 (Tracking-by-detection)**: Support Vector Machines (SVM) [12], Random Forests [6], 부스팅(boosting) 변형 [13, 5], 압축 추적(Compressive Tracking) [3], 구조화된 출력 SVM (Structured Output SVM) [7] 등이 있습니다.
- **샘플 변환 및 상관 필터링**: 불필요한 이미지 패치를 걸러내기 위한 노력으로, 분기 한정(branch-and-bound) [16]이나 빠르고 부정확한 분류기를 이용한 유망 패치 선택 [18, 19] 등이 있습니다. 훈련 측면에서는 구조적 제약 [4]이나 하드-네거티브 마이닝(hard-negative mining) [20]이 사용됩니다. 상관 필터는 MOSSE [9, 10] 등이 있으며, 푸리에 도메인에서 효율적인 연산이 가능합니다.
- **커널 메서드와 상관 필터**: 커널 메서드를 상관 필터에 적용하려는 시도 [24, 25, 26, 27]가 있었으나, 대부분 계산 비용이 높거나 이미지 변환을 고려하는 필터에 적용하기 어려웠습니다. Kernel SDF 필터 [26, 27, 25]는 제안되었지만, 변환된 이미지 간의 관계가 명확하지 않았습니다.
- **후속 연구**: 이 논문의 초기 버전 [29] 이후, 제안된 순환 이동 모델의 시간 도메인 변형 [30] 및 다중 채널 선형 상관 필터 [31, 32, 33] 등이 발표되었습니다. 이들 중 다수는 오프라인 훈련에 적합한 더 느린 솔버를 사용합니다.

## 🛠️ Methodology

1. **순환 이동 데이터 모델링**: 관심 객체를 포함하는 베이스 샘플 $x$에 대해, 모든 가능한 1D 순환 이동 $P^u x$($u=0, \dots, n-1$)을 훈련 샘플로 사용합니다. 이 샘플들로 구성된 데이터 행렬 $X$는 순환 행렬 $C(x)$가 됩니다.
2. **이산 푸리에 변환(DFT)을 통한 대각화**: 모든 순환 행렬은 DFT 행렬 $F$에 의해 대각화된다는 특성 $X = F \text{diag}(\hat{x}) F^H$를 활용합니다. 이를 통해 복잡한 행렬 연산을 푸리에 도메인에서의 원소별(element-wise) 연산으로 변환합니다.
3. **선형 릿지 회귀 (MOSSE와의 관계)**: 릿지 회귀의 해 $w=(X^H X + \lambda I)^{-1} X^H y$에 순환 행렬의 대각화 특성을 적용하면, 푸리에 도메인에서 $\hat{w} = \frac{\hat{x}^* \odot \hat{y}}{\hat{x}^* \odot \hat{x} + \lambda}$와 같은 형태로 표현됩니다. 이는 정규화된 상관 필터이며, MOSSE 필터와 동일한 형태를 가집니다.
4. **커널 릿지 회귀 (KCF)**:
   - **순환 커널 행렬 조건**: 커널 함수 $\kappa(x, x')$가 임의의 순열 행렬 $M$에 대해 $\kappa(x, x') = \kappa(Mx, Mx')$를 만족하면 (예: 가우시안, 다항식, 닷-프로덕트 기반 커널), 해당 커널 행렬 $K$도 순환 행렬이 됨을 증명합니다.
   - **고속 해**: 커널 릿지 회귀의 해 $\alpha = (K + \lambda I)^{-1} y$를 DFT로 대각화하여 $\hat{\alpha} = \frac{\hat{y}}{\hat{k}_{xx} + \lambda}$를 얻습니다. 여기서 $k_{xx}$는 커널 자체 상관(kernel auto-correlation)입니다.
   - **고속 탐지**: 탐지 단계에서 회귀 함수 $f(z)$를 모든 후보 패치에 대해 평가하는 것 또한 푸리에 도메인에서 $\hat{f}(z) = \hat{k}_{xz} \odot \hat{\alpha}$로 효율적으로 수행합니다.
5. **고속 커널 상관**: $O(N \log N)$ 복잡도로 커널 상관(예: $k_{xx}, k_{xz}$)을 계산하는 방법을 제안합니다. 닷-프로덕트 또는 RBF/가우시안 커널의 경우, 내적 항을 DFT/IDFT를 통해 효율적으로 계산합니다.
6. **다중 채널 확장 (DCF)**: 다중 채널(예: HOG 특징의 방향 빈)을 처리하기 위해 각 채널의 기여를 푸리에 도메인에서 합산합니다. 선형 커널을 사용할 경우 **Dual Correlation Filter (DCF)**를 얻습니다.
7. **추적 파이프라인**: 단순한 파이프라인을 사용합니다. 초기 프레임에서 대상 주변 패치로 모델을 훈련하고, 다음 프레임에서 이전 위치의 패치에 대해 탐지하여 최대 응답 위치로 대상을 업데이트합니다. 그 후 업데이트된 위치에서 새 모델을 훈련하고, 이전 프레임의 학습된 값과 선형 보간하여 추적기에 "기억"을 부여합니다. 코사인 윈도우와 가우시안 형태의 회귀 목표를 사용하여 순환 경계로 인한 아티팩트를 완화합니다.

## 📊 Results

- **전반적인 성능**: KCF(HOG 특징 사용)와 DCF(HOG 특징 사용)는 50개 비디오 벤치마크에서 Struck 및 TLD와 같은 기존 최고 성능 추적기를 큰 폭으로 능가했습니다. KCF(원시 픽셀)도 여전히 경쟁력 있는 성능을 보였습니다.
  - KCF (HOG): 평균 정밀도 (20px) 73.2%
  - DCF (HOG): 평균 정밀도 (20px) 72.8%
  - Struck: 65.6%, TLD: 60.8%
- **속도**: KCF와 DCF는 매우 높은 프레임 속도(FPS)를 달성했습니다.
  - KCF (HOG): 172 FPS
  - DCF (HOG): 292 FPS
  - Struck: 20 FPS, TLD: 28 FPS. MOSSE는 615 FPS지만 더 작은 영역을 추적합니다. HOG 특징 계산 오버헤드에도 불구하고 HOG 특징을 사용하는 것이 원시 픽셀보다 빠를 수 있는데, 이는 더 작은 DFT 크기 때문입니다.
- **속성별 성능**: KCF/DCF(HOG 특징)는 비강체 변형, 가려짐, 배경 복잡성 등 대부분의 도전 과제에서 가장 강건한 성능을 보였습니다. 특히 배경 복잡성에서는 수천 개의 음성 샘플을 효율적으로 포함하는 방식의 이점이 두드러졌습니다. 낮은 해상도에서는 Struck이 가장 뛰어났습니다.

## 🧠 Insights & Discussion

- **탁월한 효율성**: 이 연구의 핵심 통찰은 이미지 변환을 순환 이동으로 분석적으로 모델링함으로써 데이터 및 커널 행렬을 순환 행렬로 만들 수 있다는 것입니다. 이는 DFT를 통한 대각화를 가능하게 하여, 복잡한 행렬 연산을 푸리에 도메인에서의 단순한 원소별 연산으로 바꾸어 계산 복잡도를 획기적으로 줄입니다.
- **커널 메서드의 한계 극복**: 제안된 프레임워크는 "커널 트릭"을 적용할 때 발생하는 일반적인 복잡성 증가 문제를 해결하여, 커널 기반 알고리즘이 선형 상관 필터와 동일한 높은 속도를 달성하게 합니다.
- **음성 샘플의 효율적 통합**: 수천 개의 음성 샘플(모든 순환 이동)을 명시적인 반복 없이 암묵적으로 포함함으로써, 배경 복잡성과 같은 어려운 상황에서도 탁월한 성능을 보입니다. 이는 음성 샘플을 불충분하게 다루거나 비싼 하드-네거티브 마이닝에 의존하는 기존 방법과 대조됩니다.
- **다중 채널 vs. 다중 베이스 샘플의 트레이드오프**: 가장 빠른 원소별 연산을 위해서는 다중 채널(DCF) 또는 다중 베이스 샘플(MOSSE와 유사) 중 하나를 선택할 수 있지만, 둘 다 동시에는 어렵습니다. 이는 둘 다 선택할 경우 블록 대각화가 되어 더 비싼 솔버가 필요하기 때문입니다.
- **한계 및 미래 연구**: 순환 경계 가정으로 인한 왜곡은 코사인 윈도우 등으로 완화되지만, 여전히 미래 연구 방향으로 고려될 수 있습니다. 현재 프레임워크는 스케일 변화나 추적 실패 복구 메커니즘이 부족하여, 특히 대상이 시야를 벗어나는 경우 성능에 영향을 미칠 수 있습니다. 향후 연구로는 주기적인 경계 가정을 완화하거나, 아핀 변환 또는 비강체 변형과 같은 다른 연산자로 프레임워크를 일반화하는 방안이 있습니다.

## 📌 TL;DR

- **문제**: 실시간 객체 추적은 수많은 음성 샘플을 효율적으로 처리해야 하지만, 기존 방법은 계산 비용 또는 샘플링 부족 문제를 겪습니다.
- **해결책**: 이 논문은 이미지 변환을 순환 행렬로 모델링하고, 이산 푸리에 변환(DFT)을 활용하여 행렬 연산을 $O(N \log N)$의 원소별 연산으로 변환하는 혁신적인 방법을 제안합니다. 이를 통해 커널 메서드의 복잡성 문제를 극복한 **Kernelized Correlation Filter (KCF)**와 다중 채널 선형 필터인 **Dual Correlation Filter (DCF)**를 개발했습니다.
- **주요 결과**: KCF와 DCF는 HOG 특징을 사용하여 기존 최고 성능 추적기들(Struck, TLD)을 능가하며, 수백 FPS의 속도로 실행되는 매우 효율적이고 정확한 추적 성능을 입증했습니다. 이는 수천 개의 음성 샘플을 암묵적으로 통합하는 방식 덕분입니다.
