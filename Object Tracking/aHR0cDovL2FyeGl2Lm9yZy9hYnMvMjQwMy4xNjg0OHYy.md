# Multiple Object Tracking as ID Prediction

Ruopeng Gao, Ji Qi, Limin Wang

## 🧩 Problem to Solve

이 논문은 다중 객체 추적(Multiple Object Tracking, MOT)의 객체 연관(object association) 문제에 내재된 한계를 해결하고자 합니다. 기존 MOT 방법들은 주로 객체 검출(object detection)과 연관(association)으로 작업을 분리하며, 연관 단계에서 칼만 필터(Kalman filter)나 Re-ID(re-identification) 모듈과 같은 섬세하게 수작업으로 제작된 휴리스틱(heuristic) 기법과 복잡한 규칙에 크게 의존합니다. 이러한 방식은 복잡한 시나리오(불규칙한 움직임, 유사한 외형, 잦은 가림 등)에서 적응성과 유연성이 떨어지고, 상당한 수동 튜닝을 필요로 한다는 비판을 받습니다.

또한, 최근 인기 있는 엔드-투-엔드(end-to-end) DETR(DEtection TRansformer) 기반 MOT 방법들도 검출과 추적을 단일 디코딩 프로세스 내에서 동시에 처리할 때 발생하는 충돌 문제로 인해 검출 또는 추적 성능이 저하될 수 있다는 문제점을 지적합니다. 이 논문은 이러한 한계를 극복하고, 휴리스틱 알고리즘 없이 모델의 잠재력을 최대한 발휘할 수 있는 엔드-투-엔드 학습 가능한 MOT 파이프라인을 제안하는 것을 목표로 합니다.

## ✨ Key Contributions

- **새로운 관점 제시:** 다중 객체 추적(MOT)을 "인-컨텍스트 ID 예측(in-context ID prediction)" 문제로 재정의하여 객체 연관(object association)을 엔드-투-엔드 학습 가능한 작업으로 전환했습니다. 이는 ID를 고정된 전역 레이블로 분류하는 대신, 과거 궤적의 ID 정보를 기반으로 현재 검출된 객체의 ID를 예측하는 방식입니다.
- **간단하면서도 효과적인 방법 제안:** MOTIP(Multi-Object Tracking as ID Prediction)라는 간단하고 직관적인 방법을 제안합니다. 이 방법은 특별히 맞춤화되거나 복잡한 네트워크 구조를 사용하지 않고도 표준 DETR 검출기와 트랜스포머 디코더를 활용하여 ID 예측을 수행합니다.
- **최첨단 성능 달성:** 객체 수준 특징(object-level features)만을 추적 단서로 활용했음에도 불구하고, DanceTrack, SportsMOT, BFT 등 여러 벤치마크에서 기존 최첨단(state-of-the-art, SOTA) 방법들을 능가하는 인상적인 성능을 달성했습니다.
- **일관된 엔드-투-엔드 파이프라인:** 훈련 및 추론 과정 모두에서 일관성을 유지하는 엔드-투-엔드 학습 가능 파이프라인을 구축하여 모델의 일반화 능력과 잠재력을 최대한 발휘할 수 있도록 합니다.
- **궤적 증강 기법 도입:** 훈련 과정에서 궤적 랜덤 가림($trajectory$ $random$ $occlusion$) 및 궤적 랜덤 스위치($trajectory$ $random$ $switch$)와 같은 새로운 궤적 증강 기법을 도입하여 모델의 일반화 및 견고성(robustness)을 향상시켰습니다.

## 📎 Related Works

- **Detection-by-Tracking 패러다임:**
  - 가장 널리 사용되는 다중 객체 추적 패러다임으로, 객체 검출 후 후처리 전략을 통해 검출 결과와 과거 궤적을 연결합니다.
  - 초기에는 칼만 필터($Kalman$ $filter$)[$[61]$]를 사용하여 궤적을 모델링하고 수동으로 설계된 매칭 알고리즘을 사용했습니다 (예: SORT [$[3]$], DeepSORT [$[62]$]).
  - 최근에는 Re-ID 모듈을 추가하여 외형 유사성을 활용하고 (예: FairMOT [$[74]$], ByteTrack [$[75]$], OC-SORT [$[5]$]) 더 복잡한 모델링 및 매칭 방식을 도입하거나 멀티모달 정보를 활용합니다.
  - MOTIP는 검출과 연관을 구조적으로 분리하지만, 휴리스틱 알고리즘 대신 학습 가능한 모델을 사용한다는 점에서 차이가 있습니다.
- **Tracking-by-Propagation 패러다임:**
  - 최근 인기 있는 엔드-투-엔드 MOT 패러다임으로, 쿼리 기반 검출 모델(예: DETR [$[6]$, $[81]$])에서 쿼리를 확장하여 추적에 사용합니다 (예: MOTR [$[73]$], TrackFormer [$[43]$], MeMOTR [$[17]$]).
  - 궤적 쿼리(track queries)를 비디오 시퀀스 전체에 전파하여 추적된 대상을 표현합니다.
  - 일부 연구($[67]$, $[71]$, $[76]$)는 동시 검출 및 추적 과정에서의 상충 문제를 지적하며 이를 완화하려 노력했습니다.
  - MOTIP도 쿼리 기반 검출 모델을 사용하지만, 객체 검출과 연관이 두 개의 분리된 모듈에서 순차적으로 수행되므로 이 패러다임에 속하지 않습니다.

## 🛠️ Methodology

MOTIP는 다중 객체 추적을 "인-컨텍스트 ID 예측" 문제로 재정의하며, 다음 세 가지 주요 구성 요소로 이루어져 있습니다.

1. **DETR 검출기 ($DETR$ $Detector$):**

   - 입력 이미지 $I_t$로부터 객체를 검출하고 객체 수준 특징($f_{n}^{t}$)을 추출하기 위해 Deformable DETR [$[81]$]을 사용합니다.
   - CNN 백본과 트랜스포머 인코더가 이미지 특징을 추출 및 강화하고, 트랜스포머 디코더는 학습 가능한 검출 쿼리(detect queries)로부터 출력 임베딩을 생성합니다. 이 임베딩은 바운딩 박스와 분류 신뢰도로 디코딩됩니다.
   - 이 접근 방식은 복잡한 특징 추출 기법 없이 디코딩된 출력 임베딩을 직접 대상 특징으로 사용할 수 있게 하여 방법을 단순화합니다.

2. **학습 가능한 ID 사전 ($Learnable$ $ID$ $Dictionary$):**

   - 모델의 미학습 궤적에 대한 일반화 능력을 위해, 궤적의 ID 정보를 나타내는 $K+1$개의 학습 가능한 단어($I = \{i_{1}, i_{2}, \dots, i_{K}, i_{spec}\}$ )로 구성된 ID 사전을 생성합니다.
   - $i_{1}, \dots, i_{K}$는 특정 ID를 나타내는 일반 토큰이며, $i_{spec}$은 새로 나타난 객체(newborn objects)를 위한 특수 토큰입니다. 각 단어 $i_k$는 $C$ 차원의 임베딩입니다.

3. **궤적 형성 ($Tracklet$ $Formation$):**

   - MOTIP는 객체 수준 특징만을 추적 단서로 사용합니다.
   - 과거 $T$ 프레임 동안의 $m$-번째 궤적($T_{m}^{t-T:t-1}$)에 대해, 해당 객체 특징($f_{m}^{t}$)과 무작위로 할당된 ID 단어($i_{k_m}$)를 결합하여 트랙릿(tracklet) 표현을 생성합니다. 간단하게 연결($\tau_{m, k_{m}}^{t} = concat(f_{m}^{t}, i_{k_{m}})$) 방식을 사용하며, $2C$ 차원의 표현을 만듭니다.
   - 현재 프레임의 객체에는 아직 궤적 ID가 없으므로, $i_{spec}$ 토큰을 사용하여 $\tau_{n}^{t} = concat(f_{n}^{t}, i_{spec})$와 같이 트랙릿을 구성합니다.

4. **ID 디코더 ($ID$ $Decoder$):**

   - 표준 트랜스포머 디코더 구조[$[59]$]를 ID 디코더로 사용하여 가변 길이의 입력을 처리합니다.
   - 이 구성 요소는 모든 과거 트랙릿 $\tau_{m, k_{m}}$을 Key와 Value로 사용하여 현재 프레임의 모든 활성 검출 트랙릿 $\tau_{n}^{t}$를 디코딩합니다.
   - 간단한 선형 분류 헤드를 사용하여 디코딩된 출력 임베딩에 대한 ID 레이블을 예측합니다. 만약 검출 $\tau_{n}^{t}$가 $m$-번째 궤적에 속한다면, 분류 헤드는 이를 $k_m$으로 예측해야 합니다.
   - 이를 통해 전체 객체 연관 프로세스는 분류 작업으로 공식화되며, 교차 엔트로피 손실($L_{id}$)로 직접 감독할 수 있습니다.

5. **훈련 ($Training$):**

   - 전체 MOTIP 모델은 DETR 손실($L_{cls}, L_{L1}, L_{giou}$)과 ID 손실($L_{id}$)을 포함하는 통합 손실 함수 $L = \lambda_{cls}L_{cls} + \lambda_{L1}L_{L1} + \lambda_{giou}L_{giou} + \lambda_{id}L_{id}$를 사용하여 엔드-투-엔드로 훈련됩니다.
   - **궤적 증강 ($Trajectory$ $Augmentation$):** 모델의 일반화 및 견고성 향상을 위해 두 가지 기법을 도입합니다.
     - **궤적 랜덤 가림($Trajectory$ $random$ $occlusion$):** 각 궤적에서 토큰을 $\lambda_{occ}$ 확률로 무작위로 삭제하여 가림 문제를 시뮬레이션합니다.
     - **궤적 랜덤 스위치($Trajectory$ $random$ $switch$):** 동일 프레임 내 두 궤적의 ID 토큰을 $\lambda_{sw}$ 확률로 무작위로 교환하여 잘못된 ID 할당 오류를 시뮬레이션합니다.
   - 계산 비용 절감을 위해 DETR의 기울기는 일부 프레임에서만 역전파하고, 나머지 프레임은 no-gradient 모드로 처리합니다. 이는 GPU 친화적인 병렬 훈련을 가능하게 합니다.

6. **추론 ($Inference$):**
   - DETR이 디코딩한 모든 출력 임베딩은 먼저 검출 신뢰도 임계값($\lambda_{det}$)을 사용하여 필터링됩니다.
   - 활성 검출된 객체들은 ID 디코더에 입력되어 각 ID 레이블의 확률을 예측합니다.
   - 각 객체에 대해 가장 높은 확률(> $\lambda_{id}$)을 가진 ID를 최종 결과로 선택합니다.
   - 유효한 ID가 할당되지 않았지만 검출 신뢰도가 $\lambda_{new}$보다 높은 객체는 새로운 목표물(newborn target)로 간주하여 새 ID를 할당합니다.
   - 동일 프레임 내에서 중복 ID가 예측될 경우, 가장 높은 신뢰도 점수를 가진 객체만 해당 ID를 유지하고 나머지는 새로운 목표물로 처리됩니다.

## 📊 Results

MOTIP는 다양한 도전적인 벤치마크(DanceTrack [$[58]$], SportsMOT [$[11]$], BFT [$[78]$])에서 최첨단 성능을 달성했습니다. 평가에는 주로 HOTA(Higher Order Tracking Accuracy) [$[37]$], DetA(Detection Accuracy), AssA(Association Accuracy), MOTA [$[2]$], IDF1 [$[50]$] 메트릭이 사용되었습니다.

- **DanceTrack:** 잦은 가림과 불규칙한 움직임이 특징인 이 데이터셋에서 MOTIP는 기존 최강자였던 CO-MOT [$[67]$]를 HOTA에서 $4.3$ 포인트, AssA에서 $6.9$ 포인트라는 상당한 차이로 능가하며 새로운 SOTA를 기록했습니다. 추가 데이터셋을 사용한 경쟁 방법들보다도 우수한 성능을 보였습니다.
- **SportsMOT:** 카메라 움직임이 잦고 선수들의 고속 움직임과 반복적인 상호작용이 특징인 스포츠 방송 데이터셋에서 MOTIP는 기존 모든 방법들을 상당한 차이로 능가했습니다. 특히 연관 정확도(AssA)에서 강점을 보였으며, 추가 훈련 데이터셋 없이도 강력한 성능을 입증했습니다.
- **BFT:** 조류 추적(3차원 활동 공간, 높은 역동성, 유사한 외형)이라는 기존과 다른 도전 과제에서 MOTIP는 $70.5$ HOTA와 $71.8$ AssA로 새로운 SOTA를 수립하여, 다양한 시나리오에서의 방법의 일반화 능력을 입증했습니다.
- **어블레이션 연구 ($Ablation$ $Studies$):**
  - **헝가리안 알고리즘 ($Hungarian$ $Algorithm$):** 헝가리안 알고리즘을 사용하지 않아도 MOTIP는 강력한 성능을 유지하며, 이는 모델이 내재적으로 최적의 솔루션을 찾는 능력을 갖추고 있음을 시사합니다.
  - **ID 디코더의 자기-어텐션 ($Self$-$Attention$ $in$ $ID$ $Decoder$):** 자기-어텐션 계층이 유사한 객체 간의 혼동을 방지하는 데 결정적인 역할을 하며, 이를 통해 전역 최적 솔루션을 찾는 모델의 능력이 향상됨을 확인했습니다.
  - **ReID 파이프라인과의 비교:** MOTIP는 동일한 객체 특징 하에서도 기존 ReID 기반 방법들($[74]$, $[46]$)보다 상당한 이점을 보였습니다. 이는 ID 정보의 통합 및 상호작용이 복잡한 시나리오에서 유사 궤적을 구별하는 모델의 능력을 향상시킴을 보여줍니다.
  - **궤적 증강 ($Trajectory$ $Augmentation$):** 궤적 랜덤 가림($\lambda_{occ}=0.5$) 및 궤적 랜덤 스위치($\lambda_{sw}=0.5$) 기법을 사용했을 때 추적 성능이 크게 향상되었습니다.

## 🧠 Insights & Discussion

- **단순함 속의 효율성:** MOTIP는 "적을수록 좋다(less is more)"는 철학을 따르며, 복잡하거나 맞춤화된 모델 설계 없이도 인-컨텍스트 ID 예측 접근 방식의 실현 가능성과 잠재력을 효과적으로 입증했습니다. 이는 기본 원리의 중요성을 강조합니다.
- **미래 연구의 가능성:** 이 방법은 추가적인 추적 단서(예: 움직임, 깊이) 통합, 더욱 정교한 궤적 모델링 기법, 맞춤형 ID 디코더 계층 등 향후 성능 향상 및 맞춤화를 위한 상당한 여지를 남겨둡니다.
- **ID 사전 용량의 유연성:** ID 사전의 용량 $K$는 현재 대부분의 시나리오에서 충분하지만, 매우 혼잡한 상황에서는 $K$를 늘려야 할 필요성이 있을 수 있습니다. 이는 DETR의 쿼리 수 설정과 유사하게 일반적인 시나리오에 최적화된 설정입니다.
- **데이터셋 선택 및 공동 훈련 재고:** MOT17과 같이 훈련 데이터가 제한적인 기존 데이터셋은 최신 엔드-투-엔드 모델을 훈련하기에 부적합할 수 있습니다. DanceTrack, SportsMOT, BFT와 같이 다양하고 대규모의 최신 데이터셋을 사용함으로써 모델의 잠재력을 최대한 발휘하고 일반화 능력을 검증할 수 있었습니다. 또한, CrowdHuman과 같은 이미지 검출 데이터셋을 MOT 훈련에 추가하는 것은 시나리오 특성 및 주석 표준의 불일치, 그리고 지나치게 단순한 비디오 시뮬레이션으로 인해 모델의 견고성과 일반화 능력을 저해할 수 있음을 논의합니다. 따라서 충분한 훈련 데이터가 있을 때는 추가 데이터를 피하는 것이 더 효과적일 수 있습니다.
- **높은 병렬 처리 능력:** 검출과 연관 구성 요소를 분리하고 ID 디코더에 어텐션 마스크를 활용함으로써 훈련 중 높은 GPU 병렬 처리 능력을 달성하여 효율적인 훈련이 가능합니다.

## 📌 TL;DR

이 논문은 다중 객체 추적(MOT)의 객체 연관 문제를 재개념화하여 "인-컨텍스트 ID 예측" 작업으로 정의합니다. 이를 기반으로 저자들은 표준 DETR 검출기와 간단한 트랜스포머 디코더를 활용하는 단순하지만 효과적인 MOTIP(Multi-Object Tracking as ID Prediction) 방법을 제안합니다. MOTIP는 과거 궤적의 ID 정보를 컨텍스트로 사용하여 현재 객체의 ID를 엔드-투-엔드로 예측하며, 궤적 증강 기법을 통해 모델의 견고성을 강화합니다. 그 결과, MOTIP는 DanceTrack, SportsMOT, BFT 등 주요 벤치마크에서 기존 최첨단 방법들을 뛰어넘는 성능을 달성하며, 복잡한 시나리오에서의 높은 일반화 능력을 입증했습니다. 이는 MOT 연구를 위한 강력한 새로운 기본 모델이자 유망한 미래 방향을 제시합니다.
