# 다변량 시계열 데이터에서 비지도 이상 감지 및 진단을 위한 심층 신경망

Chuxu Zhang, Dongjin Song, Yuncong Chen, Xinyang Feng, Cristian Lumezanu, Wei Cheng, Jingchao Ni, Bo Zong, Haifeng Chen, Nitesh V. Chawla

## 🧩 해결하려는 문제

현대 시스템에서는 다변량 시계열 데이터(예: 발전소, 웨어러블 기기)가 지속적으로 수집됩니다. 이러한 데이터에서 이상 감지 및 진단은 특정 시점의 비정상 상태를 식별하고 그 근본 원인을 찾아내는 것을 목표로 합니다. 하지만 이를 위한 시스템 구축은 다음과 같은 도전 과제들 때문에 어렵습니다:

- 개별 시계열 내의 **시간적 의존성**을 포착해야 합니다.
- 서로 다른 시계열 간의 **상호 상관관계**를 인코딩해야 합니다.
- **노이즈에 강인**해야 합니다.
- 다양한 사건의 심각도(지속 시간)에 따라 **다양한 수준의 이상 점수**를 제공해야 합니다.
- 대부분의 실제 시나리오에서 **이상 데이터에 대한 레이블이 없는 비지도 학습 환경**입니다.

기존의 비지도 이상 감지 알고리즘들은 이러한 복합적인 문제들을 동시에 해결하지 못합니다.

## ✨ 주요 기여

이 논문은 다변량 시계열 데이터의 이상 감지 및 진단이라는 복합적인 문제를 해결하기 위해 Multi-Scale Convolutional Recurrent Encoder-Decoder (MSCRED) 모델을 제안합니다. 주요 기여는 다음과 같습니다:

- **문제 재정의**: 이상 감지 및 진단 문제를 이상 감지, 근본 원인 식별, 이상 심각도(지속 시간) 해석이라는 세 가지 하위 과제로 통합하여 공동으로 해결합니다.
- **시스템 시그니처 행렬 도입**: 시스템 상태의 다중 스케일(해상도) 특징을 포착하는 "시스템 시그니처 행렬" 개념을 도입합니다.
- **MSCRED 모델 개발**:
  - 컨볼루션 인코더를 통해 **센서 간 상관관계** 패턴을 인코딩합니다.
  - 어텐션 기반의 ConvLSTM 네트워크를 통해 **시간적 패턴**을 포착합니다.
  - 컨볼루션 디코더를 통해 입력 시그니처 행렬을 재구성하여 이상을 감지하고 진단합니다.
- **최초의 통합 모델**: 다변량 시계열 간의 상관관계를 고려하고 위에서 언급한 세 가지 과제를 모두 해결하는 최초의 모델입니다.
- **우수한 성능 입증**: 합성 데이터셋 및 실제 발전소 데이터셋에 대한 광범위한 실험을 통해 MSCRED가 최첨단 기준 방법론들보다 우수한 성능을 보여줍니다.

## 📎 관련 연구

- **전통적인 방법**:
  - **거리/군집 방법 (Distance/Clustering methods)**: kNN, 클러스터링 모델, One-Class SVM 등이 있으나, 시계열의 시간적 의존성을 적절히 포착하지 못합니다.
  - **확률론적 방법 (Probabilistic methods)** 및 **밀도 추정 방법 (Density estimation methods)**: DAGMM(Deep Autoencoding Gaussian Mixture Model) 등이 있으나, 시계열의 시간적 의존성을 고려하지 못합니다.
  - **시간 예측 방법 (Temporal prediction approaches)**: ARMA(Autoregressive Moving Average), LSTM 인코더-디코더 등이 시간적 의존성을 모델링하지만, 노이즈에 민감하여 오탐지(false positive)가 증가할 수 있습니다.
- **심층 학습 기반 비지도 이상 감지**:
  - DAGMM, LSTM 인코더-디코더 등이 효과적이지만, 시간적 의존성, 노이즈 내성, 이상 심각도 해석을 동시에 고려하지 못합니다.
- **MSCRED 모델 설계에 영감을 준 기술**: 완전 컨볼루션 신경망(FCN), 컨볼루션 LSTM(ConvLSTM) 네트워크, 어텐션(Attention) 메커니즘.

## 🛠️ 방법론

MSCRED는 다음과 같은 주요 구성 요소와 단계를 따릅니다:

1. **문제 정의**: 길이가 $T$인 $n$개 시계열의 과거 데이터 $X = (x_1, \dots, x_n)^T \in \mathbb{R}^{n \times T}$ (정상 데이터만 포함)가 주어졌을 때, $T$ 이후 시점의 이상 이벤트를 감지하고, 이상 발생 시 이상을 유발할 가능성이 가장 높은 시계열(근본 원인)을 식별하며, 이상 심각도(지속 시간)를 질적으로 해석합니다.

2. **시그니처 행렬을 이용한 상태 특성화**:

   - $t-w$부터 $t$까지의 다변량 시계열 세그먼트 $X_w$에 대해 $n \times n$ 시그니처 행렬 $M_t$를 구성합니다.
   - $M_t$의 각 요소 $m_{ij}^t$는 두 시계열 $x_i^w$와 $x_j^w$ 간의 쌍별 내적(pairwise inner-product)으로 계산됩니다:
     $$m_{ij}^t = \frac{\sum_{\delta=0}^{w} x_i^{t-\delta} x_j^{t-\delta}}{\kappa}$$
     여기서 $\kappa = w$는 스케일링 인자입니다.
   - 이 시그니처 행렬은 시계열 간의 형태 유사성, 값 스케일 상관관계, 그리고 입력 노이즈에 대한 강인성을 포착합니다.
   - 시스템 상태를 다양한 스케일에서 특성화하기 위해 각 시점에서 **다중 스케일(해상도) 시그니처 행렬**을 생성합니다 (예: $s=3$ 스케일, 윈도우 길이 $w=10, 30, 60$).

3. **컨볼루션 인코더 (Convolutional Encoder)**:

   - 다양한 스케일의 시그니처 행렬 $M_t$를 텐서 $X_{t,0} \in \mathbb{R}^{n \times n \times s}$로 연결합니다.
   - 여러 컨볼루션 레이어(예: Conv1-Conv4)를 사용하여 시그니처 행렬의 **센서 간(공간적) 상관관계 패턴**을 인코딩합니다. 활성화 함수로는 SELU를 사용합니다.

4. **어텐션 기반 ConvLSTM (Attention based ConvLSTM)**:

   - 컨볼루션 인코더에서 생성된 공간 특징 맵 $X_{t,l}$은 시간적으로 이전 단계에 의존합니다.
   - ConvLSTM 네트워크를 사용하여 이러한 **시간적 패턴**을 포착합니다. ConvLSTM 셀은 표준 LSTM과 유사하지만, 게이트와 셀 상태 업데이트에 컨볼루션 연산을 사용합니다.
   - 시퀀스 길이가 증가함에 따른 성능 저하를 방지하기 위해 **시간적 어텐션 메커니즘**을 도입합니다. 이는 현재 상태와 관련된 이전 시점의 숨겨진 상태(특징 맵)를 적응적으로 선택하고 가중치를 부여하여 정제된 출력 $\hat{H}_{t,l}$을 형성합니다:
     $$\hat{H}_{t,l} = \sum_{i \in (t-h, t)} \alpha_i H_{i,l}, \quad \alpha_i = \frac{\exp\{ \text{Vec}(H_{t,l})^T \text{Vec}(H_{i,l}) / \chi \}}{\sum_{j \in (t-h, t)} \exp\{ \text{Vec}(H_{t,l})^T \text{Vec}(H_{j,l}) / \chi \}}$$
     여기서 $\text{Vec}(\cdot)$은 벡터화 연산, $\chi$는 리스케일링 인자이며, $h$는 이전 세그먼트의 수(예: 5)입니다.

5. **컨볼루션 디코더 (Convolutional Decoder)**:

   - 인코딩된 특징 맵을 재구성된 시그니처 행렬로 디코딩하기 위해 컨볼루션 디코더를 사용합니다.
   - 디코더는 역순으로 동작하는 디컨볼루션 레이어(DeConv4-DeConv1)로 구성됩니다.
   - 이전 ConvLSTM 레이어의 출력과 디컨볼루션 레이어의 출력 특징 맵을 연결하는 **스킵 커넥션(skip connection)**을 사용하여 재구성 품질을 향상시킵니다.
   - 최종 출력 $\hat{X}_{t,0} \in \mathbb{R}^{n \times n \times s}$은 재구성된 시그니처 행렬을 나타냅니다.

6. **손실 함수 (Loss Function)**:

   - MSCRED의 목적 함수는 시그니처 행렬에 대한 재구성 오류를 최소화하는 것입니다:
     $$L_{\text{MSCRED}} = \sum_t \sum_{c=1}^s \|X_{t,0}{:,:,c} - \hat{X}_{t,0}{:,:,c}\|_F^2$$
     여기서 $X_{t,0}{:,:,c}$는 입력 시그니처 행렬 텐서의 $c$번째 채널을 나타냅니다.
   - Adam optimizer와 미니배치 확률적 경사 하강법을 사용하여 손실을 최소화합니다.

7. **이상 감지 및 진단**: 학습된 모델을 사용하여 유효성 검사 및 테스트 데이터의 재구성된 시그니처 행렬을 추론합니다. 입력 시그니처 행렬과 재구성된 시그니처 행렬 간의 **잔차 시그니처 행렬(residual signature matrices)**을 기반으로 이상을 감지하고 진단합니다. 이상 점수는 재구성 성능이 좋지 않은 쌍별 상관관계의 수로 정의됩니다.

## 📊 결과

- **데이터셋**: 합성 데이터셋 및 실제 발전소 데이터셋을 사용했습니다.
- **기준 모델**: OC-SVM, DAGMM, HA, ARMA, LSTM-ED 및 MSCRED의 세 가지 변형 모델(ConvLSTM 레이어 수 및 어텐션 모듈 유무에 따른)과 비교했습니다.
- **평가 지표**: Precision, Recall, F1 Score를 사용했습니다.

주요 실험 결과는 다음과 같습니다:

- **이상 감지 (RQ1, RQ2)**:
  - MSCRED는 모든 기준 모델을 현저히 능가했습니다. 특히, 가장 성능이 좋은 기준 모델인 LSTM-ED 대비 F1 Score에서 13.3% ~ 30.0%의 개선을 보였습니다.
  - MSCRED는 ARMA나 LSTM-ED보다 더 안정적인 이상 점수를 제공하며, 오탐지 및 미탐지가 적었습니다.
  - ConvLSTM 레이어 수가 증가할수록 성능이 향상되었고, 어텐션 모듈을 추가했을 때 추가적인 성능 향상이 관찰되어 각 구성 요소의 효과를 입증했습니다.
  - 어텐션 모듈의 가중치 분포는 시스템 상태 변화에 높은 민감도를 보여, 이상 감지에 유용함을 시사했습니다.
- **근본 원인 식별 (RQ3)**:
  - MSCRED는 Recall@k (k=3) 측면에서 LSTM-ED보다 합성 데이터셋에서 25.9%, 발전소 데이터셋에서 32.4% 더 우수한 성능을 보였습니다.
- **이상 심각도(지속 시간) 해석 (RQ4)**:
  - MSCRED의 세 가지 채널(small, medium, large 스케일)은 서로 다른 지속 시간의 이상에 대해 다른 감지 능력을 보여주었습니다. MSCRED(S, $w=10$)는 모든 종류의 이상을 감지할 수 있었고, MSCRED(M, $w=30$)는 중간 및 긴 지속 시간의 이상을 감지했으며, MSCRED(L, $w=60$)는 긴 지속 시간의 이상만 감지했습니다.
  - 이러한 결과를 종합하여 이상 심각도를 해석할 수 있습니다.
- **노이즈에 대한 강인성 (RQ5)**:
  - 다양한 노이즈 요인($\lambda$)에 대한 실험에서 MSCRED는 ARMA 및 LSTM-ED보다 지속적으로 우수한 성능을 보였습니다. 이는 MSCRED가 입력 노이즈에 더 강인함을 의미합니다.

## 🧠 시사점 및 논의

- MSCRED는 다변량 시계열 데이터에서 이상 감지, 근본 원인 식별, 이상 심각도 해석이라는 세 가지 복합적인 과제를 효과적으로 통합하여 해결하는 혁신적인 접근 방식을 제시합니다.
- 다중 스케일 시그니처 행렬의 사용은 시스템 상태를 포괄적으로 특성화하고 다양한 지속 시간의 이상을 구별하는 데 필수적입니다.
- 컨볼루션 인코더를 통한 공간적 상관관계 모델링과 어텐션 기반 ConvLSTM을 통한 시간적 의존성 모델링의 조합은 복잡한 다변량 시계열 패턴을 성공적으로 학습합니다.
- 특히, 노이즈에 대한 강인성은 실제 환경 데이터에 MSCRED를 적용할 때 큰 장점입니다.
- 모델의 한계로는, 이상 점수를 결정하는 임계값 $\theta$가 경험적으로 결정된다는 점이 있으며, 향후 더 자동화된 임계값 설정 방법이 연구될 수 있습니다. 또한, 매우 고차원의 시계열에 대한 확장성 및 계산 효율성에 대한 추가 분석이 필요할 수 있습니다.

## 📌 요약 (TL;DR)

다변량 시계열에서 이상을 감지하고 그 원인 및 심각도를 진단하는 것은 시계열 간의 복잡한 시간적/공간적 상관관계, 노이즈, 레이블 부재 등 여러 도전 과제를 안고 있습니다. 이 논문은 이러한 문제들을 통합적으로 해결하기 위해 **MSCRED (Multi-Scale Convolutional Recurrent Encoder-Decoder)**를 제안합니다. MSCRED는 **다중 스케일 시그니처 행렬**을 생성하여 시스템 상태를 포괄적으로 표현하고, **컨볼루션 인코더**로 센서 간 상관관계를, **어텐션 기반 ConvLSTM**으로 시간적 패턴을 학습합니다. 최종적으로 **컨볼루션 디코더**를 통해 입력 행렬을 재구성하고, 재구성 오류를 이용해 이상을 감지하고 진단합니다. 실험 결과, MSCRED는 기존 최첨단 모델들보다 우수한 이상 감지 성능을 보였으며, 근본 원인 식별 및 이상 심각도 해석 능력을 제공하고, 노이즈에 대한 강인함도 입증했습니다.
