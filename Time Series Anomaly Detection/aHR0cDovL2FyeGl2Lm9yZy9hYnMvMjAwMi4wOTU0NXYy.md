# RobustTAD: Robust Time Series Anomaly Detection via Decomposition and Convolutional Neural Networks

Jingkun Gao, Xiaomin Song, Qingsong Wen, Pichao Wang, Liang Sun, Huan Xu

## 🧩 Problem to Solve

이 논문은 대규모 애플리케이션에서 시계열 이상 탐지의 효과적이고 확장 가능한 서비스를 구축하는 문제를 다룹니다. 주요 해결 과제는 다음과 같습니다:

- **복잡하고 다양한 시계열 패턴:** 시계열 데이터는 추세 변화, 계절성 이동 및 변동 등 복잡한 패턴을 포함하여 이상 탐지를 어렵게 만듭니다.
- **제한적인 레이블링 데이터:** 시계열 이상 탐지에서 수동 레이블링은 시간이 많이 걸리고 정의가 시나리오에 따라 다르기 때문에 레이블링된 데이터가 매우 부족합니다.
- **실시간 처리 요구사항:** 이상 탐지 시스템은 낮은 지연 시간으로 대량의 지표를 병렬 처리하여 실시간으로 이상을 감지해야 합니다.
- **딥러닝 모델의 한계:** RNN/LSTM은 긴 계절성을 다루기 어렵고, CNN은 시계열의 시간 의존성 및 복잡한 패턴을 효과적으로 인코딩하는 데 제한적인 적용을 보였습니다.
- **시계열 데이터 증강 연구 부족:** 딥러닝 모델 훈련에 필수적인 데이터 증강 기법이 시계열 데이터에는 충분히 연구되지 않았습니다.

## ✨ Key Contributions

이 논문의 핵심 기여는 다음과 같습니다:

- **강건한 시계열 분해와 컨볼루션 신경망 통합 프레임워크인 RobustTAD 제안:** 복잡한 시계열 패턴을 효과적으로 처리하고 신경망 아키텍처를 단순화합니다.
- **향상된 U-Net 기반 인코더-디코더 아키텍처:** 시계열에서 다중 스케일 정보를 효과적으로 캡처하기 위해 스킵 커넥션을 포함하는 U-Net 구조를 채택하고, 분해된 시계열 컴포넌트를 입력으로 사용하여 모델 성능을 향상시킵니다.
- **체계적인 시계열 데이터 증강 기법 개발:** 레이블링된 데이터의 한계를 극복하기 위해 시간 도메인(Flipping, Downsampling, Cropping, Label Expansion) 및 주파수 도메인(Magnitude Augmentation, Phase Augmentation)에서 분해된 컴포넌트에 대한 데이터 증강 방법을 제시합니다.
- **불균형 데이터 문제를 위한 가중치 조정 손실 함수:** 이상 탐지 문제의 본질적인 불균형(정상 데이터가 이상 데이터보다 훨씬 많음)을 해결하기 위해 레이블 기반 가중치($\beta$)와 값 기반 가중치($w_t$)를 손실 함수에 도입합니다.
- **공개 벤치마크 데이터셋에서 우수한 성능 입증:** 예측 기반, 분해 기반, 전통적인 통계 알고리즘 및 최신 신경망 기반 알고리즘과 비교하여 RobustTAD가 Yahoo 벤치마크 데이터셋에서 훨씬 뛰어난 성능을 보임을 증명합니다.
- **Alibaba 그룹의 온라인 서비스 배포:** 제안된 프레임워크가 Alibaba 그룹 내 다양한 비즈니스 시나리오에서 온라인 서비스로 배포되어 활용되고 있음을 강조합니다.

## 📎 Related Works

시계열 이상 탐지에 대한 선행 연구는 다음과 같이 분류됩니다:

- **예측 기반 방법:** ARIMA [4, 12], LSTM 기반 신경망 [20, 52] 등 예측 모델의 오류를 이상치로 간주합니다. 훈련 데이터 내 이상치에 취약하며 강건성(robustness)이 부족할 수 있습니다.
- **분해 기반 방법:** 시계열을 분해하여 잔차나 추세를 이상치 탐지에 활용합니다 [7, 17, 41, 43]. 계절성 및 추세 컴포넌트를 효과적으로 감지하고 제거하는 것이 중요합니다.
  - 이 논문에서는 저자들의 이전 연구인 **RobustPeriod [46]** (주기성 감지), **RobustSTL [45]** (주기적 시계열 분해), **RobustTrend [44]** (비주기적 시계열 추세 필터링)를 활용하여 기존 분해 방법들의 한계를 극복합니다.
- **기계 학습 기반 방법:** 트리 기반 모델 [14], 변분 오토인코더(VAE) [35, 48], 컴퓨터 비전의 salient detection 기법 [31] 등을 사용하여 이상치를 식별합니다.
- **탐지 단계:** 경험적 임계값 설정 [14, 20, 24, 31, 35, 48, 52] 또는 통계적 테스트 [1, 4, 7, 12, 17, 41, 49]를 사용한 비지도 방식과, 신경망을 직접 훈련시키는 지도 방식 [31, 47, 51]이 있습니다. 특히 딥러닝은 시계열 데이터의 복잡성 처리에서 제한적인 성공을 보였습니다 [47].

## 🛠️ Methodology

RobustTAD는 시계열 분해, 인코더-디코더 신경망, 가중치 조정 손실 함수, 데이터 증강 기법을 결합합니다.

### 1. 시계열 분해 (Decomposition)

- **분해 모델:** 시계열 $x_t$를 추세($\tau_t$), 계절성($s_t$), 잔차($r_t$)의 합으로 가정합니다: $x_t = \tau_t + s_t + r_t$.
- **주기성 감지:** RobustPeriod [46]를 사용하여 시계열의 주기성을 감지하고 길이를 추정합니다.
- **강건한 분해:**
  - **주기적 시계열:** RobustSTL [45]을 사용하여 추세, 계절성, 잔차를 분해합니다. RobustSTL은 노이즈 제거, 추세 추출(LAD 손실 및 $\ell_1$-norm 정규화), 계절성 추출(계절성 양측 필터링) 단계를 포함하여 abrupt change, seasonality shift, 이상치에 강건하게 대응합니다.
  - **비주기적 시계열:** RobustTrend [44] 필터를 사용하여 추세와 잔차 컴포넌트를 효율적으로 얻습니다.
- **신경망 입력:** 잔차 컴포넌트($r_t$)를 신경망의 입력으로 사용합니다.

### 2. 인코더-디코더 네트워크 (Encoder-Decoder Network)

- **아키텍처:** 시계열 이상 탐지를 dense prediction 문제로 간주하여, U-Net [33] 아키텍처와 유사한 인코더-디코더 구조에 스킵 커넥션을 포함하여 다중 스케일 특징을 추출합니다.
- **가중치 조정 손실 함수 (Weight Adjusted Loss):** 시계열 이상 탐지 문제의 데이터 불균형을 해결하기 위해 교차 엔트로피 손실 함수를 조정합니다.
  - **레이블 기반 가중치 ($\beta$):** 이상 샘플에 더 큰 가중치를 부여합니다 ($\beta > 1$).
  - **값 기반 가중치 ($w_t$):** 이웃과 크게 다른 값(이상치일 가능성이 높은)에 더 많은 가중치를 부여합니다. 이는 $\omega_t = \frac{1}{Z_t} \exp\left( \frac{\sum_{j=1}^{H} |x_t - x_{t-j}|^2}{2\sigma_{t,H}^2} \right)$와 같이 계산됩니다.
  - 최종 손실 함수는 다음과 같습니다:
    $$\text{WALoss}(\hat{y}, y) = -\sum_t w_t \left( \beta \cdot y_t \log(\hat{y}_t) + (1-y_t) \log(1-\hat{y}_t) \right)$$

### 3. 데이터 증강 (Data Augmentation)

레이블링 데이터 부족을 해결하기 위해 분해된 컴포넌트에 특화된 데이터 증강 기법을 사용합니다.

- **시간 도메인 (Time Domain):**
  - **Flipping:** 시계열 값의 부호를 반전합니다.
  - **Downsampling:** 시계열을 다운샘플링하여 길이를 줄입니다.
  - **Cropping:** 원본 시계열에서 일부분을 무작위로 추출합니다.
  - **Label Expansion:** 레이블링된 이상치에 가까운 데이터 포인트도 이상치로 간주하여 레이블을 확장합니다.
- **주파수 도메인 (Frequency Domain):**
  - **Magnitude Augmentation:** 주파수 스펙트럼의 특정 세그먼트에서 진폭 값을 가우시안 분포에서 샘플링한 값으로 교체하여 섭동을 가합니다.
  - **Phase Augmentation:** 특정 세그먼트에서 위상 값을 가우시안 분포에서 샘플링한 작은 섭동만큼 증가시킵니다.

### 4. 스트리밍 시계열을 위한 온라인 추론 (Online Inference for Streaming Time Series)

- RobustSTL 및 RobustTrend의 온라인 버전을 개발하여 스트리밍 데이터를 효율적으로 처리하며, "warm start" 기법을 통해 수렴 속도를 높입니다.
- 신경망의 온라인 추론은 매우 효율적이며(새로운 포인트당 10ms 미만), 온라인 분해를 포함해도 전체 추론은 약 100ms 내에 완료되어 실시간 처리에 적합합니다.

## 📊 Results

RobustTAD의 성능은 Yahoo 벤치마크 데이터셋(367개 시계열)에서 Precision, Recall, F1 Score 및 Relaxed F1 Score를 사용하여 평가되었습니다.

- **U-Net 기반 설정 비교:**
  - U-Net-Raw (원본 시계열): F1 Score 0.403.
  - U-Net-De (분해 + U-Net): F1 Score 0.621. (분해를 통해 0.22 증가)
  - U-Net-DeW (분해 + 가중치 조정 손실): F1 Score 0.662.
  - **RobustTAD (U-Net-DeWA, 분해 + 가중치 조정 손실 + 데이터 증강): F1 Score 0.693, Relaxed F1 Score 0.812.**
- **다른 SOTA 방법들과의 비교:**
  - ARIMA: F1 0.225.
  - SHESD: F1 0.494.
  - Donut: F1 0.029 (높은 Recall, 낮은 Precision).
- **결론:** RobustTAD (U-Net-DeWA)는 Yahoo 벤치마크 데이터셋에서 모든 비교 방법 및 U-Net 구성보다 월등히 우수한 성능을 달성했습니다. 특히 분해, 가중치 조정 손실, 데이터 증강이 성능 향상에 결정적인 역할을 했습니다. 시각화 결과에서도 RobustTAD는 복잡한 이상치 패턴을 정확히 식별하는 능력을 보여주었습니다.

## 🧠 Insights & Discussion

- **다중 스케일 특징 학습의 중요성:** 인코더-디코더 구조는 시계열의 "맥락"을 다양한 수준에서 효과적으로 파악하여 이상 탐지 성능을 높이는 데 기여합니다.
- **분해의 핵심 역할:** 시계열 분해는 신경망이 복잡한 계절성이나 추세에 직접적으로 대응할 필요 없이 잔차 내의 이상치에 집중할 수 있게 하여, 모델의 단순성과 일반화 성능을 동시에 향상시킵니다.
- **데이터 불균형 및 부족 문제 해결:** 가중치 조정 손실과 데이터 증강은 제한된 레이블링 데이터와 데이터 불균형이라는 실제 이상 탐지 문제의 주요 병목 현상을 효과적으로 완화합니다.
- **실제 적용 가능성:** RobustTAD는 높은 성능과 효율성을 통해 Alibaba 그룹의 클라우드 및 IoT 모니터링 시스템에서 온라인 서비스로 성공적으로 배포되어 실제 환경에서의 실용성을 입증했습니다.
- **향후 연구 방향:** 더 정교한 네트워크 아키텍처 탐색, 분해된 모든 컴포넌트를 다중 채널로 직접 네트워크에 입력하는 방식, 그리고 시계열 분해와 이상 탐지를 동시에 학습하는 공동 학습 프레임워크 개발 등이 가능합니다.

## 📌 TL;DR

RobustTAD는 **복잡하고 레이블이 제한적인 시계열 데이터에서 강건한 이상 탐지**를 위해 **강건한 시계열 분해**와 **U-Net 기반 컨볼루션 신경망**을 통합한 프레임워크입니다. 이 방법은 분해된 잔차를 신경망 입력으로 사용하고, **불균형 데이터 처리를 위한 가중치 조정 손실 함수**와 **시간/주파수 도메인 데이터 증강 기법**을 통해 모델 학습을 강화합니다. Yahoo 벤치마크에서 기존 SOTA를 뛰어넘는 성능을 보였으며, Alibaba 그룹의 온라인 서비스로 성공적으로 배포되어 **실시간 시계열 이상 탐지의 효율성과 정확성**을 입증했습니다.
