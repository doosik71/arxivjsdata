# MAD-GAN: Multivariate Anomaly Detection for Time Series Data with Generative Adversarial Networks

Dan Li, Dacheng Chen, Lei Shi, Baihong Jin, Jonathan Goh, and See-Kiong Ng

## 🧩 Problem to Solve

스마트 빌딩, 공장, 발전소, 데이터 센터와 같은 사이버 물리 시스템(CPS)은 방대한 양의 다변량 시계열 데이터를 생성합니다. 이러한 시스템은 중요한 임무를 수행하므로 사이버 공격의 주요 표적이 됩니다. 기존의 임계값 기반 이상 탐지 방법은 시스템의 동적인 복잡성 때문에 부적절하며, 지도 학습 방법은 레이블된 데이터의 부족으로 대량의 데이터를 활용하기 어렵습니다. 또한, 현재의 비지도 학습 접근 방식들은 다중 변수(센서/액추에이터) 간의 시공간 상관관계 및 기타 의존성을 완전히 활용하지 못하며, 시스템의 고도로 동적인 특성을 고려할 때 현재 상태와 예측된 정상 범위 간의 단순 비교만으로는 이상 탐지에 한계가 있습니다.

## ✨ Key Contributions

- **GAN 기반 비지도 이상 탐지 방법 제안**: 다변량 시계열 데이터에서 이상을 탐지하기 위한 GAN 기반 비지도 이상 탐지 방법인 MAD-GAN을 제안했습니다.
- **LSTM-RNN을 활용한 시계열 분석**: 기존 이미지 관련 애플리케이션을 위해 개발된 GAN 프레임워크를 다변량 시계열 데이터 분석에 적응시키기 위해, GAN의 생성자와 판별자 기본 모델로 장단기 기억 순환 신경망(LSTM-RNN)을 채택하여 시간적 종속성을 포착했습니다.
- **DR-점수(Discrimination and Reconstruction Anomaly Score) 도입**: GAN으로 학습된 판별자와 생성자를 모두 활용하여, 각 테스트 샘플에 대한 판별 결과와 재구성 잔차를 결합한 새로운 이상 점수인 DR-점수를 사용하여 이상을 탐지합니다.
- **실제 CPS 데이터셋에서 우수한 성능 입증**: SWaT(Secure Water Treatment) 및 WADI(Water Distribution) 두 가지 실제 CPS 데이터셋에 대한 사이버 공격으로 인한 이상 탐지에서 기존 방법들보다 뛰어난 성능을 보였습니다.

## 📎 Related Works

이 논문은 비지도 이상 탐지 방법을 크게 네 가지 범주로 분류하고 관련 연구들을 언급합니다:

- **선형 모델 기반 방법**: 주성분 분석(PCA), 부분 최소 제곱법(PLS) 등이 있으며, 고도로 상관된 데이터에 효과적이지만 비선형성을 처리하지 못하고 다변량 가우시안 분포를 가정합니다.
- **거리 기반 방법**: K-최근접 이웃(KNN), 군집 기반 지역 이상치 인자(CBLOF) 등이 있으며, 이상 지속 시간이나 이상 개수에 대한 사전 지식이 있을 때 더 나은 성능을 보입니다.
- **확률론적 및 밀도 추정 기반 방법**: 각도 기반 이상 탐지(ABOD), 특징 배깅(FB) 등이 변수 상관관계를 고려하지만, 시계열 데이터의 시간적 상관관계를 고려하지 못합니다.
- **딥러닝 기반 비지도 이상 탐지 방법**: 오토인코더(AE), 심층 오토인코딩 가우시안 혼합 모델(DAGMM), LSTM 인코더-디코더 등이 유망한 성능을 보였으며, 본 연구는 GAN 기반 딥러닝 접근 방식을 따릅니다.
  또한, GAN은 이미지 처리 분야에서 큰 성공을 거두었으나, 시계열 데이터에 GAN 프레임워크를 적용한 연구는 아직 초기 단계이며, 연속 값 시퀀스 생성에 대한 몇몇 선행 연구(예: 음악, 의료 시계열)가 있었습니다.

## 🛠️ Methodology

MAD-GAN은 다변량 시계열 이상 탐지를 위해 생성적 적대 신경망(GAN) 프레임워크를 사용하며, 다음 단계를 따릅니다.

1. **MAD-GAN 아키텍처**:

   - **LSTM-RNN 기반 GAN**: 생성자($G$)와 판별자($D$) 모두 시계열 데이터의 시간적 상관관계를 효과적으로 포착하기 위해 장단기 기억 순환 신경망(LSTM-RNN)으로 구성됩니다.
   - **다변량 시계열 처리**: 각 데이터 스트림을 독립적으로 처리하는 대신, 전체 변수 세트를 동시에 고려하여 변수 간의 잠재적 상호작용을 모델링합니다.
   - **슬라이딩 윈도우**: 다변량 시계열을 슬라이딩 윈도우를 사용하여 서브 시퀀스(sub-sequence)로 나눕니다. 윈도우 길이($s_w$)는 다양한 해상도로 시스템 상태를 캡처하기 위해 여러 값으로 실험됩니다.
   - **적대적 학습**: 생성자($G$)는 무작위 잠재 공간(latent space)에서 가짜 시계열을 생성하고, 판별자($D$)는 생성된(가짜) 시퀀스와 실제(정상) 훈련 데이터 시퀀스를 구별하도록 학습됩니다. $D$는 진짜/가짜를 정확히 분류하고, $G$는 $D$를 속이도록 훈련됩니다.

2. **GAN 기반 이상 탐지 (DR-점수 활용)**:
   훈련된 $G$와 $D$는 다음 두 가지 방식으로 이상 탐지에 활용됩니다.

   - **판별 기반 이상 탐지**: 학습된 판별자 $D$는 가짜 데이터(이상)를 실제 데이터(정상)와 높은 민감도로 구별할 수 있으므로, 직접적인 이상 탐지 도구로 사용됩니다. 테스트 샘플 $X_{tes}$를 $D$에 입력하여 판별 결과를 얻습니다.
   - **재구성 기반 이상 탐지**: 학습된 생성자 $G$는 잠재 공간에서 실제 데이터 공간으로의 매핑($G(Z): Z \rightarrow X$) 역할을 합니다. 테스트 데이터 $X_{tes}$에 해당하는 최적의 잠재 공간 $Z_k$를 찾습니다. $G(Z_k)$는 $X_{tes}$의 재구성된 샘플이 되며, $X_{tes}$와 $G(Z_k)$ 사이의 잔차($Res(X_{tes})$)를 사용하여 이상을 식별합니다. $Z_k$는 $Er(X_{tes}, G_{rnn}(Z_k)) = 1 - Simi(X_{tes}, G_{rnn}(Z_k))$ (여기서 $Simi$는 공분산으로 정의됨)를 최소화하도록 업데이트됩니다.

3. **DR-점수 (Discrimination and Reconstruction Anomaly Score) 계산**:
   - 각 테스트 서브 시퀀스에 대해 판별 결과 $D_{rnn}(X_{tes})$와 재구성 잔차 $Res(X_{tes})$를 결합하여 이상 탐지 손실($L_{test}$)을 계산합니다:
     $$ L*{test} = \lambda Res(X*{test}) + (1-\lambda)D*{rnn}(X*{test}) $$
        여기서 $\lambda$는 가중치 매개변수입니다.
   - 서브 시퀀스의 이상 탐지 손실($L_{j,s}$)을 원래 시계열로 매핑하여 최종 DR-점수($DRS_t$)를 계산합니다:
     $$ DRS*t = \frac{\sum*{j,s \in \{j+s=t\}} L\_{j,s}}{lc_t} $$
        여기서 $lc_t$는 특정 시간 $t$에 해당하는 서브 시퀀스의 개수입니다.
   - 계산된 $DRS_t$가 사전 정의된 임계값 $\tau$보다 높으면 이상(1)으로, 그렇지 않으면 정상(0)으로 분류됩니다.

## 📊 Results

MAD-GAN은 SWaT 및 WADI 데이터셋에 대해 다양한 실험을 통해 성능을 평가했으며, 주요 결과는 다음과 같습니다.

- **다변량 생성 능력**: MAD-GAN의 생성자는 초기 학습 단계에서는 실제 데이터와 차이가 있었으나, 충분한 반복 학습 후에는 시스템의 다양한 센서 및 액추에이터에 대해 현실적인 다변량 샘플을 성공적으로 생성했습니다. MMD(Maximum Mean Discrepancy) 측정 결과, 다변량 샘플의 MMD 값이 단변량 샘플보다 초기에 낮았고 더 빠르게 수렴하여, 여러 데이터 스트림을 함께 사용하는 것이 GAN 모델 학습에 도움이 됨을 시사합니다.

- **이상 탐지 성능**:

  - **SWaT 데이터셋**: F1 점수를 기준으로 할 때, MAD-GAN은 기존 인기 있는 4가지 비지도 방법(PCA, KNN, FB, AE) 중 가장 우수한 AE보다 정밀도에서 26.34%, 재현율에서 11.11% 더 높은 성능을 보였습니다. MAD-GAN은 SWaT에서 거의 100%의 정밀도와 재현율을 달성하며 모든 익명 지점을 거짓 경보 없이 정확하게 탐지했습니다.
  - **WADI 데이터셋**: F1 점수를 기준으로 할 때, MAD-GAN의 재현율이 AE보다 약간 낮았으나, 최대 재현율 기준으로 볼 때 MAD-GAN은 다른 방법들보다 65.64%에서 94.36% 더 높은 재현율을 달성했습니다. MAD-GAN의 정밀도는 낮게 나타났지만, 사이버 공격 탐지 시 모든 침입을 탐지하기 위해 오탐(false positive)을 허용하는 것은 수용 가능한 수준으로 간주됩니다.
  - **KDDCUP99 데이터셋**: MAD-GAN은 이 데이터셋에서 0.90의 F1 점수를 달성했으며, 정밀도는 85% 이상, 재현율은 94% 이상이었습니다. 이는 CNN을 사용하는 EGAN보다 MAD-GAN(LSTM-RNN 사용)이 복잡한 시계열을 더 잘 학습할 수 있음을 보여줍니다.

- **차원 축소 효과**: LSTM-RNN의 계산 부하를 줄이기 위해 PCA를 사용하여 차원을 축소했습니다. SWaT 데이터셋의 경우 첫 5개 주성분이 분산의 99.5% 이상을 설명했으며, 이를 사용할 경우 95% 이상의 높은 재현율을 달성할 수 있었습니다. 이는 적절한 차원 축소가 성능에 큰 영향을 미치지 않으면서 계산 효율성을 높일 수 있음을 보여줍니다.

- **서브 시퀀스 해상도**: 작은 서브 시퀀스 길이(예: $s_w = 30$)가 SWaT 및 WADI 데이터셋에 대해 효율적이면서도 만족스러운 성능을 보였습니다. 큰 서브 시퀀스 길이는 SWaT 데이터셋에서 더 많은 오탐을 유발하여 정밀도가 저하되는 경향을 보였습니다.

- **학습 반복 epoch에 따른 안정성**: 학습 초기 몇 epoch 동안 성능이 빠르게 향상되었지만, 이후에는 성능(재현율)이 60% 이상에서 비교적 높은 수준으로 진동하는 불안정성을 보였습니다. 이는 GAN 기반 이상 탐지 방법의 본질적인 불안정성을 시사합니다.

## 🧠 Insights & Discussion

MAD-GAN은 다변량 시계열 데이터에서 사이버 공격으로 인한 이상을 효과적으로 탐지하기 위해 GAN과 LSTM-RNN을 결합한 강력한 프레임워크를 제공합니다. 이 연구는 기존 방법들의 한계(레이블 부족, 복잡한 시공간 상관관계 포착의 어려움)를 극복하며, 특히 실제 CPS 환경의 불균형하고 복잡한 데이터셋에서 뛰어난 재현율을 달성했습니다.

**주요 통찰**:

- LSTM-RNN을 GAN의 생성자/판별자로 활용함으로써 시계열 데이터의 시간적 종속성과 다변량 상관관계를 성공적으로 모델링할 수 있었습니다.
- 판별자($D$)의 분류 능력과 생성자($G$)의 재구성 능력을 결합한 DR-점수는 이상 탐지의 견고성을 높였습니다.
- 다변량 데이터 스트림을 함께 학습하는 것이 단변량보다 GAN 모델 학습에 더 효과적임을 MMD 분석을 통해 확인했습니다.

**한계 및 향후 연구**:

- **계산 부하**: LSTM-RNN은 긴 서브 시퀀스 처리 시 계산 부하가 증가합니다.
- **최적 서브 시퀀스 길이 결정**: 시계열 분석에서 최적의 서브 시퀀스 길이를 결정하는 원칙적인 접근 방식에 대한 연구가 필요합니다.
- **모델 불안정성**: GAN 기반 모델의 학습 안정성 문제(반복 학습 시 성능 진동)에 대한 추가 연구가 필요합니다.
- **정밀도 문제**: WADI와 같이 매우 불균형한 데이터셋에서는 재현율은 높지만 정밀도가 낮아 오탐이 많을 수 있습니다. 이는 침입 탐지 애플리케이션에서는 수용 가능하지만, 다른 시나리오에서는 개선이 필요할 수 있습니다.
- **이론적 보장**: 잠재 공간 차원 및 주성분(PC) 차원을 선택하는 데 있어 이론적 보장을 갖춘 원칙적인 방법에 대한 연구가 제안됩니다.
  향후에는 특성 선택, 모델 안정성 연구, 예측 유지보수 및 스마트 빌딩/기계의 고장 진단과 같은 다른 이상 탐지 애플리케이션으로 MAD-GAN을 확장할 계획입니다.

## 📌 TL;DR

**MAD-GAN**은 사이버 물리 시스템(CPS)의 복잡한 다변량 시계열 데이터에서 레이블 부족 및 시공간 상관관계 포착의 어려움으로 인해 기존 방법들이 한계를 보이는 이상 탐지 문제에 대한 비지도 학습 솔루션입니다. 이 방법은 **LSTM-RNN 기반 생성적 적대 신경망(GAN)** 아키텍처를 사용하여 시계열의 복잡한 의존성을 모델링하고, **판별자와 생성자의 출력을 결합한 독창적인 DR-점수**를 통해 이상을 식별합니다. 실험 결과, MAD-GAN은 SWaT 및 WADI와 같은 실제 CPS 데이터셋에서 사이버 공격으로 인한 이상 탐지에 있어 기존 비지도 방법들보다 **월등히 뛰어난 성능(특히 높은 재현율)**을 보여주며, 다변량 시계열 이상 탐지의 효과적인 접근 방식임을 입증했습니다.
