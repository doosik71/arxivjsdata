# An Evaluation of Anomaly Detection and Diagnosis in Multivariate Time Series

Astha Garg, Wenyu Zhang, Jules Samaran, Ramasamy Savitha, Chuan-Sheng Foo

## 🧩 해결하고자 하는 문제

다변량 시계열(MVTS) 이상 감지에 대한 여러 딥러닝 기반 기법들이 제안되었지만, 공통된 데이터셋과 평가 지표를 사용한 체계적인 비교 연구가 부족합니다. 기존 평가 지표들은 이상 이벤트 감지를 제대로 반영하지 못하거나 무작위 감지기(random detector)와 같은 사소한 감지기와 좋은 감지기를 구별하지 못하는 단점이 있습니다. 본 연구는 사이버 물리 시스템(CPS)의 MVTS 데이터에서 이상 감지 및 진단 성능을 체계적으로 평가하고, 이상 탐지 모델의 핵심 설계 요소(모델, 스코어링 함수)의 영향을 분석하며, 새로운 평가 지표를 제안하는 것을 목표로 합니다.

## ✨ 주요 기여

- **스코어링 함수의 중요성 강조:** 이상 감지 성능에 있어 스코어링 함수의 선택이 모델 자체보다 더 중요할 수 있으며, 특히 테스트 세트의 변화에 적응하는 동적 스코어링 함수가 정적 스코어링 함수보다 뛰어남을 밝혔습니다.
- **새로운 평가 지표 제안:** 기존 지표($F_1$ 및 `point-adjusted F-score` ($F_{pa1}$))의 단점을 극복하기 위해 `이벤트 단위 재현율` ($Rec_e$)과 `시점 단위 정밀도` ($Pr_t$)의 조화 평균인 `복합 F-스코어` ($F_{c1} = 2 \times \frac{Pr_t \times Rec_e}{Pr_t + Rec_e}$)를 제안했습니다.
- **단순 모델의 우수성 발견:** 놀랍게도 각 채널에 대해 독립적으로 작동하는 단순한 `Univariate Fully-Connected AutoEncoder (UAE)` 모델이 동적 가우시안 스코어링 함수와 결합했을 때, 이상 감지 및 진단 모두에서 최신 알고리즘들을 능가하는 성능을 보였습니다.
- **모듈형 프레임워크 제시:** 이상 감지 및 진단을 위한 모델 기반 접근 방식을 `재구성/예측 모델`, `스코어링 함수`, `임계값 함수`의 세 가지 모듈로 구성된 체계적인 프레임워크로 일반화하여 제시했습니다.

## 📎 관련 연구

본 연구는 심층 학습 기반 이상 감지, 특히 MVTS 이상 감지 분야의 최신 연구들을 평가합니다.

- **심층 학습 기반 이상 감지:** LSTM-ED, LSTM-VAE, MSCRED, BeatGAN, NASA LSTM, DAGMM, OCAN, OmniAnomaly 등 다양한 오토인코더(AutoEncoder), 생성적 적대 신경망(GAN), 예측 모델링 기반 방법론들을 포함합니다.
- **얕은 모델 기반 이상 감지:** 주성분 분석(PCA) 및 One-Class Support Vector Machine (OC-SVM)과 같은 전통적인 방법들도 비교 대상에 포함됩니다.
- **시계열 이상 감지 지표:** `Point-wise F-score` ($F_1$) 및 `Point-adjusted F-score` ($F_{pa1}$)와 같은 기존 평가 지표들의 문제점을 분석합니다.

## 🛠️ 방법론

본 연구는 MVTS 이상 감지 및 진단을 위한 모듈형 프레임워크를 제안하고, 이를 기반으로 다양한 모델과 스코어링 함수 조합을 평가합니다.

1. **모듈형 프레임워크:**

   - **재구성 또는 예측 모델 ($f_m$):** 입력 시퀀스를 재구성하거나 다음 시점(들)을 예측하여 채널별 오류($Er^i_t$)를 계산합니다. (예: AutoEncoder, LSTM)
   - **스코어링 함수:** 오류($Er$)를 채널별 이상 점수($A^i_t$)로 변환하는 `변환 함수` ($f_{trans}$)와 이를 단일 시점 이상 점수($a_t$)로 통합하는 `집계 함수` ($f_{agg}$)로 구성됩니다.
   - **임계값 함수 ($f_{thres}$):** $a_t$에 임계값을 적용하여 각 시점을 이상/정상으로 이진 분류합니다.

2. **평가 모델:**

   - **스코어링 함수와 교차 평가된 모델 (10개):** Raw Signal, PCA, UAE, FC AE, TCN AE, LSTM AE, LSTM VAE, BeatGAN, MSCRED, NASA LSTM.
   - **사전 정의된 스코어링 함수를 가진 모델 (3개):** DAGMM, OmniAnomaly, OCAN.
   - **기타:** NASA LSTM NPT (비모수적 임계값), OC-SVM.

3. **스코어링 함수 (4가지):**

   - **Error:** 정규화된 재구성 오류의 제곱 평균 제곱근(RMS)을 사용합니다.
   - **Gauss-S (정적 가우시안):** 훈련 오류에 정적 가우시안 분포를 피팅하고, `CDF (Cumulative Distribution Function)`를 기반으로 점수를 계산합니다. 점수는 `$-log(1-cdf)$`로 단조 증가합니다.
   - **Gauss-D (동적 가우시안):** Gauss-S의 정적 평균과 분산을 슬라이딩 윈도우 기반의 동적 평균 및 분산으로 대체하여 테스트 단계에서 발생하는 장기적 변화에 적응합니다.
   - **Gauss-D-K (가우시안 커널을 사용한 동적 가우시안):** Gauss-D 점수에 가우시안 커널 컨볼루션을 적용하여 여러 채널이 다른 시간에 반응할 때 이상 점수를 증폭합니다.

4. **임계값 함수 (3가지):**

   - **Best-F-score:** 주어진 지표(예: $F_{c1}$)의 최대값을 산출하는 임계값 (실제 적용 불가).
   - **Top-k:** 테스트 세트의 실제 이상 개수 `k`와 동일한 수의 시점을 이상으로 분류하는 임계값 (비스트리밍 시나리오에 적용).
   - **Tail-p:** 이상 점수가 확률에 해당할 때, 특정 작은 꼬리 확률(`p`)을 기준으로 임계값을 설정 (스트리밍 시나리오에 적용).

5. **데이터셋:** 7개의 공개적으로 사용 가능한 실제 CPS MVTS 데이터셋 (SWaT, WADI, DMDS, SKAB, MSL, SMAP, SMD)을 사용했습니다.

6. **평가 지표:**
   - **이상 감지:** 제안된 `복합 F-스코어` ($F_{c1}$)를 주요 지표로 사용하고, $F_1$, `AU-ROC`, `AU-PRC`도 보고합니다.
   - **이상 진단:** `HitRate@150` 및 제안된 `RC-top-3` 지표를 사용합니다.

## 📊 결과

- **평가 지표의 유효성:** 기존 `point-adjusted F-score` ($F_{pa1}$)는 무작위 이상 감지기에도 높은 점수를 부여하는 등 문제가 있었으나, 제안된 `복합 F-스코어` ($F_{c1}$)는 이러한 단점을 극복하고 이상 감지 성능을 더 정확하게 반영했습니다.
- **스코어링 함수의 영향:** 스코어링 함수의 선택은 모델 자체보다 이상 감지 성능에 더 큰 영향을 미쳤습니다. 특히 `Gauss-D-K`와 `Gauss-D` 같은 동적 스코어링 함수가 `Gauss-S`와 `Error`와 같은 정적 스코어링 함수보다 통계적으로 유의미하게 우수한 성능을 보였습니다.
- **모델 성능:** `Univariate Fully-Connected AutoEncoder (UAE)` 모델은 `Gauss-D` 스코어링 함수와 함께 사용될 때 7개 데이터셋 중 5개에서 최고의 성능을 달성하며, 전반적인 평균 $F_{c1}$ 및 평균 순위에서 가장 우수했습니다. 이는 `DAGMM`, `OCAN`, `OmniAnomaly`, `NASA LSTM`, `MSCRED` 등 최신 알고리즘보다 통계적으로 유의미하게 좋은 결과입니다.
- **모델 아키텍처:** `FC AE`와 `TCN AE`는 `LSTM AE`, `LSTM VAE`와 같은 RNN 기반 모델보다 우수한 성능을 보였는데, 이는 고정 길이 시계열이 FC 및 TCN 유닛으로도 효율적으로 모델링될 수 있기 때문으로 해석됩니다.
- **이상 진단 결과:** 이상 감지에서 좋은 성능을 보인 알고리즘이 이상 진단에서도 좋은 성능을 보였습니다. `UAE` 모델은 `RC-top-3` 지표에서도 평균 순위 1.5로 가장 뛰어난 성능을 입증했습니다.

## 🧠 통찰 및 논의

- **단순함의 효율성:** `UAE`와 같이 각 채널을 독립적으로 모델링하는 단순한 접근 방식이 MVTS 이상 감지에서 효과적일 수 있음을 시사합니다. 이는 주로 `시간적 이상(temporal anomalies)`이 지배적인 데이터셋에서 채널 간 상관 관계 모델링의 복잡성이 오히려 노이즈를 유발하거나 가짜 상관 관계를 학습할 수 있기 때문일 수 있습니다.
- **스코어링 함수의 중요성:** 모델의 복잡성보다 테스트 환경의 변화에 유연하게 대응하는 동적 스코어링 함수를 설계하는 것이 MVTS 이상 감지에서 실용적이고 효과적일 수 있습니다.
- **데이터셋의 한계 및 미래 연구 방향:** 현재 사용된 CPS 데이터셋은 주로 시간적 이상을 포함하고 있어, 여러 운영 상태와 `채널 간 이상(cross-channel anomalies)`이 복합적으로 나타나는 더 도전적인 데이터셋이 필요합니다. 이는 MVTS 이상 감지 알고리즘의 발전과 현실 세계 적용 가능성을 높이는 데 필수적입니다. `UAE`의 성능을 더욱 향상시키기 위해 채널별 모델을 개선하거나, 채널 간 효과를 고려하는 보완 모델과 앙상블하는 방안이 논의되었습니다.

## 📌 요약 (TL;DR)

다변량 시계열(MVTS) 이상 감지 연구는 체계적인 평가가 부족하고 기존 평가 지표에 결함이 있었습니다. 이 논문은 `모델-스코어링 함수-임계값 함수`의 모듈형 프레임워크를 제안하고, `복합 F-스코어` ($F_{c1}$)라는 새로운 평가 지표를 도입하여 이러한 문제를 해결했습니다. 놀랍게도, 단순한 `Univariate Fully-Connected AutoEncoder (UAE)` 모델이 동적 가우시안 스코어링 함수와 결합했을 때, 최신 복잡한 모델들보다 뛰어난 이상 감지 및 진단 성능을 보였습니다. 이는 MVTS 이상 감지에서 **스코어링 함수의 선택이 모델 아키텍처만큼, 혹은 그 이상으로 중요하며**, 특히 시간적 이상이 지배적인 환경에서는 단순한 채널별 모델이 더 효과적일 수 있음을 시사합니다.
