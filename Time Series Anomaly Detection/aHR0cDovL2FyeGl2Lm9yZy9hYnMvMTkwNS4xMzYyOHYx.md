# Time Series Anomaly Detection Using Convolutional Neural Networks and Transfer Learning

Tailai Wen, Roy Keyes

## 🧩 Problem to Solve

시계열 이상 탐지는 자동화된 모니터링 시스템에서 매우 중요하지만, 기존의 딥러닝 접근법은 주로 순환 신경망(RNN)에 기반을 두었으며, 이는 시계열 데이터의 잠재적인 특성을 충분히 활용하지 못할 수 있습니다. 또한, 실제 산업 IoT 시스템에서 이상(실패 이벤트) 발생 빈도가 낮아 모델 훈련을 위한 레이블링된 데이터가 부족한 '데이터 희소성' 문제가 빈번하게 발생합니다.

## ✨ Key Contributions

- **CNN 기반 시계열 이상 감지:** 이미지 분할에서 성공적으로 사용된 U-Net 아키텍처를 시계열 데이터에 맞춰 변형하여 이상 세그먼트(구간)를 감지하는 새로운 CNN 기반 딥 네트워크를 제안합니다.
- **전이 학습 프레임워크:** 대규모 합성 유니베리엇(단변량) 시계열 데이터셋으로 사전 훈련된 모델의 가중치를 활용하여 데이터 희소성 문제를 해결하는 전이 학습(Transfer Learning) 프레임워크를 제안합니다.
- **다변량 시계열을 위한 MU-Net 아키텍처:** 다변량(Multivariate) 시계열 데이터에 전이 학습을 적용하기 위한 새로운 네트워크 아키텍처인 MU-Net(Multivariate U-Net)을 도입하여, 사전 훈련된 단변량 모델의 가중치를 효과적으로 전이할 수 있도록 합니다.
- **다양한 데이터셋에서의 성공적인 검증:** 합성 및 실제 데이터셋(단변량 및 다변량)에 걸쳐 제안된 접근 방식의 성능을 성공적으로 시연했습니다.

## 📎 Related Works

- **완전 합성곱 네트워크(FCN) 및 U-Net:** 이미지 분할 분야에서 발전한 FCN [Long et al., 2015]과 이를 개선한 U-Net [Ronneberger et al., 2015] 아키텍처에 영향을 받아 시계열 분할에 적용했습니다. U-Net은 스킵 채널(skip channels)을 통해 고수준 및 저수준 특징을 연결하여 정보 손실을 방지합니다.
- **딥 전이 학습:** 이미지 및 자연어 처리 분야에서 딥 전이 학습의 성공 [Mahajan et al., 2018]을 따릅니다.
- **시계열 데이터 증강:** 시계열 데이터 증강 기법 [Um et al., 2017]을 확장하여 모델의 견고성을 높였습니다.
- **기존 시계열 이상 탐지:** 전통적인 시계열 분석 기법 [Abraham and Chuang, 1989], 특징 추출/표현 기법 [Keogh et al., 2005], 다변량 이상치 탐지 기법 [Breunig et al., 2000], 그리고 RNN 기반 딥러닝 기법 [Malhotra et al., 2015] 등이 언급됩니다.

## 🛠️ Methodology

제안된 방법론은 CNN 기반 시계열 분할과 데이터 희소성 문제를 해결하기 위한 전이 학습 프레임워크로 구성됩니다.

### 1. CNN 기반 시계열 분할 (U-Net for Time Series)

- **아키텍처:** 길이가 1024이고 $C$개 채널을 가진 시계열에 대해 U-Net과 유사한 인코더-디코더 구조를 사용합니다.
  - **인코딩:** 5개의 섹션으로 구성되며, 각 섹션은 컨볼루션 레이어, 배치 정규화, ReLu로 이루어진 두 개의 블록을 포함합니다. 필터 수는 16개에서 256개로 두 배씩 증가하며, 커널 크기는 3입니다. 섹션 사이에는 풀 사이즈 4의 맥스 풀링 레이어를 사용하여 특징 시계열을 다운샘플링합니다.
  - **디코딩:** 4개의 디코딩 섹션으로 구성되며, 각 섹션은 업샘플링 레이어와 두 개의 conv+BN+ReLu 블록을 포함합니다. 업샘플링 비율은 4이며, 대칭적인 아키텍처를 위해 대응하는 인코딩 레이어와 동일한 수의 필터를 사용합니다.
  - **스킵 채널:** U-Net의 핵심 특징인 스킵 채널은 해당 인코딩 및 디코딩 섹션의 출력을 연결하여 정보 손실을 방지합니다.
  - **출력 레이어:** 마지막 섹션은 커널 크기 1의 컨볼루션 레이어와 활성화 레이어로 구성됩니다. 이상 유형이 상호 배타적이지 않은 경우 시그모이드(Sigmoid) 활성화와 $M$개의 필터를 사용하며, 상호 배타적인 경우 소프트맥스(Softmax) 활성화와 $M+1$개의 필터(정상 클래스 포함)를 사용합니다. 손실 함수로는 소프트 다이스(soft Dice) 손실을, 최적화기로는 Adam을 사용합니다.
- **스트리밍 데이터 예측:** 훈련된 모델을 스트리밍 환경에서 배포할 때는 최신 데이터 스냅샷을 주기적으로 가져와 모델을 실행합니다. 중복 스냅샷을 사용하여 각 시점이 여러 번 평가되도록 하여 더 견고한 탐지를 얻습니다. 스냅샷 길이는 스트리밍 빈도와 이상 동작의 시간 스케일에 따라 조정됩니다.
- **입력 정규화:** 이미지와 달리 시계열 값은 스케일이 다양하므로, 사용자가 지정한 스케일을 사용하여 입력 시계열을 정규화합니다. 특정 스냅샷 내에서만 이상을 감지하려면 샘플 단위 입력 정규화 레이어를 사용할 수 있습니다.
- **데이터 증강:** 시간 워핑, 크롭핑, 무작위 추세 추가, 시계열 반전, 무작위 선형 연산, 다중 시계열 간 무작위 변이 등 다양한 데이터 증강 방법을 사용하여 훈련 데이터의 크기와 다양성을 늘립니다. 증강 방법은 레이블 불변성을 유지해야 하며, 특정 이상 유형에 대해 적절하게 선택되어야 합니다.

### 2. 전이 학습 프레임워크

- **사전 훈련 데이터셋:** 사전 훈련을 위해 다양한 합성 시계열(예: 매끄러운 곡선, 선형 곡선, 계단식 곡선, 펄스 신호 등)을 생성하고, 여기에 가장 일반적인 세 가지 유형의 이상(덧셈 이상치, 변동성 변화, 주기적 패턴 위반)을 주입하여 레이블링된 데이터를 만듭니다. 이러한 이상 유형은 일반적인 이상 감지 문제에 전이 가능한 저차원 특징을 추출하는 데 도움이 됩니다.
- **단변량 전이 학습:**
  - 대상 작업의 클래스 수에 따라 최종 컨볼루션 레이어의 출력 모양을 변경합니다.
  - 출력 섹션을 제외한 모든 레이어의 가중치는 사전 훈련된 모델의 가중치로 초기화됩니다.
  - **미세 조정 전략:**
    1. 10개 섹션(5개 인코딩, 4개 디코딩, 1개 출력)에 서로 다른 학습률 배수를 설정합니다(예: $0.01, 0.04, ..., 1.0$).
    2. 처음 두 섹션의 가중치를 고정하고 나머지 섹션을 미세 조정한 다음, 고정을 해제하고 모든 가중치를 미세 조정합니다.
- **MU-Net: 다변량 전이 학습을 위한 U-Net 기반 네트워크:**
  - 사전 훈련된 단변량 모델을 다변량 작업에 직접 적용하는 것은 첫 번째 컨볼루션 레이어의 커널 모양 문제와 의미 없는 채널 합산 문제로 인해 어렵습니다.
  - **아키텍처:** (그림 5 참조) 입력 시리즈의 $C$개 채널을 슬라이싱 레이어로 분리한 후, 각 채널은 U-Net의 처음 4개 인코딩 섹션과 유사한 자체 단변량 인코딩 섹션을 가집니다. 모든 채널의 네 번째 인코딩 섹션의 출력은 통합된 다섯 번째 인코딩 섹션 전에 연결되고, 이어서 U-Net과 동일한 4개의 디코딩 섹션과 최종 출력 섹션이 이어집니다.
  - **가중치 전이:** 사전 훈련된 U-Net 모델의 가중치를 MU-Net의 각 채널에 해당하는 처음 4개 인코딩 섹션의 가중치로 초기화합니다.
  - **미세 조정:** 처음 4개 인코딩 섹션을 고정하고 나머지 레이어를 조정합니다. 이어서 세 번째 및 네 번째 인코딩 섹션을 고정 해제하고 계속 조정합니다. 마지막으로 처음 두 섹션을 포함한 모든 가중치를 조정합니다.

## 📊 Results

4가지 시나리오에서 제안된 접근 방식을 평가했습니다.

1. **Dodgers Loop Sensor 데이터셋 (단변량, 충분한 데이터):**
   - U-Net을 훈련하여 트래픽 이상을 감지했습니다.
   - 39개의 알려진 이벤트 중 3개만 감지되지 않았으며, 이는 주로 결측값(missing values)이 많은 기간에 발생했습니다. 몇 개의 오탐(false positives)도 발생했습니다.
2. **Gasoil Plant Heating Loop 데이터셋 (다변량, 충분한 데이터):**
   - 사이버 공격을 감지하기 위해 다변량 U-Net($C=19$)을 훈련했습니다.
   - 22개의 사이버 공격 중 1개만 감지되지 않았으며, 3개의 오탐이 발생했습니다.
3. **합성 비정상 형태 곡선 (단변량, 불충분한 데이터, 전이 학습):**
   - 일반적인 U-Net을 처음부터 훈련했을 때 IoU(Intersection over Union) 점수는 50.96%였습니다.
   - 단변량 전이 학습을 사용했을 때 IoU 점수는 **71.95%**로 크게 향상되었습니다.
4. **근전도(EMG) 데이터셋 (다변량 분할, 불충분한 데이터, 전이 학습):**
   - 처음부터 U-Net을 훈련했을 때 IoU 점수는 56.61%였습니다.
   - 처음부터 MU-Net을 훈련했을 때 IoU 점수는 64.10%였습니다.
   - 사전 훈련된 U-Net을 MU-Net으로 전이하여 미세 조정했을 때 IoU 점수는 **70.04%**로 추가 향상되었습니다.

## 🧠 Insights & Discussion

- 이 연구는 이상 감지 맥락에서 CNN 기반 딥 네트워크(U-Net)를 시계열 분할에 적용한 최초의 연구입니다. 단변량 및 다변량 시계열 모두에서 만족스러운 성능을 보였습니다.
- 데이터 희소성 문제를 해결하기 위해 대규모 단변량 합성 데이터셋으로 사전 훈련된 U-Net 모델을 일반적인 이상 감지 작업에 전이하는 프레임워크를 제안했습니다. 특히 다변량 전이를 위해 새로운 아키텍처인 MU-Net을 도입하여 유망한 결과를 얻었습니다.
- 시계열 이상 탐지에서 '정확한 참 값(ground truth)'을 정의하는 것은 본질적인 어려움이 있습니다. 이상 동작의 시작과 끝을 정확히 구분하는 것은 사람 전문가조차 의견이 다를 수 있습니다. 따라서 예측된 마스크와 참 값 마스크 간의 완벽한 일치는 어려울 수 있으나, 예측된 마스크가 이상 존재를 경고하는 목적을 달성한다면 유용할 수 있습니다.
- 전이 가능한 모델은 시계열 데이터의 다양한 동작을 처리하는 데 매우 적합합니다. 사전 훈련 데이터셋은 시계열 데이터에서 가장 기본적인 이상 행동을 포함하도록 설계되어, 적은 데이터셋으로도 새로운 이상 유형을 쉽게 학습할 수 있습니다. 이는 명시적 또는 암묵적 정의를 통해 이상치를 식별하는 대부분의 이전 이상 감지 연구와 근본적으로 다릅니다.
- 향후 연구는 전이 학습 성능에 영향을 미치는 요인(예: 사전 훈련 데이터셋의 구성)에 대한 광범위한 실험과 통계적 시계열 분석, RNN 기반 이상 감지, 슬라이딩 윈도우를 사용한 CNN 기반 분류 방법 등 벤치마크 알고리즘과의 성능 비교를 포함할 수 있습니다.

## 📌 TL;DR

이 논문은 시계열 이상 탐지를 위해 U-Net 기반 CNN을 사용한 시계열 세그멘테이션 접근 방식을 제안합니다. 특히, 데이터 희소성 문제를 해결하기 위해 대규모 합성 데이터로 사전 훈련된 모델을 활용하는 전이 학습 프레임워크를 도입했으며, 다변량 시계열을 위한 새로운 아키텍처인 MU-Net을 개발했습니다. 실험 결과, 전이 학습이 데이터가 부족한 시나리오에서 IoU 점수를 크게 향상시켜, 제안된 방법이 실제 시계열 이상 탐지에서 효과적임을 보여줍니다.
