# MST-GAT: A Multimodal Spatial-Temporal Graph Attention Network for Time Series Anomaly Detection

Chaoyue Ding, Shiliang Sun, Jing Zhao

## 🧩 Problem to Solve

다중 모드 시계열(Multimodal Time Series, MTS) 이상 탐지는 작업 장치의 안전과 안정성을 유지하는 데 중요하지만, 각 모달리티의 단변량 시계열 간의 복잡한 공간-시간적 관계를 명시적으로 포착하는 데 어려움이 있습니다. 기존 딥러닝 방법들은 이러한 관계를 간과하여 오탐 및 미탐이 증가하는 경향이 있습니다. 특히 MTS 데이터는 모달리티 내(intra-modal) 및 모달리티 간(inter-modal) 상관관계를 포함한 복잡한 공간적 의존성(예: 토폴로지 구조, 모달리티 상관관계)과 시간적 의존성(예: 주기, 추세)을 가집니다. 또한, 이상 탐지 결과에 대한 해석을 제공하여 이상 현상의 가장 유력한 단변량 시계열을 찾아내는 것도 중요한 과제입니다.

## ✨ Key Contributions

- **MST-GAT(Multimodal Spatial-Temporal Graph Attention Network)**이라는 새로운 MTS 이상 탐지 방법을 제안합니다. 이는 다중 모드 시계열 데이터에서 공간-시간적 의존성을 명시적으로 모델링하는 데 선구적인 역할을 합니다.
- **VAE(Variational Autoencoder) 기반의 재구성 모듈과 MLP(Multilayer Perceptron) 기반의 예측 모듈을 공동으로 최적화**하여 두 접근 방식의 장점을 통합합니다. 이를 통해 벤치마크 데이터셋에서 F1-score 0.60 이상, AUC 0.92 이상의 최고 성능을 달성하며, 강력한 기준선 모델들을 능가합니다.
- 재구성 및 예측 결과를 기반으로 효율적인 **이상 해석 방법**을 고안하여 탐지된 이상 현상에 대한 직관적이고 해석 가능한 정보를 제공합니다.

## 📎 Related Works

- **시계열 이상 탐지**:
  - **전통적인 방법**: 클러스터링 기반, 거리 기반, 밀도 기반, 고립 기반.
  - **딥러닝 기반**:
    - **재구성 기반**: DAGMM (심층 오토인코딩 가우시안 모델), OmniAnomaly (확률적 RNN과 VAE), RAMED (다중 해상도 네트워크).
    - **예측 기반**: LSTM (우주선 이상 탐지), GDN (그래프 어텐션 네트워크로 구조 학습).
  - 기존 연구들은 재구성 및 예측 방법의 상보성을 입증했지만, 다중 모드 데이터 간의 관계를 명시적으로 포착하지 못했습니다.
- **그래프 신경망(GNNs)**:
  - 그래프 구조 데이터(소셜 네트워크, 의료 과학)에서 탁월한 성공을 거두었습니다.
  - GCN (그래프 컨볼루션 네트워크), GAT (그래프 어텐션 네트워크) [18]. GAT는 어텐션 메커니즘을 사용하여 이웃 노드에 집계 가중치를 할당합니다.
- **다중 모드 머신러닝**:
  - 서로 다른 모달리티의 정보로부터 이점을 얻어 모델 견고성을 향상시키는 것을 목표로 합니다.
  - 다중 커널 학습 모델, 확률적 그래픽 모델, 신경망 모델 등이 있습니다.
  - 이상 탐지에도 적용되었으나, 복잡한 시계열 간의 공간-시간적 상관관계를 통합하는 데 한계가 있었습니다.

## 🛠️ Methodology

MST-GAT는 각 센서를 노드로, 그 관계를 엣지로 처리하는 그래프 구조로 구성되며, 다중 모드 시계열의 복잡한 다중 모드 및 공간-시간적 관계를 모델링합니다.

1. **문제 정의**: $N$개의 단변량 시계열과 $T$개의 타임스탬프로 구성된 다중 모드 훈련 시계열 $X = [x_1, \dots, x_T] \in \mathbb{R}^{N \times T}$를 사용하여 모델을 훈련합니다. 각 $x_t$는 $M$개의 모달리티를 포함합니다. 목표는 $T'$ 길이의 테스트 시계열 $\tilde{X}$에서 각 타임스탬프 $\tilde{x}_i$가 이상인지($\tilde{y}_i = 1$) 정상인지($\tilde{y}_i = 0$) 탐지하는 것입니다.
2. **그래프 구조 학습**:
   - 각 단변량 시계열의 고유 속성을 특성화하는 시계열 임베딩 $v_i \in \mathbb{R}^d$를 사용합니다.
   - 이 임베딩 간의 코사인 유사도 $e_{ij} = \text{sim}(v_i, v_j)$를 계산한 후, 상위 $K$개 이웃을 선택하여 인접 행렬 $A$를 구성하는 희소 직접 그래프를 생성합니다.
3. **다중 모드 그래프 어텐션 네트워크(M-GAT)**:
   - 길이 $w$의 슬라이딩 윈도우를 사용하여 입력 $\hat{X} \in \mathbb{R}^{N \times w}$를 처리합니다.
   - 세 가지 어텐션 모듈로 구성됩니다:
     - **다중 헤드 어텐션 모듈**: 노드 $i$의 이웃 노드 표현을 집계하여 모달리티 독립적인 공간 관계를 모델링합니다:
       $$h^{l+1}_{att,i} = ||_{s=1}^S \sum_{j \in N_i} \alpha^{ls}_{ij} W^{ls}_{att} h^l_j$$
     - **모달리티 내(Intra-modal) 어텐션 모듈**: 동일한 모달리티에 속하는 시계열 간의 상관관계를 포착합니다. 후보 집합 $C^{intra}_i = \{k | m_i = m_k\}$ 내에서 (옵션으로 TopK 필터링 후) 이웃을 선택하여 어텐션 스코어 $\beta^{l}_{intra,ij}$를 기반으로 피처를 계산합니다.
     - **모달리티 간(Inter-modal) 어텐션 모듈**: 다른 모달리티에 속하는 시계열 간의 상관관계를 포착합니다. 후보 집합 $C^{inter}_i = \{k | m_i \neq m_k\}$ 내에서 이웃을 선택합니다.
   - 세 모듈의 출력을 연결하여 최종 노드 표현 $h^{l+1}_i$를 생성합니다.
4. **시간 컨볼루션 네트워크**:
   - M-GAT의 출력을 받아 시간 차원에 표준 컨볼루션 작업을 적용하여 시간적 역학을 포착합니다.
   - $T^{l+1} = \text{ReLU}(\Phi * \text{ReLU}(T^l))$
5. **공동 최적화 및 이상 스코어**:
   - 재구성 모듈과 예측 모듈의 장점을 통합하기 위해 공동 손실 함수 $L = \gamma_1 L_{rec} + (1-\gamma_1) \times L_{pred}$를 사용합니다.
   - **재구성 모듈**: VAE를 사용하여 입력 데이터의 재구성 확률 $p_\psi(X_t)$를 학습합니다. 손실 함수는 VAE의 ELBO(Evidence Lower Bound)를 최대화하는 방향으로 설계됩니다. 각 단변량 시계열의 재구성 확률 $p_i$를 제공합니다.
   - **예측 모듈**: MLP를 사용하여 다음 타임스탬프의 관측값을 예측합니다. 손실 함수는 실제 값과 예측 값의 제곱 오차 $L_{pred} = \frac{1}{T-w} \sqrt{\sum_{i=1}^N (x_{i,t+1} - \hat{x}_{i,t+1})^2}$를 최소화합니다. 각 단변량 시계열의 예측 값 $\hat{x}_i$를 제공합니다.
   - **이상 스코어**: 재구성 확률과 예측 오차를 결합하여 최종 이상 스코어를 계산합니다:
     $$score = \frac{\sum_{i=1}^N (1-p_i) + \gamma_2 \times (x_i - \hat{x}_i)^2}{1+\gamma_2}$$
   - **추론**: 검증 세트에서 POT(Peaks-Over-Threshold) 알고리즘을 사용하여 이상 임계값을 설정합니다. 스코어가 임계값을 초과하면 "이상"으로 분류됩니다.
   - **해석 가능성**: 이상 구간 내에서 각 센서의 평균 이상 스코어가 가장 높은 센서를 해당 이상을 유발했을 가능성이 가장 높은 센서로 식별하여 해석을 제공합니다.

## 📊 Results

- **데이터셋**: MSL, SMAP (우주선 데이터), SWaT, WADI (수처리 시스템 데이터) 네 가지 벤치마크 데이터셋에서 실험을 수행했습니다.
- **성능 지표**: Precision(정확도), Recall(재현율), F1-score(F1 점수), AUC(ROC 곡선 아래 면적)를 사용했습니다.
- **주요 결과**:
  - MST-GAT는 F1-score와 AUC 측면에서 8개의 최첨단 기준선(PCA, AE, DAGMM, LSTM-VAE, MAD-GAN, OmniAnomaly, USAD, GDN)을 모든 데이터셋에서 일관되게 능가했습니다. 특히, MSL과 SMAP에서 F1-score를 0.9%에서 1.52% 향상시켰고, 더 복잡한 SWaT와 WADI 데이터셋에서는 최소 2.73% 이상 개선했습니다.
  - Wilcoxon signed-rank test 결과, MST-GAT의 성능 향상은 모든 기준선 모델에 비해 통계적으로 유의미했습니다.
- **해석 가능성**: WADI 데이터셋 사례 연구에서, MST-GAT는 다른 시계열과 일관되지 않은 추세를 보이는 센서(`1AIT001PV`)를 가장 이상적인 센서로 정확하게 지목하여 사람의 직관과 일치하는 해석 결과를 제공했습니다.
- **하이퍼파라미터 민감도**: 손실 함수와 이상 스코어에 사용되는 하이퍼파라미터 $\gamma_1$과 $\gamma_2$에 대해 MST-GAT가 비교적 둔감하여 다양한 설정에 대해 견고함을 보였습니다.
- **시계열 임베딩 분석**: MSL 데이터셋의 시계열 임베딩 코사인 유사도 행렬은 높은 모달리티 내 일관성과 다양한 모달리티 간 상관관계를 보여, M-GAT를 통한 모달리티 의존성 모델링의 타당성을 입증했습니다.
- **제거 연구(Ablation Studies)**:
  - 모달리티 내/간 어텐션 모듈을 제거하면 성능이 크게 저하되어, 다중 모드 시계열의 명시적인 모달리티 의존성 포착이 중요함을 확인했습니다.
  - 시간 컨볼루션 네트워크를 제거했을 때도 성능 저하가 발생하여 시간적 의존성 모델링의 필요성을 입증했습니다.
  - TopK 기반의 동적 희소 그래프 대신 완전 그래프를 사용했을 때 성능이 감소하여, 적절한 그래프 구조 학습이 중요함을 보였습니다.
  - 어텐션 메커니즘을 제거하고 각 이웃에 동일한 가중치를 할당했을 때 가장 큰 성능 저하가 발생하여, 복잡한 의존성 모델링에 어텐션이 필수적임을 입증했습니다.

## 🧠 Insights & Discussion

MST-GAT의 뛰어난 성능은 다중 모드 시계열에서 공간적(모달리티 내/간) 및 시간적 의존성을 명시적으로 포착하는 것이 정확한 이상 탐지에 결정적이라는 가설을 강력히 지지합니다. M-GAT는 모달리티 독립적인 관계뿐만 아니라 모달리티 내 및 모달리티 간 관계를 모델링함으로써, 특히 SWaT 및 WADI와 같은 복잡한 데이터셋에서 향상된 피처 표현과 이상 탐지 능력을 제공합니다. 재구성 모듈(VAE)과 예측 모듈(MLP)의 공동 최적화는 상호 보완적인 강점을 활용하여 다양한 이상 패턴(예: 주기적 이상 대 일반 데이터 분포 이상)에 걸쳐 모델의 견고성을 높입니다. 제안된 해석 방법은 이상 현상의 가장 유력한 원인(특정 단변량 시계열)을 찾아내어 탐지 시스템의 유용성과 신뢰도를 향상시킵니다.

**한계 및 향후 연구**:

- 향후 연구는 샘플링 속도가 다른 센서에서 수집된 데이터와 같이 정렬되지 않은 다중 모드 시계열 데이터로 프레임워크를 확장하는 것입니다.
- 실제 배포 요구 사항을 충족하기 위해 모델의 메모리 사용량과 실행 시간을 최적화하는 것도 중요한 연구 영역입니다.

## 📌 TL;DR

다중 모드 시계열(MTS) 이상 탐지에서 기존 딥러닝 방식들은 다양한 모달리티의 시계열 간 공간-시간적 관계를 명시적으로 포착하지 못해 성능 한계가 있었습니다. 이를 해결하기 위해 본 논문은 **MST-GAT(Multimodal Spatial-Temporal Graph Attention Network)**를 제안합니다. MST-GAT는 **다중모드 그래프 어텐션 네트워크(M-GAT)**를 통해 모달리티 내/간 관계를 포함한 공간적 상관관계를 모델링하고, **시간 컨볼루션 네트워크**로 시간적 의존성을 포착합니다. 또한, **재구성(VAE 기반) 및 예측(MLP 기반) 모듈을 동시 최적화**하여 장점을 통합하고, 이상 스코어와 개별 시계열 기여도를 통해 **이상 현상의 원인을 해석**할 수 있도록 합니다. 네 가지 벤치마크 데이터셋에서 최첨단 성능을 달성했으며, 각 모듈의 효과와 해석 가능성을 입증했습니다.
