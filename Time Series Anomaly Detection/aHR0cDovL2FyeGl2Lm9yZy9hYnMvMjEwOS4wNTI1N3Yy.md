# Towards a Rigorous Evaluation of Time-series Anomaly Detection

Siwon Kim, Kukjin Choi, Hyun-Soo Choi, Byunghan Lee, Sungroh Yoon

## 🧩 Problem to Solve

최근 시계열 이상 탐지(Time-series Anomaly Detection, TAD) 연구들은 벤치마크 데이터셋에서 높은 F1 점수를 보고하며 상당한 성능 향상을 이룬 것처럼 보인다. 그러나 대부분의 연구는 '점 조정(Point Adjustment, PA)'이라는 독특한 평가 프로토콜을 적용한다. 본 논문은 이 PA 프로토콜이 탐지 성능을 과대평가할 가능성이 매우 높으며, 심지어 무작위 이상 점수조차 최신 TAD 방법과 유사한 성능을 보일 수 있음을 밝힌다. 이로 인해 TAD 방법들의 비교 및 순위가 잘못될 수 있고, 기존 TAD 방법들의 실제 잠재력에 대한 의문이 제기된다. 또한, 적절한 성능 기준선(baseline)이 없어 모델의 실제 개선 효과를 평가하기 어렵다는 문제가 있다.

## ✨ Key Contributions

- TAD의 독특한 평가 프로토콜인 PA가 기존 방법들의 탐지 성능을 크게 과대평가한다는 것을 이론적 및 실험적으로 입증했습니다.
- PA를 적용하지 않을 경우, 기존 방법들이 새로운 기준선에 비해 (또는 대부분) 미미한 개선만을 보인다는 것을 보여주었습니다.
- 이러한 발견을 바탕으로 TAD의 엄격한 평가를 위한 새로운 기준선과 평가 프로토콜인 PA%K를 제안했습니다.

## 📎 Related Works

- **기존 TAD 평가의 문제점 지적:** Wu and Keogh (2021)는 벤치마크 TAD 데이터셋의 한계를 지적하며 간단한 탐지기가 일부 데이터셋에 충분하다고 주장했으며, Lai et al. (2021)은 새로운 이상 유형 분류법과 데이터셋을 제안했습니다. 본 연구는 PA 프로토콜의 과대평가와 기준선의 부재라는 평가 방식의 근본적인 문제에 초점을 맞춥니다.
- **비지도 학습 기반 TAD 방법:**
  - **재구성 기반(Reconstruction-based) 방법:** 입력과 재구성된 신호 간의 거리를 이상 점수로 활용합니다 (예: Autoencoder, VAE 기반의 LSTM-VAE, OmniAnomaly, USAD, DAGMM, MSCRED).
  - **예측 기반(Forecasting-based) 방법:** 미래 시점의 신호를 예측하고 실제 값과의 거리를 이상 점수로 사용합니다 (예: LSTM 기반).
  - **기타 방법:** One-class 분류 (예: THOC), 베이지안 네트워크 (예: RADM), 그래프 신경망 (예: GDN) 등이 있습니다.

## 🛠️ Methodology

1. **PA 프로토콜의 과대평가 분석:**
   - 표준 F1 점수($$F1 = \frac{2 \cdot P \cdot R}{P + R}$$) 계산을 정의하고, PA가 TP(True Positives)를 증가시키고 FN(False Negatives)을 감소시켜 F1 점수를 인위적으로 높이는 방식($$\hat{y}_{t} = \begin{cases} 1, & \text{if } A(w_{t}) > \delta \text{ or } t \in S_{m} \text{ and } \exists t' \in S_{m} A(w_{t'}) > \delta \\ 0, & \text{otherwise} \end{cases}$$)을 설명합니다.
   - 수학적 증명을 통해 균일 분포에서 추출된 무작위 이상 점수조차도 PA 적용 시 F1$_{PA}$가 1에 가까워질 수 있음을 보입니다. 특히 이상 구간의 길이가 길수록 이러한 경향이 두드러집니다.
2. **미학습 모델의 비교 가능한 성능 입증:**
   - 무작위로 초기화된 딥러닝 모델(예: 오토인코더)의 출력은 0에 가까우므로, 재구성 오류 기반 이상 점수는 입력 윈도우의 크기($$A(w_{t}) \approx ||w_{t}||^2$$)에 비례한다는 것을 보입니다.
   - 시계열 데이터의 점 이상(point anomaly)은 특정 센서 값의 급격한 변화를 수반하므로, 이상 윈도우의 크기가 정상 윈도우보다 커져 자연스럽게 높은 이상 점수를 갖게 됩니다.
3. **새로운 기준선 제안:**
   - 랜덤으로 초기화된 단순한 재구성 모델(예: 단일 계층 LSTM으로 구성된 미학습 오토인코더)의 F1 점수를 새로운 기준선으로 제안합니다.
   - 더 극단적인 경우, 입력 자체의 크기($$||w_{t}||^2$$)를 이상 점수로 사용하는 것도 기준선으로 간주될 수 있습니다.
4. **새로운 평가 프로토콜 PA%K 제안:**
   - PA의 과대평가와 F1의 과소평가 가능성(불완전한 GT 레이블링으로 인한)을 완화하기 위해 PA%K를 제안합니다.
   - PA%K는 특정 이상 구간 $S_m$ 내에서 탐지된 이상 시점의 비율($$\frac{||\{t'|t' \in S_m, A(w_{t'}) > \delta\}||}{||S_m||}$$)이 임계값 $K$를 초과할 경우에만 해당 구간 전체를 이상으로 간주합니다.
   - $K=0$은 기존 PA와 동일하며, $K=100$은 PA를 적용하지 않은 F1과 동일합니다.
   - $K$ 값에 대한 의존성을 줄이기 위해 $K$를 0부터 100까지 증가시키면서 얻은 F1$_{PA\%K}$ 곡선의 면적(AUC)을 측정하는 것을 권장합니다.

## 📊 Results

- **F1$_{PA}$와 F1의 상관관계:** SWaT 및 WADI 데이터셋에서 F1$_{PA}$와 F1 간의 Pearson 상관계수(PCC) 및 Kendall 순위 상관계수(KRC)가 낮게 나타나, F1$_{PA}$가 실제 탐지 성능을 신뢰할 수 있게 반영하지 못함을 보여주었습니다.
- **기준선과의 비교:**
  - `Case 1 (Random anomaly score)`은 F1$_{PA}$에서 종종 가장 높은 점수를 보였지만, F1에서는 매우 낮은 점수를 기록하여 PA의 과대평가 효과를 명확히 보여주었습니다.
  - `Case 2 (Input itself as anomaly score)` 및 `Case 3 (Anomaly score from randomized model)`과 같은 간단한 기준선들은 PA를 적용하지 않은 F1 점수에서 많은 최신 TAD 방법들과 비교할 만하거나 심지어 더 높은 성능을 달성했습니다.
  - 특히 GDN만이 모든 데이터셋에서 기준선(Case 2 및 3)을 꾸준히 상회하는 F1 성능을 보였습니다.
  - SMD 데이터셋의 경우, 다른 데이터셋에 비해 이상 구간의 길이가 짧고 이상 비율이 낮아 PA의 과대평가 효과가 덜 두드러졌습니다.
  - 윈도우 크기($\tau$)가 길어질수록 Case 2 및 3의 F1 기준선 성능이 증가하는 경향을 보였습니다.
- **PA%K 프로토콜의 효과:** 훈련된 모델은 $K$ 값 변화에 관계없이 일관되게 높은 F1$_{PA\%K}$를 유지했지만, 무작위 점수(Case 1)는 $K$가 증가함에 따라 F1$_{PA\%K}$가 급격히 감소했습니다. F1$_{PA\%K}$ 곡선의 AUC를 통해 훈련된 모델과 무작위 모델을 명확히 구별할 수 있음을 확인했습니다.

## 🧠 Insights & Discussion

- 현재 TAD 평가 방식의 문제점은 (1) PA로 인한 성능 과대평가와 (2) 적절한 기준선 부재로 요약됩니다.
- **PA 과대평가 완화 방안:**
  - 이상 구간 레이블링의 불완전성을 해결하기 위해 더욱 세밀하게 주석(annotation)된 새로운 벤치마크 데이터셋을 개발하는 것이 궁극적인 해결책이지만, 현실적으로 어렵습니다.
  - 제안된 PA%K 프로토콜은 데이터셋 수정 없이 PA의 과대평가 효과를 완화할 수 있는 좋은 대안이 될 수 있습니다. PA%K는 F1 점수 외의 다른 평가 지표에도 적용 가능합니다.
- **기준선 설정의 중요성:**
  - 미학습 모델(Case 2 및 3)의 성능을 기준선으로 설정하고, 이에 대한 상대적인 개선도를 측정하는 것이 중요합니다.
  - 윈도우 크기는 기준선 성능에 영향을 미치므로 신중하게 결정해야 합니다.
- **임계값 의존성 감소:**
  - 실제 환경에서는 테스트 데이터셋에 접근하지 않고 TAD 임계값을 미리 정의하기 어렵습니다. AUROC(Area Under the Receiver Operating Characteristic)나 AUPR(Area Under Precision-Recall)과 같이 임계값에 덜 의존적인 지표를 사용하여 엄격한 평가를 수행하는 것이 도움이 됩니다. 이 경우에도 제안된 기준선 선택 방법과 PA%K 프로토콜은 유효하게 적용될 수 있습니다.
- 본 연구는 현재 TAD 방법들의 잠재력을 명확히 하고 미래 연구의 개선 방향을 제시하는 데 기여할 것으로 기대됩니다.

## 📌 TL;DR

**문제:** 기존 시계열 이상 탐지(TAD) 연구는 '점 조정(PA)' 평가 프로토콜로 인해 성능이 과대평가되고 있으며, 비교를 위한 적절한 기준선이 부족합니다.

**제안 방법:** 본 논문은 PA가 F1 점수를 부풀려 무작위 이상 점수조차 최신 TAD 성능처럼 보이게 할 수 있음을 이론적 및 실험적으로 증명합니다. 또한, PA를 사용하지 않을 경우, 간단한 미학습 모델이 많은 기존 TAD 방법들과 유사한 성능을 보임을 밝힙니다. 이러한 분석을 바탕으로 미학습 모델의 성능을 새로운 기준선으로 제안하고, PA의 과대평가를 완화하면서 불완전한 실제 레이블을 고려하는 새로운 평가 프로토콜인 PA%K를 제안합니다.

**주요 발견:** 엄격한 평가(PA 미적용 또는 PA%K 적용) 시, 많은 기존 TAD 방법들이 제안된 기준선에 비해 미미하거나 전혀 개선되지 않은 성능을 보였습니다.
