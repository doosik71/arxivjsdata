# Latent Embedding Feedback and Discriminative Features for Zero-Shot Classification

Sanath Narayan, Akshita Gupta, Fahad Shahbaz Khan, Cees G. M. Snoek, Ling Shao

## 🧩 Problem to Solve

본 연구는 훈련 시 시각적 데이터가 없는 "미분류(unseen)" 클래스를 분류하는 **제로샷 학습(Zero-Shot Learning, ZSL)**과, 테스트 시 미분류 및 기분류(seen) 클래스 모두에 속할 수 있는 **일반화된 제로샷 학습(Generalized Zero-Shot Learning, GZSL)** 문제를 다룹니다. 기존 최신 GAN 기반 방법론들은 클래스별 의미론적 임베딩을 활용하여 미분류 클래스 특징을 합성하지만, 의미론적 일관성 제약 조건이 훈련 단계에서만 적용되고 특징 합성 및 분류 단계에서는 무시되는 경향이 있습니다. 이는 생성된 특징과 실제 특징 간의 의미론적 격차와 클래스 간의 모호성을 야기하며, GAN의 고질적인 문제인 모드 붕괴(mode collapse)도 특징 다양성을 저해합니다.

## ✨ Key Contributions

- ZSL 프레임워크의 **모든 단계(훈련, 특징 합성, 분류)**에서 의미론적 임베딩 디코더(Semantic Embedding Decoder, SED) 모듈의 효과적인 활용을 제안하는 **TF-VAEGAN**이라는 새로운 방법론을 제시합니다.
- VAE-GAN 아키텍처 내에서 생성된 특징을 반복적으로 정제하는 **피드백 모듈**을 도입합니다. 이 모듈은 SED의 잠재 임베딩을 변환하여 생성기의 잠재 표현을 조절함으로써 특징 합성의 품질을 향상시킵니다.
- 분류 단계에서 **판별적 특징 변환(discriminative feature transformation)** 기법을 제안합니다. 이는 SED의 잠재 임베딩과 해당 시각적 특징을 결합하여 클래스 간 모호성을 줄입니다.
- 제안하는 접근 방식이 객체 인식뿐만 아니라 **비디오 제로샷 행동 인식**에서도 효과적임을 입증합니다.
- 6개 주요 ZSL 벤치마크(CUB, FLO, SUN, AWA2, HMDB51, UCF101)에서 기존 방법론들을 능가하는 최첨단 성능을 달성합니다.
- 제안된 기법들이 `f-CLSWGAN`과 같은 다른 GAN 기반 ZSL 프레임워크에도 통합될 수 있음을 보여 일반화 가능성을 입증합니다.

## 📎 Related Works

- **초기 ZSL 연구:** 의미론적 임베딩 분류기 학습 (Akata et al., 2015), 시각적 특징과 의미론적 임베딩 공간 간의 호환성 함수 학습 (Frome et al., 2013).
- **Transductive ZSL:** 미분류 클래스의 레이블 없는 데이터 활용 (Fu et al., 2015).
- **GAN 기반 ZSL/GZSL:** 미분류 클래스 특징 합성 (Xian et al., 2018), 조건부 WGAN (Arjovsky et al., 2017).
- **GAN의 Cycle-consistency:** Cycle-WGAN (Felix et al., 2018)은 훈련 중 디코더를 사용하지만, 특징 합성 및 분류 단계에서는 폐기합니다.
- **VAE-GAN 하이브리드:** `f-VAEGAN` (Xian et al., 2019)은 VAE와 GAN을 결합하지만, 의미론적 임베딩에 대한 cycle-consistency 제약이 부족합니다.
- **피드백 메커니즘:** 이전 연구 (Zamir et al., 2017; Shama et al., 2019)는 이미지 초해상도 등에서 피드백 루프를 탐구했지만, ZSL 특징 합성에서의 VAE-GAN 아키텍처에 적용된 사례는 없었습니다.

## 🛠️ Methodology

본 논문은 `f-VAEGAN` [43] 아키텍처를 기반으로 확장하여, ZSL 파이프라인의 모든 단계에서 의미론적 일관성을 강화합니다.

1. **기반 아키텍처: f-VAEGAN 확장**
    - 인코더 $E(x, a)$와 디코더 $G(z, a)$로 구성된 VAE와 생성기 $G(z, a)$ 및 판별기 $D(x, a)$로 구성된 GAN을 결합합니다.
    - 기존 `f-VAEGAN`의 손실 함수 $L_{vaegan} = L_{V} + \alpha L_{W}$에 새로운 의미론적 일관성 손실 $L_{R}$을 추가하여 전체 손실 $L_{total} = L_{vaegan} + \beta L_{R}$을 최적화합니다.

2. **의미론적 임베딩 디코더(SED) 활용**
    - $Dec: X \rightarrow A$는 시각적 특징 $x$ 또는 $\hat{x}$로부터 해당 의미론적 임베딩 $a$를 재구성합니다.
    - **Cycle-consistency 손실($L_R$)**: 생성된 특징이 자신을 생성한 임베딩으로 다시 변환될 수 있도록 $L_1$ 손실을 사용합니다.
        $$ L_{R} = E[||Dec(x) - a||_1] ] + E[||Dec(\hat{x}) - a||_1] $$
    - **모든 단계에서의 활용**: SED는 훈련, 특징 합성, 분류 **모든 단계**에서 활용됩니다.

3. **피드백 모듈($F$)**
    - 훈련 및 특징 합성 단계에서 생성된 특징을 반복적으로 정제합니다.
    - SED의 잠재 임베딩 $h$를 입력으로 받아 $F(h)$를 통해 변환된 피드백 $\hat{x}_f$를 생성합니다.
    - 생성기 $G$의 $l$-번째 레이어 출력 $g_l$에 피드백 $\hat{x}_f$를 가산적으로 변조합니다: $g_l \leftarrow g_l + \delta \hat{x}_f$.
    - **훈련 전략 개선**: `G`와 `F`를 교대로 훈련하며, `F` 훈련 시 2단계 서브 반복을 수행합니다.
        - 첫 번째 서브 반복: `G`는 초기 특징 $\hat{x}[0]$을 생성하고, `Dec`는 이로부터 잠재 임베딩 $\hat{h}$를 얻습니다.
        - 두 번째 서브 반복: `F`는 $\hat{h}$를 $\hat{x}_f[t]$로 변환하고, `G`는 동일한 `z, a`와 추가된 $\hat{x}_f[t]$를 사용하여 향상된 특징 $\hat{x}[t+1]$을 생성합니다.

4. **판별적 특징 변환 (분류 단계)**
    - 생성기 `G`는 "하나의 임베딩에서 여러 인스턴스로" 매핑을, `Dec`는 "여러 인스턴스에서 하나의 임베딩으로" 역매핑을 학습하여 상호보완적인 정보를 인코딩합니다.
    - `Dec`의 잠재 임베딩 $h$를 추출하여 해당 시각적 특징 $x$ (또는 $\hat{x}$)와 **연결(concatenation)**합니다: $x_s \oplus h_s$ 및 $\hat{x}_u \oplus \hat{h}_u$.
    - 이렇게 변환된 판별적 특징을 사용하여 최종 ZSL/GZSL 분류기를 학습하여 클래스 간 모호성을 줄입니다.

## 📊 Results

- **객체 인식 (4개 데이터셋: CUB, FLO, SUN, AWA2):**
  - **ZSL (T1 정확도):** `f-VAEGAN`을 포함한 모든 기존 SOTA 방법론을 능가합니다. 예를 들어, CUB에서 64.9%, FLO 70.8%, SUN 66.0%, AWA 72.2% (IN 설정).
  - **GZSL (조화 평균 H):** IN GZSL에서 CUB 58.1%, FLO 71.7%, SUN 43.0%, AWA 66.6%를 달성하여 `f-VAEGAN` 대비 CUB에서 4.6%, FLO에서 7.1%의 상당한 성능 향상을 보였습니다.
  - 전반적으로 유도(IN), 전이(TR), 미세 조정된 유도(FT-IN), 미세 조정된 전이(FT-TR) 등 모든 설정에서 우수한 성능을 보였습니다.

- **행동 인식 (2개 데이터셋: HMDB51, UCF101):**
  - **ZSL 및 GZSL:** HMDB51과 UCF101 모두에서 SOTA 성능을 달성하며, `f-VAEGAN` 및 `CEWGAN`과 같은 기존 방법을 능가합니다.
  - HMDB51 ZSL에서 33.0%, GZSL에서 37.6%를 기록했습니다.

- **Ablation Study:**
  - 피드백 모듈과 판별적 특징 변환 각각이 단독으로도 baseline 대비 일관된 성능 향상을 가져옵니다.
  - 두 기법의 결합은 더욱 큰 성능 향상을 이끌어냅니다.
  - 피드백 모듈의 입력으로 SED의 잠재 임베딩을 사용하고 교대 훈련 전략을 채택하는 것이 최적의 성능을 위한 핵심 요소임을 입증했습니다.

- **일반화 가능성:** 제안된 기법들을 `f-CLSWGAN` 아키텍처에 통합했을 때도 ZSL 및 GZSL 작업 모두에서 성능 향상을 확인했습니다.

- **시각적 분석:**
  - `t-SNE` 시각화는 `TF-VAEGAN`이 클래스 간 그룹화를 개선하여 미세한 차이를 가진 클래스에 대한 혼란을 줄임을 보여줍니다.
  - 특징 역변환을 통한 이미지 시각화는 피드백을 통해 합성된 특징이 baseline보다 실제 이미지에 의미론적으로 더 가깝고 품질이 우수함을 보여줍니다.

## 🧠 Insights & Discussion

- **의미론적 일관성의 중요성:** ZSL/GZSL 파이프라인의 모든 단계(훈련, 특징 합성, 분류)에서 의미론적 일관성을 적극적으로 적용하는 것이 성능 향상에 결정적인 역할을 한다는 점이 핵심 통찰입니다. 기존 방법들이 훈련 단계에만 국한했던 제약을 넘어선 것입니다.
- **상호보완적 정보 활용:** 생성기($G$)는 의미론적 임베딩에서 시각적 특징으로의 매핑을 학습하고, SED($Dec$)는 그 역변환을 학습합니다. 이 두 모듈이 인코딩하는 상호보완적인 정보를 활용함으로써 특징 합성의 품질과 분류의 판별력을 크게 향상시킬 수 있습니다. 특히 미세한 차이를 가진 클래스(fine-grained classes)에서 클래스 간 모호성을 줄이는 데 효과적입니다.
- **반복적 정제의 효과:** 피드백 모듈은 생성기가 SED의 잠재 공간을 통해 자신의 생성된 특징에 대한 의미론적 일관성을 "인지"하게 함으로써, 특징 생성을 반복적으로 정제할 수 있게 합니다. 이는 생성된 특징과 실제 특징 사이의 의미론적 격차를 줄이는 데 기여합니다.
- **판별력 강화:** SED의 잠재 임베딩은 클래스 내 다양성(intra-class diversity)과 클래스 간 분리 가능성(inter-class separability)을 모두 포착합니다. 이를 시각적 특징과 연결함으로써, 분류기가 더욱 판별력 있는 표현을 학습할 수 있게 되어, 시각적으로 유사한 카테고리 간의 구별 능력이 향상됩니다.
- **한계점:** 전반적인 성능 향상에도 불구하고, 일부 어려운 경우(예: 특정 꽃 클래스)에서는 실제 특징의 역변환과 합성된 특징의 역변환 사이에 여전히 의미론적 격차가 존재하여 특징 합성 품질 향상을 위한 추가적인 연구 여지가 있음을 시사합니다.

## 📌 TL;DR

**문제:** 기존 제로샷 학습(ZSL/GZSL) GAN들은 특징을 합성하지만, 합성 및 분류 과정에서 의미론적 일관성을 간과하여 의미론적 격차와 클래스 모호성을 유발합니다.
**방법:** 본 논문은 `f-VAEGAN`을 확장한 **TF-VAEGAN**을 제안합니다. 이 모델은 의미론적 임베딩 디코더(SED)를 훈련, 특징 합성, 분류의 **모든 단계**에 통합하며, SED의 잠재 임베딩으로 생성기를 조절하여 특징을 반복적으로 정제하는 새로운 **피드백 모듈**을 도입합니다. 또한, 분류 시 시각적 특징과 SED의 잠재 임베딩을 결합하여 **판별적 특징**을 생성합니다.
**결과:** TF-VAEGAN은 6개 객체 및 행동 인식 데이터셋에서 최첨단 성능을 달성하며, 모든 단계에서의 의미론적 일관성, 반복적 피드백, 그리고 판별적 특징 변환이 ZSL/GZSL 성능 향상에 핵심적임을 입증합니다.
