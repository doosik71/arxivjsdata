# 파형 기반 ANN-LSTM 네트워크를 이용한 ECG 및 PPG 기반 비침습 혈압 추정

Md. Sayed Tanveer, Md. Kamrul Hasan

## 🧩 Problem to Solve

ECG(심전도) 및 PPG(광혈류측정) 신호에서 혈압(BP)을 추정하기 위해 다양한 특징을 추출하는 것이 어렵다는 문제가 있습니다. 순환계 질환 및 다른 생리적 시스템의 상호작용으로 인한 파형의 형태 변화 때문에 특징 추출이 복잡하고 오류 발생 가능성이 높습니다. 또한, 기존 모델들은 추출된 특징들의 시간 영역 변화를 효과적으로 고려하지 못하여 연속적인 비침습 혈압 측정의 정확도를 저해합니다.

## ✨ Key Contributions

* **계층적 ANN-LSTM 모델 제안:** ECG 및 PPG 파형으로부터 필요한 특징을 자동으로 추출하고 이 특징들의 시간 영역 변화를 학습하는 파형 기반의 계층적 ANN-LSTM 모델을 제안했습니다.
* **자동 특징 추출:** 하위 ANN 계층은 ECG 및 PPG 파형에서 필요한 형태학적 특징을 자동으로 추출하여 수동 특징 엔지니어링의 어려움을 해결했습니다.
* **시간 영역 변화 학습:** 상위 LSTM 계층은 하위 계층에서 추출된 특징들의 시간 영역 변화를 학습하여 혈압 추정의 정확도를 향상시켰습니다.
* **우수한 성능 달성:** 제안된 모델은 기존 특징 공학 기반 네트워크 및 다른 심층 학습 모델에 비해 수축기 혈압(SBP) 및 이완기 혈압(DBP) 추정에서 더 높은 정확도를 보여주었습니다.
* **의료 표준 만족:** 미국 의료기기 협회(AAMI) 및 영국 고혈압 학회(BHS) 표준을 모두 만족하는 성능을 달성했습니다.
* **연속적이고 신뢰성 있는 추정:** 비침습적이고 연속적인 방식으로 혈압을 신뢰성 있게 추정할 수 있음을 입증하여 모바일 헬스케어 기기에서의 활용 가능성을 높였습니다.

## 📎 Related Works

* **PTT (Pulse Transit Time) 기반 방법:** 초기에는 연속 혈압 측정에 유망한 매개변수로 여겨졌으나, PTT 단독으로는 만족스러운 혈압 추정 결과를 얻지 못했습니다 [10], [11].
* **특징 엔지니어링 및 머신러닝:** PPG 신호에서 추출된 형태학적 특징과 PTT를 결합하여 머신러닝 알고리즘으로 혈압을 추정하려는 시도가 있었으며, PTT 단독 모델보다 나은 정확도를 보였습니다 [12], [13], [14].
* **자동 특징 추출 방법:** Kachuee et al. [13]은 PPG 파형 모델링에 시간 영역 접근 방식을, Xing et al. [18]은 주파수 영역 접근 방식을 사용했으나, 특징 엔지니어링 기반 방법 대비 성능 향상이 미미했습니다. 신경망은 복잡한 특징 엔지니어링 없이 필요한 특징을 자동으로 추출할 수 있음이 알려져 있습니다 [19].
* **LSTM 활용:** Su et al. [24]은 수동으로 제작된 특징을 사용하여 심층 LSTM 네트워크가 혈압 추정 정확도를 향상시킬 수 있음을 보여주었습니다. 그러나 본 논문은 특징 추출 자체도 자동으로 수행하는 모델을 제안합니다.

## 🛠️ Methodology

본 논문에서는 ECG 및 PPG 신호로부터 혈압을 추정하기 위한 파형 기반의 계층적 ANN-LSTM 모델을 제안합니다.

1. **데이터 소스:**
    * Physionet의 MIMIC I 데이터베이스에서 39명의 ICU 환자 데이터를 사용했습니다.
    * ECG, PPG 및 ABP(동맥혈압) 신호는 125Hz의 샘플링 주파수로 수집되었습니다.
    * 다양한 연령대와 성별, 호흡 부전, 심부전, 패혈증, 협심증 등 다양한 임상 상태를 가진 환자 데이터가 포함되었습니다.

2. **전처리 (Preprocessing):**
    * **TQWT 필터링:** 기준선 표류(baseline wandering) 및 노이즈 제거를 위해 Tunable-Q 웨이블릿 변환(TQWT) [36]을 사용한 대역통과 필터링을 적용했습니다. TQWT는 파형의 형태를 최대한 보존하면서 노이즈를 효과적으로 제거합니다.
    * **Q 값 선택:** 윈도우된 ECG 또는 PPG 신호의 푸리에 변환을 수행하여 주파수 범위 1.0-3.5 Hz 내의 기본 피크를 식별합니다. 이 피크 주파수와 피크 왼쪽의 국소 최소 주파수를 사용하여 룩업 테이블에서 적절한 Q 값을 선택하여 기본 피크가 감쇠되지 않도록 합니다. 기본 피크가 감지되지 않으면 Q 값 1.08을 사용합니다.
    * **노이즈 제거:** DC 성분과 기준선 표류를 포함하는 잔여 신호를 제거한 후, 소프트 Rigrsure 임계값 처리 [38]를 사용한 웨이블릿 노이즈 제거를 수행하여 고주파 노이즈를 제거합니다.

3. **비균일 파형 분할 (Non-uniform Waveform Segmentation):**
    * 심박수 변동에 따른 바이아스를 피하기 위해, 연속적인 3개의 ECG 또는 PPG 피크(두 주기) 길이로 신호를 분할합니다.
    * 각 분할된 신호는 256개 샘플 길이로 리샘플링됩니다 (제로 패딩은 사용하지 않습니다).
    * 입력 벡터 $x_i$는 리샘플링된 ECG 파형 ($e^w_i(m_i)$), PPG 파형 ($p^w_i(m_i)$) 및 정규화된 세그먼트 길이 ($l_i$)를 연결하여 생성된 513개의 특징으로 구성됩니다.
    * ANN-LSTM 네트워크를 위해 $M$개의 연속적인 특징 벡터 시퀀스 (예: $M=10$ 또는 $M=32$)를 생성합니다. 각 시퀀스는 한 피크씩 오프셋됩니다.

4. **네트워크 구현 (Network Implementation):**
    * **하위 계층:** Time-distributed ANN으로 구성됩니다. 각 ANN은 1개의 은닉층(128개 뉴런, ReLU 활성화 함수)을 가지며, 513개 특징으로 구성된 $x_i$ 벡터에서 필요한 특징을 추출합니다.
    * **상위 계층:** 2개의 스택형 LSTM 레이어로 구성됩니다. 128개의 은닉 상태를 가지며, 하위 계층에서 추출된 특징들의 시간 영역 변화를 학습합니다. 첫 번째 LSTM 레이어는 양방향(bidirectional) [41]으로 구성되어 양방향 시간 변화를 모델링합니다.
    * **훈련:** 각 환자의 데이터를 훈련 70%, 검증 10%, 테스트 20%로 분할했습니다.
    * **하이퍼파라미터:** 배치 크기는 128, 손실 함수는 평균 제곱 오차(MSE), 최적화 도구는 Adam 옵티마이저 [40] (초기 학습률 0.001)를 사용했습니다. 정규화를 위해 경사도의 $l_2$ 노름(norm)을 $M=10$일 때 3, $M=32$일 때 5로 제한했습니다.

## 📊 Results

제안된 모델은 MIMIC I 데이터베이스의 39명의 환자 데이터를 사용하여 평가되었으며, 다음과 같은 결과를 보였습니다.

* **MAE 및 RMSE:**
  * **짧은 시퀀스 ($M=10$):**
    * SBP: MAE $1.10$ mmHg, RMSE $1.56$ mmHg
    * DBP: MAE $0.58$ mmHg, RMSE $0.85$ mmHg
  * **긴 시퀀스 ($M=32$):**
    * SBP: MAE $0.93$ mmHg, RMSE $1.26$ mmHg
    * DBP: MAE $0.52$ mmHg, RMSE $0.73$ mmHg
  * 시퀀스 길이가 길어질수록(M=32) 예측 정확도가 향상되었습니다.

* **다른 모델과의 비교 (Table II):**
  * P-AdaBoost, W-AdaBoost 및 DeepRNN-4L (Su et al. [24])을 포함한 기존의 특징 공학 기반 및 딥러닝 모델들보다 MAE 및 RMSE 측면에서 더 우수한 성능을 달성했습니다.

* **AAMI 표준 평가 (Table III):**
  * 제안된 모델은 SBP와 DBP 추정 모두에서 AAMI 표준(평균 오차(ME) < 5 mmHg, 오차 표준 편차(SDE) < 8 mmHg)을 만족했습니다. 특히, 매우 낮은 ME와 최소 SDE를 기록했습니다.

* **BHS 표준 평가 (Table IV):**
  * SBP 및 DBP 추정 모두에서 Grade A를 획득했습니다. 테스트 샘플의 98% 이상에서 추정 오차가 5 mmHg 미만을 기록했습니다.

* **통계 분석:**
  * **Bland-Altman plot (Fig. 8):** SBP의 동의 한계(LOA)는 $[-3.083, 3.033]$ mmHg, DBP는 $[-1.674, 1.653]$ mmHg로, 95%의 추정 오차가 SBP의 경우 3.1 mmHg, DBP의 경우 1.7 mmHg 미만임을 보여줍니다.
  * **Pearson 상관 계수 (Fig. 9):** SBP는 $r=0.9986$, DBP는 $r=0.9975$로, 지면 진실(ground truth)과 추정된 혈압 간의 매우 높은 선형성을 나타냅니다.
  * **Box plot 분석 (Fig. 9):** 매우 높거나 낮은 SBP 및 DBP 값을 높은 정확도로 추정할 수 있음을 입증했습니다.

* **연속 혈압 측정 (Fig. 10):** 제안된 모델은 기존 특징 공학 기반 모델보다 연속적인 SBP 및 DBP 변화를 더 정확하게 추적할 수 있음을 보여주었습니다.

## 🧠 Insights & Discussion

* **성능 우수성의 근거:** 제안된 모델은 ECG 및 PPG 파형으로부터 특징을 수동으로 추출하는 복잡한 과정 없이, ANN 계층을 통해 필요한 형태학적 특징을 자동으로 학습합니다. 또한, LSTM 계층을 통해 이 특징들의 시간 영역 변화를 효과적으로 모델링하여 혈압 추정의 정확도를 극대화했습니다. 이러한 자동 특징 추출 및 시간 의존성 학습 능력이 기존 특징 엔지니어링 기반 모델 대비 우수한 성능의 핵심 요인으로 분석됩니다.
* **SBP와 DBP 추정 정확도 차이:** SBP 추정의 정확도가 DBP보다 약간 낮은 경향을 보였는데, 이는 데이터베이스에 고립성 수축기 고혈압(ISH) 환자가 포함되어 SBP 데이터의 분산이 DBP에 비해 높았기 때문입니다. 이러한 높은 분산은 모델이 SBP 추정을 학습하기 어렵게 만듭니다.
* **실용적 의의:** 제안된 모델은 비침습적이고 연속적인 방식으로 혈압을 신뢰성 있게 추정할 수 있음을 입증했습니다. 이는 현재 모바일 헬스케어 기기에서 제공되는 연속 혈압 측정 기능을 크게 향상시킬 것으로 기대됩니다.
* **향후 연구:** 본 연구는 MIMIC I 데이터베이스의 39명의 환자 데이터를 사용했으므로, 향후 연구에서는 더 많은 수의 다양한 인구(예: 연령, 질병 상태, 인종 등)를 대상으로 모델의 강건성(robustness)을 조사할 필요가 있습니다.

## 📌 TL;DR

비침습적 혈압(BP) 추정에서 ECG와 PPG 파형의 형태 변화로 인한 특징 추출의 어려움과 시간 영역 변화를 고려하지 못하는 한계를 해결하기 위해, 본 논문은 파형 기반의 계층적 ANN-LSTM 모델을 제안합니다. 이 모델은 하위 ANN 계층에서 ECG 및 PPG 파형으로부터 형태학적 특징을 자동으로 추출하고, 상위 LSTM 계층에서 이 특징들의 시간 변화를 학습합니다. 실험 결과, 제안된 모델은 기존 방법들보다 우수한 MAE 및 RMSE를 달성(SBP MAE 1.10 mmHg, DBP MAE 0.58 mmHg, $M=10$ 기준)했으며, AAMI 및 BHS Grade A 표준을 모두 만족했습니다. 이는 모바일 헬스케어 기기에서의 연속적이고 정확한 비침습 BP 추정에 크게 기여할 것입니다.
