# BP-Net: Efficient Deep Learning for Continuous Arterial Blood Pressure Estimation using Photoplethysmogram

Rishi Vardhan K, Vedanth S, Poojah G, Abhishek K, Nitish Kumar M, Vineeth Vijayaraghavan

## 🧩 Problem to Solve

심혈관 질환(CVD)과 뇌졸중의 주요 바이오마커인 혈압(BP)은 의학적 합병증 예방 및 진단을 위해 지속적으로 모니터링되어야 합니다. 현재 커프리스(cuffless) 방식의 연속 혈압 모니터링은 비침습적이고 방해받지 않는다는 장점이 있지만, 주로 손가락 광혈류측정(PPG) 신호 주변에서 명시적인 특징 공학(feature engineering)이 필요하다는 한계가 있습니다. 이 연구는 PPG 파형을 사용하여 중간 동맥 혈압(ABP) 파형을 통해 수축기 혈압(SBP), 평균 동맥압(MAP), 이완기 혈압(DBP)을 추정하는 효율적인 종단 간(end-to-end) 딥러닝 솔루션을 제시함으로써 이러한 문제를 해결하고자 합니다.

## ✨ Key Contributions

- **종단 간 딥러닝 솔루션 BP-Net 제안**: PPG 파형을 직접 입력으로 받아 ABP 파형을 추정하고, 이를 통해 SBP, MAP, DBP를 도출하는 U-Net 기반의 모델인 BP-Net을 개발했습니다.
- **국제 표준 만족**: DBP 및 MAP 추정에서 영국 고혈압 학회(BHS) 표준 Grade A를, SBP 추정에서 Grade B를 달성했습니다. 또한 DBP 및 MAP 추정에서 의료기기 발전을 위한 협회(AAMI) 기준을 충족했습니다.
- **우수한 예측 정확도**: SBP 추정에서 $5.16 \text{mmHg}$, DBP 추정에서 $2.89 \text{mmHg}$의 평균 절대 오차(MAE)를 달성했습니다.
- **엣지 디바이스 배포 가능성 입증**: Raspberry Pi 4 장치에 BP-Net을 배포하여 PPG 파형을 ABP 파형으로 변환하는 데 $4.25 \text{ms}$의 낮은 추론 시간을 달성함으로써 실시간, 자원 제약 환경에서의 활용 가능성을 입증했습니다.
- **특징 공학 최소화**: 기존 커프리스 방식에서 요구되던 광범위한 특징 공학 단계를 제거하여 모델의 복잡성과 계산 부담을 줄였습니다.

## 📎 Related Works

- **맥파 전파 시간(PTT) 기법**: ECG의 R 피크와 손가락 PPG의 수축기 피크 사이의 시간 간격을 측정하여 BP와 음의 상관관계가 있음을 이용하는 방식입니다. 주로 보정 절차를 통해 BP를 예측합니다.
- **회귀 기법**:
  - **고전적인 머신러닝**: PPG 및 ECG 신호에서 특징을 추출하여 SVM, Random Forest 등으로 SBP, DBP를 추정하는 방식입니다.
  - **딥러닝 기반**: RNN(LSTM), Bi-LSTM 네트워크를 사용하여 장기 혈압 예측 또는 연속 혈압 추정을 시도합니다. ECG 신호 사용 및 광범위한 특징 공학이 요구되는 경우가 많습니다.
  - **원시 PPG 신호 사용**: 일부 연구는 PPG 신호와 그 파생물을 직접 사용하여 SBP, DBP를 추정하지만, 기존 방법에 비해 성능이 좋지 않은 경향이 있습니다.
- **PPG-to-ABP 파형 변환**: ABP와 PPG 파형 간의 유사성에 주목하여, cascaded U-Net (PPG2ABP), 단일 U-Net, 또는 LSTM 네트워크를 사용하여 PPG에서 ABP 파형을 추정하는 시도가 있었습니다. 이러한 방법들은 SBP와 DBP 외에 추가적인 진단 정보를 제공할 수 있습니다.
- **기존 방식의 한계**: 대부분의 접근 방식은 광범위한 특징 공학, 또는 ECG 신호(측정 시 방해됨)를 필요로 하거나, 계산량이 많아 엣지 디바이스 배포에 적합하지 않은 경우가 많습니다.

## 🛠️ Methodology

BP-Net은 PPG 신호 입력을 통해 ABP 파형을 추정하는 신호 대 신호 변환 U-Net 아키텍처입니다.

- **데이터셋**: Physionet의 MIMIC II Waveform 데이터베이스에서 파생된 커프리스 혈압 추정 데이터셋을 사용합니다. 이 데이터셋은 125Hz로 샘플링된 ECG, PPG, ABP 신호를 포함하며, 극단적인 BP 값이나 누락된 데이터는 제외되었습니다.
- **데이터 전처리**:
  - **노이즈 제거**: Discrete Wavelet Decomposition (DWT)을 사용하여 10단계 분해하고, Daubechies 8 (db8) 마더 웨이블릿으로 고주파 및 저주파 성분을 제거합니다.
  - **다운샘플링**: 약 741.53시간의 전처리된 데이터를 10초 길이의 에피소드 데이터 127,260개(약 353.5시간)로 다운샘플링하여 계산 효율성을 높입니다.
  - **정규화**: 입력 PPG 및 출력 ABP 신호는 평균 정규화됩니다.
- **BP-Net 아키텍처 (U-Net 확장)**: 인코더-디코더 네트워크인 U-Net 프레임워크를 기반으로 하며, 다음과 같은 블록들로 구성됩니다.
  1. **Average Ensemble Block**: 입력 신호를 여러 채널로 확장한 후 채널별 평균화를 통해 신호 대 잡음비(SNR)를 개선하여 학습 수렴을 가속화합니다.
  2. **Contraction Block (CB)**: 패딩된 컨볼루션 레이어를 통해 채널 수를 두 배로 늘리고 다운샘플링을 수행합니다. 배치 정규화, Leaky ReLU 활성화 및 스트라이드 컨볼루션 후 Inception-Residual (IR) 블록으로 전달됩니다.
  3. **Expansion Block (EB)**: 패딩된 컨볼루션 레이어를 통해 채널 수를 절반으로 줄이고 업샘플링을 수행합니다. 배치 정규화, Leaky ReLU 활성화 및 스트라이드 전치 컨볼루션 후 IR 블록으로 전달됩니다. 계약 경로의 해당 CB 출력과 연결됩니다.
  4. **Inception-Residual (IR) Block**: 다양한 커널 크기의 컨볼루션 필터를 동시에 사용하여 특징을 추출하고, 채널별 연결을 통해 출력을 생성합니다. 잔차 연결(residual connection)을 포함하여 기울기 소실 문제를 완화합니다.
  5. **Denoising Block**: 아키텍처의 마지막에 위치하여 학습된 업샘플링을 통해 최종 출력을 생성하고, 노이즈가 적은 신호를 출력합니다.
- **자체 지도 사전 학습(Self Supervised Pretraining)**:
  - 모델은 먼저 입력 PPG 파형을 재구성하도록 학습됩니다.
  - 이후 학습된 인코더 가중치를 고정하고, 다른 모델을 훈련하여 PPG 신호로부터 ABP 신호를 재구성하는 작업을 수행하도록 미세 조정합니다. 이를 통해 PPG 신호의 중간 파형 표현을 명시적으로 캡처하는 인코더 부분이 ABP 신호를 추정하도록 효과적으로 학습됩니다.
- **SBP, MAP, DBP 도출**: 예측된 ABP 파형에서 최대값은 SBP, 최소값은 DBP, 평균값은 MAP로 계산됩니다.
- **학습 상세**: Adam 옵티마이저, MAE 손실 함수, 초기 학습률 $0.0001$을 사용합니다. 10-Fold 교차 검증을 수행하며, 각 폴드마다 300 에포크를 학습합니다.

## 📊 Results

- **BHS 표준 평가**:
  - DBP: Grade A (오차 $5 \text{mmHg}$ 미만 $84.34\%$, $10 \text{mmHg}$ 미만 $95.19\%$, $15 \text{mmHg}$ 미만 $98.14\%$)
  - MAP: Grade A (오차 $5 \text{mmHg}$ 미만 $85.64\%$, $10 \text{mmHg}$ 미만 $94.40\%$, $15 \text{mmHg}$ 미만 $97.68\%$)
  - SBP: Grade B (오차 $5 \text{mmHg}$ 미만 $69.21\%$, $10 \text{mmHg}$ 미만 $86.01\%$, $15 \text{mmHg}$ 미만 $92.19\%$)
- **AAMI 표준 평가**:
  - DBP: 평균 오차(ME) $0.594 \text{mmHg}$, 표준 편차(SD) $4.778 \text{mmHg}$ (기준 통과)
  - MAP: ME $0.425 \text{mmHg}$, SD $4.784 \text{mmHg}$ (기준 통과)
  - SBP: ME $-0.225 \text{mmHg}$, SD $8.504 \text{mmHg}$ (SD 기준 미달)
- **평균 절대 오차 (MAE)**:
  - SBP: $5.16 \text{mmHg}$
  - DBP: $2.89 \text{mmHg}$
- **추론 시간 (엣지 디바이스)**: Raspberry Pi 4 Model B에서 10초 분량의 PPG 신호를 ABP 신호로 변환하는 데 $42.53 \text{ms}$ 소요, 이는 1초 분량 당 $4.25 \text{ms}$에 해당합니다.
- **기존 접근 방식과의 비교**: BP-Net은 다른 ABP 추정 접근 방식(Athaya et al., Ibtehaz et al., Harfiya et al.)과 비교하여 유사하거나 경쟁력 있는 MAE 성능을 보이며, 특히 복잡한 특징 공정 없이 단일 PPG 신호만을 사용하여 엣지 디바이스에 배포하기에 적합한 낮은 계산 복잡성을 제공합니다.

## 🧠 Insights & Discussion

- **실시간 연속 혈압 모니터링의 실현 가능성**: BP-Net은 PPG 신호만으로 ABP 파형을 정확하게 추정하고, 이를 기반으로 SBP, MAP, DBP를 도출함으로써 비침습적이고 연속적인 혈압 모니터링에 대한 잠재력을 보여줍니다. 특히 Raspberry Pi 4와 같은 저사양 엣지 디바이스에서 매우 빠른 추론 시간을 달성하여 웨어러블 및 임베디드 의료 애플리케이션에 대한 실용적인 가능성을 열었습니다.
- **SBP 추정의 한계 및 원인**: SBP 추정은 DBP 및 MAP에 비해 BHS 및 AAMI 표준에서 약간의 미달을 보였습니다. 이는 SBP 신호가 DBP 및 MAP에 비해 높은 분산(variance)을 가지기 때문으로, MIMIC 데이터베이스를 다루는 다른 연구에서도 흔히 나타나는 한계입니다. 이는 향후 모델 개선의 중요한 연구 방향이 될 수 있습니다.
- **특징 공학의 부담 경감**: 기존의 커프리스 혈압 추정 방법들이 광범위한 특징 공학이나 ECG 신호를 필요로 했던 것에 비해, BP-Net은 종단 간 딥러닝 접근 방식을 통해 이러한 부담을 크게 줄였습니다. 이는 모델의 구현 복잡성을 낮추고 실제 환경에서의 배포를 용이하게 합니다.
- **연구 비교의 어려움**: 혈압 추정 연구는 다양한 데이터셋, 피험자 수, 평가 기준을 사용하여 비교 분석이 어려운 경우가 많습니다. 본 연구는 MIMIC II 데이터셋을 사용하여 국제 표준(BHS, AAMI)에 따라 결과를 제시함으로써 다른 연구와의 비교 가능성을 높였습니다.
- **향후 개선 방향**: 실험에 사용된 피험자 수를 늘리면 BP-Net의 성능이 더욱 향상될 수 있을 것으로 기대됩니다.

## 📌 TL;DR

이 논문은 PPG 신호를 사용하여 연속적인 동맥 혈압(ABP) 파형을 추정하고, 이를 통해 SBP, MAP, DBP를 도출하는 딥러닝 기반의 **BP-Net**을 제안합니다. 복잡한 특징 공학 없이 U-Net 아키텍처를 확장하여, BHS 표준에서 DBP/MAP는 Grade A, SBP는 Grade B를 달성하고, AAMI 표준도 DBP/MAP에 대해 충족하는 등 **높은 정확도**를 보였습니다. 특히 Raspberry Pi 4에서 $4.25 \text{ms}$의 빠른 추론 시간을 기록하여 **엣지 디바이스 기반의 실시간, 비침습적 혈압 모니터링**에 대한 잠재력을 입증했습니다.
