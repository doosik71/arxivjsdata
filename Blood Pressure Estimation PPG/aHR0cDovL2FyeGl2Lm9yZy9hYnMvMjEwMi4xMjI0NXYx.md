# Estimation of Continuous Blood Pressure from PPG via a Federated Learning Approach

Eoin Brophy, Maarten De Vos, Geraldine Boylan, Tomás Ward

## 🧩 Problem to Solve

이 연구의 주된 목적은 심혈관 질환으로 인한 전 세계 사망률 증가 문제를 해결하는 데 기여하는 것입니다. 기존의 혈압 측정 방식(수은 혈압계, 동맥 카테터 등)은 침습적이거나, 연속 측정이 어렵거나, 비용이 많이 든다는 한계가 있습니다. 특히, 광혈류측정(PPG) 센서 하나만으로 비침습적이고 연속적인 동맥 혈압(ABP)을 추정하는 것은 여전히 어려운 문제입니다. 또한, 환자 데이터의 프라이버스를 보호하면서 대규모 분산 학습 환경에서 이러한 모델을 개발하는 것도 중요한 과제입니다.

## ✨ Key Contributions

- **T2T-GAN(Time series-to-Time series Generative Adversarial Network) 개발**: 단일 PPG 신호로부터 고품질의 연속적인 ABP 파형을 생성하는 새로운 GAN 기반 프레임워크를 제시했습니다. 이는 시계열-대-시계열 변환을 위한 CycleGAN의 개념을 활용합니다.
- **연속 ABP 생성 GAN의 첫 구현**: PPG 입력 신호로부터 연속적인 ABP를 생성할 수 있는 GAN 프레임워크를 구현한 최초의 사례입니다.
- **페더레이티드 러닝(Federated Learning) 적용**: 환자 데이터 프라이버스를 침해하지 않고 분산된 데이터 소스에서 모델을 훈련하기 위해 페더레이티드 러닝 방식을 채택했습니다. 이는 대규모 실제 환경 구현 가능성을 보여줍니다.
- **실제 데이터셋에서의 일반화 능력 입증**: 훈련에 사용되지 않은, 잡음이 많고 독립적인 데이터셋(마취 환자 데이터)에 대해 모델의 일반화 능력을 평가했습니다.
- **양방향 시계열 변환 가능성**: PPG에서 ABP뿐만 아니라 ABP에서 PPG로의 변환도 가능함을 시사하여, 두 생리적 시계열 파형 간의 추론 능력을 보여줍니다.

## 📎 Related Works

- **PTT(Pulse Transit Time) 기반 혈압 추정**: ECG 및 PPG에서 추출한 PTT를 사용하여 혈압을 추정하는 초기 연구들($[2, 3, 5, 6]$). 도메인 전문 지식을 요구하는 특징 기반 방식이었습니다.
- **기계 학습 기반 혈압 추정**: 신호 처리 전문가 의존성을 줄이고 특징 추출 과정을 자동화하려는 노력으로, 스펙트로-시간(spectro-temporal) 심층 신경망(DNN)($[7]$), 순환 신경망(RNN)($[8]$), 통계적 특징 추출 및 회귀 모델($[9]$) 등이 사용되었습니다.
- **연속 혈압 파형 예측**: Ibtehaz와 Rahman의 PPG2ABP($[12]$)는 인코더-디코더 U-Net 모델을 사용하여 PPG에서 연속적인 BP 파형을 예측하는 방법을 제시했습니다. 본 연구는 이 모델을 기반으로 GAN을 통해 연속 혈압 파형을 생성합니다.
- **GAN을 이용한 생체 신호 변환**: Sarkar와 Etemad의 CardioGAN($[14]$)은 PPG 신호로부터 ECG 신호를 생성하는 적대적 학습 방법을 사용했습니다. 본 연구는 PPG와 ABP 간의 변환으로 확장합니다.
- **페더레이티드 러닝**: Google AI Blog($[15]$)에서 처음 소개된 분산 학습 방식으로, 중앙 서버에 데이터를 저장하지 않고도 여러 기기에서 협력적으로 모델을 학습합니다. Rasouli 등($[16]$)은 이미지 및 에너지 데이터에 대한 페더레이티드 GAN 훈련을 구현한 바 있습니다.

## 🛠️ Methodology

이 연구에서는 PPG 신호로부터 연속적인 ABP 신호를 생성하기 위해 T2T-GAN(Time series-to-Time series Generative Adversarial Network) 프레임워크를 사용했으며, 데이터 프라이버스를 위해 페더레이티드 러닝(Federated Learning) 방식을 적용했습니다.

1. **모델 아키텍처**:
   - **T2T-GAN**: 비쌍 이미지-대-이미지 변환에 사용되는 CycleGAN($[17]$)을 시계열 데이터에 맞게 변형하여, 시계열 간의 복잡한 관계를 포착하고 PPG를 ABP로, ABP를 PPG로 변환합니다. Cycle-consistency Loss를 사용하여 변환의 일관성을 유지합니다.
   - **생성자($G_{PA}$, $G_{AP}$)**: PPG를 ABP로($G_{PA}$), ABP를 PPG로($G_{AP}$) 변환하는 역할을 합니다. 각 생성자는 2개 층의 스택형 LSTM(Long Short-Term Memory)으로 구성되며, 각 층에 50개의 은닉 유닛과 출력에 완전 연결 층을 가집니다. 입력 크기는 1000입니다.
   - **판별자($D_A$, $D_P$)**: 생성된 ABP 및 PPG 파형이 실제와 얼마나 유사한지 판별합니다. 각 판별자는 4개 층의 1차원 CNN(Convolutional Neural Network)으로 구성되며, ReLU 활성화 함수와 Max Pooling을 사용하고, 출력에 Sigmoid 활성화 함수가 있는 완전 연결 층을 가집니다.
2. **데이터셋**:
   - **훈련/검증 데이터셋**: "Cuff-Less Blood Pressure Estimation" 데이터셋($[18, 19]$) (PhysioNet($[20]$)에서 유래)의 ECG, PPG, ABP 신호를 사용했습니다. 125 Hz로 샘플링된 이 데이터셋을 8초 간격으로 분할하여 144,000개의 훈련 샘플과 55,000개의 검증 샘플을 생성했습니다.
   - **테스트 데이터셋**: "University of Queensland vital signs dataset"($[21]$)에서 마취 환자 데이터 중 1명의 환자(Case 5)의 ABP 및 PPG 측정값(100 Hz 샘플링)을 사용했습니다. 10초 간격으로 분할하여 900개의 샘플을 생성했으며, 이 데이터셋은 훈련 데이터셋과 완전히 독립적이고 이전에 보지 못한 데이터입니다.
3. **페더레이티드 러닝 구현**:
   - 총 $N=20$개의 클라이언트 GAN 모델을 구성하고, 훈련 데이터셋을 $N$개의 동일한 크기의 무작위 부분집합으로 나눕니다.
   - 각 클라이언트 GAN은 할당된 데이터로 $e=5$ 에포크 동안 로컬 훈련을 수행합니다.
   - 훈련 후, 클라이언트 모델은 가중치를 중앙 글로벌 GAN으로 보냅니다.
   - 글로벌 GAN은 수신된 가중치들을 집계하여 업데이트된 글로벌 모델을 형성하고, 이 가중치를 다시 클라이언트 GAN에 전달합니다.
   - 총 10번의 통신 라운드를 수행했으며, 각 라운드에서 6개의 무작위 클라이언트가 선택되어 훈련에 참여합니다.
4. **훈련**: 배치 크기는 32로 설정되었습니다. 전체 손실 함수는 다음과 같습니다.
   $$L(G_{PA}, G_{AP}, D_P, D_A) = L_{T2T-GAN}(G_{PA}, D_A, PPG, ABP) + L_{T2T-GAN}(G_{AP}, D_P, ABP, PPG) + \lambda_c L_{cyc}(G_{PA}, G_{AP}) + \lambda_i L_{identity}(G_{PA}, G_{AP})$$
   여기서 $L_{T2T-GAN}$은 MSE(Mean Squared Error) 손실이고, $L_{cyc}$와 $L_{identity}$는 L1-norm입니다. $\lambda_c$는 10, $\lambda_i$는 5로 설정되었습니다.
5. **평가**:
   - **MAP(Mean Arterial Pressure) 추정**: 생성된 ABP 신호에서 수축기 혈압(SBP)과 이완기 혈압(DBP)을 추출한 후, 공식 $MAP = [SBP + (2 \times DBP)] / 3$을 사용하여 MAP을 계산하고 실제 MAP과 비교합니다.
   - **AAMI(Association for the Advancement of Medical Instrumentation) 표준**: AAMI 표준은 혈압 측정 방법의 평균 오차($\mu$)가 5 mmHg 미만이고 표준 편차($\sigma$)가 8 mmHg 미만이어야 한다고 요구합니다.
   - **Bland-Altman(BA) 플롯**: 생성된 ABP가 실제 ABP를 얼마나 잘 대체하는지 시각적으로 평가합니다.
   - **캘리브레이션(Calibration)**: 테스트 데이터셋의 첫 1분 동안 캘리브레이션을 수행하여 사용자 편향을 제거하고 정확도를 높였습니다.
   - **시계열 유사성 측정**: DTW(Dynamic Time Warping), RMSE(Root Mean Squared Error), PCC(Pearson Correlation Coefficient)를 사용하여 실제 및 생성된 ABP 시계열 간의 구조적 유사성을 정량적으로 평가했습니다.

## 📊 Results

- **정성적 평가**: 그림 5에서 볼 수 있듯이, 페더레이티드 T2T-GAN 프레임워크는 단일 PPG 신호로부터 ABP를 성공적으로 모델링하여 시각적으로 만족스러운 결과를 보여주었습니다. 생성된 ABP 파형은 실제 ABP 파형과 유사한 형태를 가집니다.
- **MAP 오차 및 AAMI 표준 비교**:
  - 캘리브레이션 전: 평균 MAP 오차는 $-4.23 \text{ mmHg}$였고, 표준 편차는 $23.7 \text{ mmHg}$였습니다. (그림 6 좌측)
  - 1분 캘리브레이션 후: 평균 MAP 오차는 $2.54 \text{ mmHg}$로 AAMI 표준($5 \text{ mmHg}$) 이내로 감소했지만, 표준 편차는 $23.7 \text{ mmHg}$로 AAMI 표준($8 \text{ mmHg}$)을 충족하지 못했습니다. (그림 6 우측)
  - 캘리브레이션은 평균 오차의 편향을 줄이는 데 효과적이었습니다.
- **시계열 유사성 지표(DTW, RMSE, PCC)**:
  - 표 1에 제시된 바와 같이, 페더레이티드 방식은 비페더레이티드 방식에 비해 시계열 유사성 지표에서 약간의 성능 저하를 보였습니다 (예: 테스트 데이터셋에서 DTW 56.73 vs 62.55, RMSE 0.19 vs 0.24, PCC -0.11 vs -0.22).
  - 그러나 두 방식 모두 검증 데이터셋과 테스트 데이터셋에서 유사한 성능을 보였으며, 이는 모델이 이전에 보지 못한 데이터에 대해 일반화 능력을 가짐을 시사합니다.

## 🧠 Insights & Discussion

- **실세계 적용 가능성 및 프라이버시 보호**: 이 연구는 PPG 센서 하나만으로 연속 ABP를 생성하는 새로운 분산 학습 프레임워크를 제시함으로써, 환자 프라이버스를 보호하면서 대규모로 연속 ABP를 모니터링할 수 있는 기반을 마련했습니다. 이는 저비용 웨어러블 장치의 상품화와 임상의가 환자의 심혈관 상태를 원격으로 정확하게 모니터링할 수 있는 가능성을 열어줍니다.
- **AAMI 표준 미달의 원인 분석**: 평균 오차는 캘리브레이션을 통해 AAMI 표준을 충족했지만, 표준 편차는 여전히 높게 나타났습니다. 이는 훈련 데이터셋(ICU 환자)과 완전히 독립적이고 잡음이 많으며 심혈관 변수에 현저한 변화가 있는 마취 환자 테스트 데이터셋의 '실제성' 때문으로 분석됩니다. 즉, 데이터셋 간의 차이가 모델의 일반화에 영향을 미쳤을 가능성이 큽니다.
- **향후 연구 방향**: 데이터셋 전처리 및 정제 작업을 추가한다면 더 개선된 결과를 얻을 수 있을 것으로 예상됩니다. 현재 연구는 잡음이 많은 실제 데이터를 그대로 사용하여 현실적인 시나리오를 반영하는 데 중점을 두었습니다.
- **제한 사항**: AAMI 표준을 완전히 충족하지 못했으며, 이는 모델의 임상적 활용을 위한 추가 개선이 필요함을 의미합니다. 또한, 사용된 테스트 데이터셋이 단일 환자로부터 얻어졌다는 점도 일반화에 대한 심층적인 분석을 제한할 수 있습니다.

## 📌 TL;DR

이 논문은 비침습적이고 연속적인 혈압 측정을 위한 **페더레이티드 학습(Federated Learning) 기반의 T2T-GAN(Time series-to-Time series Generative Adversarial Network)** 프레임워크를 제안합니다. 이 프레임워크는 단일 **PPG(Photoplethysmogram) 신호**로부터 **연속적인 ABP(Arterial Blood Pressure) 파형**을 생성하며, 이는 환자 데이터 프라이버스를 보호하면서 대규모 실세계 환경에서의 적용 가능성을 높입니다. 훈련되지 않은 잡음이 많은 독립적인 테스트 데이터셋(마취 환자)에 대해 **MAP(Mean Arterial Pressure) 추정에서 평균 오차 $2.54 \text{ mmHg}$**를 달성했지만, 표준 편차는 AAMI 표준을 충족하지 못했습니다. 이는 훈련/테스트 데이터셋 간의 환자 특성 차이 때문으로 분석되며, 저비용 웨어러블 기기를 통한 심혈관 모니터링의 길을 열었습니다.
