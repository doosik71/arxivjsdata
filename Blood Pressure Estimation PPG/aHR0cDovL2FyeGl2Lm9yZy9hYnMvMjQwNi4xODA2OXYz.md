# 웨어러블 생체 신호 기반 커프리스 혈압 측정에 대규모 언어 모델 활용

Zengding Liu, Chen Chen, Jiannong Cao, Minglei Pan, Jikui Liu, Nan Li, Fen Miao, Ye Li

## 🧩 해결하려는 문제

전통적인 커프 기반 혈압(BP) 측정은 불편함과 간헐적인 측정의 한계가 있습니다. 웨어러블 생체 신호(예: ECG, PPG)를 이용한 커프리스 BP 측정 기술은 이러한 한계를 극복하며 편리하고 지속적인 모니터링을 제공하지만, 기존의 기계론적 또는 데이터 기반 모델들은 생체 신호와 BP 값 사이의 복잡한 상관관계 및 상호작용을 완전히 탐색하지 못해 정확도 향상이 필요합니다. 대규모 언어 모델(LLM)이 다양한 텍스트 작업에서 뛰어난 성능을 보였음에도 불구하고, 웨어러블 생체 신호 분석을 통한 커프리스 BP 측정에 LLM을 활용하는 연구는 아직 미흡합니다.

## ✨ 주요 기여

- **프롬프트 설계 전략 제안:** BP 도메인 지식을 활용하여 LLM의 커프리스 BP 측정 정확도를 높이는 프롬프트 템플릿을 설계했습니다.
- **종합적인 LLM 평가:** 10가지 최첨단 LLM을 대규모 웨어러블 데이터셋(1,272명)에서 광범위하게 평가하여 LLM의 커프리스 BP 추정 잠재력을 입증했습니다.
- **오픈 소스 LLM 공개:** 커프리스 BP 측정을 위해 특별히 미세 조정된 최초의 오픈 소스 LLM인 CBPM-LLaMA (LLaMA3-8B 기반)를 공개했습니다.

## 📎 관련 연구

- **커프리스 혈압 측정:**
  - **기계론적 방법:** Pulse Transit Time (PTT) 기반 모델이 주류를 이루며, ECG와 PPG 신호 간의 시간 지연을 측정하여 BP를 추정합니다. Moens-Korteweg 및 Hughes 방정식을 기반으로 BP와 PTT의 역관계가 존재한다는 이론을 따릅니다. (예: Poon et al. [10], Ding et al. [11], Liu et al. [12])
  - **데이터 기반 방법:**
    - **특징 기반 머신러닝:** 생체 신호에서 BP 관련 특징을 추출하고, 머신러닝 기술(선형 회귀, 랜덤 포레스트, ANN 등)을 사용하여 BP 값에 매핑합니다. (예: Haddad et al. [13], Yang et al. [14])
    - **엔드-투-엔드 딥러닝:** 원시 생체 신호 파형에서 직접 BP를 추정하여 수동 특징 추출의 필요성을 없앱니다. (예: Zabihi et al. [15], Kim et al. [16])
- **시계열 데이터를 이용한 건강 관련 LLM:**
  - **시계열 데이터 처리 방식:**
    - 숫자 입력 및 출력을 직접 프롬프트로 변환 (예: PromptCast [17]).
    - 시계열 데이터를 교차-모달리티 적응을 통해 텍스트 표현으로 재구성 (예: Time-LLM [18], TEST [19]). 주로 시계열 예측에 초점을 맞춥니다.
  - **건강 관련 LLM 맞춤화:** 대부분 텍스트 모달리티 작업(건강 질문 답변, 보고서 생성)에 집중합니다. (예: MedAlpaca-7B [21], PalmyraMed-20B [22], PMCLLaMA-13B [32])
  - **생체 신호 통합 연구 부족:** Health-Learner [6]와 Health-LLM [7]이 생체 시계열 데이터 분석에 LLM을 활용했으나, 커프리스 BP 추정에는 적용된 바가 없습니다.

## 🛠️ 방법론

이 연구는 웨어러블 생체 신호(ECG 및 PPG)에서 추출된 생리학적 특징을 LLM에 통합하여 커프리스 BP를 추정하는 프레임워크를 제안합니다.

1. **신호 특징 추출 (Signal Feature Extraction):**
   - ECG, PPG, VPPG (PPG의 1차 미분), APPG (PPG의 2차 미분) 신호에서 **31가지 생리학적 특징**을 추출합니다.
   - 이 특징들은 심박출량, 말초 저항, 동맥 경직도와 관련된 범주로 분류됩니다.
   - 각 심박(beat-by-beat) 단위로 특징을 추출한 후 평균을 사용합니다.
2. **프롬프트 설계 및 지시어 튜닝 (Prompt Design and Instruction Tuning):**
   - **단계별 상황 강화 프롬프트 (Stepwise Context-Enhanced Prompts) 설계:**
     - **기본 프롬프트 (Basic Prompt):** 추출된 신호 특징 값(숫자 데이터)만을 텍스트 형식으로 임베딩합니다.
     - **BP 도메인 지식 포함 (With BP Domain Knowledge):** 평균 동맥압(MAP)은 심박출량과 말초 저항에, 맥압(PP)은 동맥 경직도에 주로 영향을 받는다는 BP 도메인 지식을 프롬프트에 추가합니다. 특징들을 유형-값(type-value) 형식으로 임베딩하여 MAP와 PP를 추정하도록 모델을 튜닝합니다. 최종 SBP와 DBP는 추정된 MAP와 PP를 통해 계산됩니다 ($SBP = MAP + \frac{2}{3}PP$, $DBP = MAP - \frac{1}{3}PP$).
     - **BP 도메인 지식 및 사용자 정보 포함 (With BP Domain Knowledge and User Information):** **나이, 성별, 키, 몸무게, 고혈압 이력**과 같은 사용자별 요소를 프롬프트에 추가하여 BP 추정 정확도를 더욱 높입니다.
   - **지시어 튜닝 (Instruction Tuning):** 명시적인 지침을 통해 LLM을 미세 조정하여 생리학적 특징, 메커니즘, 문맥을 깊이 이해하고 정확한 응답을 생성하도록 합니다.
3. **모델 (Models):**
   - **LLM 기반 모델:** Gemma-7B, Mistral-7B, Yi-6B, MedAlpaca-7B, LLaMA2-7B, LLaMA3-8B, Qwen2-7B, PalmyraMed-20B, PMCLLaMA-13B, OpenBioLLM-8B 등 10가지 오픈 소스 LLM을 실험에 사용합니다.
   - **기준 모델 (Baseline Models):** AdaBoost, Decision Tree Regressor (DTR)와 같은 전통적인 머신러닝 모델, 그리고 초기 보정 값으로 BP를 추정하는 Zero-baseline을 비교 대상으로 사용합니다.
4. **보정 (Calibration):** 보정 기반 BP 추정 방식을 따르며, 개인의 기준 BP(Basal BP)를 사용하여 모델 출력을 보정합니다.
   - $SBP_{cal} = SBP_{free} \cdot \alpha + BaseSBP \cdot (1 - \alpha)$
   - $DBP_{cal} = DBP_{free} \cdot \alpha + BaseDBP \cdot (1 - \alpha)$
   - 여기서 $\alpha$는 0.3으로 설정된 실험적으로 결정된 파라미터입니다.

## 📊 결과

- **LLM 성능 우수성:** 미세 조정된 LLM들은 대부분 AdaBoost 및 DTR과 같은 기존 베이스라인 모델보다 우수한 성능을 보였습니다.
  - **최고 성능:** LLaMA3-8B는 수축기 혈압(SBP) 추정에서 가장 우수했으며, Qwen2-7B는 이완기 혈압(DBP) 추정에서 가장 우수했습니다.
  - **정량적 결과 (최적 LLM):**
    - **SBP 추정 (LLaMA3-8B):** 평균 오류(ME) $\pm$ 표준 편차(SDE) = $0.00 \pm 9.25$ mmHg, 평균 절대 오차(MAE) = $7.08$ mmHg.
    - **DBP 추정 (Qwen2-7B):** ME $\pm$ SDE = $1.29 \pm 6.37$ mmHg, MAE = $5.19$ mmHg.
  - **베이스라인 대비 개선:** LLaMA3-8B는 SBP 추정에서 AdaBoost 대비 ME $\pm$ SDE를 $1.39 \pm 9.55$ mmHg에서 $0.00 \pm 9.25$ mmHg로 감소시켰습니다. Qwen2-7B는 DBP 추정에서 ME $\pm$ SDE를 $1.62 \pm 7.04$ mmHg에서 $1.29 \pm 6.37$ mmHg로 감소시켰습니다.
- **프롬프트 문맥 강화의 중요성 (Ablation Study):**
  - BP 도메인 지식 추가 시 SBP MAE 및 SDE가 각각 1.03%, 2.0% 감소했습니다.
  - BP 도메인 지식과 사용자 정보까지 포함하자 SBP MAE 및 SDE가 각각 8.90%, 7.31% 감소하여 가장 큰 개선을 보였습니다.
- **학습 데이터 크기의 영향:**
  - 원래 데이터셋의 30%만으로도 미세 조정된 LLM(LLaMA3-8B)은 80% 데이터로 학습된 AdaBoost 베이스라인보다 우수한 성능을 보였습니다.
  - 학습 데이터가 많을수록 성능이 향상되는 경향을 보였습니다.
- **보정 파라미터 $\alpha$의 효과:** 대부분의 모델에서 $\alpha = 0.3$일 때 가장 낮은 MAE를 달성했습니다.

## 🧠 통찰 및 논의

- **LLM의 잠재력:** LLM이 웨어러블 생체 신호 기반 커프리스 BP 추정이라는 새로운 영역에서 효과적으로 활용될 수 있음을 입증했습니다. 특히, 지시어 튜닝을 통해 복잡한 생체 신호-BP 관계를 포착하는 능력을 보여주었습니다.
- **문맥 정보의 중요성:** BP 도메인 지식과 사용자 정보(나이, 성별 등)를 프롬프트에 통합하는 것이 LLM의 BP 추정 정확도를 크게 향상시킨다는 점을 확인했습니다. 이는 LLM이 자체의 대규모 지식 기반을 효율적으로 활용하고 관련 정보를 파악하는 데 도움이 됩니다.
- **데이터 효율성:** 비교적 적은 양의 학습 데이터(원래 데이터셋의 30%)만으로도 베이스라인 모델을 능가하는 성능을 달성할 수 있음을 보여주어, 데이터 및 컴퓨팅 자원이 제한적인 환경에서도 LLM 기반 접근법이 유망함을 시사합니다.
- **한계 및 향후 연구:**
  - 단일 웨어러블 데이터셋에 대한 평가라는 한계가 있습니다. 향후에는 다양한 데이터셋에서 LLM의 성능을 평가할 계획입니다.
  - 수동으로 추출된 특징을 LLM의 입력으로 사용했습니다. 앞으로는 원시 신호 파형에서 직접 BP를 추정하는 LLM의 잠재력을 탐색할 것입니다.
  - LLM의 의사결정 과정을 조사하여 BP 추정의 해석 가능성을 높이는 연구가 필요합니다.

## 📌 TL;DR

이 연구는 웨어러블 생체 신호(ECG, PPG)를 이용한 커프리스 혈압(BP) 측정에 대규모 언어 모델(LLM)을 최초로 적용했습니다. ECG와 PPG에서 추출한 생리학적 특징과 BP 도메인 지식, 사용자 정보를 결합하여 문맥이 강화된 프롬프트 템플릿을 설계하고, 이를 통해 10가지 LLM을 지시어 튜닝했습니다. 그 결과, 최적으로 미세 조정된 LLM(LLaMA3-8B, Qwen2-7B)이 기존 베이스라인 모델들을 뛰어넘는 정확도를 보였으며, 특히 SBP 추정에서 **0.00 $\pm$ 9.25 mmHg**, DBP 추정에서 **1.29 $\pm$ 6.37 mmHg**의 오차를 달성했습니다. 프롬프트에 BP 도메인 지식과 사용자 정보를 추가하는 전략이 BP 추정 정확도를 크게 향상시킴을 입증하여, 커프리스 BP 측정의 정확도 향상을 위한 LLM의 가능성을 제시했습니다.
